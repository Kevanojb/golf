import{r as he,c as rr,R as ue,j as e}from"./index-Cwu3uirz.js";const vr={BASE_URL:"/golf/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:`eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1xa25haGRmcHF4cnBncHhxdHVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI0NTU3MDYsImV4cCI6MjA3ODAzMTcwNn0.GTUVsrRJ-MClMg96vuHZpUtAnUFtCsJvuLiiE0D-fCc
`,VITE_SUPABASE_URL:`https://mqknahdfpqxrpgpxqtus.supabase.co
`},Hr=["kevanojb@icloud.com"];let Ra="",Oa="";const sr=(s,a=0)=>{const r=Number(s);return Number.isFinite(r)?r:a};typeof window<"u"&&(window.supabase=window.supabase||{},window.supabase.createClient=window.supabase.createClient||rr);function Mr(s){return Number.isFinite(s)?s<=-2?"bg-emerald-100 text-emerald-900 border border-emerald-200":s===-1?"bg-emerald-50 text-emerald-900 border border-emerald-200":s===0?"bg-slate-50 text-slate-900 border border-slate-200":s===1?"bg-amber-50 text-amber-900 border border-amber-200":s===2?"bg-orange-50 text-orange-900 border border-orange-200":"bg-rose-50 text-rose-900 border border-rose-200":""}function Er(s){return Number.isFinite(s)?s<=-2?"Eagle+":s===-1?"Birdie":s===0?"Par":s===1?"Bogey":s===2?"Double":"Triple+":""}function Ir(s){const a=Number(s);return Number.isFinite(a)?a>=4?"bg-emerald-100 text-emerald-900 border border-emerald-200":a===3?"bg-emerald-50 text-emerald-900 border border-emerald-200":a===2?"bg-slate-50 text-slate-900 border border-slate-200":a===1?"bg-amber-50 text-amber-900 border border-amber-200":"bg-rose-50 text-rose-900 border border-rose-200":""}function Dr(){try{return(typeof import.meta<"u"&&vr?"/golf/":"/").replace(/^\/+/,"").split("/")[0]||""}catch{return""}}function $r(){try{if(typeof window>"u")return"";const s=Dr(),a=String(window.location.pathname||"").split("?")[0].split("#")[0].split("/").filter(Boolean);if(!a.length)return"";if(s){const r=a.indexOf(s);if(r>=0&&a[r+1])return decodeURIComponent(a[r+1])}return decodeURIComponent(a[0]||"")}catch{return""}}var rs=function(s,a){if(a===void 0&&(a=NaN),s==null)return a;if(typeof s=="string"){var r=s.trim();if(!r||r==="‚Äî"||r==="-")return a;s=r}var u=Number(s);return Number.isFinite(u)?u:a},ia=function(s){var a=s&&(s.parsPerHole||s.parPerHole||s.parsArr||s.pars||s.parHoles||s.par)||null,r=s&&(s.siPerHole||s.strokeIndexPerHole||s.siArr||s.si||s.strokeIndex)||null,u=Array.isArray(a)?a.map(Number):null,d=Array.isArray(r)?r.map(Number):null;return{pArr:u,sArr:d}};function lr(s,a,r){const u=r||{},d=!!u.pickupAsZero,A=u.max===void 0?1/0:u.max,x=u.min===void 0?-1/0:u.min,g=u.intMode!==!1,c=new Array(18).fill(NaN);if(!s||a===void 0||a===null)return c;for(let o=0;o<18;o++){const m=a+o+(o>=9?1:0),M=m<s.length?s[m]:"";let n=String(M??"").trim();if(n===""||n==="‚Äî"||n==="-"){c[o]=NaN;continue}if(n==="P"||n==="p"||n==="\\"||n==="/"){c[o]=d?0:NaN;continue}const l=n.replace(/[^0-9.\-]/g,"");let f=g?parseInt(l,10):parseFloat(l);if(!Number.isFinite(f)){c[o]=NaN;continue}if(f<x||f>A){c[o]=NaN;continue}c[o]=f}return c}function ca(s){try{const a=Array.isArray(s)?s:[];if(!a.length)return 18;for(const r of a){const u=Array.isArray(r==null?void 0:r.perHole)?r.perHole:null,d=Array.isArray(r==null?void 0:r.grossPerHole)?r.grossPerHole:null;for(let A=9;A<18;A++){const x=u?Number(u[A]):NaN,g=d?Number(d[A]):NaN;if(Number.isFinite(x)||Number.isFinite(g))return 18}}return 9}catch{return 18}}function ur(s){const a=Array.isArray(s)?s:[],r=[];for(let o=0;o<a.length;o++){const m=Number(a[o]);Number.isFinite(m)&&r.push(m)}if(r.length<6)return NaN;const u=Math.min(10,r.length),d=r.slice(-u),A=(u-1)/2,x=d.reduce((o,m)=>o+m,0)/u;let g=0,c=0;for(let o=0;o<u;o++){const m=o-A;g+=m*(d[o]-x),c+=m*m}return c?g/c:NaN}function hr(s){const a=Array.isArray(s)?s.slice():[],r=typeof window<"u"&&window.__dslUiState?window.__dslUiState:{},u=r&&r.seasonYear?String(r.seasonYear):"All",d=r&&r.seasonLimit?String(r.seasonLimit):"All";let x=a.filter(Boolean).slice().sort((g,c)=>{const o=Number.isFinite(Number(g==null?void 0:g.dateMs))?Number(g.dateMs):Number((g==null?void 0:g.idx)||0),m=Number.isFinite(Number(c==null?void 0:c.dateMs))?Number(c.dateMs):Number((c==null?void 0:c.idx)||0);return o-m});if(u&&u.toLowerCase()!=="all"){const g=o=>{const m=String(o??"").trim(),M=m.match(/^(\d{4})-(\d{2})$/);if(M){const n=M[1],l=String(Number(n.slice(0,2)+M[2]));return`${n}-${l}`}return m},c=g(u);x=x.filter(o=>{var n;const m=(o&&(o.seasonId??o.season_id))??(o&&o.parsed&&(o.parsed.seasonId??o.parsed.season_id))??(o&&o.meta&&(o.meta.seasonId??o.meta.season_id));if(m!=null&&String(m).trim()!=="")return g(m)===c;const M=Number.isFinite(Number(o==null?void 0:o.dateMs))?Number(o.dateMs):Number.isFinite(Number((n=o==null?void 0:o.parsed)==null?void 0:n.dateMs))?Number(o.parsed.dateMs):o!=null&&o.date?_coerceDateMs(o.date):NaN;if(Number.isFinite(M))try{const l=typeof window<"u"&&window.__dslSeasonsDef?window.__dslSeasonsDef:[],f=seasonIdForDateMs(M,l);if(f!=null&&String(f).trim()!=="")return g(f)===c}catch{}return!1})}if(d&&d.toLowerCase()!=="all"){const g=Number(d);Number.isFinite(g)&&g>0&&(x=x.slice(-g))}return x}if(typeof window<"u"&&typeof window._bestWorstSentences<"u"&&typeof window._bestWorstSentences!="function"){const s=window._bestWorstSentences;window._bestWorstSentences=()=>Array.isArray(s)?s:s?[s]:[]}const Lr=[20,17,15,13,11,9,8,7,6,5,4,3,2,1],xa=(s,a,r)=>Math.max(a,Math.min(r,s)),Ya=s=>Math.round((Number(s)||0)*10)/10;function os(s){return String(s||"").replace(/\u00A0/g," ").replace(/\s+/g," ").trim().toLowerCase()}function xr(s){const a=os(s).split(" ").filter(Boolean);return a.length?a[a.length-1]:""}function Va(s,a){if(s=os(s),a=os(a),s===a)return 0;const r=s.length,u=a.length;if(!r)return u;if(!u)return r;const d=new Array(u+1);for(let A=0;A<=u;A++)d[A]=A;for(let A=1;A<=r;A++){let x=d[0];d[0]=A;for(let g=1;g<=u;g++){const c=d[g],o=s[A-1]===a[g-1]?0:1;d[g]=Math.min(d[g]+1,d[g-1]+1,x+o),x=c}}return d[u]}function br(s,a){const r=os(s),u=os(a);if(!r||!u)return!1;if(r===u||r.includes(u)||u.includes(r))return!0;const d=xr(r),A=xr(u),x=Va(r,u),g=Math.max(r.length,u.length);return d&&A&&d===A?x<=(g<=10?2:3):x<=(g<=8?1:2)}function zt(s){try{const a=document.createElement("div");a.className="fixed bottom-4 right-4 left-4 md:left-auto md:right-4 px-3 py-2 rounded-lg bg-black text-white text-sm shadow z-50 text-center",a.textContent=s,document.body.appendChild(a),setTimeout(()=>{a.style.opacity="0",a.style.transition="opacity .2s",setTimeout(()=>a.remove(),220)},1400)}catch{}}function Tr({open:s,onClose:a,onSubmit:r,busy:u}){const[d,A]=he.useState(""),[x,g]=he.useState(""),[c,o]=he.useState("");if(he.useEffect(()=>{s||(A(""),g(""),o(""))},[s]),!s)return null;const m=async M=>{M.preventDefault(),o("");const n=(d||"").trim();if(!n||!x){o("Enter email + password.");return}try{await r(n,x)}catch(l){o((l==null?void 0:l.message)||String(l))}};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:a}),e.jsxs("div",{className:"relative w-full max-w-md glass-card p-4 sm:p-5",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-extrabold text-squab-900",children:"Admin sign in"}),e.jsx("div",{className:"text-xs text-neutral-500",children:"Use your Supabase account."})]}),e.jsx("button",{className:"btn-secondary",type:"button",onClick:a,children:"‚úï"})]}),e.jsxs("form",{className:"mt-4 space-y-3",onSubmit:m,children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-700 mb-1",children:"Email"}),e.jsx("input",{className:"w-full px-3 py-2 rounded-xl border border-squab-200 bg-white/90 focus:outline-none focus:ring-2 focus:ring-squab-300",type:"email",autoComplete:"email",value:d,onChange:M=>A(M.target.value),placeholder:"name@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-700 mb-1",children:"Password"}),e.jsx("input",{className:"w-full px-3 py-2 rounded-xl border border-squab-200 bg-white/90 focus:outline-none focus:ring-2 focus:ring-squab-300",type:"password",autoComplete:"current-password",value:x,onChange:M=>g(M.target.value),placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"})]}),c?e.jsx("div",{className:"text-sm text-red-700 bg-red-50 border border-red-200 rounded-xl px-3 py-2",children:c}):null,e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-1",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:a,disabled:u,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:u,children:u?"Signing in...":"Sign in"})]})]})]})]})}function Br({open:s,onClose:a,onSubmit:r}){const[u,d]=ue.useState("");return ue.useEffect(()=>{s&&d("")},[s]),ue.useEffect(()=>{if(!s)return;const A=x=>{x&&(x.key==="Escape"&&a&&a(),x.key==="Enter"&&r&&r(u))};return window.addEventListener("keydown",A),()=>window.removeEventListener("keydown",A)},[s,u,a,r]),s?e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:a}),e.jsxs("div",{className:"absolute inset-x-0 bottom-0 max-h-[75vh] rounded-t-3xl bg-white border border-neutral-200 shadow-2xl overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-neutral-200 bg-white/90 backdrop-blur-md",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-squab-700",children:"Admin"}),e.jsx("div",{className:"text-xl font-black text-neutral-900",children:"Enter password"}),e.jsx("div",{className:"text-xs text-neutral-600 mt-1",children:"Unlocks player management on this device."})]}),e.jsx("button",{className:"chip border-neutral-200 bg-white text-neutral-700 hover:opacity-90",onClick:a,children:"Close"})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx("input",{value:u,onChange:A=>d(A.target.value),placeholder:"Password...",type:"password",className:"w-full rounded-2xl border border-neutral-200 px-4 py-3 bg-white"}),e.jsxs("div",{className:"mt-3 flex items-center justify-end gap-2",children:[e.jsx("button",{className:"btn-secondary",onClick:a,children:"Cancel"}),e.jsx("button",{className:"btn-primary",onClick:()=>r&&r(u),children:"Unlock"})]}),e.jsxs("div",{className:"mt-2 text-[11px] text-neutral-500",children:["Tip: set ",e.jsx("span",{className:"font-mono",children:"window.DEN_ADMIN_PASSWORD"})," in the file to change the password."]})]})]})]}):null}function Gr({open:s,onClose:a,isAdmin:r,players:u,hiddenKeys:d,onSave:A}){const[x,g]=ue.useState(""),[c,o]=ue.useState([]),m=ue.useRef(null);ue.useEffect(()=>{s&&(g(""),o(Array.isArray(d)?d.slice():[]))},[s,d]),ue.useEffect(()=>{if(!s)return;const I=V=>{V&&V.key==="Escape"&&a&&a()};return window.addEventListener("keydown",I),()=>window.removeEventListener("keydown",I)},[s,a]);const M=ue.useMemo(()=>{const V=(Array.isArray(u)?u:[]).map(Qe=>{const ve=String((Qe==null?void 0:Qe.name)||"").trim(),xt=os(ve);return{name:ve,key:xt}}).filter(Qe=>Qe.name&&Qe.key),te=new Set,Z=[];for(const Qe of V.sort((ve,xt)=>ve.name.localeCompare(xt.name)))te.has(Qe.key)||(te.add(Qe.key),Z.push(Qe));return Z},[u]),n=(x||"").toLowerCase().trim(),l=n?M.filter(I=>I.name.toLowerCase().includes(n)):M,f=new Set(c),E=M.reduce((I,V)=>I+(f.has(V.key)?0:1),0);function D(I,V){o(te=>{const Z=new Set(Array.isArray(te)?te:[]);return V?Z.delete(I):Z.add(I),Array.from(Z)})}function C(){o([])}function N(){o(M.map(I=>I.key))}function X(){try{const I=JSON.stringify({hiddenKeys:Array.from(new Set(c))},null,2),V=new Blob([I],{type:"application/json"}),te=URL.createObjectURL(V),Z=document.createElement("a");Z.href=te,Z.download="player_visibility.json",document.body.appendChild(Z),Z.click(),Z.remove(),setTimeout(()=>URL.revokeObjectURL(te),2e3)}catch{}}async function J(I){var te,Z;const V=(Z=(te=I==null?void 0:I.target)==null?void 0:te.files)==null?void 0:Z[0];if(V)try{const Qe=await V.text(),ve=JSON.parse(Qe),xt=Array.isArray(ve==null?void 0:ve.hiddenKeys)?ve.hiddenKeys:Array.isArray(ve==null?void 0:ve.hidden)?ve.hidden:[],mt=Array.from(new Set((xt||[]).map(vt=>String(vt||"").trim()).filter(Boolean)));o(mt)}catch{alert("Could not import file (invalid JSON).")}finally{try{I.target.value=""}catch{}}}return s?e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:a}),e.jsxs("div",{className:"absolute inset-x-0 bottom-0 max-h-[92vh] rounded-t-3xl bg-white border border-neutral-200 shadow-2xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 bg-white/90 backdrop-blur-md border-b border-neutral-200 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-400",children:"Admin"}),e.jsx("div",{className:"text-xl font-black text-neutral-900",children:"Player filter"}),e.jsx("div",{className:"text-xs text-neutral-600 mt-1",children:"Show only the players you want in leaderboards & reports. You can re‚Äëadd anyone anytime."})]}),e.jsx("button",{className:"chip border-neutral-200 bg-white text-neutral-700 hover:opacity-90",onClick:a,children:"Close"})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between gap-2 flex-wrap",children:[e.jsxs("div",{className:"text-[11px] text-neutral-600",children:["Showing ",e.jsx("span",{className:"font-black",children:E})," / ",e.jsx("span",{className:"font-black",children:M.length})," players"]}),e.jsxs("div",{className:"flex gap-2 flex-wrap justify-end",children:[e.jsx("button",{className:"chip border-neutral-200 bg-white text-neutral-700",onClick:C,children:"Include all"}),e.jsx("button",{className:"chip border-neutral-200 bg-white text-neutral-700",onClick:N,children:"Exclude all"}),e.jsx("button",{className:"chip border-neutral-200 bg-white text-neutral-700",onClick:X,title:"Download current visibility list",children:"Export"}),e.jsx("button",{className:"chip border-neutral-200 bg-white text-neutral-700",onClick:()=>m.current&&m.current.click(),title:"Import a previously exported list",children:"Import"}),e.jsx("input",{ref:m,type:"file",accept:"application/json",style:{display:"none"},onChange:J})]})]}),e.jsx("div",{className:"mt-3",children:e.jsx("input",{value:x,onChange:I=>g(I.target.value),placeholder:"Search player...",className:"w-full rounded-2xl border border-neutral-200 px-4 py-2 bg-white"})})]}),e.jsx("div",{className:"p-4 overflow-y-auto flex-1 min-h-0",children:M.length?e.jsx("div",{className:"space-y-2",children:l.map(I=>{const V=!f.has(I.key);return e.jsxs("label",{className:"flex items-center justify-between gap-3 rounded-2xl border border-neutral-200 bg-neutral-50 px-4 py-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-extrabold text-neutral-900 truncate",children:I.name}),e.jsx("div",{className:"text-xs text-neutral-600",children:V?"Included":"Excluded"})]}),e.jsx("input",{type:"checkbox",checked:V,onChange:te=>D(I.key,te.target.checked),className:"h-5 w-5"})]},I.key)})}):e.jsx("div",{className:"text-sm text-neutral-600",children:"No players yet ‚Äî scan/import some games first."})}),e.jsxs("div",{className:"border-t border-neutral-200 p-4 flex items-center justify-between gap-3",children:[e.jsx("div",{className:"text-xs text-neutral-600",children:r?"Save publishes to the league.":"Save stores locally on this device (sign in to publish to everyone)."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn-secondary",onClick:a,children:"Cancel"}),e.jsx("button",{className:"btn-primary",onClick:()=>A&&A(c),title:r?"Publish player visibility":"Save locally",children:r?"Publish":"Save locally"})]})]})]})]}):null}function qr(s){return 36}function Ma(s){return Number.isFinite(s)?s<=9?"0-9":s<=18?"10-18":s<=28?"19-28":"29-36":null}function Or(s){const a=Ma(s);return a==="0-9"?.5:a==="10-18"||a==="19-28"?1:1.5}function Yr(s){const a=Ma(s);return a==="0-9"?1:a==="10-18"?2:a==="19-28"?2.5:3}function jr(s,a,r,u,d){const A=Math.round(s);let x=s;r>=35?x-=Or(A)*(r-34):r<=31&&(x+=.5*(32-r)),d&&(x-=Yr(A));const g=qr(),c=xa(x,0,36),o=xa(Math.round(c),0,g);return{nextExact:c,nextPlaying:o}}const js=s=>{const a=(s||"").trim();return/^players?$/i.test(a)||/^team(\s*\d+)?$/i.test(a)||/^team average$/i.test(a)||/^stableford$/i.test(a)||/^strokeplay$/i.test(a)||/^round\s*\d+$/i.test(a)||/^(out|in|total|s\.i\.|par)$/i.test(a)};function wr(s){if(!s)return[];const a=s.includes("	")?"	":s.includes(";")?";":",",r=[];let u="",d=!1;for(let A=0;A<s.length;A++){const x=s[A];x==='"'?d&&s[A+1]==='"'?(u+='"',A++):d=!d:x===a&&!d?(r.push(u.trim()),u=""):u+=x}return r.push(u.trim()),r.map(A=>A.replace(/^"|"$/g,""))}function ds(s){const a=parseFloat(String(s??"").replace(/[^0-9.\-]/g,""));return Number.isFinite(a)?a:NaN}function pe(s,a){const r=ds(s);return Number.isFinite(r)?r:a}const Ur="peerGroup";function pr(s){var u,d;const a=["startExact","start_exact","hcap","handicap","playingHcap","handicapIndex","handicap_index","hi","HI","exact","hcp","HCP"],r=A=>{if(!A)return NaN;for(const x of a){const g=pe(A[x],NaN);if(Number.isFinite(g))return g}return NaN};try{const A=Array.isArray(s==null?void 0:s.windowSeries)?s.windowSeries:Array.isArray(s==null?void 0:s.roundSeries)?s.roundSeries:Array.isArray(s==null?void 0:s.series)?s.series:Array.isArray(s==null?void 0:s.rounds)?s.rounds:null;if(A&&A.length){const c=A[A.length-1]||{};let o=r(c);if(Number.isFinite(o))return Math.round(o*10)/10;let m=0,M=0;for(const n of A){const l=r(n);Number.isFinite(l)&&(m+=l,M++)}if(M)return Math.round(m/M*10)/10}const x=pe((u=s==null?void 0:s.metrics)==null?void 0:u.avgHcap,pe((d=s==null?void 0:s.metrics)==null?void 0:d.avg_handicap,pe(s==null?void 0:s.avgHcap,pe(s==null?void 0:s.handicapIndex,pe(s==null?void 0:s.handicap_index,NaN)))));if(Number.isFinite(x))return Math.round(x*10)/10;const g=r(s);if(Number.isFinite(g))return Math.round(g*10)/10}catch{}return NaN}function Ca(s,a){const r={};return(s||[]).forEach(u=>{const d=(u==null?void 0:u[a])||{};Object.keys(d).forEach(A=>{const x=d[A];r[A]||(r[A]={sumMe:0,sumField:0,holes:0}),r[A].sumMe+=pe(x==null?void 0:x.me,0),r[A].sumField+=pe(x==null?void 0:x.fieldAvg,0),r[A].holes+=pe(x==null?void 0:x.holes,0)})}),Object.keys(r).forEach(u=>{const d=r[u],A=Math.max(0,d.holes);r[u]={me:A?d.sumMe/A:0,fieldAvg:A?d.sumField/A:0,holes:A}}),r}function Wr(s,a,r,u){const d=ds(s),A=ds(a),x=ds(r),g=ds(u);return!Number.isFinite(d)||!Number.isFinite(A)||A<=0||!Number.isFinite(x)||!Number.isFinite(g)?NaN:Math.round(d*(A/113)+(x-g))}function fa(s,a){const r=Math.trunc(ds(s)),u=Math.trunc(ds(a));if(!Number.isFinite(r)||!Number.isFinite(u)||u<1||u>18||r<=0)return 0;const d=Math.floor(r/18),A=r%18;return d+(u<=A?1:0)}function zr(s,a){const r=Math.trunc(ds(s)),u=Math.trunc(ds(a));return Number.isFinite(r)?r+(Number.isFinite(u)?u:0)+2:NaN}function nr(s,a,r,u,d){const A=Array.isArray(s)?s:[],x=Array.isArray(a==null?void 0:a.pars)?a.pars:Array.isArray(a==null?void 0:a.par)?a.par:[],g=Array.isArray(a==null?void 0:a.si)?a.si:Array.isArray(a==null?void 0:a.SI)?a.SI:[],c=x.reduce((n,l)=>n+(Number.isFinite(ds(l))?ds(l):0),0),o=Wr(r,u,d,c);if(!Number.isFinite(o))return NaN;let m=0,M=0;for(let n=0;n<18;n++){const l=ds(A[n]),f=ds(x[n]),E=ds(g[n]);if(!Number.isFinite(l)||!Number.isFinite(f)||f<=0)continue;const D=fa(o,E),C=zr(f,D),N=Number.isFinite(C)?Math.min(l,C):l;m+=N,M+=1}return M>=9?m:NaN}function ir(s,a,r,u){const d=ds(s),A=ds(a),x=ds(r),g=Number.isFinite(ds(u))?ds(u):0;return!Number.isFinite(d)||!Number.isFinite(A)||A<=0||!Number.isFinite(x)?NaN:(d-x-g)*113/A}function Sr(s){const a=(Array.isArray(s)?s:[]).map(ds).filter(Number.isFinite),r=a.length;if(r<3)return NaN;let u=0,d=0;r===3?(u=1,d=-2):r===4?(u=1,d=-1):r===5?(u=1,d=0):r===6||r===7||r===8?(u=2,d=0):r===9||r===10||r===11?(u=3,d=0):r===12||r===13||r===14?(u=4,d=0):r===15||r===16?(u=5,d=0):r===17||r===18?(u=6,d=0):r===19?(u=7,d=0):(u=8,d=0);const x=a.slice().sort((o,m)=>o-m).slice(0,u);if(!x.length)return NaN;const c=x.reduce((o,m)=>o+m,0)/x.length+d;return Math.round(c*10)/10}function Vr(s){var M;if(!Array.isArray(s))return{ok:!1,reason:"no_series"};const a=new Map;for(const n of s){const l=(n==null?void 0:n.courseName)||(n==null?void 0:n.course)||(n==null?void 0:n.clubName)||(n==null?void 0:n.venueName)||"",f=(n==null?void 0:n.teeName)||(n==null?void 0:n.tee)||(n==null?void 0:n.teeLabel)||"",E=`${String(l)}|${String(f)}`;a.has(E)||a.set(E,{courseName:l,teeName:f,rounds:[]}),a.get(E).rounds.push(n)}const r=Array.from(a.values()).sort((n,l)=>{var f,E;return(((f=l.rounds)==null?void 0:f.length)||0)-(((E=n.rounds)==null?void 0:E.length)||0)})[0];if(!r||(((M=r.rounds)==null?void 0:M.length)||0)<2)return{ok:!1,reason:"need_2_rounds",groups:Array.from(a.values())};const u=18,d=Array(u).fill(0),A=Array(u).fill(0);for(const n of r.rounds){const l=Array.isArray(n==null?void 0:n.perHole)?n.perHole:Array.isArray(n==null?void 0:n.pointsPerHole)?n.pointsPerHole:null;if(l)for(let f=0;f<u;f++){const E=Number(l[f]);Number.isFinite(E)&&(d[f]+=E,A[f]+=1)}}const x=d.map((n,l)=>A[l]?n/A[l]:NaN),g=x.filter(Number.isFinite),c=g.length?g.reduce((n,l)=>n+l,0)/g.length:NaN,o=x.map((n,l)=>({hole:l+1,avg:n,vsOverall:Number.isFinite(n)&&Number.isFinite(c)?n-c:NaN,samples:A[l]||0})).filter(n=>Number.isFinite(n.avg)&&n.samples>0).sort((n,l)=>n.avg-l.avg),m=o.filter(n=>Number.isFinite(n.vsOverall)&&n.vsOverall<=-.5);return{ok:!0,courseName:r.courseName||"‚Äî",teeName:r.teeName||"",rounds:r.rounds.length,overallAvg:c,flagged:m,rows:o}}function Os(s,a){const r=s==null||s===""?NaN:Number(s);if(!Number.isFinite(r))return"‚Äî";const u=a&&typeof a=="object"?a:{};typeof a=="number"&&Number.isFinite(a)&&(u.min=a,u.max=a);const d=Number.isFinite(u.min)?u.min:0,A=Number.isFinite(u.max)?u.max:Number.isFinite(u.dp)?u.dp:d,x=u.sign===!0;try{const c=new Intl.NumberFormat(void 0,{minimumFractionDigits:d,maximumFractionDigits:A}).format(r);return x&&r>0?`+${c}`:c}catch{const g=A,c=g?r.toFixed(g):String(Math.round(r));return x&&r>0?`+${c}`:c}}function Jr(s,a=2){const r=Number(s);if(!Number.isFinite(r))return"‚Äî";const u=Math.abs(r),d=u>0&&u<.01?3:a;return(r>0?"+":"")+r.toFixed(d)}function Ja(s){const a=pe(s==null?void 0:s.holes,NaN),r=pe(s==null?void 0:s.pts,NaN);return!Number.isFinite(a)||a<=0||!Number.isFinite(r)?NaN:r/a}function Xa(s){const a=pe(s==null?void 0:s.holes,NaN),r=pe(s==null?void 0:s.val,NaN);return!Number.isFinite(a)||a<=0||!Number.isFinite(r)?NaN:r/a}function Xr(s,a,r){const u=Number(a),d=Number(r);return!Number.isFinite(u)||!Number.isFinite(d)?NaN:String(s)==="gross"?d-u:u-d}function Ha({scoringMode:s,dim:a,mapObj:r,fieldObj:u,limit:d}){const A=String(s)==="gross",x=[],g=Object.keys(r||{});for(const o of g){const m=r==null?void 0:r[o],M=u==null?void 0:u[o],n=pe(m==null?void 0:m.holes,0);if(!n)continue;const l=A?Xa(m):Ja(m),f=A?Xa(M):Ja(M);let E=String(o);a==="SI"&&(E=`SI ${o}`),a==="Par"&&(E=String(o)),x.push({key:String(o),label:E,holes:n,playerAvg:l,fieldAvg:f})}const c=o=>{const m=String(o).match(/(-?\d+\.?\d*)/);return m?Number(m[1]):NaN};if(a==="Par"){const o={"Par 3":1,"Par 4":2,"Par 5":3,Unknown:9};x.sort((m,M)=>(o[m.key]||99)-(o[M.key]||99))}else if(a==="SI"){const o={"1‚Äì6":1,"7‚Äì12":2,"13‚Äì18":3,Unknown:9,"1-6":1,"7-12":2,"13-18":3};x.sort((m,M)=>(o[m.key]||99)-(o[M.key]||99))}else x.sort((o,m)=>{const M=c(o.key),n=c(m.key);return Number.isFinite(M)&&Number.isFinite(n)&&M!==n?M-n:o.key.localeCompare(m.key)});return Number.isFinite(Number(d))&&Number(d)>0&&x.length>Number(d)?(x.sort((o,m)=>(m.holes||0)-(o.holes||0)),x.slice(0,Number(d))):x}function Zr(s){if(!s||!s.length)return new Array(18).fill(NaN);let a=-1;for(let d=0;d<s.length;d++)if(String(s[d]).trim().toLowerCase()==="stableford"){a=d;break}if(a<0)return new Array(18).fill(NaN);const r=a+2;return lr(s,r,{min:0,max:6,intMode:!1,pickupAsZero:!0})}function Kr(s){if(!s||!s.length)return new Array(18).fill(NaN);let a=-1;for(let d=0;d<s.length;d++)if(String(s[d]).trim().toLowerCase()==="best ball"){a=d;break}if(a<0)return new Array(18).fill(NaN);const r=a+2;return lr(s,r,{min:0,max:6,intMode:!1,pickupAsZero:!0})}function Qr(s,a){let r="";const u=[];let d=a+1;for(;d<s.length;){const A=s[d]||[],x=(A[0]||"").trim().toLowerCase();if(!x){d++;continue}if(x==="courselayout")break;if(x==="course"){r=(A[1]||"").trim()||r,d++;continue}if(x==="tee"){const g=(A[1]||"").trim(),o=(A[2]||"").trim().toUpperCase()==="F"?"F":"M",m=s[d+1]||[];if((m[0]||"").trim().toLowerCase()!=="hole"){d++;continue}const n=m.findIndex(C=>String(C).trim().toLowerCase()==="par"),l=m.findIndex(C=>String(C).trim().toLowerCase()==="yards"),f=m.findIndex(C=>String(C).trim().toLowerCase()==="si");if(l<0||n<0||f<0){d+=2;continue}const E=Array(18).fill(null).map((C,N)=>({hole:N+1,par:0,yards:0,si:0}));let D=d+2;for(;D<s.length;){const C=s[D]||[],N=(C[0]||"").trim().toLowerCase();if(!N||N==="tee"||N==="course"||N==="courselayout")break;const X=parseInt(C[0],10);if(!Number.isFinite(X)||X<1||X>18)break;E[X-1]={hole:X,par:parseInt(C[n]||"0",10),yards:parseInt(C[l]||"0",10),si:parseInt(C[f]||"0",10)},D++}u.push({teeName:g,gender:o,pars:E.map(C=>C.par),yards:E.map(C=>C.yards),si:E.map(C=>C.si)}),d=D;continue}d++}return u.length?{courseName:r,tees:u}:null}function en(s,a){let r=-1;for(let E=a+1;E<s.length;E++){const C=((s[E]||[])[0]||"").trim().toLowerCase();if(C){if(C==="courselayout")break;if(C==="hole"){r=E;break}}}if(r<0)return null;const u=s[r].map(E=>String(E||"")),d=E=>E.replace(/\s+/g,"").toLowerCase(),A=u.findIndex(E=>d(E)==="mensyards"),x=u.findIndex(E=>d(E)==="menspar"),g=u.findIndex(E=>d(E)==="menssi"),c=u.findIndex(E=>d(E)==="womensyards"||d(E)==="ladiesyards"),o=u.findIndex(E=>d(E)==="womenspar"||d(E)==="ladiespar"),m=u.findIndex(E=>d(E)==="womenssi"||d(E)==="ladiessi");if(A<0||x<0||g<0)return null;const M=Array(18).fill(null).map((E,D)=>({hole:D+1,par:0,yards:0,si:0})),n=Array(18).fill(null).map((E,D)=>({hole:D+1,par:0,yards:0,si:0}));let l=r+1;for(;l<s.length;){const E=s[l]||[],D=(E[0]||"").trim().toLowerCase();if(!D||D==="courselayout")break;const C=parseInt(E[0],10);if(!Number.isFinite(C)||C<1||C>18)break;M[C-1]={hole:C,par:parseInt(E[x]||0),yards:parseInt(E[A]||0),si:parseInt(E[g]||0)},o>=0&&(n[C-1]={hole:C,par:parseInt(E[o]||0),yards:parseInt(E[c]||0),si:parseInt(E[m]||0)}),l++}const f=[{teeName:"Men",gender:"M",pars:M.map(E=>E.par),yards:M.map(E=>E.yards),si:M.map(E=>E.si)}];return o>=0&&n.some(E=>E.par>0)&&f.push({teeName:"Women",gender:"F",pars:n.map(E=>E.par),yards:n.map(E=>E.yards),si:n.map(E=>E.si)}),{courseName:"",tees:f}}function tn(s){let a=-1;for(let u=0;u<s.length;u++)if((s[u][0]||"").trim().toLowerCase()==="courselayout"){a=u;break}if(a<0)return null;let r=!1;for(let u=a+1;u<s.length;u++){const d=(s[u][0]||"").trim().toLowerCase();if(d==="tee"){r=!0;break}if(d==="courselayout")break}return r?Qr(s,a):en(s,a)}function Na(s,a){if(!a||!a.length)return null;const r=(s.teeLabel||"").toLowerCase(),u=(s.gender||"M").toUpperCase();if(r){let A=a.find(x=>(x.teeName||"").toLowerCase()===r);if(A||(A=a.find(x=>{const g=(x.teeName||"").toLowerCase();return g&&(g.includes(r)||r.includes(g))}),A))return A}return a.find(A=>(A.gender||"M").toUpperCase()===u)||null}function sn(s){const r=s.replace(/\r/g,"").split(`
`).map(wr);let u="",d=-1;for(let b=0;b<r.length;b++){const j=r[b].join("").toLowerCase();if(j.includes("hole 1")&&j.includes("hole 18")){d=b;break}}if(d>0)for(let b=d-1;b>=0;b--){const j=(r[b][0]||"").trim();if(j&&!/round\s*\d+/i.test(j)&&!/stableford|strokeplay/i.test(j)){const O=(r[b]||[]).join(" "),T=/\b(?:jan|feb|mar|apr|may|jun|jul|aug|sep|sept|oct|nov|dec)\b/i.test(O)&&/\b20\d{2}\b/.test(O),ae=b>0?String(r[b-1]&&r[b-1][0]||"").trim():"";let ye=j;T&&ae&&!/round\s*\d+/i.test(ae)&&!/stableford|strokeplay/i.test(ae)&&(ye=/[a-z]$/.test(ae)&&/^[a-z]/.test(j)?ae+j:ae+" "+j),u=ye;break}}let A=null,x=null;for(let b=0;b<r.length;b++){const j=r[b],O=String(j[0]||"").trim().toLowerCase();if(O==="s.i."||O==="si"||O==="s.i"){const T=[];for(let ae=3;ae<j.length;ae++){const ye=parseInt(String(j[ae]||"").trim(),10);Number.isNaN(ye)||T.push(ye)}T.length>=19?x=T.slice(0,9).concat(T.slice(10,19)):T.length===18&&(x=T.slice(0,18))}}for(let b=0;b<r.length;b++){const j=r[b];if((j[0]||"").trim().toLowerCase()==="par"){const O=[];for(let T=3;T<j.length;T++){const ae=parseInt(String(j[T]||"").trim(),10);Number.isNaN(ae)||O.push(ae)}O.length>=19?A=O.slice(0,9).concat(O.slice(10,19)):O.length===18&&(A=O.slice(0,18));break}}let g=null;try{g=tn(r)}catch{}const c=g&&g.tees?g.tees.map(b=>{let j=b.pars||[];return(!j||j.length!==18||j.every(O=>!O))&&A&&A.length===18&&(j=A.slice()),{teeName:b.teeName||"",gender:(b.gender||"M").toUpperCase(),pars:j,yards:b.yards||[],si:b.si&&b.si.length===18?b.si:x&&x.length===18?x.slice():[]}}):[],o=b=>{const j=String(b||"").trim().toLowerCase();return j?j==="m"||j==="male"||j==="man"||j==="men"||j==="gents"||j==="gent"?"M":j==="f"||j==="female"||j==="woman"||j==="women"||j==="ladies"||j==="lady"?"F":"":""},m=(b,j)=>{const O=(b||[]).map(T=>String(T||"").trim().toLowerCase());for(const T of j){const ae=O.findIndex(ye=>ye===T||ye.replace(/\s+/g,"")===T.replace(/\s+/g,""));if(ae>=0)return ae}return-1};let M=-1,n=0,l=1,f=-1,E=-1;for(let b=0;b<r.length;b++){const j=r[b];if(!j||!j.length)continue;const O=m(j,["name","player","player name","playername"]),T=m(j,["hdcp","handicap","hcp"]);if(O>=0&&T>=0){M=b,n=O,l=T,f=m(j,["gender","sex"]),E=m(j,["tee","teelabel","tee label","tee name","teename"]);break}}const D=[];if(M>=0)for(let b=M+1;b<r.length;b++){const j=r[b];if(!j)break;const O=(j[n]||"").trim();if(!O)break;if(js(O)||/^player$/i.test(O))continue;const T=parseFloat(String(j[l]||"").trim());if(Number.isNaN(T))continue;const ae=f>=0?o(j[f]):"",ye=E>=0?String(j[E]||"").trim():"";D.push({name:O,handicap:T,gender:ae||"M",teeLabel:ye||""})}const C={},N={},X=b=>{const j=String(b||"").trim();if(!j||/^[+-]?\d+(?:\.\d+)?$/.test(j))return!1;const O=j.toLowerCase();return/tee|white|yellow|red|blue|black|green|gold|silver|champ|championship|mens|men|gents|ladies|women|forward|back/.test(O)};for(let b=0;b<r.length;b++){const j=r[b];if(!j)continue;const O=(j[0]||"").trim();if(O){for(let T=1;T<=4;T++){const ae=(j[T]||"").trim();if(!ae)continue;X(ae)&&!N[O]&&(N[O]=ae);const ye=ae.toLowerCase();/women|ladies/.test(ye)&&(C[O]="F")}C[O]==null&&(C[O]="M")}}for(const b of D)!b.gender&&C[b.name]&&(b.gender=C[b.name]),!b.teeLabel&&N[b.name]&&(b.teeLabel=N[b.name]);typeof window<"u"&&window.__SMART_ODDS_DEBUG&&console.log("[PARSE CSV PLAYERS]",{count:D.length,sample:D.slice(0,5).map(b=>({name:b.name,handicap:b.handicap,gender:b.gender,teeLabel:b.teeLabel}))});let J=c;if((!J||!J.length)&&A&&A.length===18){const b=Array.from(new Set(D.map(O=>String(O.teeLabel||"").trim()).filter(Boolean)));J=(b.length?b:["Default tee"]).map(O=>({teeName:O,gender:/women|ladies|red\b/.test(String(O).toLowerCase())?"F":"M",pars:A.slice(),yards:[],si:x&&x.length===18?x.slice():[]}))}let I=-1;for(let b=0;b<r.length;b++)if((r[b][0]||"").trim().toLowerCase()==="stableford"){I=b;break}const V={};if(I>=0)for(let b=I+2;b<r.length;b++){const j=r[b];if(!j)break;const O=(j[0]||"").trim();if(!O||O==="..."||/^round\s*\d+/i.test(O)||/^(player)$/i.test(O)||js(O))break;const T=[];for(let ae=1;ae<j.length;ae++){const ye=ds(j[ae]);Number.isFinite(ye)&&T.push(ye)}T.length&&(V[O]=T[T.length-1],D.some(ae=>ae.name===O)||D.push({name:O,handicap:0,gender:C[O]||"M",teeLabel:N[O]||""}))}const te={},Z=D.map(b=>(b.name||"").trim()).filter(Boolean),Qe=(b,j)=>{if(!b||(b[0]||"").trim()!==j)return!1;const O=String(b[1]||"").trim().toLowerCase();if(!O||!O.includes("tee"))return!1;let T=0;for(let ae=3;ae<b.length;ae++){const ye=String(b[ae]??"").trim();if(!ye||ye.includes("¬£"))continue;const U=parseInt(ye.replace(/[^0-9\-]/g,""),10);Number.isFinite(U)&&U>=1&&U<=19&&T++}return T>=6},ve=(b,j)=>Array.isArray(b)&&b.some(O=>String(O||"").trim().toLowerCase()===j),xt=b=>Array.isArray(b)&&b.some(j=>String(j||"").trim().toLowerCase().replace(/\s+/g,"")==="bestball"),mt=b=>{const j=d>=0?d:0;for(let O=j;O<r.length;O++)if(Qe(r[O],b))return O;return-1},vt=(b,j)=>{var O;for(let T=b+1;T<r.length;T++){const ae=(((O=r[T])==null?void 0:O[0])||"").trim();if(!ae)continue;if(ae!==j&&Z.includes(ae)&&Qe(r[T],ae))return T;const ye=ae.toLowerCase();if(ye==="stableford"||ye==="courselayout")return T}return r.length},jt=(b,j,O)=>{for(let T=b;T<j;T++){const ae=r[T];if(O(ae))return ae}return null};for(const b of D){const j=mt(b.name);if(j<0){console.warn("[parseSquabbitCSV] Player block not found:",b.name),te[b.name]={perHole:Array(18).fill(0),back9:0,hcapCard:NaN,totalFromCard:NaN,grossPerHole:Array(18).fill(NaN),bestBallPerHole:null,bestBallHcapCard:NaN};continue}const O=vt(j,b.name),T=r[j]||[],ae=Le=>{if(!Le||!Le.length)return new Array(18).fill(NaN);let Fe=-1;for(let wt=0;wt<Le.length;wt++)if(String(Le[wt]).trim().toLowerCase()==="gross"){Fe=wt;break}let Vt=3;return Fe>=0&&(Vt=Fe+2),lr(Le,Vt,{min:1,max:19,intMode:!0,pickupAsZero:!1})};let ye=Array(18).fill(NaN),U=-1;for(let Le=j+1;Le<O;Le++)if(ve(r[Le],"stableford")){U=Le;break}const at=U>=0?r[U]:null;let ce=Array(18).fill(0),gt=NaN,ot=NaN;if(at){ce=Zr(at)||Array(18).fill(0);let Le=-1;for(let Fe=0;Fe<at.length;Fe++)if(String(at[Fe]).trim().toLowerCase()==="stableford"){Le=Fe;break}if(Le>=0){gt=ds(at[Le+1]);for(let Fe=at.length-1;Fe>Le;Fe--){const Vt=ds(at[Fe]);if(Number.isFinite(Vt)){ot=Vt;break}}}}const qe=U>j&&r[U-1]||T;ye=ae(qe)||Array(18).fill(NaN);const Dt=jt(j+1,O,Le=>xt(Le));let bt=null,ke=NaN;if(Dt){bt=Kr(Dt);let Le=-1;for(let Fe=0;Fe<Dt.length;Fe++)if(String(Dt[Fe]||"").trim().toLowerCase().replace(/\s+/g,"")==="bestball"){Le=Fe;break}Le>=0&&(ke=ds(Dt[Le+1]))}const w=(ce||[]).slice(9).reduce((Le,Fe)=>Le+(Number(Fe)||0),0);te[b.name]={perHole:ce,back9:w,hcapCard:gt,totalFromCard:ot,grossPerHole:ye,bestBallPerHole:bt,bestBallHcapCard:ke}}const He=D.filter(b=>b.name&&!/^player$/i.test(b.name.trim())&&!js(b.name)).map(b=>{const j=te[b.name]||{};let O=Number.isFinite(b.handicap)?b.handicap:NaN;(!Number.isFinite(O)||O<=0)&&(O=Number.isFinite(j.hcapCard)?j.hcapCard:0);let T=0;return Number.isFinite(V[b.name])?T=V[b.name]:Number.isFinite(j.totalFromCard)&&(T=j.totalFromCard),{name:b.name,gender:b.gender||C[b.name]||"M",teeLabel:b.teeLabel||N[b.name]||"",handicap:O,points:T,back9:j.back9||0,perHole:j.perHole||[],grossPerHole:j.grossPerHole||Array(18).fill(NaN),courseHandicap:Number.isFinite(j.hcapCard)?j.hcapCard:O,bestBallPerHole:j.bestBallPerHole||null,bestBallCourseHandicap:j.bestBallHcapCard,pars:A||null,sis:x||null}}),Je=u||(g?g.courseName:"");try{let b=function(T,ae){const ye=Math.max(0,Math.round(Number(T)||0)),U=Number(ae);if(!Number.isFinite(U)||U<=0)return 0;const at=Math.floor(ye/18),ce=ye%18;return at+(ce>0&&U<=ce?1:0)},j=function(T,ae,ye){const U=Number.isFinite(Number(T))?Number(T):4,at=Number.isFinite(Number(ye))?Number(ye):1;return U+b(ae,at)+2};const O=(()=>{let T=9;for(const ae of He||[]){const ye=Array.isArray(ae==null?void 0:ae.perHole)?ae.perHole:null,U=Array.isArray(ae==null?void 0:ae.grossPerHole)?ae.grossPerHole:null;for(let at=9;at<18;at++){const ce=ye?Number(ye[at]):NaN,gt=U?Number(U[at]):NaN;if(Number.isFinite(ce)||Number.isFinite(gt)){T=18;break}}if(T===18)break}return T})();for(const T of He||[]){const ae=Array.isArray(T==null?void 0:T.perHole)?T.perHole.slice():new Array(18).fill(NaN),ye=Array.isArray(T==null?void 0:T.grossPerHole)?T.grossPerHole.slice():new Array(18).fill(NaN),U=new Array(18).fill(!1);let at=!1;for(let qe=0;qe<O;qe++){const Dt=Number(ae[qe]),bt=Number(ye[qe]);if(Number.isFinite(Dt)||Number.isFinite(bt)&&bt>0){at=!0;break}}if(!at){T.imputedMask=U,T.imputedGrossPerHole=ye;continue}let ce=Array.isArray(T==null?void 0:T.pars)&&T.pars.length===18?T.pars:null,gt=Array.isArray(T==null?void 0:T.sis)&&T.sis.length===18?T.sis:null;if((!ce||!gt)&&Array.isArray(J)&&J.length){const qe=String((T==null?void 0:T.teeLabel)||(T==null?void 0:T.tee)||"").trim().toLowerCase(),Dt=String((T==null?void 0:T.gender)||"").trim().toUpperCase();let bt=J.find(ke=>String((ke==null?void 0:ke.teeName)||"").trim().toLowerCase()===qe)||null;bt||(bt=J.find(ke=>String((ke==null?void 0:ke.gender)||"").toUpperCase()===Dt)||J[0]),bt&&(!ce&&Array.isArray(bt.pars)&&bt.pars.length===18&&(ce=bt.pars),!gt&&Array.isArray(bt.sis)&&bt.sis.length===18&&(gt=bt.sis))}const ot=Number.isFinite(Number(T==null?void 0:T.courseHandicap))?Number(T.courseHandicap):Number.isFinite(Number(T==null?void 0:T.handicap))?Number(T.handicap):0;for(let qe=0;qe<O;qe++){const Dt=Number(ye[qe]);if(!Number.isFinite(Dt)||Dt<=0){const bt=ce?ce[qe]:4,ke=gt?gt[qe]:qe+1;ye[qe]=j(bt,ot,ke),U[qe]=!0,Number.isFinite(Number(ae[qe]))||(ae[qe]=0)}}T.perHole=ae,T.grossPerHole=ye,T.imputedMask=U,T.imputedGrossPerHole=ye}}catch{}return{players:He,courseTees:J,courseName:Je}}function an(s){const r=String(s||"").split(/\r?\n/).map(b=>b.trimEnd()).filter(b=>b.length>0);if(!r.length)throw new Error("CSV is empty.");const u=r.map(wr),d=b=>String(b||"").trim().toLowerCase().replace(/\s+/g," ").replace(/[.]/g,""),A=b=>b!=null&&b!==""&&!Number.isNaN(Number(b)),x=b=>{const j=Number(String(b||"").replace(/[^\d.-]/g,""));return Number.isFinite(j)?j:NaN};let g="";for(const b of u.slice(0,10)){if(!b||!b.length)continue;const j=d(b[0]);if(j==="course name"||j==="course"){for(let O=1;O<b.length;O++){const T=String(b[O]||"").trim();if(T){g=T;break}}if(g)break}}if(!g){const b=u[0]||[];d(b[0])==="course name"&&(g=String(b.find((j,O)=>O>0&&String(j||"").trim())||"").trim())}let c=-1,o=[];for(let b=0;b<u.length;b++){const j=u[b]||[];if(!j.length||d(j[0])!=="hole")continue;const O={};for(let T=1;T<j.length;T++){const ae=String(j[T]||"").trim(),ye=parseInt(ae,10);ye>=1&&ye<=18&&(O[ye]=T)}if(Object.keys(O).length>=9){c=b,o=Array.from({length:18},(T,ae)=>O[ae+1]).filter(Boolean);break}}if(c<0||o.length<9)throw new Error("Unrecognised CSV format (could not locate Hole 1‚Äì18 header row).");const m=o.length;Array.from({length:m},(b,j)=>j+1);const M=b=>{for(let j=0;j<u.length;j++){const O=u[j]||[],T=d(O[0]);if(b.has(T))return j}return-1},n=M(new Set(["par"])),l=M(new Set(["si","s i","stroke index","hcp","handicap"])),f=M(new Set(["yards","yds","yd","yardage"])),E=M(new Set(["meters","metres","m"])),D=n>=0?o.map(b=>x((u[n]||[])[b])):[],C=l>=0?o.map(b=>x((u[l]||[])[b])):[],N=f>=0?o.map(b=>x((u[f]||[])[b])):E>=0?o.map(b=>{const j=x((u[E]||[])[b]);return Number.isFinite(j)?Math.round(j*1.09361):NaN}):[];let X=-1,J=-1;for(let b=0;b<u.length;b++){const j=u[b]||[];if(!j.length)continue;const O=d(j[0]);if(!(O!=="player"&&O!=="name")){X=b;for(let T=0;T<j.length;T++)if(d(j[T])==="tee"||d(j[T])==="tees"){J=T;break}J<0&&j.length>2&&(d(j[1])==="tee"||d(j[1])==="tees")&&(J=1);break}}const I=b=>d(String(b||"")).replace(/\s+/g," ").trim(),V=b=>String(b||"").replace(/\s*\(.*?\)\s*/g," ").replace(/\s+/g," ").trim(),te=b=>/team|best\s*ball|scramble|fourball|foursomes/i.test(String(b||"")),Z=b=>/stableford|net\s*pts|net\s*points|points/i.test(String(b||"")),Qe=b=>{const j=String(b||"");let O=j;j.includes("(")&&(O=j.split("(")[0].trim()),O=O.trim();let T="",ae=NaN;const ye=j.match(/tee\s*:\s*([a-z0-9]+)/i);ye&&ye[1]&&(T=String(ye[1]).trim());const U=j.match(/hcp\s*:\s*([0-9]+(?:\.[0-9]+)?)/i);return U&&U[1]&&(ae=x(U[1])),{name:O,tee:T,hcp:ae}},ve=new Map,xt=new Map,mt=(b,j)=>{const O=[];for(let T=0;T<m;T++){const ae=o[T];O.push(x(b[ae]))}return O},vt=X>=0?X+1:Math.max(c,n,l,f,E)+1;for(let b=vt;b<u.length;b++){const j=u[b]||[];if(!j.length)continue;const O=String(j[0]||"").trim();if(!O)continue;const T=d(O);if(["hole","par","si","s i","players"].includes(T)||o.slice(0,Math.min(m,6)).map(bt=>j[bt]).filter(A).length<2)continue;let ye=Qe(O),U=ye.name||O;const at=(J>=0?String(j[J]||"").trim():ye.tee)||"",ce=ye.hcp;if(te(U))continue;if(Z(O)){const bt=V(O).replace(/net\s*pts\s*\(.*?\)/i,"").replace(/net\s*pts/i,"").replace(/net\s*points/i,"").replace(/\(.*stableford.*\)/i,"").replace(/stableford/i,"").replace(/points?/i,"").trim(),ke=I(bt||U),w=mt(j);xt.set(ke,w);continue}const gt=I(U),ot=mt(j),qe=ve.get(gt)||{name:U,gender:"M",teeLabel:at,handicap:NaN,courseHandicap:NaN,grossPerHole:Array(18).fill(NaN),perHole:[],points:0,back9:0,pars:null,sis:null};qe.name=U,at&&(qe.teeLabel=at),Number.isFinite(ce)&&(qe.handicap=ce,qe.courseHandicap=ce);const Dt=qe.grossPerHole.slice();for(let bt=0;bt<m;bt++)Dt[bt]=ot[bt];qe.grossPerHole=Dt,ve.set(gt,qe)}const jt=Array.from(ve.entries()).map(([b,j])=>{const O=xt.get(b);return Array.isArray(O)&&O.length?(j.perHole=O.slice(),j.points=O.reduce((T,ae)=>T+(Number(ae)||0),0),j.back9=O.slice(9,18).reduce((T,ae)=>T+(Number(ae)||0),0)):(j.perHole=[],j.points=0,j.back9=0),j.pars=D&&D.length===m?D.slice():null,j.sis=C&&C.length===m?C.slice():null,Number.isFinite(j.courseHandicap)||(j.courseHandicap=Number.isFinite(j.handicap)?j.handicap:0),Number.isFinite(j.handicap)||(j.handicap=0),j}).filter(b=>b.name&&!te(b.name)),He=new Set(jt.map(b=>String(b.teeLabel||"").trim()).filter(Boolean)),Je=Array.from(He).map(b=>({teeName:b,gender:"M",pars:D&&D.length===m?D.slice():[],yards:N&&N.length===m?N.slice():[],si:C&&C.length===m?C.slice():[]}));return{players:jt,courseTees:Je,courseName:g}}function Ua(s){try{return sn(String(s||""))}catch{return an(String(s||""))}}function ga({items:s}){return!s||!s.length?null:e.jsx("div",{className:"hide-print mb-3",children:e.jsx("div",{className:"flex flex-wrap items-center gap-1 text-xs text-neutral-500",children:s.map((a,r)=>e.jsxs("span",{className:"inline-flex items-center gap-1",children:[r>0&&e.jsx("span",{className:"text-neutral-300",children:"/"}),a.onClick?e.jsx("button",{className:"px-2 py-1 rounded-full bg-white/70 border border-squab-200 hover:bg-white transition",onClick:a.onClick,title:a.title,children:a.label}):e.jsx("span",{className:"px-2 py-1 rounded-full bg-neutral-100 border border-neutral-200",children:a.label})]},r))})})}function Wa({active:s="progress",setView:a}){return null}function rn({seasonModel:s,seasonPlayer:a,setSeasonPlayer:r,seasonYear:u,setSeasonYear:d,seasonLimit:A,setSeasonLimit:x,seasonYears:g,scoringMode:c,setScoringMode:o}){var E;const m=((s==null?void 0:s.players)||[]).filter(D=>D&&D.name&&!(typeof js=="function"&&js(D.name))),M=a||((E=m==null?void 0:m[0])==null?void 0:E.name)||"",n=u||"All",l=A||"All",f=c||"stableford";return[M||"‚Äî",String(l).toLowerCase()==="all"?"All games":`Last ${l}`,String(n).toLowerCase()==="all"?"All years":String(n),f==="gross"?"Gross":"Stableford"].join(" ¬∑ "),null}function nn({leagueHeaderTitle:s,eventName:a,statusMsg:r,courseName:u,view:d,setView:A}){return e.jsx("div",{className:"hide-print sticky top-0 z-40",style:{paddingTop:"env(safe-area-inset-top)"},children:e.jsx("div",{className:"glass-card app-topbar shadow-md px-3 py-2 sm:px-4 sm:py-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-2 sm:gap-3",children:[e.jsxs("div",{className:"min-w-0 hidden sm:block",children:[e.jsx("h1",{className:"text-lg md:text-xl font-extrabold tracking-tight text-squab-900 truncate",children:s||"Den Society League ‚Äî Ultimate Edition"}),e.jsx("div",{className:"text-[11px] text-neutral-500 truncate",children:a||"Untitled Event"})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 flex-wrap justify-end min-w-0",children:[d!=="home"?e.jsxs("button",{className:"topbtn px-3 py-2 text-sm",onClick:()=>A("home"),title:"Back to Main Menu","aria-label":"Back to Main Menu",children:[e.jsx("span",{className:"ico",children:"üè†"}),"Home"]}):null,e.jsxs("span",{className:"topchip px-3 py-2 text-sm max-w-[70vw] sm:max-w-none",children:[e.jsx("span",{className:"ico",children:"‚õ≥"}),e.jsx("span",{className:"txt truncate",children:a||"Untitled Event"})]})]})]})})})}function ln({statusMsg:s,courseName:a}){const r=String(s||"").toLowerCase().includes("connected");return e.jsxs("div",{className:"status-mini","aria-label":"Connection status",children:[e.jsx("span",{className:"dot "+(r?"bg-emerald-500":"bg-rose-500"),"aria-hidden":"true"}),e.jsx("span",{className:"lbl",children:"Supabase"}),e.jsx("span",{className:"mono",children:s||"‚Äî"}),e.jsx("span",{className:"mx-2 text-neutral-300",children:"‚Ä¢"}),e.jsx("span",{className:"lbl",children:"Course"}),e.jsx("span",{className:a?"text-neutral-700":"text-neutral-400",children:a||"‚Äî"})]})}function ya({setView:s,left:a=null,title:r=null,right:u=null}){return e.jsx("div",{className:"nav-wrap mb-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[a,r?e.jsx("span",{className:"chip",children:r}):null]}),e.jsx("div",{className:"flex items-center gap-2",children:u})]})})}function kr({seasonsDef:s,seasonYear:a,setSeasonYear:r,leagueTitle:u}){var o;const d=m=>{const M=String(m&&m.label?m.label:"").trim(),n=String((m==null?void 0:m.season_id)??"").trim();let l=M;if(!l){const C=String((m==null?void 0:m.start_date)||(m==null?void 0:m.startDate)||"").slice(0,10),N=String((m==null?void 0:m.end_date)||(m==null?void 0:m.endDate)||"").slice(0,10),X=C?C.slice(0,4):"",J=N?N.slice(0,4):"";X&&J&&X!==J?l=`${X}-${J}`:X?l=X:l=n||""}const f=String(u||"Den Society League").trim(),E=l.toLowerCase(),D=f.toLowerCase();return f&&!E.includes(D)&&(l=`${f} ${l}`.trim()),l||n||""},A=(s||[]).map(m=>({id:String(m.season_id),label:d(m)})),x=String(a??""),g=(o=A[0])!=null&&o.id?String(A[0].id):"All",c=x&&(x.toLowerCase()==="all"||A.some(m=>m.id===x))?x:g;return ue.useEffect(()=>{const m=String(a??"");!(m&&(m.toLowerCase()==="all"||A.some(n=>n.id===m)))&&c&&c!==m&&r(c)},[s]),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-black tracking-widest uppercase text-neutral-500",children:"Season"}),e.jsxs("div",{className:"select-wrap",children:[e.jsxs("select",{className:"select-premium",value:String(c||""),onChange:m=>r(m.target.value),children:[e.jsx("option",{value:"All",children:"All"}),A.map(m=>e.jsx("option",{value:m.id,children:m.label},m.id))]}),e.jsx("svg",{className:"select-chevron",viewBox:"0 0 20 20",fill:"none","aria-hidden":"true",children:e.jsx("path",{d:"M6 8l4 4 4-4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]})}function ms({setView:s,hasEvent:a=!0}){const[r,u]=he.useState(!1),d=he.useRef(null);he.useEffect(()=>{if(!r)return;const c=m=>{d.current&&(d.current.contains(m.target)||u(!1))},o=m=>{m.key==="Escape"&&u(!1)};return document.addEventListener("mousedown",c),document.addEventListener("touchstart",c,{passive:!0}),document.addEventListener("keydown",o),()=>{document.removeEventListener("mousedown",c),document.removeEventListener("touchstart",c),document.removeEventListener("keydown",o)}},[r]);const A=[{k:"event",label:"‚õ≥ Game"},{k:"graphs",label:"üìà Graphs"},{k:"scorecard",label:"üßæ Player Scorecard"},{k:"course_stats",label:"üó∫Ô∏è Course Stats"},{k:"ratings",label:"‚≠ê Ratings"},{sep:!0},{k:"banter",label:"üòÇ Banter"},{k:"style",label:"üéØ Styles"},{k:"story",label:"üìñ Story"},{k:"replay",label:"üì∫ Replay"},{k:"team_replay",label:"ü§º Teams"},{k:"casino",label:"üé∞ Casino"},{k:"trophies",label:"üèÜ Trophies"},{k:"partner",label:"ü§ù Partners"},{k:"headtohead",label:"ü•ä Rivalry"}],x=c=>{u(!1),s(c)},g=a?e.jsxs("div",{className:"relative z-[200]",ref:d,children:[e.jsx("button",{className:"btn-secondary",onClick:()=>u(c=>!c),"aria-haspopup":"menu","aria-expanded":r?"true":"false",title:"Open in‚Äëgame menu",children:"‚ò∞ Menu"}),r?e.jsxs("div",{className:"absolute left-0 mt-2 w-72 max-w-[85vw] rounded-2xl border border-squab-200 bg-white/95 shadow-xl backdrop-blur p-2 z-[200]",role:"menu",children:[e.jsx("div",{className:"px-2 pt-2 pb-1 text-[10px] font-black tracking-widest uppercase text-neutral-500",children:"In‚Äëgame tools"}),A.map((c,o)=>c.sep?e.jsx("div",{className:"my-2 h-px bg-neutral-200/80"},"sep"+o):e.jsxs("button",{className:"w-full text-left px-3 py-2 rounded-xl hover:bg-squab-50 active:bg-squab-100 transition flex items-center justify-between gap-3",onClick:()=>x(c.k),role:"menuitem",children:[e.jsx("span",{className:"font-extrabold text-neutral-900",children:c.label}),e.jsx("span",{className:"text-xs text-neutral-500",children:"‚Üí"})]},c.k)),e.jsx("div",{className:"mt-2 px-2 py-1 text-[11px] text-neutral-500",children:"League & Eclectic live on the Main Menu. Review Past Games and Guide are on Home."})]}):null]}):e.jsx("button",{className:"btn-secondary",onClick:()=>s("past"),children:"üóÇÔ∏è Review Your Past Games"});return e.jsx(ya,{setView:s,left:g})}function on({activeRole:s,isSuperAdmin:a,setView:r,fileInputRef:u,importLocalCSV:d,runSeasonAnalysis:A,computed:x,addEventToSeason:g,removeEventFromSeason:c,clearSeason:o,user:m,handleLogin:M,handleLogout:n,handleSwitchSociety:l,openPlayersAdmin:f,visiblePlayersCount:E,totalPlayersCount:D}){const C=!!m,X=!!(m&&(m.is_admin||m.role==="admin"))?m.email||"Admin":"Not signed in",J=x&&(x.seasonEvents&&x.seasonEvents.length||x.events&&x.events.length||x.rounds&&x.rounds.length)||0,I=x&&(x.formatsCount||x.formats&&x.formats.length)||0,V=x&&(x.holesExplored||x.holeCount||x.holes&&x.holes.length)||0,te=J||I||V?`${J} rounds analyzed ¬∑ ${I||0} formats ¬∑ ${V||0} holes explored`:"Explore trends, surprises, and scoring patterns";return e.jsxs("section",{id:"player-report-top",className:"content-card",style:{padding:14},children:[e.jsx("style",{children:`
        /* Mobile menu CTA consistency (Home screen) */
        .hm-cta-row{ display:flex; flex-direction:column; gap:10px; align-items:stretch; margin-top:12px; }
        .hm-cta{ width:100%; justify-content:center; }
        .hm-stats{ font-size:12px; line-height:1.35; opacity:.92; }

        /* Make the smaller card action buttons behave like the main CTA on mobile */
        .hm-card-action{ display:flex; align-items:center; gap:10px; }
        .hm-linkbtn{ display:inline-flex; align-items:center; justify-content:center; white-space:nowrap; }
        @media (max-width: 640px){
          .hm-cta-row{ gap:12px; }
          .hm-cta{ width:100%; }
          .hm-card-inner{ display:flex; flex-direction:column; gap:12px; }
          .hm-card-action{ width:100%; }
          .hm-linkbtn{
            width:100%;
            padding:14px 16px;
            border-radius:18px;
            font-weight:900;
            letter-spacing:-0.01em;
            background: linear-gradient(180deg, rgba(255,212,75,1) 0%, rgba(245,166,35,1) 100%);
            color: rgba(23,17,0,0.96);
            box-shadow: 0 10px 24px rgba(0,0,0,0.18);
          }
          .hm-pill{ display:none; }
        }
        @media (min-width: 641px){
          .hm-cta-row{ flex-direction:row; align-items:center; justify-content:space-between; gap:12px; }
          .hm-cta{ width:auto; }
        }
      `}),e.jsx("style",{children:`
        /* Top sheet (front-most) gets the branded header + totals. Back sheets keep the subtle grid look. */
        .hm-sheet.s3{
          background-image:
            url("data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%22640%22%20height%3D%22360%22%20viewBox%3D%220%200%20640%20360%22%3E%0A%3Crect%20width%3D%22640%22%20height%3D%22360%22%20rx%3D%2212%22%20ry%3D%2212%22%20fill%3D%22rgba%28255%2C255%2C255%2C0.0%29%22/%3E%0A%3Crect%20x%3D%220%22%20y%3D%220%22%20width%3D%22640%22%20height%3D%2256%22%20fill%3D%22rgba%2816%2C185%2C129%2C0.18%29%22/%3E%0A%3Ctext%20x%3D%2218%22%20y%3D%2226%22%20font-size%3D%2216%22%20font-family%3D%22Arial%22%20font-weight%3D%22900%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.70%29%22%3EChart%20Hills%3C/text%3E%0A%3Ctext%20x%3D%22622%22%20y%3D%2226%22%20font-size%3D%2216%22%20font-family%3D%22Arial%22%20font-weight%3D%22900%22%20text-anchor%3D%22end%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.70%29%22%3EBen%20Hogan%3C/text%3E%0A%3Ctext%20x%3D%2218%22%20y%3D%2246%22%20font-size%3D%2212%22%20font-family%3D%22Arial%22%20font-weight%3D%22700%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.55%29%22%3EStrokes%3A%2059%20%20%C2%B7%20%20Stableford%3A%2054%3C/text%3E%0A%3Cg%3E%0A%3Ctext%20x%3D%2260%22%20y%3D%2292%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E6%3C/text%3E%3Ctext%20x%3D%22116%22%20y%3D%2292%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E7%3C/text%3E%3Ctext%20x%3D%22172%22%20y%3D%2292%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E8%3C/text%3E%3Ctext%20x%3D%22228%22%20y%3D%2292%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E9%3C/text%3E%3Ctext%20x%3D%22284%22%20y%3D%2292%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E1%3C/text%3E%3Ctext%20x%3D%22340%22%20y%3D%2292%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E2%3C/text%3E%3Ctext%20x%3D%22396%22%20y%3D%2292%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E3%3C/text%3E%3Ctext%20x%3D%22452%22%20y%3D%2292%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E4%3C/text%3E%3Ctext%20x%3D%22508%22%20y%3D%2292%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E5%3C/text%3E%3Ctext%20x%3D%2260%22%20y%3D%22144%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E9%3C/text%3E%3Ctext%20x%3D%22116%22%20y%3D%22144%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E1%3C/text%3E%3Ctext%20x%3D%22172%22%20y%3D%22144%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E2%3C/text%3E%3Ctext%20x%3D%22228%22%20y%3D%22144%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E3%3C/text%3E%3Ctext%20x%3D%22284%22%20y%3D%22144%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E4%3C/text%3E%3Ctext%20x%3D%22340%22%20y%3D%22144%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E5%3C/text%3E%3Ctext%20x%3D%22396%22%20y%3D%22144%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E6%3C/text%3E%3Ctext%20x%3D%22452%22%20y%3D%22144%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E7%3C/text%3E%3Ctext%20x%3D%22508%22%20y%3D%22144%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E8%3C/text%3E%3Ctext%20x%3D%2260%22%20y%3D%22196%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E3%3C/text%3E%3Ctext%20x%3D%22116%22%20y%3D%22196%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E4%3C/text%3E%3Ctext%20x%3D%22172%22%20y%3D%22196%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E5%3C/text%3E%3Ctext%20x%3D%22228%22%20y%3D%22196%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E6%3C/text%3E%3Ctext%20x%3D%22284%22%20y%3D%22196%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E7%3C/text%3E%3Ctext%20x%3D%22340%22%20y%3D%22196%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E8%3C/text%3E%3Ctext%20x%3D%22396%22%20y%3D%22196%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E9%3C/text%3E%3Ctext%20x%3D%22452%22%20y%3D%22196%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E1%3C/text%3E%3Ctext%20x%3D%22508%22%20y%3D%22196%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E2%3C/text%3E%3Ctext%20x%3D%2260%22%20y%3D%22248%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E6%3C/text%3E%3Ctext%20x%3D%22116%22%20y%3D%22248%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E7%3C/text%3E%3Ctext%20x%3D%22172%22%20y%3D%22248%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E8%3C/text%3E%3Ctext%20x%3D%22228%22%20y%3D%22248%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E9%3C/text%3E%3Ctext%20x%3D%22284%22%20y%3D%22248%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E1%3C/text%3E%3Ctext%20x%3D%22340%22%20y%3D%22248%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E2%3C/text%3E%3Ctext%20x%3D%22396%22%20y%3D%22248%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E3%3C/text%3E%3Ctext%20x%3D%22452%22%20y%3D%22248%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E4%3C/text%3E%3Ctext%20x%3D%22508%22%20y%3D%22248%22%20font-size%3D%2218%22%20font-family%3D%22Arial%22%20fill%3D%22rgba%2815%2C23%2C42%2C0.35%29%22%3E5%3C/text%3E%0A%3C/g%3E%0A%3C/svg%3E"),
            linear-gradient(180deg, rgba(226,232,240,0.95) 0%, rgba(226,232,240,0.95) 16%, transparent 16%),
            repeating-linear-gradient(0deg, rgba(148,163,184,0.22) 0px, rgba(148,163,184,0.22) 1px, transparent 1px, transparent 12px),
            repeating-linear-gradient(90deg, rgba(148,163,184,0.18) 0px, rgba(148,163,184,0.18) 1px, transparent 1px, transparent 22px),
            linear-gradient(180deg, rgba(255,255,255,0.90), rgba(255,255,255,0.66));
          background-size: cover, auto, auto, auto, auto;
          background-blend-mode: normal, normal, normal, normal, normal;
        }
      `}),e.jsx("div",{className:"hm-stage",children:e.jsxs("div",{className:"hm-grid",children:[e.jsxs("div",{className:"hm-hero",children:[e.jsx("div",{className:"hm-glow"}),e.jsxs("div",{className:"hm-hero-inner",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Explore Your Games"}),e.jsx("p",{className:"hm-sub",children:"Dive into your rounds. Find patterns. Spot surprises."}),e.jsx("div",{style:{color:"rgba(255,255,255,0.84)",fontWeight:800,marginTop:8},children:"Inside you‚Äôll find:"}),e.jsxs("div",{className:"hm-cta-row",children:[e.jsxs("button",{className:"hm-cta",onClick:()=>r("past"),children:[e.jsx("span",{className:"hm-arrow",children:"‚Üí"}),e.jsx("span",{children:"Enter Game Explorer"})]}),e.jsx("div",{className:"hm-stats",children:te})]}),e.jsx("div",{className:"hm-inline-menu","aria-label":"Menu options (visual)",children:e.jsxs("div",{className:"hm-inline-menu-grid",children:[e.jsxs("div",{className:"hm-inline-item",children:[e.jsx("span",{className:"hm-ico",children:"‚õ≥"}),e.jsx("span",{children:"Game"})]}),e.jsxs("div",{className:"hm-inline-item",children:[e.jsx("span",{className:"hm-ico",children:"üìà"}),e.jsx("span",{children:"Graphs"})]}),e.jsxs("div",{className:"hm-inline-item",children:[e.jsx("span",{className:"hm-ico",children:"üßæ"}),e.jsx("span",{children:"Player Scorecard"})]}),e.jsxs("div",{className:"hm-inline-item",children:[e.jsx("span",{className:"hm-ico",children:"üó∫Ô∏è"}),e.jsx("span",{children:"Course Stats"})]}),e.jsxs("div",{className:"hm-inline-item",children:[e.jsx("span",{className:"hm-ico",children:"‚≠ê"}),e.jsx("span",{children:"Ratings"})]}),e.jsxs("div",{className:"hm-inline-item",children:[e.jsx("span",{className:"hm-ico",children:"üòÇ"}),e.jsx("span",{children:"Banter"})]}),e.jsxs("div",{className:"hm-inline-item",children:[e.jsx("span",{className:"hm-ico",children:"üéØ"}),e.jsx("span",{children:"Styles"})]}),e.jsxs("div",{className:"hm-inline-item",children:[e.jsx("span",{className:"hm-ico",children:"üìñ"}),e.jsx("span",{children:"Story"})]}),e.jsxs("div",{className:"hm-inline-item",children:[e.jsx("span",{className:"hm-ico",children:"üì∫"}),e.jsx("span",{children:"Replay"})]}),e.jsxs("div",{className:"hm-inline-item",children:[e.jsx("span",{className:"hm-ico",children:"ü§º"}),e.jsx("span",{children:"Teams"})]}),e.jsxs("div",{className:"hm-inline-item",children:[e.jsx("span",{className:"hm-ico",children:"üé∞"}),e.jsx("span",{children:"Casino"})]}),e.jsxs("div",{className:"hm-inline-item",children:[e.jsx("span",{className:"hm-ico",children:"üèÜ"}),e.jsx("span",{children:"Trophies"})]}),e.jsxs("div",{className:"hm-inline-item",children:[e.jsx("span",{className:"hm-ico",children:"ü§ù"}),e.jsx("span",{children:"Partners"})]}),e.jsxs("div",{className:"hm-inline-item",children:[e.jsx("span",{className:"hm-ico",children:"ü•ä"}),e.jsx("span",{children:"Rivalry"})]})]})})]}),e.jsx("div",{className:"hm-hero-right",children:e.jsxs("div",{className:"hm-mini-stack","aria-hidden":"true",children:[e.jsx("div",{className:"hm-sheet s1"}),e.jsx("div",{className:"hm-sheet s2"}),e.jsx("div",{className:"hm-sheet s3"})]})})]})]}),e.jsx("button",{className:"hm-card heroish",onClick:()=>r("player_progress"),style:{textAlign:"left",cursor:"pointer"},children:e.jsxs("div",{className:"hm-card-inner",children:[e.jsxs("div",{style:{minWidth:0},children:[e.jsx("h3",{children:"Review & Improve"}),e.jsx("div",{className:"hm-desc",children:"Turn insight into better scores."}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("span",{className:"hm-ico2",children:"üßæ"}),e.jsx("span",{children:"See what actually costs you points"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"hm-ico2",children:"üí™"}),e.jsx("span",{children:"Find your biggest strengths vs the field"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"hm-ico2",children:"üß≠"}),e.jsx("span",{children:"Build simple game plans that work"})]})]})]}),e.jsxs("div",{className:"hm-card-action",children:[e.jsx("button",{className:"hm-linkbtn",onClick:Z=>{Z.stopPropagation(),r("player_progress")},children:e.jsx("span",{children:"‚Üí Review Performance"})}),e.jsx("div",{className:"hm-pill",children:"‚ãØ"})]})]})}),e.jsxs("div",{className:"hm-row2",children:[e.jsx("button",{className:"hm-card heroish",onClick:()=>r("standings"),style:{textAlign:"left",cursor:"pointer"},children:e.jsxs("div",{className:"hm-card-inner",children:[e.jsxs("div",{style:{minWidth:0},children:[e.jsx("h3",{children:"League Standings"}),e.jsx("div",{className:"hm-desc",children:"How the season is shaping up."}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("span",{className:"hm-ico2",children:"üìã"}),e.jsx("span",{children:"Current rankings"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"hm-ico2",children:"üìâ"}),e.jsx("span",{children:"Points gaps & momentum"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"hm-ico2",children:"üìà"}),e.jsx("span",{children:"Who‚Äôs climbing, who‚Äôs slipping"})]})]})]}),e.jsxs("div",{className:"hm-card-action",children:[e.jsx("button",{className:"hm-linkbtn",onClick:Z=>{Z.stopPropagation(),r("standings")},children:e.jsx("span",{children:"‚Üí View League"})}),e.jsx("div",{className:"hm-pill",children:"‚ãØ"})]})]})}),e.jsx("button",{className:"hm-card heroish",onClick:()=>r("eclectic"),style:{textAlign:"left",cursor:"pointer"},children:e.jsxs("div",{className:"hm-card-inner",children:[e.jsxs("div",{style:{minWidth:0},children:[e.jsx("h3",{children:"Eclectic"}),e.jsx("div",{className:"hm-desc",children:"Your best golf, stitched together."}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("span",{className:"hm-ico2",children:"üèÅ"}),e.jsx("span",{children:"Best score on every hole"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"hm-ico2",children:"üß©"}),e.jsx("span",{children:"What your ‚Äúperfect round‚Äù looks like"})]}),e.jsxs("li",{children:[e.jsx("span",{className:"hm-ico2",children:"üõ†Ô∏è"}),e.jsx("span",{children:"Where improvement still lives"})]})]})]}),e.jsxs("div",{className:"hm-card-action",children:[e.jsx("button",{className:"hm-linkbtn",onClick:Z=>{Z.stopPropagation(),r("eclectic")},children:e.jsx("span",{children:"‚Üí View Eclectic"})}),e.jsx("div",{className:"hm-pill",children:"‚ãØ"})]})]})})]}),e.jsx("button",{className:"hm-admin",onClick:()=>r("admin"),style:{textAlign:"left",cursor:"pointer"},children:e.jsxs("div",{className:"hm-admin-inner",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"hm-admin-title",children:[e.jsx("span",{className:"hm-gear",children:"‚öôÔ∏è"}),e.jsx("span",{children:"Admin"})]}),e.jsxs("div",{className:"hm-admin-sub",children:["Settings, imports, season setup, players",D!=null?` ¬∑ Players: ${E}/${D}`:"",C?` ¬∑ Signed in as ${X}`:""]})]}),e.jsx("div",{className:"hm-pill",style:{background:"rgba(255,255,255,0.10)",borderColor:"rgba(255,255,255,0.18)"},children:"‚Üó"})]})}),e.jsx("div",{className:"hm-foot",children:"Most players discover something new every time they explore their games. üí°"})]})})]})}function cn({activeRole:s,isSuperAdmin:a,setView:r,fileInputRef:u,importLocalCSV:d,computed:A,addEventToSeason:x,removeEventFromSeason:g,clearSeason:c,seasonsDef:o,leagueSeasonYear:m,setLeagueSeasonYear:M,activeSocietyId:n,activeSocietySlug:l,user:f,handleLogin:E,handleLogout:D,handleSwitchSociety:C,openPlayersAdmin:N,visiblePlayersCount:X,totalPlayersCount:J}){const I=String(s||"").toLowerCase(),V=!!f&&(a||I==="admin"||I==="captain"),te=V?f.email||"Admin":"Not signed in",Z=!!(A&&A.length);function Qe(xe){return String(xe||"").trim().toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")}const xt=(Array.isArray(o)?o:[]).slice().sort((xe,fe)=>String((xe==null?void 0:xe.label)||(xe==null?void 0:xe.season_id)||"").localeCompare(String((fe==null?void 0:fe.label)||(fe==null?void 0:fe.season_id)||""))),[mt,vt]=ue.useState(!1),[jt,He]=ue.useState(""),[Je,b]=ue.useState("season"),[j,O]=ue.useState(""),[T,ae]=ue.useState(""),[ye,U]=ue.useState(!1),[at,ce]=ue.useState(""),[gt,ot]=ue.useState(!1),[qe,Dt]=ue.useState(""),[bt,ke]=ue.useState(""),[w,Le]=ue.useState(""),[Fe,Vt]=ue.useState(""),[fs,wt]=ue.useState(!1),[ft,ut]=ue.useState(""),[Me,Jt]=ue.useState("season"),[_t,Kt]=ue.useState(!1);ue.useEffect(()=>{qe&&(bt||ke(Qe(qe)))},[qe,bt]);async function W(){var $t,Qt;if(!V)return;const xe=window.__supabase_client__;if(!xe){ce("Supabase client missing.");return}try{const{data:Rt}=await xe.auth.getSession();if(!((Qt=($t=Rt==null?void 0:Rt.session)==null?void 0:$t.user)!=null&&Qt.id)){ce("You must Sign in as Captain before creating a season.");return}}catch{ce("You must Sign in as Captain before creating a season.");return}const fe=(jt||"").trim();if(!fe){ce("Enter a season name.");return}const Oe=(Je||"season").trim(),me=Qe(fe)||`season-${Date.now()}`,re=new Date,ie=Rt=>{const ps=Rt.getFullYear(),es=String(Rt.getMonth()+1).padStart(2,"0"),Ht=String(Rt.getDate()).padStart(2,"0");return`${ps}-${es}-${Ht}`},St=(j||"").trim()||ie(re),Gt=new Date(re);Gt.setFullYear(Gt.getFullYear()+1);const ge=(T||"").trim()||ie(Gt);U(!0),ce("Creating season‚Ä¶");try{const{error:Rt}=await xe.from("seasons").insert([{society_id:n,competition:Oe,season_id:me,label:fe,start_date:St,end_date:ge,is_active:!1}]);if(Rt)throw Rt;ce(`‚úÖ Season created: ${fe}`),vt(!1),He(""),O(""),ae(""),M(me)}catch(Rt){ce((Rt==null?void 0:Rt.message)||String(Rt))}finally{U(!1)}}async function de(){if(!V)return;const xe=window.__supabase_client__;if(!xe){ce("Supabase client missing.");return}const fe=(qe||"").trim(),Oe=(bt||""||Qe(fe)).trim(),me=(w||"").trim();if(!fe)return ce("Enter a society name.");if(!Oe)return ce("Enter a slug (or let it auto-generate).");Kt(!0),ce("Creating society‚Ä¶");try{const{data:re,error:ie}=await xe.rpc("create_society_as_captain",{society_name:fe,society_slug:Oe,first_season_name:me||null});if(ie)throw ie;if(!String(re||""))throw new Error("Create society RPC returned no id.");ce(`‚úÖ Society created: ${fe}`),ot(!1),Dt(""),ke(""),Le("");const Gt="/golf/".replace(/\/+$/,"/");window.location.href=`${Gt}${Oe}`}catch(re){const ie=(re==null?void 0:re.message)||String(re);/create_society_as_captain/i.test(ie)||/function .* does not exist/i.test(ie)?ce("Create society needs a Supabase SQL RPC called create_society_as_captain (security definer). If you haven‚Äôt added it yet, ask me for the SQL and I‚Äôll give you a copy/paste migration."):ce(ie)}finally{Kt(!1)}}async function Te(xe){var me;(me=xe==null?void 0:xe.preventDefault)==null||me.call(xe),ut("");const fe=(Fe||"").trim().toLowerCase();if(!fe)return;const Oe=window.__supabase_client__;if(!Oe){ut("Supabase client missing.");return}wt(!0);try{const{error:re}=await Oe.rpc("add_captain_email",{p_society_id:n,p_email:fe});if(re)throw re;ut("Captain invite recorded. They will become captain on first login."),Vt("")}catch(re){ut("Error: "+((re==null?void 0:re.message)||re))}finally{wt(!1)}}return e.jsxs("section",{className:"content-card p-4 md:p-6 hm-stage",children:[e.jsx(ya,{setView:r,title:"Admin",left:e.jsx("button",{className:"btn-secondary",onClick:()=>r("home"),children:"‚Üê Home"})}),e.jsx("div",{className:"glass-card p-4 border border-neutral-200",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-400",children:"Access"}),e.jsx("div",{className:"mt-1 text-sm font-extrabold text-neutral-900 truncate",children:te}),e.jsx("div",{className:"text-xs text-neutral-500",children:"Sign in to upload/delete events and edit season standings."})]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:V?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn-secondary",onClick:C,children:"Switch Society"}),e.jsx("button",{className:"btn-secondary",onClick:D,children:"Sign Out"})]}):e.jsx("button",{className:"btn-primary",onClick:E,children:"Sign In"})})]})}),e.jsxs("div",{className:"mt-4 grid md:grid-cols-2 gap-3",children:[e.jsx("button",{className:"btn-primary w-full "+(V?"":"opacity-50 cursor-not-allowed"),onClick:()=>V&&u.current&&u.current.click(),disabled:!V,title:V?"Load a new CSV event":"Sign in first",children:"‚¨ÜÔ∏è Import New Games"}),e.jsxs("div",{className:"glass-card p-3 border border-neutral-200",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-400",children:"Loaded event"}),e.jsx("div",{className:"mt-1 text-sm font-extrabold text-neutral-900",children:Z?"Ready":"None loaded"}),e.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:Z?"You can add/remove this event from the season.":"Load an event before using Add/Remove."})]})]}),e.jsx("input",{ref:u,type:"file",accept:".csv",className:"hidden",onChange:async xe=>{var me;const fe=(me=xe.target.files)==null?void 0:me[0];if(!fe)return;const Oe=await fe.text();d(Oe,fe.name,fe),xe.target.value=""}}),e.jsxs("div",{className:"mt-4 grid md:grid-cols-3 gap-3",children:[e.jsx("button",{className:"btn-primary w-full "+(!V||!Z?"opacity-50 cursor-not-allowed":""),onClick:()=>V&&Z&&x&&x(),disabled:!V||!Z,title:V?Z?"Uploads the loaded event and updates standings":"Load an event first":"Sign in first",children:"‚ûï Add Event to Season"}),e.jsx("button",{className:"btn-secondary w-full "+(Z?"":"opacity-50 cursor-not-allowed"),onClick:()=>Z&&g&&g(),disabled:!Z,title:Z?"Removes the loaded event's points from season standings":"Load an event first",children:"‚ûñ Remove Loaded Event"}),e.jsx("button",{className:"btn-secondary w-full "+(!V||!m?"opacity-50 cursor-not-allowed":""),onClick:()=>V&&m&&c?c():null,disabled:!V||!m,title:V?m?"Deletes the selected season's data":"Pick a season first":"Sign in first",children:"üóëÔ∏è Delete whole season"})]}),e.jsxs("div",{className:"mt-4 glass-card p-4 border border-neutral-200",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-400",children:"Season / competition"}),e.jsx("div",{className:"mt-1 text-sm font-extrabold text-neutral-900",children:"Choose a season"}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("select",{className:"w-full rounded-xl border border-neutral-200 bg-white px-3 py-2 text-sm",value:m||"",onChange:xe=>M&&M(xe.target.value),disabled:!V,title:V?"Select the season you want to work on":"Sign in first",children:[e.jsx("option",{value:"",children:"-- Select season --"}),(xt||[]).map(xe=>{const fe=String(xe.season_id||""),Oe=String(xe.label||xe.season_id||"(unnamed)"),me=String(xe.competition||"");return e.jsxs("option",{value:fe,children:[Oe,me?` (${me})`:""]},fe)})]}),e.jsxs("div",{className:"mt-2 text-xs text-neutral-500",children:["This selection is used by ",e.jsx("span",{className:"font-black",children:"Add game to season"})," and ",e.jsx("span",{className:"font-black",children:"Delete whole season"}),"."]})]})]}),e.jsxs("div",{className:"mt-4 glass-card p-4 border border-neutral-200",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-400",children:"Season"}),e.jsx("div",{className:"mt-1 text-sm font-extrabold text-neutral-900",children:"Create a new season"}),e.jsx("div",{className:"text-xs text-neutral-500",children:"Creates a new season in the current society."})]}),e.jsx("button",{className:"btn-primary "+(V?"":"opacity-50 cursor-not-allowed"),onClick:()=>V?vt(!0):null,disabled:!V,title:V?"Create a new season":"Sign in first",children:"‚ûï Create a new season"})]}),mt?e.jsxs("form",{className:"mt-4 grid gap-2",onSubmit:xe=>{xe.preventDefault(),W()},children:[e.jsx("label",{className:"text-xs font-black text-neutral-600",children:"Season / Competition label"}),e.jsx("input",{className:"w-full rounded-xl border border-neutral-200 bg-white px-3 py-2 text-sm",value:jt,onChange:xe=>He(xe.target.value),placeholder:"e.g. Winter League 2026"}),e.jsx("label",{className:"text-xs font-black text-neutral-600 mt-2",children:"Competition type"}),e.jsxs("select",{className:"w-full rounded-xl border border-neutral-200 bg-white px-3 py-2 text-sm",value:Je,onChange:xe=>b(xe.target.value),children:[e.jsx("option",{value:"season",children:"season"}),e.jsx("option",{value:"winter",children:"winter"}),e.jsx("option",{value:"league",children:"league"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-black text-neutral-600",children:"Start date"}),e.jsx("input",{className:"w-full rounded-xl border border-neutral-200 bg-white px-3 py-2 text-sm",type:"date",value:j,onChange:xe=>O(xe.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-black text-neutral-600",children:"End date"}),e.jsx("input",{className:"w-full rounded-xl border border-neutral-200 bg-white px-3 py-2 text-sm",type:"date",value:T,onChange:xe=>ae(xe.target.value)})]})]}),at?e.jsx("div",{className:"mt-2 text-xs rounded-xl px-3 py-2 border border-neutral-200 bg-neutral-50",children:at}):null,e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[e.jsx("button",{type:"button",className:"btn",onClick:()=>{vt(!1),ce("")},disabled:ye,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:ye,children:ye?"Creating‚Ä¶":"Create season"})]})]}):null]}),e.jsxs("div",{className:"mt-4 glass-card p-4 border border-neutral-200",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-400",children:"Society"}),e.jsx("div",{className:"mt-1 text-sm font-extrabold text-neutral-900",children:"Create a new society"}),e.jsx("div",{className:"text-xs text-neutral-500",children:"Captains can create a new society quickly ‚Äî no invite code required."})]}),e.jsx("button",{className:"btn-primary "+(V?"":"opacity-50 cursor-not-allowed"),onClick:()=>V?ot(!0):null,disabled:!V,title:V?"Create a new society":"Sign in first",children:"üèÅ Create a new Society"})]}),gt?e.jsxs("form",{className:"mt-4 grid gap-2",onSubmit:xe=>{xe.preventDefault(),de()},children:[e.jsx("label",{className:"text-xs font-black text-neutral-600",children:"Society name"}),e.jsx("input",{className:"w-full rounded-xl border border-neutral-200 bg-white px-3 py-2 text-sm",value:qe,onChange:xe=>Dt(xe.target.value),placeholder:"e.g. Dennis The Menace"}),e.jsx("label",{className:"text-xs font-black text-neutral-600 mt-2",children:"Slug (optional)"}),e.jsx("input",{className:"w-full rounded-xl border border-neutral-200 bg-white px-3 py-2 text-sm",value:bt,onChange:xe=>ke(xe.target.value),placeholder:"e.g. dennis-the-menace"}),e.jsxs("div",{className:"text-xs text-neutral-500",children:["This becomes the golfer link: ",e.jsx("span",{className:"font-mono",children:"/golf/<slug>"})]}),e.jsx("label",{className:"text-xs font-black text-neutral-600 mt-2",children:"First season label"}),e.jsx("input",{className:"w-full rounded-xl border border-neutral-200 bg-white px-3 py-2 text-sm",value:w,onChange:xe=>Le(xe.target.value),placeholder:"e.g. Holiday"}),e.jsx("label",{className:"text-xs font-black text-neutral-600 mt-2",children:"Competition type"}),e.jsxs("select",{className:"w-full rounded-xl border border-neutral-200 bg-white px-3 py-2 text-sm",value:Me,onChange:xe=>Jt(xe.target.value),children:[e.jsx("option",{value:"season",children:"season"}),e.jsx("option",{value:"winter",children:"winter"}),e.jsx("option",{value:"league",children:"league"})]}),at?e.jsx("div",{className:"mt-2 text-xs rounded-xl px-3 py-2 border border-neutral-200 bg-neutral-50",children:at}):null,e.jsxs("div",{className:"flex items-center justify-between gap-2 mt-2",children:[e.jsx("button",{type:"button",className:"btn",onClick:()=>{ce(""),ot(!1)},children:"Back"}),e.jsx("button",{className:"btn-primary",disabled:_t,children:_t?"Creating‚Ä¶":"Create society"})]}),e.jsxs("div",{className:"mt-2 text-xs text-neutral-500",children:["Note: this uses a Supabase RPC called ",e.jsx("span",{className:"font-mono",children:"create_society_as_captain"}),". If you haven't created that function yet, this will fail."]})]}):null]}),a?e.jsxs("div",{className:"mt-4 glass-card p-4 border border-neutral-200",children:[e.jsx("div",{className:"flex flex-wrap items-center justify-between gap-3",children:e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-400",children:"Captains"}),e.jsx("div",{className:"mt-1 text-sm font-extrabold text-neutral-900",children:"Add captain by email"}),e.jsx("div",{className:"text-xs text-neutral-500",children:"Add an email here. When they sign in via magic link, they‚Äôll automatically become captain."})]})}),e.jsxs("form",{className:"mt-3 flex flex-wrap items-end gap-2",onSubmit:Te,children:[e.jsxs("label",{className:"flex-1 min-w-[240px]",children:[e.jsx("div",{className:"text-xs font-bold text-neutral-500 mb-1",children:"Captain email"}),e.jsx("input",{className:"input w-full",type:"email",value:Fe,onChange:xe=>Vt(xe.target.value),placeholder:"captain@domain.com"})]}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:fs||!Fe.trim(),children:fs?"Adding‚Ä¶":"Add captain"})]}),ft?e.jsx("div",{className:"mt-2 text-xs font-semibold text-neutral-600",children:ft}):null]}):null,e.jsxs("div",{className:"mt-4 glass-card p-4 border border-neutral-200",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-400",children:"Players view"}),e.jsx("div",{className:"mt-1 text-sm font-extrabold text-neutral-900",children:"Share this link with golfers"}),e.jsx("div",{className:"mt-2 text-sm",children:e.jsx("a",{className:"underline font-mono",href:`https://kevanojb.github.io/golf/${String(l||"")}`,target:"_blank",rel:"noreferrer",children:`https://kevanojb.github.io/golf/${String(l||"")}`})}),l?null:e.jsx("div",{className:"mt-2 text-xs text-amber-700",children:"This society has no slug set ‚Äî please set a slug so golfers can use a friendly URL."})]}),e.jsx("div",{className:"mt-4 glass-card p-4 border border-neutral-200",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-400",children:"Players"}),e.jsx("div",{className:"mt-1 text-sm font-extrabold text-neutral-900",children:"Manage Players"}),e.jsxs("div",{className:"text-xs text-neutral-500",children:["Show/hide players across leaderboards & reports.",Number.isFinite(X)&&Number.isFinite(J)&&J?e.jsxs("span",{className:"ml-2",children:["Showing ",e.jsx("span",{className:"font-black",children:X})," / ",e.jsx("span",{className:"font-black",children:J})]}):null]})]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.jsx("button",{className:"btn-primary "+(V?"":"opacity-50 cursor-not-allowed"),onClick:()=>V&&N&&N(),disabled:!V,title:V?"Choose which players are included for everyone":"Sign in first",children:"üë• Manage Players"})})]})}),e.jsx("div",{className:"mt-3 text-xs text-neutral-500",children:"Tip: League & Eclectic are public ‚Äî Admin is only for captains."})]})}function dn({sharedGroups:s,loadShared:a,setView:r}){function u(D){let C=2166136261;for(let N=0;N<D.length;N++)C^=D.charCodeAt(N),C=Math.imul(C,16777619);return C>>>0}function d(D){try{return Number.isFinite(D)?new Date(D).toLocaleDateString("en-GB",{timeZone:"UTC",year:"numeric",month:"short",day:"2-digit"}):""}catch{return""}}function A(D){const C=u(D||"golf"),N=95+C%40,X=190+(C>>5)%40,J=35+(C>>9)%25,I=18+(C>>12)%14,V=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 360">
  <defs>
    <linearGradient id="sky" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0" stop-color="hsl(${X} 55% 72%)"/>
      <stop offset="1" stop-color="hsl(${X} 45% 86%)"/>
    </linearGradient>
    <linearGradient id="grass" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0" stop-color="hsl(${N} 45% 34%)"/>
      <stop offset="1" stop-color="hsl(${N} 55% 22%)"/>
    </linearGradient>
    <radialGradient id="sun" cx="78%" cy="22%" r="55%">
      <stop offset="0" stop-color="hsla(${J} 95% 75% .55)"/>
      <stop offset=".55" stop-color="hsla(${J} 95% 75% .18)"/>
      <stop offset="1" stop-color="hsla(${J} 95% 75% 0)"/>
    </radialGradient>
    <filter id="grain" x="-20%" y="-20%" width="140%" height="140%">
      <feTurbulence type="fractalNoise" baseFrequency=".9" numOctaves="2" stitchTiles="stitch"/>
      <feColorMatrix type="matrix" values="
        1 0 0 0 0
        0 1 0 0 0
        0 0 1 0 0
        0 0 0 .08 0"/>
    </filter>
  </defs>

  <rect width="640" height="360" fill="url(#sky)"/>
  <rect width="640" height="360" fill="url(#sun)"/>
  <path d="M0 ${170-I} C 110 ${155-I}, 240 ${190-I}, 330 ${175-I} C 450 ${155-I}, 530 ${195-I}, 640 ${180-I} L 640 360 L 0 360 Z"
        fill="url(#grass)"/>
  <path d="M-40 360 C 110 ${280+I}, 210 ${230+I}, 340 ${240+I} C 480 ${255+I}, 540 ${310+I}, 700 360 L 700 420 L -40 420 Z"
        fill="hsla(${N} 55% 46% .35)"/>
  <path d="M60 360 C 160 ${310+I}, 250 ${245+I}, 330 ${250+I} C 430 ${258+I}, 500 ${315+I}, 610 360"
        stroke="hsla(${N} 70% 62% .45)" stroke-width="16" stroke-linecap="round" fill="none"/>
  <path d="M86 360 C 175 ${312+I}, 255 ${260+I}, 330 ${258+I} C 420 ${265+I}, 490 ${322+I}, 585 360"
        stroke="hsla(${N} 65% 78% .25)" stroke-width="10" stroke-linecap="round" fill="none"/>
  <circle cx="520" cy="260" r="22" fill="hsla(0 0% 100% .22)"/>
  <circle cx="520" cy="260" r="10" fill="hsla(0 0% 100% .25)"/>
  <g opacity=".9">
    <rect x="118" y="146" width="3" height="86" rx="1.5" fill="hsla(0 0% 100% .65)"/>
    <path d="M121 148 L 165 158 L 121 170 Z" fill="hsla(${J} 95% 62% .9)"/>
  </g>
  <rect width="640" height="360" filter="url(#grain)" opacity=".55"/>
</svg>`;return"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(V)}const x=ue.useRef(new Map),[g,c]=ue.useState(!1);ue.useEffect(()=>{let D=!1;async function C(){const N=new Set;s.forEach(X=>{X.events.forEach(J=>{const I=(J.courseName||J.name||"").replace(/\.csv$/i,""),V=m(I);V&&N.add(V)})});for(const X of N)x.current.has(X)||await M(X);D||c(!0)}return C(),()=>{D=!0}},[s]);const o=ue.useRef(new Map);function m(D){return(D||"").toLowerCase().replace(/\b(19|20)\d{2}\b/g,"").replace(/\b(golf\s*club|golf|club)\b/g,"").replace(/\bgc\b/g,"").replace(/[^a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/(^-|-$)/g,"").trim()}async function M(D){const C=(D||"").trim();if(!C)return null;const N=x.current;if(N.has(C))return N.get(C);const X=o.current;if(X.has(C))return await X.get(C);const J=(async()=>{try{if(!window.__supabase_client__)return null;const I=window.__supabase_client__,{data:V,error:te}=await I.from("courses").select("photo_urls").eq("slug",C).maybeSingle();if(te)return null;const Z=Array.isArray(V==null?void 0:V.photo_urls)?V.photo_urls:null;return N.set(C,Z),Z}catch{return null}finally{X.delete(C)}})();return X.set(C,J),await J}function n(D,C){if(!D||D.length===0)return null;const N=u(C||"golf");return D[N%D.length]}const[l,f]=ue.useState(0);function E(){f(D=>(D+1)%1e6)}return e.jsxs("section",{className:"rounded-2xl p-3 md:p-4 bg-white border border-squab-200 shadow-sm",children:[e.jsx(ga,{items:[{label:"Analyse Game"}]}),e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("h2",{className:"text-lg font-semibold text-squab-900",children:"Analyse Game"})}),s.length===0&&e.jsx("div",{className:"text-sm text-neutral-600 p-2",children:"No shared CSVs yet."}),e.jsx("div",{className:"text-xs text-neutral-500 mb-3",children:"Pick an event by course image (name + date). No more boring filenames."}),s.map(D=>e.jsxs("div",{className:"mb-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-500",children:D.year}),e.jsxs("div",{className:"text-[11px] text-neutral-400",children:[D.events.length," event",D.events.length===1?"":"s"]})]}),e.jsx("div",{className:"event-grid",children:D.events.map(C=>{const N=(C.courseName||C.name||"").replace(/\.csv$/i,""),X=d(C.dateMs),J=(N||"")+"|"+String(C.dateMs||"")+"|"+String(C.path||"");let I=A(J);const V=m(N);console.log("COURSE:",N,"=> SLUG IT SEARCHES:",V);const te=x.current.get(V),Z=n(te,J);return Z?I=Z:V&&!o.current.has(V)&&!x.current.has(V)&&M(V).then(()=>E()),e.jsxs("button",{className:"event-card",onClick:async()=>{await a(C),r("event")},title:(X?X+" ‚Äî ":"")+N,children:[e.jsx("div",{className:"event-thumb",style:{backgroundImage:`url("${I}")`}}),e.jsxs("div",{className:"event-overlay",children:[e.jsx("div",{className:"event-title",children:N||"Event"}),e.jsxs("div",{className:"event-meta",children:[e.jsx("span",{className:"pill-mini",children:X||"Date unknown"}),e.jsx("span",{className:"pill-mini subtle",children:(C.format||"").toUpperCase()||"ROUND"})]})]})]},C.path)})})]},D.year))]})}function mn({computed:s,courseTees:a,setView:r}){const[u,d]=he.useState("");he.useEffect(()=>{!u&&s&&s.length&&d(s[0].name)},[s,u]);const A=he.useMemo(()=>ca(s),[s]);if(!s||!s.length)return e.jsxs("section",{className:"content-card p-4 md:p-6",children:[e.jsx(ya,{setView:r,title:"Player Scorecard",left:e.jsx(ms,{setView:r,hasEvent:!!(s&&s.length)})}),e.jsx("p",{className:"text-neutral-600",children:"Load an event to see player scorecards."})]});const x=s.map(N=>N.name),g=s.find(N=>N.name===u)||s[0],c=Na(g,a),o=Array.isArray(g.grossPerHole)?g.grossPerHole:Array(18).fill(NaN),m=Array.isArray(g.imputedMask)?g.imputedMask:Array(18).fill(!1),M=Array.isArray(g.perHole)?g.perHole:Array(18).fill(NaN),n=c&&Array.isArray(c.pars)&&c.pars.length===18?c.pars:Array(18).fill("‚Äî"),l=c&&Array.isArray(c.yards)&&c.yards.length===18?c.yards:Array(18).fill("‚Äî"),f=c&&Array.isArray(c.si)&&c.si.length===18?c.si:Array(18).fill("‚Äî"),E=o.reduce((N,X)=>Number.isFinite(X)?N+X:N,0),D=M.reduce((N,X)=>Number.isFinite(Number(X))?N+Number(X):N,0),C=he.useMemo(()=>{try{const N=g,X=(Array.isArray(N.perHole)?N.perHole:[]).slice(0,A).map(V=>Number(V));return!s||s.length<2?[]:s.filter(V=>V&&V.name&&V.name!==N.name).map(V=>{const te=(Array.isArray(V.perHole)?V.perHole:[]).slice(0,A).map(Je=>Number(Je));let Z=0,Qe=0,ve=0;const xt=[];for(let Je=0;Je<A;Je++){const b=X[Je],j=te[Je];if(!Number.isFinite(b)||!Number.isFinite(j))continue;const O=b-j;xt.push({i:Je+1,d:O}),O>0?Z++:O<0?Qe++:ve++}const mt=xt.filter(Je=>Je.d<0).sort((Je,b)=>Je.d-b.d).slice(0,3).map(Je=>Je.i),vt=X.reduce((Je,b)=>Number.isFinite(b)?Je+b:Je,0),jt=te.reduce((Je,b)=>Number.isFinite(b)?Je+b:Je,0),He=vt-jt;return{name:V.name,won:Z,lost:Qe,halved:ve,net:Z-Qe,ptsDiff:He,worstHoles:mt,samples:xt.length}}).sort((V,te)=>V.net-te.net||V.ptsDiff-te.ptsDiff)}catch{return[]}},[s,g,A]);return e.jsxs("section",{className:"content-card p-4 md:p-6",children:[e.jsx(ya,{setView:r,title:"Player Scorecard",left:e.jsx(ms,{setView:r,hasEvent:!!(s&&s.length)})}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs text-neutral-600",children:"Player"}),e.jsx("select",{className:"rounded-2xl border border-squab-200 px-3 py-2 bg-white text-sm min-w-[220px]",value:g.name,onChange:N=>d(N.target.value),children:x.map(N=>e.jsx("option",{value:N,children:N},N))}),e.jsxs("div",{className:"text-[11px] text-neutral-500 mt-1",children:["Tee: ",e.jsx("span",{className:"font-semibold",children:g.teeLabel||(c?c.teeName:"‚Äî")})]})]}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("div",{className:"px-3 py-2 rounded-2xl bg-white border border-squab-200",children:[e.jsx("div",{className:"text-[10px] font-black tracking-widest uppercase text-neutral-500",children:"Gross"}),e.jsx("div",{className:"text-lg font-extrabold tabular-nums",children:E||"‚Äî"})]}),e.jsxs("div",{className:"px-3 py-2 rounded-2xl bg-white border border-squab-200",children:[e.jsx("div",{className:"text-[10px] font-black tracking-widest uppercase text-neutral-500",children:"Stableford"}),e.jsx("div",{className:"text-lg font-extrabold tabular-nums",children:D||"‚Äî"})]})]})]}),c?null:e.jsx("div",{className:"p-3 rounded-2xl bg-amber-50 border border-amber-200 text-amber-900 text-sm",children:"No matching tee layout found for this player. Yards/SI may be blank."}),e.jsx("div",{className:"overflow-auto table-wrap",children:e.jsxs("table",{className:"min-w-full text-xs md:text-sm table-zebra",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-squab-200 bg-squab-50 text-left",children:[e.jsx("th",{children:"Hole"}),e.jsx("th",{className:"text-right px-3",children:"Par"}),e.jsx("th",{className:"text-right px-3",children:"Yards"}),e.jsx("th",{className:"text-right px-3",children:"SI"}),e.jsx("th",{className:"text-right px-3 border-l border-squab-200 pl-4",children:"Gross"}),e.jsx("th",{className:"text-right px-3",children:"Pts"})]})}),e.jsx("tbody",{children:Array.from({length:A},(N,X)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{children:X+1}),e.jsx("td",{className:"text-right px-3 tabular-nums",children:n[X]??"‚Äî"}),e.jsx("td",{className:"text-right px-3 tabular-nums",children:l[X]??"‚Äî"}),e.jsx("td",{className:"text-right px-3 tabular-nums",children:f[X]??"‚Äî"}),e.jsx("td",{className:"text-right px-3 tabular-nums border-l border-squab-200 pl-4 font-extrabold",children:(()=>{const J=o[X],I=!!m[X],V=Number(n[X]),te=Number.isFinite(J)&&Number.isFinite(V)?J-V:NaN;if(I&&Number.isFinite(J))return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-lg border border-amber-200 bg-amber-50 text-amber-900",children:[e.jsx("span",{className:"tabular-nums",children:J}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-wide",children:"NDB"})]});if(Number.isFinite(J)){const Z=Mr(te),Qe=Er(te);return e.jsx("span",{className:"inline-flex items-center justify-end min-w-[2.25rem] px-2 py-0.5 rounded-lg "+Z,title:Qe,children:e.jsx("span",{className:"tabular-nums",children:J})})}return"‚Äî"})()}),e.jsx("td",{className:"text-right px-3 tabular-nums font-semibold",children:(()=>{const J=Number(M[X]);if(!Number.isFinite(J))return"‚Äî";const I=Ir(J);return e.jsx("span",{className:"inline-flex items-center justify-end min-w-[2.25rem] px-2 py-0.5 rounded-lg "+I,title:J>=4?"Net eagle+":J===3?"Net birdie":J===2?"Net par":J===1?"Net bogey":"Net double+",children:e.jsx("span",{className:"tabular-nums",children:J})})})()})]},X))})]})}),C&&C.length>0&&e.jsxs("div",{className:"mt-4 rounded-3xl border border-neutral-200 bg-white p-4 md:p-5 shadow-sm",children:[e.jsx("div",{className:"flex items-start justify-between gap-3",children:e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs font-black tracking-widest text-neutral-500",children:"VS YOUR GROUP"}),e.jsx("div",{className:"text-sm md:text-base font-semibold text-squab-900",children:"Where you won or lost holes"}),e.jsx("div",{className:"text-xs text-neutral-500",children:"Hole wins are based on Stableford points per hole (higher wins). Only holes with points for both players are counted."})]})}),e.jsx("div",{className:"mt-3 space-y-2",children:C.map(N=>{const X=N.net>=3?"bg-emerald-50 text-emerald-900 border-emerald-200":N.net<=-3?"bg-rose-50 text-rose-900 border-rose-200":"bg-neutral-50 text-neutral-900 border-neutral-200",J=N.ptsDiff>=3?"text-emerald-700":N.ptsDiff<=-3?"text-rose-700":"text-neutral-600",I=Number.isFinite(N.ptsDiff)?`${N.ptsDiff>0?"+":""}${N.ptsDiff.toFixed(1)} pts`:"‚Äî";return e.jsxs("div",{className:"rounded-2xl border border-neutral-200 bg-white px-3 py-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-semibold text-squab-900 truncate max-w-[220px]",children:N.name}),e.jsxs("div",{className:"text-[11px] text-neutral-500",children:["Won ",N.won," ¬∑ Lost ",N.lost," ¬∑ Halved ",N.halved,N.samples?` ¬∑ n=${N.samples} holes`:""]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`text-[11px] font-bold px-2 py-1 rounded-full border ${X}`,children:["Net ",N.net>0?"+":"",N.net]}),e.jsx("span",{className:`text-[11px] font-bold ${J}`,children:I})]})]}),N.worstHoles&&N.worstHoles.length>0&&e.jsxs("div",{className:"mt-2 text-[11px] text-neutral-600",children:["Lost most ground on holes:"," ",e.jsx("span",{className:"font-semibold text-neutral-800",children:N.worstHoles.join(", ")})]})]},N.name)})})]})]})}function un({computed:s,setView:a,courseSlope:r,setCourseSlope:u,courseRating:d,setCourseRating:A,startHcapMode:x,setStartHcapMode:g,nextHcapMode:c,setNextHcapMode:o,oddsMaxRounds:m,setOddsMaxRounds:M,seasonRoundsFiltered:n,seasonRoundsAll:l,seasonModelAll:f,oddsExcludeMap:E,oddsExcludedNames:D,setExcludeFromOdds:C}){const[N,X]=he.useState(!1),J=he.useMemo(()=>{const I=W=>{const de=os(String(W||""));return!!(de&&E&&E[de])},V=(Array.isArray(s)?s:[]).filter(W=>W&&W.name&&!I(W.name)),te=new Map;V.forEach(W=>{const de=os(String(W.name||""));de&&te.set(de,W)});const Z=new Set,Qe=[],ve=[],xt=W=>{let de=Number((W==null?void 0:W.pts)??(W==null?void 0:W.points)??(W==null?void 0:W.stableford)??(W==null?void 0:W.sf)??(W==null?void 0:W.totalPoints)??(W==null?void 0:W.netPoints));if(!Number.isFinite(de)&&Array.isArray(W==null?void 0:W.perHole))try{de=W.perHole.reduce((Te,xe)=>Te+(Number(xe)||0),0)}catch{}return de};if(f&&Array.isArray(f.players)&&f.players.length){const W=new Map,de=[];for(const fe of f.players||[]){const Oe=String((fe==null?void 0:fe.name)||"").trim(),me=os(Oe);if(!me||I(Oe))continue;const re=Array.isArray(fe==null?void 0:fe.series)?fe.series:[];for(const ie of re){const St=xt(ie);if(!Number.isFinite(St))continue;const Gt=Number.isFinite(Number(ie==null?void 0:ie.dateMs))?Number(ie.dateMs):null,ge=String((ie==null?void 0:ie.file)??""),$t=String((ie==null?void 0:ie.teeLabel)??(ie==null?void 0:ie.tee)??(ie==null?void 0:ie.tee_name)??(ie==null?void 0:ie.teeName)??"").toLowerCase().trim(),Qt=String((ie==null?void 0:ie.gender)??(ie==null?void 0:ie.sex)??(fe==null?void 0:fe.gender)??(fe==null?void 0:fe.sex)??"").toUpperCase(),Rt=Qt==="F"||Qt==="FEMALE"||Qt==="W"||Qt==="WOMEN"?"F":"M",ps=$t||Rt,es=Number((ie==null?void 0:ie.hi)??(ie==null?void 0:ie.startExact)??(ie==null?void 0:ie.index)??(ie==null?void 0:ie.handicap)??(ie==null?void 0:ie.exact)??(fe==null?void 0:fe.hi)??(fe==null?void 0:fe.startExact));if(de.push({k:me,name:Oe,pts:St,hi:es,dateMs:Gt,gender:Rt,teeLabel:$t,groupKey:ps,file:ge}),Z.add(me),ge){W.has(ge)||W.set(ge,{pts:[],byGroup:new Map,dateMs:Gt});const Ht=W.get(ge);Ht.pts.push(St),Number.isFinite(Gt)&&!Number.isFinite(Number(Ht.dateMs))&&(Ht.dateMs=Gt),Ht.byGroup.has(ps)||Ht.byGroup.set(ps,[]),Ht.byGroup.get(ps).push(St)}}}const Te=new Map,xe=new Map;for(const[fe,Oe]of W.entries()){const me=Oe.pts.length?Oe.pts.reduce((re,ie)=>re+ie,0)/Oe.pts.length:36;Te.set(fe,me),ve.push({dateMs:Number.isFinite(Number(Oe.dateMs))?Number(Oe.dateMs):null,roundAvg:me,n:Oe.pts.length,file:fe});for(const[re,ie]of Oe.byGroup.entries()){const St=ie.length?ie.reduce((Gt,ge)=>Gt+ge,0)/ie.length:me;xe.set(fe+"|"+re,St)}}for(const fe of de){const Oe=fe.file?Te.get(fe.file)??36:36,me=fe.file?xe.get(fe.file+"|"+fe.groupKey)??Oe:Oe;Qe.push({...fe,roundAvg:Oe,groupAvg:me})}}else(Array.isArray(l)?l:Array.isArray(n)?n:[]).forEach(de=>{const Te=de&&de.parsed?de.parsed:de,xe=Te&&Array.isArray(Te.players)?Te.players:[],fe=Number.isFinite(de==null?void 0:de.dateMs)?de.dateMs:Number.isFinite(Te==null?void 0:Te.dateMs)?Te.dateMs:null,Oe=String((de==null?void 0:de.file)??(Te==null?void 0:Te.file)??""),me=xe.map(ge=>xt(ge)).filter(Number.isFinite),re=me.length?me.reduce((ge,$t)=>ge+$t,0)/me.length:36,ie=new Map,St=new Map;for(const ge of xe){const $t=xt(ge);if(!Number.isFinite($t))continue;const Qt=String((ge==null?void 0:ge.teeLabel)??(ge==null?void 0:ge.tee)??(ge==null?void 0:ge.tee_name)??(ge==null?void 0:ge.teeName)??"").toLowerCase().trim(),Rt=String((ge==null?void 0:ge.gender)??(ge==null?void 0:ge.sex)??"").toUpperCase(),es=Qt||(Rt==="F"||Rt==="FEMALE"||Rt==="W"||Rt==="WOMEN"?"F":"M");ie.set(es,(ie.get(es)||0)+$t),St.set(es,(St.get(es)||0)+1)}const Gt=new Map;for(const[ge,$t]of ie.entries()){const Qt=St.get(ge)||1;Gt.set(ge,$t/Qt)}Number.isFinite(fe)&&ve.push({dateMs:fe,roundAvg:re,n:me.length,file:Oe}),xe.forEach(ge=>{const $t=String((ge==null?void 0:ge.name)||(ge==null?void 0:ge.player)||(ge==null?void 0:ge.playerName)||"").trim(),Qt=os($t);if(!Qt||I($t))return;const Rt=xt(ge),ps=Number((ge==null?void 0:ge.startExact)??(ge==null?void 0:ge.index)??(ge==null?void 0:ge.hi)??(ge==null?void 0:ge.handicap)??(ge==null?void 0:ge.exact)??(ge==null?void 0:ge.hiExact)),es=String((ge==null?void 0:ge.teeLabel)??(ge==null?void 0:ge.tee)??(ge==null?void 0:ge.tee_name)??(ge==null?void 0:ge.teeName)??"").toLowerCase().trim(),Ht=String((ge==null?void 0:ge.gender)??(ge==null?void 0:ge.sex)??"").toUpperCase(),Cs=Ht==="F"||Ht==="FEMALE"||Ht==="W"||Ht==="WOMEN"?"F":"M",Ys=es||Cs,Xs=Gt.get(Ys)??re;Qe.push({k:Qt,name:$t,pts:Rt,hi:ps,dateMs:fe,roundAvg:re,gender:Cs,teeLabel:es,groupKey:Ys,groupAvg:Xs,file:Oe}),Z.add(Qt)})});te.forEach((W,de)=>Z.add(de));const mt=new Map;for(const W of Qe)mt.has(W.k)||mt.set(W.k,[]),mt.get(W.k).push(W);for(const W of mt.values())W.sort((de,Te)=>{const xe=Number.isFinite(de.dateMs)?de.dateMs:-1/0,fe=Number.isFinite(Te.dateMs)?Te.dateMs:-1/0;return xe-fe});const vt=ve.filter(W=>Number.isFinite(W==null?void 0:W.dateMs)&&Number.isFinite(W==null?void 0:W.roundAvg)).sort((W,de)=>W.dateMs-de.dateMs).slice(-20),jt=.9;let He=0,Je=0;for(let W=0;W<vt.length;W++){const de=vt.length-1-W,Te=Math.pow(jt,de);He+=Te,Je+=Te*vt[W].roundAvg}const b=He>0?Je/He:36;let j=0,O=0;for(let W=0;W<vt.length;W++){const de=vt.length-1-W,Te=Math.pow(jt,de);j+=Te,O+=Te*Math.pow(vt[W].roundAvg-b,2)}const T=Math.max(.8,Math.min(4,j>0?Math.sqrt(O/j):1.6));let ae=.75;try{let W=0,de=0,Te=0;for(let xe=0;xe<Qe.length;xe++){const fe=Qe[xe],Oe=Number(fe.hi),me=Number(fe.pts)-Number(fe.roundAvg);!Number.isFinite(Oe)||!Number.isFinite(me)||(W+=1,de+=Oe,Te+=me)}if(W>=20){de/=W,Te/=W;let xe=0,fe=0;for(let Oe=0;Oe<Qe.length;Oe++){const me=Qe[Oe],re=Number(me.hi),ie=Number(me.pts)-Number(me.roundAvg);if(!Number.isFinite(re)||!Number.isFinite(ie))continue;const St=re-de,Gt=ie-Te;xe+=St*St,fe+=St*Gt}xe>1e-6&&(ae=fe/xe,ae=Math.max(0,Math.min(2,ae)))}}catch{}const ye=Array.from(Z).map(W=>{const de=te.get(W),Te=mt.get(W)||[],xe=de?String(de.name||""):Te.length?String(Te[Te.length-1].name||""):"",fe=Te.map(Mt=>{const st=Number(Mt.pts),Be=Number(Mt.groupAvg??Mt.roundAvg);return!Number.isFinite(st)||!Number.isFinite(Be)?null:{res:st-Be,pts:st,ra:Be,dateMs:Mt.dateMs,hi:Mt.hi,groupKey:Mt.groupKey,gender:Mt.gender,teeLabel:Mt.teeLabel}}).filter(Boolean),Oe=Math.max(3,Math.min(12,Number(m)||12)),me=fe.slice(-Oe),re=.85;let ie=0,St=0;for(let Mt=0;Mt<me.length;Mt++){const st=me.length-1-Mt,Be=Math.pow(re,st);ie+=Be,St+=Be*me[Mt].res}const Gt=ie>0?St/ie:0,ge=me.length,$t=ge/(ge+6),Qt=Gt*$t;let Rt=0,ps=0;for(let Mt=0;Mt<me.length;Mt++){const st=me.length-1-Mt,Be=Math.pow(re,st);Rt+=Be,ps+=Be*Math.pow(me[Mt].res-Gt,2)}const es=Rt>0?Math.sqrt(ps/Rt):3.8,Ht=Math.max(1.2,Math.min(7.5,es*(.6+.4*$t)+(1-$t)*3));let Cs=0;if(ge>=3){let Mt=0,st=0,Be=0,Pt=0,h=0;for(let z=0;z<ge;z++){const Q=ge-1-z,ne=Math.pow(re,Q),le=z,Ee=me[z].res;Mt+=ne,st+=ne*le,Be+=ne*Ee,Pt+=ne*le*le,h+=ne*le*Ee}const P=Mt*Pt-st*st;Math.abs(P)>1e-9&&(Cs=(Mt*h-st*Be)/P,Cs=Math.max(-2.5,Math.min(2.5,Cs)))}const Ys=Te.length?Te[Te.length-1]:null,Xs=Number(de?de.startExact??de.index??de.hi??0:(Ys==null?void 0:Ys.hi)??0),Us=xa(Xs,0,36),Qs=de?Number(de.nextExactNum??de.nextExact??de.nextExactRaw??de.nextExactDisplay??Us):Us,ea=xa(Qs,0,36),_s=String(c||"").toLowerCase(),Ws=_s==="same"||_s==="nochange"||_s==="no-change"||_s==="no_change"?Us:ea;let ba=Us,da=ae;try{let Mt=0,st=0,Be=0;for(let Pt=0;Pt<me.length;Pt++){const h=me.length-1-Pt,P=Math.pow(re,h),z=Number(me[Pt].hi),Q=Number(me[Pt].res);!Number.isFinite(z)||!Number.isFinite(Q)||(Mt+=P,st+=P*z,Be+=P*Q)}if(Mt>0){const Pt=st/Mt,h=Be/Mt;ba=Pt;let P=0,z=0,Q=0;for(let be=0;be<me.length;be++){const Ne=me.length-1-be,_e=Math.pow(re,Ne),rt=Number(me[be].hi),nt=Number(me[be].res);if(!Number.isFinite(rt)||!Number.isFinite(nt))continue;const et=rt-Pt,Pe=nt-h;P+=_e*et*et,z+=_e*et*Pe,Q+=1}const le=P>1e-6?z/(P+1.25):ae,Ee=Q/(Q+4);da=le*Ee+ae*(1-Ee),da=Math.max(0,Math.min(2,da))}}catch{}const Xt=Qt+da*(Ws-ba),Ms=xa(b+Xt,18,56),qt=ea-Ws,cs=Ms-36,Lt=Math.sqrt(T*T+Ht*Ht),pa=Math.max(1.5,Math.min(9,Lt));return{name:xe,startExact:Ws,nextExactNum:ea,deltaHI:qt,expPts:Ms,formMu:cs,formSigma:pa,formTrend:Cs,modelBaseMu:b,modelBaseSigma:T,leagueHiSlope:ae,modelResMu:Xt,modelResSigma:Ht,roundsUsed:ge}}).filter(W=>W&&W.name),U=JSON.stringify({mode:c,rows:ye.map(W=>({n:String(W.name||""),mu:Number(W.formMu||0),tr:Number(W.formTrend||0),sg:Number(W.formSigma||0),ex:Number(W.expPts||36),st:Number(W.startExact||0),nx:Number(W.nextExactNum||W.startExact||0)}))}),at=W=>{let de=1779033703^W.length;for(let Te=0;Te<W.length;Te++)de=Math.imul(de^W.charCodeAt(Te),3432918353),de=de<<13|de>>>19;return()=>(de=Math.imul(de^de>>>16,2246822507),de=Math.imul(de^de>>>13,3266489909),de^=de>>>16,de>>>0)},ce=W=>()=>{let de=W+=1831565813;return de=Math.imul(de^de>>>15,de|1),de^=de+Math.imul(de^de>>>7,de|61),((de^de>>>14)>>>0)/4294967296},gt=at(U)(),ot=ce(gt),qe=()=>{let W=0,de=0;for(;W===0;)W=ot();for(;de===0;)de=ot();return Math.sqrt(-2*Math.log(W))*Math.cos(2*Math.PI*de)},Dt=8e3,bt=new Array(ye.length).fill(0),ke=new Array(ye.length).fill(0),w=new Array(ye.length).fill(0),Le=ye[0]&&Number.isFinite(Number(ye[0].modelBaseMu))?Number(ye[0].modelBaseMu):36,Fe=ye[0]&&Number.isFinite(Number(ye[0].modelBaseSigma))?Number(ye[0].modelBaseSigma):1.6,Vt=ye.map(W=>Number.isFinite(Number(W.modelResMu))?Number(W.modelResMu):0),fs=ye.map(W=>{const de=Number.isFinite(Number(W.modelResSigma))?Number(W.modelResSigma):4;return Math.max(1,Math.min(8,de))});for(let W=0;W<Dt;W++){const de=Le+qe()*Fe,xe=ye.map((fe,Oe)=>{const me=de+Vt[Oe]+qe()*fs[Oe];return Math.max(0,Math.min(60,me))}).map((fe,Oe)=>({i:Oe,p:fe,t:ot()})).sort((fe,Oe)=>Oe.p-fe.p||fe.t-Oe.t);if(xe.length){bt[xe[0].i]++;for(let fe=0;fe<Math.min(3,xe.length);fe++)ke[xe[fe].i]++;for(let fe=0;fe<Math.min(4,xe.length);fe++)w[xe[fe].i]++}}const wt=ye.map((W,de)=>{const Te=bt[de]/Dt*100,xe=ke[de]/Dt*100,fe=w[de]/Dt*100,Oe=Number.isFinite(Number(W.formMu))?Number(W.formMu):0,me=Number.isFinite(Number(W.formTrend))?Number(W.formTrend):0,re=Number.isFinite(Number(W.formSigma))?Number(W.formSigma):4,ie=re<=2.2?"Steady":re<=3.6?"Normal":"Volatile",St=me>=.25?"‚Üë":me<=-.25?"‚Üì":"‚Üí",Gt=Number.isFinite(Number(W.startExact))?Number(W.startExact):0,ge=Number.isFinite(Number(W.nextExactNum))?Number(W.nextExactNum):Gt,$t=Math.max(0,Math.min(36,ge)),Qt=$t-Gt;return{name:W.name,startHI:Gt,deltaHI:Qt,nextHI:$t,winPct:Te,top3Pct:xe,top4Pct:fe,expPts:Number.isFinite(Number(W.expPts))?Number(W.expPts):Math.max(18,Math.min(56,Le+Vt[de])),muAdj:Oe,trend:me,trendTag:St,sigma:re,tag:ie,nextDisplay:W.nextDisplay??(Number.isFinite($t)?$t.toFixed(1):"‚Äî"),nextDisplayNum:$t,roundsUsed:Number.isFinite(Number(W.oddsRoundsUsed))?Number(W.oddsRoundsUsed):Number.isFinite(Number(W.formN))?Number(W.formN):0,similarRounds:Number.isFinite(Number(W.oddsSimilarRounds))?Number(W.oddsSimilarRounds):0,usedSimilar:!!W.oddsUsedSimilar}}),ft=[...wt].sort((W,de)=>de.winPct-W.winPct),ut=[...wt].sort((W,de)=>de.top4Pct-W.top4Pct),Me=ut.map(W=>W.top4Pct/100),Jt=(Me[0]||0)+(Me[1]||0)+(Me[2]||0)+(Me[3]||0),_t=(Me[3]||0)-(Me[4]||0),Kt=Jt>=2.35&&_t>=.06?"High":Jt>=2.1&&_t>=.03?"Medium":"Low";try{const W=Array.from(new Set(Qe.map(Te=>String(Te.groupKey||"").toLowerCase()).filter(Boolean))).sort(),de=typeof window<"u"&&window.__ODDS_DEBUG&&typeof window.__ODDS_DEBUG=="object"?window.__ODDS_DEBUG:{};window.__ODDS_DEBUG={...de,ts:Date.now(),seasonRoundsCount:Array.isArray(ve)?ve.length:0,seasonRoundDates:(()=>{try{const Te=(Array.isArray(ve)?ve:[]).map(xe=>Number(xe==null?void 0:xe.dateMs)).filter(Number.isFinite).map(xe=>new Date(xe).toISOString().slice(0,10));return Array.from(new Set(Te)).sort()}catch{return[]}})(),seasonPlayerRowsCount:Qe.length,leagueBaseMu:b,leagueBaseSigma:T,leagueHiSlope:ae,leagueWithinSigma:ye&&ye.length?Math.sqrt(ye.reduce((Te,xe)=>Te+Math.pow(Number(xe.formSigma||0),2),0)/Math.max(1,ye.length)):null,groups:W,sample:Qe.slice(-120).map(Te=>({name:Te.name,pts:Te.pts,roundAvg:Te.roundAvg,roundStd:null,teeLabel:Te.teeLabel,dateMs:Te.dateMs,gender:Te.gender,groupKey:Te.groupKey,groupAvg:Te.groupAvg,hi:Te.hi})),model:{sims:Dt,confidence:Kt,c4:Jt,gap:_t,rows:ft.slice(0,60),top4:ut.slice(0,4)}}}catch(W){try{window.__ODDS_DEBUG={error:String(W)}}catch{}}return{sims:Dt,rows:ft,top4:ut.slice(0,4),confidence:Kt,c4:Jt,gap:_t}},[s,c,m,l,n,f]);return e.jsxs("section",{className:"content-card p-4 md:p-6",children:[e.jsx(ga,{items:[{label:"Round Leaderboard"}]}),e.jsx(ms,{setView:a,hasEvent:!!(s&&s.length)}),e.jsxs("div",{className:"mb-6 bg-neutral-50 rounded-2xl border border-neutral-200 overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"bg-neutral-100 p-3 border-b border-neutral-200 flex flex-wrap gap-2 justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"‚öôÔ∏è"}),e.jsx("h3",{className:"font-bold text-neutral-800 text-xs uppercase tracking-wider",children:"Handicap Calculator"})]}),e.jsxs("div",{className:"flex gap-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-white px-2 py-1 rounded border border-neutral-200 shadow-sm",children:[e.jsx("label",{className:"text-neutral-500 font-bold uppercase text-[10px]",children:"Slope"}),e.jsx("input",{type:"number",className:"w-12 font-bold text-neutral-900 text-center outline-none bg-transparent",value:r||"",placeholder:"-",onChange:I=>u(Number(I.target.value))})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white px-2 py-1 rounded border border-neutral-200 shadow-sm",children:[e.jsx("label",{className:"text-neutral-500 font-bold uppercase text-[10px]",children:"Rating"}),e.jsx("input",{type:"number",className:"w-12 font-bold text-neutral-900 text-center outline-none bg-transparent",value:d||"",placeholder:"-",onChange:I=>A(Number(I.target.value))})]})]})]}),e.jsxs("div",{className:"p-4 grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block font-bold text-neutral-700 mb-2 text-sm",children:"1. Today's Handicap Mode"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>g("raw"),className:`flex-1 py-2 rounded-lg text-xs font-bold border transition-colors ${x==="raw"?"bg-emerald-700 text-white border-emerald-800 shadow-inner":"bg-white text-neutral-700 hover:bg-neutral-100 border-neutral-200"}`,children:"Original"}),e.jsx("button",{onClick:()=>g("calc"),className:`flex-1 py-2 rounded-lg text-xs font-bold border transition-colors ${x==="calc"?"bg-emerald-700 text-white border-emerald-800 shadow-inner":"bg-white text-neutral-700 hover:bg-neutral-100 border-neutral-200"}`,children:"Apply Slope"})]}),e.jsx("p",{className:"text-[10px] text-neutral-400 mt-2",children:x==="calc"?`Calculating: HI √ó (${r||0} √∑ 113) + (${d||0} ‚àí Par) = Course Hcap (ref)`:"Using exact playing handicap from the CSV file."})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block font-bold text-neutral-700 mb-2 text-sm",children:"2. Next Handicap Preview"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>o("den"),className:`flex-1 py-2 rounded-lg text-xs font-bold border transition-colors ${c==="den"?"bg-neutral-900 text-white border-neutral-900 shadow-inner":"bg-white text-neutral-700 hover:bg-neutral-100 border-neutral-200"}`,children:"Legacy Formula"}),e.jsx("button",{onClick:()=>o("whs"),className:`flex-1 py-2 rounded-lg text-xs font-bold border transition-colors ${c==="whs"?"bg-neutral-900 text-white border-neutral-900 shadow-inner":"bg-white text-neutral-700 hover:bg-neutral-100 border-neutral-200"}`,children:"WHS Diff"}),e.jsx("button",{onClick:()=>o("same"),className:`flex-1 py-2 rounded-lg text-xs font-bold border transition-colors ${c==="same"?"bg-neutral-900 text-white border-neutral-900 shadow-inner":"bg-white text-neutral-700 hover:bg-neutral-100 border-neutral-200"}`,children:"No Change"})]}),e.jsx("p",{className:"text-[10px] text-neutral-400 mt-2",children:c==="den"?"Applies Cuts & Buffers to Starting Index.":c==="whs"?"Calculates differential from score.":"Keeps handicap exactly the same."})]})]})]}),e.jsx("div",{className:"overflow-auto table-wrap",children:e.jsxs("table",{className:"min-w-full text-sm table-zebra",children:[e.jsx("thead",{className:"bg-neutral-50",children:e.jsxs("tr",{className:"text-left text-xs uppercase tracking-wide text-neutral-500 font-bold border-b border-squab-200",children:[e.jsx("th",{className:"py-3 px-3",children:"#"}),e.jsx("th",{className:"py-3 px-3",children:"Name"}),e.jsx("th",{className:"py-3 px-3 text-center",children:"Index"}),e.jsx("th",{className:"py-3 px-3 bg-squab-50 text-squab-800 border-x border-squab-200 text-center w-24",children:"Playing"}),e.jsx("th",{className:"py-3 px-3 text-center",children:"Pts"}),e.jsx("th",{className:"py-3 px-3 text-center",children:"Back9"}),e.jsx("th",{className:"py-3 px-3 text-center",children:"League"}),e.jsx("th",{className:"py-3 px-3 bg-neutral-100 border-l border-neutral-200 text-neutral-700 text-right",children:c==="whs"?"Diff":"Next"})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-100",children:s.map((I,V)=>e.jsxs("tr",{className:"hover:bg-neutral-50 transition-colors "+(I.isWinner?"ring-2 ring-emerald-400/60 ring-inset bg-emerald-50/10":""),children:[e.jsx("td",{className:"py-3 px-3 font-bold text-squab-600",children:I.position}),e.jsx("td",{className:"py-3 px-3 font-medium text-neutral-900",children:I.name}),e.jsx("td",{className:"py-3 px-3 text-center text-neutral-400 font-mono text-xs",children:I.startExact}),e.jsx("td",{className:"py-3 px-3 text-center font-bold bg-squab-50 text-squab-900 border-x border-squab-100 text-lg",children:x==="calc"?I.playingHcapRef??I.playingHcap:I.playingHcap}),e.jsx("td",{className:"py-3 px-3 text-center font-bold text-neutral-800",children:I.points}),e.jsx("td",{className:"py-3 px-3 text-center text-neutral-500 text-xs",children:I.back9}),e.jsx("td",{className:"py-3 px-3 text-center font-bold text-emerald-600",children:I.leaguePoints}),e.jsx("td",{className:"py-3 px-3 text-right bg-neutral-50 border-l border-neutral-200 font-mono text-neutral-700 font-bold",children:I.nextDisplay})]},V))})]})}),e.jsxs("div",{className:"mt-5 panel-core p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-end justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs uppercase tracking-wider text-neutral-500 font-bold",children:"Next Society Stableford"}),e.jsx("div",{className:"text-lg font-black text-neutral-900",children:"Winner odds (next HI)"}),e.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:["Based on each player‚Äôs last up to ",e.jsx("b",{children:m})," rounds in the current filters, using ",e.jsx("b",{children:"points ‚àí 36"})," form + volatility."]})]}),Array.isArray(D)&&D.length?e.jsxs("div",{className:"mt-2 text-[11px] text-neutral-600",children:["Hidden from odds (tap to re-include):",e.jsxs("div",{className:"mt-1 flex flex-wrap gap-2",children:[D.slice(0,80).map(I=>e.jsxs("label",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full border border-neutral-200 bg-white",children:[e.jsx("input",{type:"checkbox",className:"h-3 w-3 accent-black",checked:!0,onChange:V=>C(I,!1),title:"Show this golfer in winner odds"}),e.jsx("span",{children:I})]},I)),D.length>80?e.jsxs("span",{className:"text-neutral-400",children:["(+",D.length-80," more)"]}):null]})]}):null,e.jsxs("div",{className:"flex items-center gap-3 text-xs text-neutral-500",children:[e.jsxs("div",{children:["Sims: ",e.jsx("span",{className:"font-mono font-bold",children:J.sims})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-neutral-500",children:"Rounds"}),e.jsx("select",{className:"rounded-lg border border-neutral-200 bg-white px-2 py-1 text-xs font-bold text-neutral-800",value:m,onChange:I=>M(Math.max(3,Math.min(12,Number(I.target.value)||12))),title:"How many recent rounds to use in the winner odds model",children:[3,4,5,6,7,8,9,10,11,12].map(I=>e.jsx("option",{value:I,children:I},I))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-neutral-500",children:"Model internals"}),e.jsx("button",{onClick:()=>X(I=>!I),className:`pill-mini ${N?"success":""}`,title:"Show Start HI and ŒîHI used by the model",children:N?"On":"Off"})]})]})]}),e.jsxs("div",{className:"mt-3 grid md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"md:col-span-2 p-3 rounded-2xl border border-neutral-200 bg-white/80",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx("div",{className:"text-xs uppercase tracking-wider text-neutral-500 font-black",children:"Top-4 prediction"}),e.jsxs("span",{className:`pill-mini ${J.confidence==="High"?"subtle":J.confidence==="Medium"?"bg-amber-50 border-amber-200 text-amber-900":"bg-neutral-100 border-neutral-200 text-neutral-700"}`,children:["Confidence: ",e.jsx("b",{children:J.confidence})]})]}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:(J.top4||[]).map(I=>e.jsxs("span",{className:"pill-mini subtle",children:[I.name," ¬∑ ",e.jsxs("span",{className:"font-mono",children:[I.top4Pct.toFixed(1),"%"]})]},I.name))}),e.jsxs("div",{className:"mt-2 text-xs text-neutral-500",children:["If confidence is ",e.jsx("b",{children:"Low"}),", treat this as a contenders list ‚Äî society golf is noisy and the 4th spot isn‚Äôt clearly separated."]})]}),e.jsxs("div",{className:"p-3 rounded-2xl border border-neutral-200 bg-white/70",children:[e.jsx("div",{className:"text-xs uppercase tracking-wider text-neutral-500 font-black",children:"Model confidence"}),e.jsxs("div",{className:"mt-1 text-sm text-neutral-700",children:["Top-4 concentration: ",e.jsx("span",{className:"font-mono font-black",children:(J.c4||0).toFixed(2)})," / 4"]}),e.jsxs("div",{className:"mt-1 text-sm text-neutral-700",children:["#4 vs #5 gap: ",e.jsxs("span",{className:"font-mono font-black",children:[((J.gap||0)*100).toFixed(1),"%"]})]}),e.jsx("div",{className:"mt-2 text-xs text-neutral-500",children:"Higher concentration + a clear gap means we can ‚Äúcall‚Äù the Top-4 with more confidence."})]})]}),e.jsx("div",{className:"mt-3 table-wrap",children:e.jsxs("table",{className:"w-full table-zebra",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-3 text-left",children:"#"}),e.jsx("th",{className:"py-2 px-3 text-left",children:"Player"}),e.jsx("th",{className:"py-2 px-3 text-center",title:"Hide this golfer from winner odds",children:"Hide"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"Win%"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"Top 3%"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"Top 4%"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"Expected Pts"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"Rounds (¬±4)"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"Volatility"}),N&&e.jsx("th",{className:"py-2 px-3 text-right",children:"Start HI"}),N&&e.jsx("th",{className:"py-2 px-3 text-right",children:"ŒîHI"}),e.jsx("th",{className:"py-2 px-3 text-right",children:"Next HI"})]})}),e.jsx("tbody",{children:(J.rows||[]).slice(0,12).map((I,V)=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 px-3 text-neutral-500 font-mono text-xs",children:V+1}),e.jsx("td",{className:"py-2 px-3 font-bold text-neutral-900",children:I.name}),e.jsx("td",{className:"py-2 px-3 text-center",children:e.jsx("input",{type:"checkbox",className:"h-4 w-4 accent-black",checked:!!(E&&E[os(I.name)]),onChange:te=>C(I.name,!!te.target.checked),title:"Hide this golfer from winner odds"})}),e.jsxs("td",{className:"py-2 px-3 text-right font-black text-neutral-900",children:[I.winPct.toFixed(1),"%"]}),e.jsxs("td",{className:"py-2 px-3 text-right font-bold text-neutral-700",children:[I.top3Pct.toFixed(1),"%"]}),e.jsxs("td",{className:"py-2 px-3 text-right font-bold text-neutral-700",children:[I.top4Pct.toFixed(1),"%"]}),e.jsx("td",{className:"py-2 px-3 text-right font-mono font-bold text-neutral-800",children:I.expPts.toFixed(1)}),e.jsx("td",{className:"py-2 px-3 text-right font-mono text-neutral-700",children:I.usedSimilar?I.similarRounds:`${I.similarRounds} (fb)`}),e.jsx("td",{className:"py-2 px-3 text-right",children:e.jsxs("span",{className:`pill-mini ${I.tag==="Steady"?"subtle":""}`,children:[I.tag," ¬∑ œÉ ",I.sigma.toFixed(1)]})}),N&&e.jsx("td",{className:"py-2 px-3 text-right font-mono text-neutral-700",children:Number.isFinite(Number(I.startHI))?Number(I.startHI).toFixed(1):"‚Äî"}),N&&e.jsx("td",{className:"py-2 px-3 text-right font-mono text-neutral-700",children:Number.isFinite(Number(I.deltaHI))?(Number(I.deltaHI)>=0?"+":"")+Number(I.deltaHI).toFixed(1):"‚Äî"}),e.jsx("td",{className:"py-2 px-3 text-right font-mono text-neutral-700",children:I.nextDisplay??"‚Äî"})]},I.name))})]})}),e.jsxs("div",{className:"mt-3 text-sm text-neutral-700",children:[e.jsx("b",{children:"How to use this:"})," if your ",e.jsx("span",{className:"font-mono",children:"Expected Pts"})," is close to the leaders but your volatility is high, the fastest win is usually ",e.jsx("b",{children:"cutting one wipe/double+"}),"."]})]})]})}function hn({computed:s,courseTees:a,setView:r}){const u=c=>c>=3?"Excellent":c>=2.5?"Good":c>=2?"Solid":c>=1.5?"Needs Work":"Struggle",d=c=>c>=3?"bg-emerald-100 text-emerald-800":c>=2.5?"bg-emerald-50 text-emerald-700":c>=2?"bg-neutral-100 text-neutral-800":c>=1.5?"bg-amber-100 text-amber-800":"bg-red-100 text-red-800",A=ue.useMemo(()=>ca(s),[s]),x=(c,o)=>{const m={3:{s:0,c:0},4:{s:0,c:0},5:{s:0,c:0}};for(let n=0;n<A;n++){const l=o[n];if(!l||!m[l])continue;const f=rs(c[n],NaN);Number.isFinite(f)&&(m[l].s+=f,m[l].c++)}const M=n=>m[n].c?m[n].s/m[n].c:0;return{p3:M(3),p4:M(4),p5:M(5)}},g=he.useMemo(()=>s.map(c=>{const o=Na(c,a);if(!o)return{name:c.name,p3:0,p4:0,p5:0};const m=x(c.perHole||[],o.pars);return{name:c.name,p3:Ya(m.p3),p4:Ya(m.p4),p5:Ya(m.p5),total:Ya(m.p3+m.p4+m.p5)}}).sort((c,o)=>o.total-c.total),[s,a]);return e.jsxs("section",{className:"content-card p-3 md:p-5",children:[e.jsx(ms,{setView:r,hasEvent:!!(s&&s.length)}),e.jsx("h2",{className:"section-title mb-3",children:"Player Ratings"}),e.jsx("div",{className:"overflow-auto table-wrap",children:e.jsxs("table",{className:"min-w-full text-sm table-zebra",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-squab-200 text-left",children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Par-3 Avg"}),e.jsx("th",{children:"Rating"}),e.jsx("th",{children:"Par-4 Avg"}),e.jsx("th",{children:"Rating"}),e.jsx("th",{children:"Par-5 Avg"}),e.jsx("th",{children:"Rating"})]})}),e.jsxs("tbody",{children:[g.map(c=>e.jsxs("tr",{className:"border-b border-squab-200",children:[e.jsx("td",{className:"font-medium",children:c.name}),e.jsx("td",{children:c.p3.toFixed(1)}),e.jsx("td",{children:e.jsx("span",{className:`px-2 py-0.5 rounded-lg text-xs ${d(c.p3)}`,children:u(c.p3)})}),e.jsx("td",{children:c.p4.toFixed(1)}),e.jsx("td",{children:e.jsx("span",{className:`px-2 py-0.5 rounded-lg text-xs ${d(c.p4)}`,children:u(c.p4)})}),e.jsx("td",{children:c.p5.toFixed(1)}),e.jsx("td",{children:e.jsx("span",{className:`px-2 py-0.5 rounded-lg text-xs ${d(c.p5)}`,children:u(c.p5)})})]},c.name)),g.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"py-3 text-neutral-600",children:"Load an event to see ratings."})})]})]})})]})}function xn({season:s,setView:a,seasonsDef:r,seasonYear:u,setSeasonYear:d}){const A=Object.values(s).filter(x=>!js(x.name)).sort((x,g)=>g.totalPoints-x.totalPoints||x.name.localeCompare(g.name));return e.jsxs("section",{className:"content-card p-3 md:p-5 hm-stage",children:[e.jsx(ya,{setView:a,right:e.jsx(kr,{seasonsDef:r,seasonYear:u,setSeasonYear:d,leagueTitle:Ra})}),e.jsx("h2",{className:"section-title mb-3",children:"League"}),e.jsx("div",{className:"overflow-auto table-wrap",children:e.jsxs("table",{className:"min-w-full text-sm table-zebra",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-squab-200 text-left",children:[e.jsx("th",{children:"Rank"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Events"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Best Event"}),e.jsx("th",{children:"Best Hole"}),e.jsx("th",{children:"Eclectic"})]})}),e.jsxs("tbody",{className:"[&_tr:nth-child(even)]:bg-squab-50/50",children:[A.map((x,g)=>e.jsxs("tr",{className:"border-b border-squab-200 "+(g===0?"bg-emerald-50":g<3?"bg-squab-50":""),children:[e.jsx("td",{className:"font-semibold",children:g===0?"ü•á":g===1?"ü•à":g===2?"ü•â":g+1}),e.jsx("td",{children:x.name}),e.jsx("td",{children:x.events}),e.jsx("td",{children:x.totalPoints}),e.jsx("td",{children:x.bestEventPoints}),e.jsx("td",{children:x.bestHolePoints}),e.jsx("td",{children:x.eclecticTotal})]},x.name)),A.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"py-3 text-neutral-600",children:"No season data yet."})})]})]})})]})}function bn({season:s,setView:a,seasonsDef:r,seasonYear:u,setSeasonYear:d}){const A=Object.values(s).filter(g=>!js(g.name)).sort((g,c)=>(c.eclecticTotal||0)-(g.eclecticTotal||0)),x=g=>g>=4?"bg-purple-100 text-purple-700 font-bold":g===3?"bg-emerald-100 text-emerald-800 font-semibold":g===2?"text-neutral-800":g===1?"bg-orange-50 text-orange-800":g===0?"bg-red-50 text-red-300":"";return e.jsxs("section",{className:"content-card p-3 md:p-5 hm-stage",children:[e.jsx(ya,{setView:a,right:e.jsx(kr,{seasonsDef:r,seasonYear:u,setSeasonYear:d,leagueTitle:Ra})}),e.jsx("h2",{className:"section-title mb-3",children:"Eclectic"}),e.jsx("div",{className:"overflow-auto table-wrap",children:e.jsxs("table",{className:"min-w-full text-xs md:text-sm table-zebra",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-squab-200 text-left",children:[e.jsx("th",{children:"Rank"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Eclectic Total"}),Array.from({length:18},(g,c)=>e.jsxs("th",{children:["H",c+1]},c))]})}),e.jsxs("tbody",{className:"[&_tr:nth-child(even)]:bg-squab-50/50",children:[A.map((g,c)=>e.jsxs("tr",{className:"border-b border-squab-200 "+(c===0?"bg-emerald-50":c<3?"bg-squab-50":""),children:[e.jsx("td",{className:"font-semibold",children:c===0?"ü•á":c===1?"ü•à":c===2?"ü•â":c+1}),e.jsx("td",{children:g.name}),e.jsx("td",{children:g.eclecticTotal}),(g.bestPerHole||Array(18).fill(0)).map((o,m)=>e.jsx("td",{className:`text-center ${x(o)}`,children:o},m))]},g.name)),A.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:21,className:"py-3 text-neutral-600",children:"No eclectic data yet."})})]})]})})]})}function pn({computed:s,setView:a}){if(!s.length)return e.jsxs("section",{className:"rounded-2xl p-4 bg-white border border-squab-200 shadow-sm",children:[e.jsx(ga,{items:[{label:"Game",onClick:()=>a("event"),title:"Round Leaderboard"},{label:"Fun & Banter"}]}),e.jsx(ms,{setView:a,hasEvent:!!(s&&s.length)}),e.jsx("p",{className:"text-neutral-600",children:"Load an event to see analysis."})]});const r=ue.useMemo(()=>ca(s),[s]),u=Math.max(0,r-4),d=s.map(c=>{const o=(c.perHole||[]).slice(0,r).map(n=>Number(n)||0);let m=0,M=0;for(let n=0;n<r-1;n++)o[n]<=1&&(m++,o[n+1]>=2&&M++);return{name:c.name,ratio:m?M/m*100:0,bounces:M,opportunities:m}}).sort((c,o)=>o.ratio-c.ratio),A=s.map(c=>{const o=(c.perHole||[]).slice(0,r).map(l=>Number(l)||0),m=o.reduce((l,f)=>l+f,0)/r,M=o.reduce((l,f)=>l+Math.pow(f-m,2),0)/r,n=Math.sqrt(M);return{name:c.name,stdDev:n}}).sort((c,o)=>c.stdDev-o.stdDev),x=s.map(c=>{const o=(c.perHole||[]).slice(u,r).reduce((m,M)=>m+(Number(M)||0),0);return{name:c.name,pts:o}}).sort((c,o)=>o.pts-c.pts),g=s.map(c=>{const m=(c.perHole||[]).slice(0,r).map(n=>Number(n)||0).filter(n=>n===0).length,M=c.points+m;return{name:c.name,actual:c.points,potential:M,diff:m}}).sort((c,o)=>o.diff-c.diff);return e.jsxs("section",{className:"content-card p-0 space-y-0",children:[e.jsx(ms,{setView:a,hasEvent:!!(s&&s.length)}),e.jsxs("div",{className:"panel-head",children:[e.jsx("h2",{className:"text-xl font-bold text-squab-900",children:"Banter & Analysis"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"The mental game, the chokes, and the excuses."})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"border border-squab-200 rounded-2xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-blue-50 p-3 border-b border-blue-100",children:[e.jsx("h3",{className:"font-bold text-blue-900 text-sm uppercase",children:'üß† The "Bounce Back" King'}),e.jsx("p",{className:"text-xs text-blue-700",children:"Resilience: Scoring 2+ pts immediately after a bad hole (0-1 pts)."})]}),e.jsx("div",{className:"overflow-auto max-h-[300px]",children:e.jsxs("table",{className:"w-full text-xs text-left",children:[e.jsx("thead",{className:"bg-white sticky top-0",children:e.jsxs("tr",{className:"border-b border-neutral-100 text-neutral-500",children:[e.jsx("th",{className:"p-2",children:"Name"}),e.jsx("th",{className:"p-2",children:"Success Rate"})]})}),e.jsx("tbody",{children:d.map((c,o)=>e.jsxs("tr",{className:"border-b border-neutral-50 hover:bg-neutral-50",children:[e.jsxs("td",{className:"p-2 font-medium",children:[o===0?"üëë ":"",c.name]}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-bold",children:[c.ratio.toFixed(0),"%"]}),e.jsxs("span",{className:"text-neutral-400",children:["(",c.bounces,"/",c.opportunities,")"]})]})})]},c.name))})]})})]}),e.jsxs("div",{className:"border border-squab-200 rounded-2xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-purple-50 p-3 border-b border-purple-100",children:[e.jsx("h3",{className:"font-bold text-purple-900 text-sm uppercase",children:"üé¢ Rollercoaster vs Steady Eddie"}),e.jsx("p",{className:"text-xs text-purple-700",children:"Based on standard deviation. Low = Consistent. High = Wild."})]}),e.jsx("div",{className:"overflow-auto max-h-[300px]",children:e.jsxs("table",{className:"w-full text-xs text-left",children:[e.jsx("thead",{className:"bg-white sticky top-0",children:e.jsxs("tr",{className:"border-b border-neutral-100 text-neutral-500",children:[e.jsx("th",{className:"p-2",children:"Name"}),e.jsx("th",{className:"p-2",children:"Type"}),e.jsx("th",{className:"p-2",children:"Dev"})]})}),e.jsx("tbody",{children:A.map((c,o)=>e.jsxs("tr",{className:"border-b border-neutral-50 hover:bg-neutral-50",children:[e.jsx("td",{className:"p-2 font-medium",children:c.name}),e.jsx("td",{className:"p-2",children:o<3?e.jsx("span",{className:"text-emerald-600 font-bold",children:"Robot ü§ñ"}):o>A.length-4?e.jsx("span",{className:"text-orange-600 font-bold",children:"Chaos üé¢"}):e.jsx("span",{className:"text-neutral-400",children:"-"})}),e.jsx("td",{className:"p-2 font-mono",children:c.stdDev.toFixed(2)})]},c.name))})]})})]}),e.jsxs("div",{className:"border border-squab-200 rounded-2xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-orange-50 p-3 border-b border-orange-100",children:[e.jsxs("h3",{className:"font-bold text-orange-900 text-sm uppercase",children:["üî• The Closer (Holes ",u+1,"-",r,")"]}),e.jsx("p",{className:"text-xs text-orange-700",children:"Total stableford points scored on the final 4 holes."})]}),e.jsx("div",{className:"overflow-auto max-h-[300px]",children:e.jsxs("table",{className:"w-full text-xs text-left",children:[e.jsx("thead",{className:"bg-white sticky top-0",children:e.jsxs("tr",{className:"border-b border-neutral-100 text-neutral-500",children:[e.jsx("th",{className:"p-2",children:"Name"}),e.jsx("th",{className:"p-2",children:"Finish Pts"})]})}),e.jsx("tbody",{children:x.map((c,o)=>e.jsxs("tr",{className:"border-b border-neutral-50 hover:bg-neutral-50",children:[e.jsxs("td",{className:"p-2 font-medium",children:[o===0?"ü•á ":"",c.name]}),e.jsx("td",{className:"p-2 font-bold text-orange-800",children:c.pts})]},c.name))})]})})]}),e.jsxs("div",{className:"border border-squab-200 rounded-2xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-emerald-50 p-3 border-b border-emerald-100",children:[e.jsx("h3",{className:"font-bold text-emerald-900 text-sm uppercase",children:'ü•∫ The "Shoulda Woulda" Index'}),e.jsx("p",{className:"text-xs text-emerald-700",children:'"If I just played for bogey..." (Recalculated assuming 0pt holes were 1pt).'})]}),e.jsx("div",{className:"overflow-auto max-h-[300px]",children:e.jsxs("table",{className:"w-full text-xs text-left",children:[e.jsx("thead",{className:"bg-white sticky top-0",children:e.jsxs("tr",{className:"border-b border-neutral-100 text-neutral-500",children:[e.jsx("th",{className:"p-2",children:"Name"}),e.jsx("th",{className:"p-2",children:"Cost"}),e.jsx("th",{className:"p-2",children:"Potential"})]})}),e.jsx("tbody",{children:g.map((c,o)=>e.jsxs("tr",{className:"border-b border-neutral-50 hover:bg-neutral-50",children:[e.jsx("td",{className:"p-2 font-medium",children:c.name}),e.jsxs("td",{className:"p-2 text-red-600 font-bold",children:["-",c.diff," pts"]}),e.jsx("td",{className:"p-2 text-neutral-400",children:c.potential})]},c.name))})]})})]})]})]})}function fn({computed:s,setView:a,courseTees:r}){const u=ue.useMemo(()=>ca(s),[s]),[d,A]=ue.useState(""),[x,g]=ue.useState("stableford"),[c,o]=ue.useState("field");if(ue.useEffect(()=>{s.length&&!d&&A(s[0].name)},[s,d]),!s.length)return e.jsxs("section",{className:"rounded-2xl p-4 bg-white border border-squab-200 shadow-sm",children:[e.jsx(ms,{setView:a,hasEvent:!!(s&&s.length)}),e.jsx("p",{className:"text-neutral-600",children:"Load an event to see graphs."})]});const m=s.find(b=>b.name===d)||s[0],M=Math.round(m.startExact??m.handicap??0),n=Ma(M),l=b=>{if(x==="stableford")return(b.perHole||[]).map(O=>{const T=Number(O);return Number.isFinite(T)?T:0});const j=Array.isArray(b.grossPerHole)?b.grossPerHole:[];return Array.from({length:18},(O,T)=>{const ae=Number(j[T]);return Number.isFinite(ae)&&ae>0?ae:NaN})},f=l(m),E=Array(18).fill(0),D=Array(18).fill(0),C=Array(18).fill(0),N=Array(18).fill(0);s.forEach(b=>{const j=l(b),O=Math.round(b.startExact??b.handicap??0),T=Ma(O)===n;j.forEach((ae,ye)=>{ae>0&&(E[ye]+=ae,D[ye]+=1,T&&(C[ye]+=ae,N[ye]+=1))})});const X=E.map((b,j)=>D[j]?b/D[j]:0),J=C.map((b,j)=>N[j]?b/N[j]:X[j]),I=c==="field"?X:J,V=Math.max(...f,...I,x==="gross"?6:4),te=Math.max(4,Math.ceil(V+1)),Z=280,Qe=800,ve={top:20,right:20,bottom:40,left:40},xt=Z-ve.top-ve.bottom,mt=(Qe-ve.left-ve.right)/18,vt=mt*.35,jt=mt*.1,He=b=>xt-b/te*xt,Je=(b,j)=>x==="gross"?b>0&&b<j-.5?"fill-emerald-500 hover:fill-emerald-600":b>j+.5?"fill-rose-500 hover:fill-rose-600":"fill-neutral-400 hover:fill-neutral-500":b>j+.5?"fill-emerald-500 hover:fill-emerald-600":b<j-.5?"fill-rose-500 hover:fill-rose-600":"fill-neutral-400 hover:fill-neutral-500";return e.jsxs("section",{className:"content-card p-4 md:p-6",children:[e.jsx(ms,{setView:a,hasEvent:!!(s&&s.length)}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-squab-900",children:"Hole-by-Hole Comparison"}),e.jsx("div",{className:"text-xs text-neutral-500",children:x==="gross"?"Strokes per hole (lower is better). Missing gross shown as blank.":"Points per hole (higher is better)."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap gap-3 justify-center w-full",children:[e.jsxs("div",{className:"flex bg-neutral-100 rounded-lg p-1 border border-neutral-200",children:[e.jsx("button",{onClick:()=>g("stableford"),className:`px-3 py-1 rounded-md text-xs font-bold transition-all ${x==="stableford"?"bg-white shadow-sm text-squab-900":"text-neutral-500"}`,children:"Pts"}),e.jsx("button",{onClick:()=>g("gross"),className:`px-3 py-1 rounded-md text-xs font-bold transition-all ${x==="gross"?"bg-white shadow-sm text-squab-900":"text-neutral-500"}`,children:"Gross"})]}),e.jsx("select",{className:"rounded-2xl border border-squab-200 px-3 py-1.5 text-xs bg-white",value:d,onChange:b=>A(b.target.value),children:s.map(b=>e.jsx("option",{value:b.name,children:b.name},b.name))}),e.jsxs("select",{className:"rounded-2xl border border-squab-200 px-3 py-1.5 text-xs bg-white",value:c,onChange:b=>o(b.target.value),children:[e.jsx("option",{value:"field",children:"vs Field"}),e.jsxs("option",{value:"handicap",children:["vs ",n," Grp"]})]})]})]}),e.jsx("div",{className:"w-full overflow-x-auto pb-2",children:e.jsx("div",{className:"min-w-[600px]",children:e.jsxs("svg",{viewBox:`0 0 ${Qe} ${Z}`,className:"w-full h-auto font-sans",children:[Array.from({length:te+1}).map((b,j)=>{if(te>10&&j%2!==0)return null;const O=He(j)+ve.top;return e.jsxs("g",{children:[e.jsx("line",{x1:ve.left,y1:O,x2:Qe-ve.right,y2:O,stroke:"#e5e7eb",strokeDasharray:j===0?"":"4 4"}),e.jsx("text",{x:ve.left-8,y:O+4,textAnchor:"end",className:"text-[10px] fill-neutral-400",children:j})]},j)}),Array.from({length:u}).map((b,j)=>{const O=f[j]??0,T=I[j]??0,ae=ve.left+j*mt+mt/2,ye=ae-vt-jt/2,U=ae+jt/2,at=He(O)+ve.top,ce=xt-(at-ve.top),gt=He(T)+ve.top,ot=xt-(gt-ve.top),qe=Je(O,T);return e.jsxs("g",{children:[e.jsx("text",{x:ae,y:Z-5,textAnchor:"middle",className:"text-[10px] font-semibold fill-neutral-600",children:j+1}),e.jsx("rect",{x:ye,y:at,width:vt,height:Math.max(0,ce),className:`transition-colors ${qe}`,rx:2,children:e.jsx("title",{children:`Hole ${j+1}: ${O} (${x})`})}),e.jsx("text",{x:ye+vt/2,y:at-4,textAnchor:"middle",className:"text-[9px] font-bold fill-neutral-600",children:O>0?Number.isInteger(O)?O:O.toFixed(1):""}),e.jsx("rect",{x:U,y:gt,width:vt,height:Math.max(0,ot),className:"fill-neutral-200",rx:2,children:e.jsx("title",{children:`Avg: ${Number.isFinite(T)?T.toFixed(2):"‚Äî"}`})})]},j)})]})})})]})}function gn({computed:s,courseTees:a,courseSlope:r,courseRating:u,startHcapMode:d,setView:A}){const x=he.useMemo(()=>(s||[]).map(ke=>ke.name),[s]),[g,c]=he.useState(""),[o,m]=he.useState(""),[M,n]=he.useState(""),[l,f]=he.useState(""),E="Team 1",D="Team 2",[C,N]=he.useState(0),[X,J]=he.useState(!1),[I,V]=he.useState(1200),te=he.useMemo(()=>ca(s),[s]),[Z,Qe]=he.useState(0),[ve,xt]=he.useState([]),[mt,vt]=he.useState(""),[jt,He]=he.useState(!1),[Je,b]=he.useState(null),[j,O]=he.useState(null),[T,ae]=he.useState(null),ye=ke=>(s||[]).find(w=>w.name===ke),U=(ke,w)=>{var fs,wt;const Le=ye(ke);if(!Le)return{pts:0,method:"noPlayer"};const Fe=Number((fs=Le==null?void 0:Le.bestBallPerHole)==null?void 0:fs[w]);if(Number.isFinite(Fe))return{pts:Fe,method:"bestBall"};const Vt=Number((wt=Le==null?void 0:Le.perHole)==null?void 0:wt[w]);return Number.isFinite(Vt)?{pts:Vt,method:"stableford"}:{pts:0,method:"missingPoints"}},at=(ke,w)=>{const Le=U(ke[0],w),Fe=U(ke[1],w);return{pts:Math.max(Number(Le.pts)||0,Number(Fe.pts)||0),a:Le,b:Fe}},ce=he.useMemo(()=>{const ke=[g,o,M,l].filter(Boolean);return ke.length===4&&new Set(ke).size===4},[g,o,M,l]),gt=he.useMemo(()=>{const ke=[g,o,M,l].filter(Boolean);if(ke.length!==4)return!1;for(const w of ke){const Le=ye(w),Fe=Le==null?void 0:Le.bestBallPerHole;if(!Array.isArray(Fe)||Fe.length<18)return!0}return!1},[g,o,M,l,s]),ot=()=>{N(0),Qe(0),xt([]),vt(""),He(!1),b(null),O(null),ae(null),J(!1)},qe=(ke,w)=>{const Le=te-w,Fe=Math.abs(ke),Vt=ke===0?"":ke>0?E:D;return Fe>Le&&Fe>0?{text:`Match Closed ‚Äî ${Vt} wins`,closed:!0}:Fe===Le&&Fe>0?{text:`Dormie ‚Äî ${Vt}`,closed:!1}:{text:"",closed:!1}},Dt=()=>{if(!ce||jt||C>=te)return;const ke=C+1,w=ke-1,Le=at([g,o],w),Fe=at([M,l],w),Vt=Le.pts,fs=Fe.pts;b(ke),O(Vt),ae(fs),window.setTimeout(()=>{let wt=0,ft="Halved";Vt>fs?(wt=1,ft="$Team 1 wins"):fs>Vt&&(wt=-1,ft="$Team 2 wins");const ut=Z+wt,Me=ke,Jt={hole:ke,delta:wt,diffVal:ut,t1:Vt,t2:fs,res:ft,match:ut===0?"All Square":`${Math.abs(ut)} Up (${ut>0?E:D})`,detail:{mode:"Best Ball if available, else Stableford",t1Players:[{name:g,...Le.a},{name:o,...Le.b}],t2Players:[{name:M,...Fe.a},{name:l,...Fe.b}]}};xt(Kt=>[...Kt,Jt]),Qe(ut),N(Me);const _t=qe(ut,Me);vt(_t.text),He(_t.closed),b(null)},450)};if(he.useEffect(()=>{if(!X)return;if(jt||C>=te){J(!1);return}const ke=window.setTimeout(()=>Dt(),I);return()=>window.clearTimeout(ke)},[X,I,C,jt,ce,g,o,M,l,E,D,s,Z]),!s.length)return e.jsxs("section",{className:"rounded-2xl p-4 bg-white border border-squab-200 shadow-sm",children:[e.jsx(ms,{setView:A,hasEvent:!!(s&&s.length)}),e.jsx("p",{className:"text-neutral-600",children:"Load an event CSV to watch the team matchplay replay."})]});const bt=Z===0?"All Square":`${Math.abs(Z)} Up (${Z>0?E:D})`;return e.jsxs("section",{className:"content-card p-4 md:p-6",children:[e.jsx(ms,{setView:A,hasEvent:!!(s&&s.length)}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4 border-b border-squab-100 pb-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-squab-900",children:"ü§º Team Matchplay Live Replay"}),e.jsxs("p",{className:"text-sm text-neutral-500",children:["2v2 Better-Ball Stableford ‚Äî uses the ",e.jsx("span",{className:"font-semibold",children:"Best Ball"})," row from the Squabbit CSV."]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("button",{className:"btn border "+(X?"bg-emerald-600 text-white border-emerald-700":"bg-white border-squab-200"),onClick:()=>{if(!ce){zt("Pick 4 different players first.");return}J(ke=>!ke)},children:X?"Pause":C===0?"Start":"Resume"}),e.jsx("button",{className:"btn border border-squab-200 bg-white",onClick:Dt,disabled:!ce||jt||C>=te,children:"Step"}),e.jsx("button",{className:"btn border border-squab-200 bg-white",onClick:ot,children:"Reset"}),e.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[e.jsx("span",{className:"text-xs text-neutral-500",children:"Speed"}),e.jsx("input",{type:"range",min:"450",max:"2200",step:"50",value:I,onChange:ke=>V(Number(ke.target.value))})]})]})]}),gt&&e.jsx("div",{className:"mb-4 rounded-2xl border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-900",children:"Heads up: one or more selected players don‚Äôt have a Best Ball row in this CSV ‚Äî this will revert to Stableford points on any holes where Best Ball is missing."}),e.jsx("div",{className:"tm-viz-card mb-4",children:(()=>{const ke=(ve||[]).map(Me=>({h:Me.hole,d:Me.diffVal??0,res:Me.res,match:Me.match})),w=ke.length?ke[ke.length-1].h:0,Le=Math.min(te,Math.max(1,typeof Je=="number"&&Je>0?Je:w||1)),Fe=ke.find(Me=>Me.h===Le)||{d:0,res:"Halved"},Vt=Fe.d===0?"All Square":Fe.d>0?`${Math.abs(Fe.d)} Up (Team 1)`:`${Math.abs(Fe.d)} Up (Team 2)`,fs=Fe.res?Fe.res:"‚Äî",wt=Math.max(2,...ke.map(Me=>Math.abs(Me.d))),ft=Math.min(6,Math.max(3,wt)),ut=[];for(let Me=ft;Me>=-ft;Me--){const Jt=Me===0?"AS":Me>0?`${Me} UP`:`${Math.abs(Me)} DN`,_t=Me===0?"All Square":Me>0?"Team 1 leading":"Team 2 leading";ut.push({v:Me,label:Jt,sub:_t})}return e.jsxs("div",{className:"tm-sky",children:[e.jsxs("div",{className:"tm-ladder",children:[e.jsx("div",{className:"tm-ladder-title",children:"Match Position"}),ut.map((Me,Jt)=>e.jsxs("div",{className:"tm-rung "+(Me.v===Fe.d?"current":""),children:[e.jsxs("div",{children:[e.jsx("div",{className:"label",children:Me.label}),e.jsx("div",{className:"sub",children:Me.sub})]}),e.jsx("span",{className:"pip"})]},Jt))]}),e.jsxs("div",{className:"tm-broadcast",children:[e.jsxs("div",{className:"tm-broadcast-top",children:[e.jsx("div",{className:"tm-bigstate",children:e.jsxs("div",{children:[e.jsxs("div",{className:"hole",children:["Hole ",Le]}),e.jsx("div",{className:"state",children:Vt}),e.jsxs("div",{className:"result",children:["Result: ",fs]})]})}),e.jsxs("div",{className:"text-xs text-neutral-500",children:[bt," ¬∑ Holes completed: ",C,"/",te," ",jt?"¬∑ Match Closed":""]})]}),e.jsxs("div",{className:"tm-barwrap",children:[e.jsx("div",{className:"tm-bars","aria-label":"Match position bar graph by hole",children:Array.from({length:te}).map((Me,Jt)=>{const _t=Jt+1,Kt=(ve||[]).find(ie=>ie.hole===_t),W=Kt?Kt.diffVal??0:0,de=Math.min(ft,Math.abs(W)),Te=ft?de/ft*50:0,xe=W>0,fe=W<0,Oe=xe?"up":fe?"down":"as",me=Le===_t,re=xe?{height:`${Te}%`,bottom:"50%"}:fe?{height:`${Te}%`,bottom:`${50-Te}%`}:{height:"2%",bottom:"49%"};return e.jsxs("div",{className:`tm-barcell ${me?"current":""}`,title:Kt?`Hole ${_t}: ${Kt.res} ¬∑ ${Kt.match}`:`Hole ${_t}: not played yet`,children:[e.jsx("div",{className:"tm-midline"}),e.jsx("div",{className:`tm-bar ${Oe}`,style:re})]},_t)})}),e.jsx("div",{className:"tm-tape-num","aria-hidden":"true",children:Array.from({length:te}).map((Me,Jt)=>e.jsx("div",{children:Jt+1},Jt))})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border border-squab-200 bg-white/85 backdrop-blur px-4 py-3 shadow-sm",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] font-black uppercase tracking-widest text-neutral-400",children:"Pick the players"}),e.jsxs("div",{className:"text-sm font-semibold text-neutral-800",children:["Choose ",e.jsx("span",{className:"font-black",children:"2 players"})," for ",e.jsx("span",{className:"font-black",children:"Team 1"})," and ",e.jsx("span",{className:"font-black",children:"Team 2"})," to replay the match"]}),e.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:"The match replay needs all 4 players selected."})]}),e.jsx("span",{className:"chip special",children:"Required"})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-0",children:[e.jsxs("div",{className:"rounded-2xl border border-squab-200 p-3 bg-neutral-50",children:[e.jsx("div",{className:"text-xs text-neutral-500 font-bold uppercase mb-2",children:"Team 1"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("select",{className:"rounded-2xl border border-squab-200 px-3 py-2 bg-white ring-2 ring-emerald-200 focus:ring-emerald-400",value:g,onChange:Me=>c(Me.target.value),children:[e.jsx("option",{value:"",children:"Player 1"}),x.map(Me=>e.jsx("option",{value:Me,children:Me},"t1p1-"+Me))]}),e.jsxs("select",{className:"rounded-2xl border border-squab-200 px-3 py-2 bg-white ring-2 ring-emerald-200 focus:ring-emerald-400",value:o,onChange:Me=>m(Me.target.value),children:[e.jsx("option",{value:"",children:"Player 2"}),x.map(Me=>e.jsx("option",{value:Me,children:Me},"t1p2-"+Me))]})]})]}),e.jsxs("div",{className:"rounded-2xl border border-squab-200 p-3 bg-neutral-50",children:[e.jsx("div",{className:"text-xs text-neutral-500 font-bold uppercase mb-2",children:"Team 2"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("select",{className:"rounded-2xl border border-squab-200 px-3 py-2 bg-white ring-2 ring-emerald-200 focus:ring-emerald-400",value:M,onChange:Me=>n(Me.target.value),children:[e.jsx("option",{value:"",children:"Player 1"}),x.map(Me=>e.jsx("option",{value:Me,children:Me},"t2p1-"+Me))]}),e.jsxs("select",{className:"rounded-2xl border border-squab-200 px-3 py-2 bg-white ring-2 ring-emerald-200 focus:ring-emerald-400",value:l,onChange:Me=>f(Me.target.value),children:[e.jsx("option",{value:"",children:"Player 2"}),x.map(Me=>e.jsx("option",{value:Me,children:Me},"t2p2-"+Me))]})]})]})]}),e.jsxs("div",{className:"rounded-2xl border border-squab-200 p-4 bg-white mb-0 ring-2 ring-emerald-200 focus:ring-emerald-400",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-neutral-500 font-bold uppercase",children:"Match"}),e.jsx("div",{className:"text-2xl font-black text-squab-900",children:bt}),e.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:["Holes completed: ",C,"/",te]})]}),mt&&e.jsx("div",{className:"px-4 py-2 rounded-2xl border text-sm font-bold "+(jt?"bg-emerald-50 border-emerald-300 text-emerald-800":"bg-amber-50 border-amber-300 text-amber-800"),children:mt})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-4",children:[e.jsxs("div",{className:"rounded-2xl border border-squab-200 bg-neutral-50 p-3",children:[e.jsx("div",{className:"text-xs text-neutral-500 font-bold uppercase mb-1",children:E.toUpperCase()}),e.jsx("div",{className:"flip "+(Je?"flip-active":""),children:e.jsxs("div",{className:"flip-inner",children:[e.jsx("div",{className:"flip-front text-4xl font-black text-squab-900",children:j??"‚Äî"}),e.jsx("div",{className:"flip-back text-4xl font-black text-squab-900",children:j??"‚Äî"})]})})]}),e.jsxs("div",{className:"rounded-2xl border border-squab-200 bg-neutral-50 p-3",children:[e.jsx("div",{className:"text-xs text-neutral-500 font-bold uppercase mb-1",children:D.toUpperCase()}),e.jsx("div",{className:"flip "+(Je?"flip-active":""),children:e.jsxs("div",{className:"flip-inner",children:[e.jsx("div",{className:"flip-front text-4xl font-black text-squab-900",children:T??"‚Äî"}),e.jsx("div",{className:"flip-back text-4xl font-black text-squab-900",children:T??"‚Äî"})]})})]})]}),e.jsx("div",{className:"text-xs text-neutral-500 mt-3",children:Je?`Hole ${Je}: points flip... then match updates.`:"Waiting for next hole..."})]})]})]}),e.jsxs("div",{className:"tm-story",children:[e.jsx("div",{className:"kicker",children:"What just happened"}),e.jsxs("div",{className:"line",children:["Hole ",Le,": ",fs]}),e.jsxs("div",{className:"line2",children:["Match moves to ",e.jsx("b",{children:Vt})]})]})]})]})})()}),e.jsxs("div",{className:"rounded-2xl border border-squab-200 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-2 bg-neutral-50 border-b border-squab-200 text-xs font-bold uppercase text-neutral-500",children:"Hole-by-hole ‚Äî Better-ball Stableford ‚Üí Matchplay hole result"}),e.jsx("div",{className:"overflow-auto table-wrap",children:e.jsxs("table",{className:"min-w-full text-sm table-zebra",children:[e.jsx("thead",{className:"bg-white sticky top-0",children:e.jsxs("tr",{className:"text-left text-xs uppercase tracking-wide text-neutral-500 font-bold border-b border-neutral-100",children:[e.jsx("th",{className:"py-2 px-3",children:"Hole"}),e.jsx("th",{className:"py-2 px-3",children:"Team 1 (best)"}),e.jsx("th",{className:"py-2 px-3",children:"Team 2 (best)"}),e.jsx("th",{className:"py-2 px-3",children:"Result"}),e.jsx("th",{className:"py-2 px-3",children:"Match"})]})}),e.jsxs("tbody",{className:"divide-y divide-neutral-100",children:[ve.map(ke=>e.jsxs(ue.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-neutral-50",children:[e.jsx("td",{className:"py-2 px-3",children:e.jsx("span",{className:"tm-holebadge",children:ke.hole})}),e.jsx("td",{className:"py-2 px-3",children:e.jsx("span",{className:"tm-scorepill",children:ke.t1})}),e.jsx("td",{className:"py-2 px-3",children:e.jsx("span",{className:"tm-scorepill",children:ke.t2})}),e.jsx("td",{className:"py-2 px-3",children:e.jsx("span",{className:"tm-resultpill",children:ke.res})}),e.jsx("td",{className:"py-2 px-3",children:e.jsx("span",{className:"tm-matchpill",children:ke.match})})]}),e.jsx("tr",{className:"bg-neutral-50/60",children:e.jsx("td",{className:"py-2 px-3 text-xs text-neutral-500",colSpan:5,children:e.jsxs("div",{className:"flex flex-col md:flex-row md:gap-6 gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-[10px] uppercase font-bold text-neutral-400 mb-1",children:"Team 1 details"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:ke.detail.t1Players.map((w,Le)=>e.jsxs("div",{className:"rounded-2xl border border-neutral-200 bg-white px-2 py-1",children:[e.jsx("div",{className:"font-semibold text-neutral-800 text-xs",children:w.name}),e.jsxs("div",{className:"text-[11px] text-neutral-600",children:["Pts: ",e.jsx("span",{className:"font-bold",children:w.pts})," ",e.jsxs("span",{className:"text-neutral-400",children:["(",w.method==="bestBall"?"Best Ball":w.method==="missingBestBall"?"Missing Best Ball":w.method,")"]})]})]},"t1d-"+ke.hole+"-"+Le))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-[10px] uppercase font-bold text-neutral-400 mb-1",children:"Team 2 details"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:ke.detail.t2Players.map((w,Le)=>e.jsxs("div",{className:"rounded-2xl border border-neutral-200 bg-white px-2 py-1",children:[e.jsx("div",{className:"font-semibold text-neutral-800 text-xs",children:w.name}),e.jsxs("div",{className:"text-[11px] text-neutral-600",children:["Pts: ",e.jsx("span",{className:"font-bold",children:w.pts})," ",e.jsxs("span",{className:"text-neutral-400",children:["(",w.method==="bestBall"?"Best Ball":w.method==="missingBestBall"?"Missing Best Ball":w.method,")"]})]})]},"t2d-"+ke.hole+"-"+Le))})]})]})})}),e.jsx("tr",{className:"tm-spacer",children:e.jsx("td",{colSpan:5})})]},"row-"+ke.hole)),ve.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-4 px-3 text-sm text-neutral-600",children:"Pick teams, then press Start."})})]})]})})]})]})}function za({value:s,onChange:a,options:r}){return e.jsx("div",{className:"flex flex-col sm:flex-row flex-wrap gap-3 justify-center w-full",children:r.map(u=>{const d=String(u.value)===String(s);return e.jsx("button",{onClick:()=>a(u.value),className:"px-3 py-1.5 rounded-full text-sm font-black border transition "+(d?"bg-neutral-900 text-white border-neutral-900":"bg-white text-neutral-800 border-neutral-200 hover:border-neutral-400"),children:u.label},u.value)})})}function Nn({a:s,b:a,labels:r,height:u=180}){const d=(s||[]).map(Number),A=(a||[]).map(Number),x=Math.max(d.length,A.length,0);if(x<2)return e.jsx("div",{className:"text-sm text-neutral-600",children:"Not enough games to chart yet."});const g=[...d,...A].filter(Number.isFinite),c=g.length?Math.min(...g):0,o=g.length?Math.max(...g):1,m=680,M=u,n=34,l=(m-2*n)/(x-1),f=N=>{if(!Number.isFinite(N))return NaN;if(o===c)return M/2;const X=(N-c)/(o-c);return M-n-X*(M-2*n)},E=N=>{let X="";for(let J=0;J<x;J++){const I=Number(N[J]);if(!Number.isFinite(I))continue;const V=n+J*l,te=f(I);Number.isFinite(te)&&(X+=(X?" L ":"M ")+V+" "+te)}return X||""},D=E(d),C=E(A);return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("svg",{viewBox:`0 0 ${m} ${M}`,className:"w-full min-w-[680px]",children:[(()=>{if(o===c){const X=M/2,J=Math.round(c*10)/10;return e.jsxs("g",{children:[e.jsx("line",{x1:n,y1:X,x2:m-n,y2:X,stroke:"rgba(0,0,0,0.10)"}),e.jsx("text",{x:n-8,y:X+4,textAnchor:"end",fontSize:"10",fill:"rgba(0,0,0,0.45)",children:String(J)})]},"yt-flat")}const N=4;return Array.from({length:N+1}).map((X,J)=>{const I=c+(o-c)*(J/N),V=f(I),te=Math.round(I*10)/10;return e.jsxs("g",{children:[e.jsx("line",{x1:n,y1:V,x2:m-n,y2:V,stroke:"rgba(0,0,0,0.08)"}),e.jsx("text",{x:n-8,y:V+4,textAnchor:"end",fontSize:"10",fill:"rgba(0,0,0,0.45)",children:String(te)})]},"yt"+J)})})(),e.jsx("line",{x1:n,y1:M-n,x2:m-n,y2:M-n,stroke:"rgba(0,0,0,0.18)"}),e.jsx("line",{x1:n,y1:n,x2:n,y2:M-n,stroke:"rgba(0,0,0,0.18)"}),C?e.jsx("path",{d:C,fill:"none",stroke:"rgba(0,0,0,0.25)",strokeWidth:"3"}):null,D?e.jsx("path",{d:D,fill:"none",stroke:"currentColor",strokeWidth:"4"}):null,Array.from({length:x}).map((N,X)=>{const J=n+X*l,I=d[X],V=A[X],te=f(I),Z=f(V);return e.jsxs("g",{children:[Number.isFinite(Z)?e.jsx("circle",{cx:J,cy:Z,r:"4",fill:"rgba(0,0,0,0.25)"}):null,Number.isFinite(te)?e.jsx("circle",{cx:J,cy:te,r:"5",fill:"currentColor"}):null,r!=null&&r[X]?e.jsx("text",{x:J,y:M-10,textAnchor:"middle",fontSize:"10",fill:"rgba(0,0,0,0.5)",children:r[X]}):null]},X)})]})})}function yn({seasonModel:s,scoringMode:a,setScoringMode:r,grossCompare:u,setGrossCompare:d,seasonFiles:A,reportNextHcapMode:x,setReportNextHcapMode:g,seasonPlayer:c,setSeasonPlayer:o,seasonYear:m,setSeasonYear:M,seasonLimit:n,setSeasonLimit:l,seasonYears:f,seasonLoading:E,seasonProgress:D,seasonError:C,runSeasonAnalysis:N,setView:X}){var Yt,ls,Zt,Ns,Hs,$s,na,As,Zs,Ds,Ls,ht,Ts,Ks,Js,la,ns,hs,$e,Ve,Ge,lt;const[J,I]=ue.useState(()=>{try{const t=window.__dslUiState&&window.__dslUiState.cohortMode||localStorage.getItem("dsl_cohortMode")||"field";return t==="field"||t==="band"?t:"field"}catch{return"field"}});ue.useEffect(()=>{try{window.__dslUiState=window.__dslUiState||{},window.__dslUiState.cohortMode=J;try{localStorage.setItem("dsl_cohortMode",J)}catch{}window.__dslUiState.seasonYear=m,window.__dslUiState.seasonLimit=n}catch{}},[J,m,n]);const[V,te]=ue.useState(!1),[Z,Qe]=ue.useState("all"),[ve,xt]=ue.useState(()=>{try{return localStorage.getItem("dsl_lens")||"pointsField"}catch{return"pointsField"}}),[mt,vt]=ue.useState(()=>{try{return localStorage.getItem("dsl_trendMetric")||"overall"}catch{return"overall"}});ue.useEffect(()=>{try{localStorage.setItem("dsl_trendMetric",String(mt||"overall"))}catch{}},[mt]);const jt=ve==="strokesPar"?"par":"field";ue.useEffect(()=>{ve==="pointsField"?a!=="stableford"&&r("stableford"):a!=="gross"&&r("gross"),ve==="strokesPar"&&J!=="field"&&I("field")},[ve]);const He=ue.useMemo(()=>[{key:"pointsField_field",label:"Stableford Points ‚Äî vs Field",pp:"pointsField",cohort:"field",rgb:"124,58,237",hint:"Stableford points ranked across everyone (overall view)."},{key:"pointsField_band",label:"Stableford Points ‚Äî vs Handicap band",pp:"pointsField",cohort:"band",rgb:"124,58,237",hint:"Stableford points vs players with similar handicaps (fairer comparison)."},{key:"strokesField_field",label:"Score (Strokes) ‚Äî vs Field",pp:"strokesField",cohort:"field",rgb:"37,99,235",hint:"Gross strokes compared across everyone (lower is better)."},{key:"strokesField_band",label:"Score (Strokes) ‚Äî vs Handicap band",pp:"strokesField",cohort:"band",rgb:"37,99,235",hint:"Gross strokes vs similar handicaps (lower is better)."},{key:"strokesPar",label:"Score (Strokes) ‚Äî vs Par",pp:"strokesPar",cohort:"field",rgb:"249,115,22",hint:"Absolute score relative to par (no field/band comparison)."}],[]),Je=ue.useMemo(()=>{const t=He.find(i=>i.pp===ve&&i.cohort===J);return t||ve==="strokesPar"&&He.find(i=>i.key==="strokesPar")||He[0]},[He,ve,J]),b=(Je==null?void 0:Je.key)||"pointsField_field",j=ue.useMemo(()=>({background:`rgba(${(Je==null?void 0:Je.rgb)||"124,58,237"}, 1)`}),[Je]);ue.useEffect(()=>{try{localStorage.setItem("dsl_lens",ve)}catch{}try{window.dispatchEvent(new Event("dsl_lens_change"))}catch{}},[ve]),ue.useEffect(()=>{const t=()=>{try{const i=localStorage.getItem("dsl_lens")||"pointsField";(i==="pointsField"||i==="strokesField"||i==="strokesPar")&&xt(p=>p===i?p:i)}catch{}};return window.addEventListener("dsl_lens_change",t),window.addEventListener("storage",t),()=>{window.removeEventListener("dsl_lens_change",t),window.removeEventListener("storage",t)}},[]);const[O,T]=ue.useState(8),[ae,ye]=ue.useState(!1);ue.useEffect(()=>{try{if(!ae)return;const t=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=t}}catch{}},[ae]);const U=(t,i=NaN)=>pe(t,i),at=t=>{const i=(t||[]).map(Number).filter(Number.isFinite);return i.length?i.reduce((p,y)=>p+y,0)/i.length:NaN},ce=t=>{const i=(t||[]).map(Number).filter(Number.isFinite);if(i.length<2)return NaN;const p=at(i);let y=0;for(const _ of i){const k=_-p;y+=k*k}return Math.sqrt(y/(i.length-1))},gt=t=>{const i=(t||[]).map(Number).filter(Number.isFinite).slice().sort((y,_)=>y-_);if(!i.length)return NaN;const p=Math.floor(i.length/2);return i.length%2?i[p]:(i[p-1]+i[p])/2},ot=t=>String(t??"").trim().toLowerCase().replace(/\s+/g," "),qe=(t,i=1)=>Os(t,i),Dt=(t,i=0)=>Number.isFinite(t)?`${qe(t*100,i)}%`:"‚Äî",bt=t=>Dt(t,0),ke=Xr,w=ue.useMemo(()=>{const t=(s==null?void 0:s.players)||[];return t.find(i=>i.name===c)||t[0]||null},[s,c]),Le=ue.useMemo(()=>w&&Array.isArray(w.series)?w.series:[],[w]),Fe=ue.useMemo(()=>{try{return Vr(Le)}catch{return{ok:!1,reason:"error"}}},[Le]),Vt=String((w==null?void 0:w.name)||"").trim().split(/\s+/).filter(Boolean),fs=Vt[0]||"",wt=Vt.slice(1).join(" "),ft=(s==null?void 0:s.players)||[],ut=(s==null?void 0:s.field)||{},Me=ue.useMemo(()=>{const t=Ma(pr(w)),i=(ft||[]).filter(p=>Ma(pr(p))===t);return{byPar:Ca(i,"byPar"),bySI:Ca(i,"bySI"),byYards:Ca(i,"byYards"),byParGross:Ca(i,"byParGross"),bySIGross:Ca(i,"bySIGross"),byYardsGross:Ca(i,"byYardsGross")}},[Ur,ut,ft,w]),Jt=a==="gross";ue.useMemo(()=>Ha({scoringMode:a,dim:"Par",mapObj:Jt?w==null?void 0:w.byParGross:w==null?void 0:w.byPar,fieldObj:Jt?Me==null?void 0:Me.byParGross:Me==null?void 0:Me.byPar}),[w,ut,a]),ue.useMemo(()=>Ha({scoringMode:a,dim:"SI",mapObj:Jt?w==null?void 0:w.bySIGross:w==null?void 0:w.bySI,fieldObj:Jt?Me==null?void 0:Me.bySIGross:Me==null?void 0:Me.bySI,limit:6}),[w,ut,a]),ue.useMemo(()=>{const t=Jt?w==null?void 0:w.byYardsGross:(w==null?void 0:w.byYards)||(w==null?void 0:w.byParYards),i=Jt?Me==null?void 0:Me.byYardsGross:(ut==null?void 0:ut.byYards)||(ut==null?void 0:ut.byParYards);return Ha({scoringMode:a,dim:"Yd",mapObj:t,fieldObj:i,limit:8})},[w,ut,a]);const[_t,Kt]=ue.useState("stableford"),[W,de]=ue.useState(!0),Te=t=>t&&t.holes?Number(t.pts)/Number(t.holes):NaN,xe=t=>t&&t.holes?Number(t.val)/Number(t.holes):NaN,fe=t=>t&&t.name&&!(typeof js=="function"&&js(t.name)),Oe=ue.useMemo(()=>{const t=(Array.isArray(ft)?ft:[]).filter(fe),i=y=>{const _=t.map(k=>{var v,ee;if(_t==="gross"){const F=(v=k==null?void 0:k.byParGross)==null?void 0:v[y],oe=F&&Number.isFinite(Number(F.holes))?Number(F.holes):NaN,$=xe(F);return{name:k.name,v:$,holes:oe}}else{const F=(ee=k==null?void 0:k.byPar)==null?void 0:ee[y],oe=F&&Number.isFinite(Number(F.holes))?Number(F.holes):NaN,$=Te(F);return{name:k.name,v:$,holes:oe}}}).filter(k=>Number.isFinite(k.v));return _.sort((k,v)=>_t==="gross"?k.v-v.v:v.v-k.v),_.slice(0,20)};return{all:(()=>{const y=["Par 3","Par 4","Par 5"],_=t.map(k=>{if(_t==="gross"){let v=0,ee=0;y.forEach(oe=>{var se;const $=(se=k==null?void 0:k.byParGross)==null?void 0:se[oe],K=$&&Number.isFinite(Number($.holes))?Number($.holes):0,Ae=$&&Number.isFinite(Number($.val))?Number($.val):0;v+=K,ee+=Ae});const F=v?ee/v:NaN;return{name:k.name,v:F,holes:v}}else{let v=0,ee=0;y.forEach(oe=>{var se;const $=(se=k==null?void 0:k.byPar)==null?void 0:se[oe],K=$&&Number.isFinite(Number($.holes))?Number($.holes):0,Ae=$&&Number.isFinite(Number($.pts))?Number($.pts):0;v+=K,ee+=Ae});const F=v?ee/v:NaN;return{name:k.name,v:F,holes:v}}}).filter(k=>Number.isFinite(k.v));return _.sort((k,v)=>_t==="gross"?k.v-v.v:v.v-k.v),_.slice(0,20)})(),p3:i("Par 3"),p4:i("Par 4"),p5:i("Par 5")}},[ft,_t]),me=ue.useMemo(()=>{if(!w)return{label:"Field",players:ft,fieldAgg:ut};if(J==="field")return{label:"Field",players:ft,fieldAgg:ut};const t=Array.isArray(w.series)?w.series:[],i=at(t.map($=>U($.hcap,NaN))),p=Number.isFinite(i)?i>=18?6:i>=10?4:3:4,y=ft.filter($=>{if(!$||$.name===w.name)return!1;const K=Array.isArray($.series)?$.series:[],Ae=at(K.map(se=>U(se.hcap,NaN)));return Number.isFinite(i)&&Number.isFinite(Ae)&&Math.abs(Ae-i)<=p});if(y.length<3)return{label:"Field (band too small)",players:ft,fieldAgg:ut};const _=()=>({holes:0,pts:0,wipes:0}),k=($,K)=>{if(!$||!K)return;const Ae=U(K.holes,0);Ae&&($.holes+=Ae,Number.isFinite(U(K.pts,NaN))&&($.pts+=U(K.pts,0)),Number.isFinite(U(K.wipes,NaN))&&($.wipes+=U(K.wipes,0)))},v=()=>({holes:0,val:0,bogeyPlus:0,parOrBetter:0,birdieOrBetter:0,doublePlus:0,eaglePlus:0,birdies:0,pars:0,bogeys:0,doubles:0,triplesPlus:0}),ee=($,K)=>{if(!$||!K)return;const Ae=U(K.holes,0);Ae&&($.holes+=Ae,$.val+=U(K.val,0),["bogeyPlus","parOrBetter","birdieOrBetter","doublePlus","eaglePlus","birdies","pars","bogeys","doubles","triplesPlus"].forEach(se=>{$[se]+=U(K[se],0)}))},F={totals:_(),totalsGross:v(),byPar:{"Par 3":_(),"Par 4":_(),"Par 5":_(),Unknown:_()},byParGross:{"Par 3":v(),"Par 4":v(),"Par 5":v(),Unknown:v()},bySI:{"1‚Äì6":_(),"7‚Äì12":_(),"13‚Äì18":_(),Unknown:_()},bySIGross:{"1‚Äì6":v(),"7‚Äì12":v(),"13‚Äì18":v(),Unknown:v()},byYards:{},byYardsGross:{}},oe=($,K,Ae)=>{K&&Object.keys(K).forEach(se=>{$[se]||($[se]=Ae?v():_()),Ae?ee($[se],K[se]):k($[se],K[se])})};return y.forEach($=>{k(F.totals,$.totals),ee(F.totalsGross,$.totalsGross),["Par 3","Par 4","Par 5","Unknown"].forEach(K=>{var Ae,se;k(F.byPar[K],(Ae=$.byPar)==null?void 0:Ae[K]),ee(F.byParGross[K],(se=$.byParGross)==null?void 0:se[K])}),["1‚Äì6","7‚Äì12","13‚Äì18","Unknown"].forEach(K=>{var Ae,se;k(F.bySI[K],(Ae=$.bySI)==null?void 0:Ae[K]),ee(F.bySIGross[K],(se=$.bySIGross)==null?void 0:se[K])}),oe(F.byYards,$.byYards,!1),oe(F.byYardsGross,$.byYardsGross,!0)}),{label:`Handicap band (¬±${p})`,players:y,fieldAgg:F}},[w,J,ft,ut]),re=me.fieldAgg||ut;ue.useEffect(()=>{try{const t=String(J||"field")==="field"?"field":"band",i=Array.isArray(me==null?void 0:me.players)?me.players:[],p=Array.isArray(w==null?void 0:w.series)?w.series:[],y=at(p.map(F=>U(F==null?void 0:F.hcap,NaN))),_=Number.isFinite(y)?y>=18?6:y>=10?4:3:4;let k="Field";if(t==="band")if(Number.isFinite(y)){const F=y-_,oe=y+_;k=`Handicap band (${F.toFixed(1)}‚Äì${oe.toFixed(1)})`}else k=`Handicap band (¬±${_})`;else k="Field";/Field \(band too small\)/.test(String((me==null?void 0:me.label)||""))&&(k="Field (band too small)");let v=1/0,ee=-1/0;for(const F of i){const oe=Array.isArray(F==null?void 0:F.series)?F.series:[],$=at(oe.map(K=>U(K==null?void 0:K.hcap,NaN)));Number.isFinite($)&&(v=Math.min(v,$),ee=Math.max(ee,$))}window.__dslOverviewReport={playerName:String((w==null?void 0:w.name)||""),yearLabel:m,seasonLimit:n,scoringMode:a,lensMode:localStorage.getItem("dsl_lens")||"pointsField",comparatorMode:ve==="strokesPar"?"par":t,cohortLabel:ve==="strokesPar"?"Par baseline":String((me==null?void 0:me.label)||k),peerBand:ve==="strokesPar"?"Par baseline":k,peerPlayersN:ve==="strokesPar"?0:i.length,peerMin:ve==="strokesPar"?NaN:v!==1/0?v:NaN,peerMax:ve==="strokesPar"?NaN:ee!==-1/0?ee:NaN,peerContextBand:k,peerContextPlayersN:i.length,peerContextMin:v!==1/0?v:NaN,peerContextMax:ee!==-1/0?ee:NaN,playerAgg:w,peerAgg:ve==="strokesPar"?null:re,peerContextAgg:re};try{window.dispatchEvent(new Event("dsl_overview_report_change"))}catch{}}catch{}},[w,me,re,J,m,n,a,ve]);const ie=t=>{const i=U(t==null?void 0:t.holes,0),p=U(t==null?void 0:t.pts,NaN);return i?p/i:NaN},St=t=>{const i=U(t==null?void 0:t.holes,0),p=U(t==null?void 0:t.val,NaN);return i?p/i:NaN},Gt=t=>{const i=Array.isArray(t==null?void 0:t.series)?t.series.slice():[];return i.sort((p,y)=>(Number(p.dateMs)||Number(p.idx)||0)-(Number(y.dateMs)||Number(y.idx)||0)),i},$t=(()=>{const t=Gt(w),i=Number.isFinite(U(w==null?void 0:w.games,NaN))?Number(w.games):t.length;return i&&i>0?i:t.length})()===1,Qt=t=>{const i=Gt(t);if(!i.length)return NaN;const p=a==="gross"?i.map(y=>{const _=U(y.gross,NaN),k=U(y.parTotal,NaN);return Number.isFinite(_)&&Number.isFinite(k)?_-k:NaN}).filter(Number.isFinite):i.map(y=>U(y.pts,NaN)).filter(Number.isFinite);return p.length?$t?p[p.length-1]:at(p):NaN},Rt=Qt(w),ps=(()=>{const i=((me==null?void 0:me.players)||[]).filter(p=>p&&w&&p.name!==w.name).map(p=>Qt(p)).filter(Number.isFinite);return i.length?i.reduce((p,y)=>p+y,0)/i.length:NaN})(),es=ke(a,Rt,ps);(()=>{const t=Number(w==null?void 0:w.games);return Number.isFinite(t)&&t>0?t:(Array.isArray(w==null?void 0:w.series)?w.series.length:0)||0})(),(()=>{const t=(w==null?void 0:w.byParGross)||(w==null?void 0:w.byPar)||{};return Object.values(t).reduce((i,p)=>i+pe((p==null?void 0:p.holes)||(p==null?void 0:p.n)||(p==null?void 0:p.count)||0,0),0)})();const Ht=Array.isArray(w==null?void 0:w.series)?w.series.slice():[],Cs=(Number.isFinite(w==null?void 0:w.games)?Number(w.games):Ht.length)||0;Ht.sort((t,i)=>{const p=Number.isFinite(t==null?void 0:t.dateMs)&&Number(t.dateMs)>0?Number(t.dateMs):Number((t==null?void 0:t.idx)||0),y=Number.isFinite(i==null?void 0:i.dateMs)&&Number(i.dateMs)>0?Number(i.dateMs):Number((i==null?void 0:i.idx)||0);return p-y});const Xs=String(n||"").toLowerCase()==="all"?0:Number(n),Us=Xs&&Xs>0?Ht.slice(-Xs):Ht.slice(),Qs=(t,i)=>{if(!t)return NaN;const p=String(i||"overall"),y=ia(t),_=Array.isArray(y==null?void 0:y.pArr)?y.pArr:Array.isArray(t==null?void 0:t.parsPerHole)?t.parsPerHole.map(Number):Array.isArray(t==null?void 0:t.parPerHole)?t.parPerHole.map(Number):null,k=p==="p3"?3:p==="p4"?4:p==="p5"?5:null;if(k&&Array.isArray(_)&&_.length)if(a==="gross"){const v=Array.isArray(t==null?void 0:t.grossPerHole)?t.grossPerHole:null;if(!Array.isArray(v)||!v.length)return NaN;let ee=0,F=0,oe=0;for(let $=0;$<Math.min(v.length,_.length);$++){if(Number(_[$])!==k)continue;const K=U(v[$],NaN);Number.isFinite(K)&&(ee+=K,F+=Number(_[$])||0,oe+=1)}return oe?ee-F:NaN}else{const v=Array.isArray(t==null?void 0:t.perHole)?t.perHole:Array.isArray(t==null?void 0:t.ptsPerHole)?t.ptsPerHole:Array.isArray(t==null?void 0:t.pointsPerHole)?t.pointsPerHole:null;if(!Array.isArray(v)||!v.length)return NaN;let ee=0,F=0;for(let oe=0;oe<Math.min(v.length,_.length);oe++){if(Number(_[oe])!==k)continue;const $=U(v[oe],NaN);Number.isFinite($)&&(ee+=$,F+=1)}return F?ee:NaN}if(a==="gross"){const v=U(t.gross,NaN),ee=U(t.parTotal,NaN);return Number.isFinite(v)&&Number.isFinite(ee)?v-ee:NaN}return U(t.pts,NaN)},ea=Us.map(t=>Qs(t,mt)),_s=Us.map((t,i)=>{if(Number.isFinite(Number(t==null?void 0:t.dateMs))&&Number(t.dateMs)>0){const p=new Date(Number(t.dateMs));return`${p.getDate()}/${p.getMonth()+1}`}return`G${(Number(t==null?void 0:t.idx)||i)+1}`}),ha=mt==="p3"?"Par 3":mt==="p4"?"Par 4":mt==="p5"?"Par 5":"Overall",Ws=(()=>{const t=ha==="Overall"?"":`${ha} only ‚Äî `;return ve==="pointsField"?t+"Stableford points per round compared to the field average. Higher is better.":ve==="strokesField"?t+"Score per round compared to the field average. Lower is better.":t+"Strokes over par per round. Lower is better."})(),ba=(()=>{const i=(Array.isArray(me==null?void 0:me.players)?me.players:Array.isArray(s==null?void 0:s.players)?s.players:[]).filter(p=>p&&p.name!==(w==null?void 0:w.name));return Us.map(p=>{const y=p==null?void 0:p.file;if(!y)return NaN;const _=[];for(const k of i){const ee=hr(k==null?void 0:k.series).find(oe=>(oe==null?void 0:oe.file)===y),F=Qs(ee,mt);Number.isFinite(F)&&_.push(F)}return _.length?at(_):NaN})})(),da=Us.map(t=>{if(a==="gross")return 0;const i=String(mt||"overall");if(i==="overall")return 36;const p=ia(t),y=Array.isArray(p==null?void 0:p.pArr)?p.pArr:Array.isArray(t==null?void 0:t.parsPerHole)?t.parsPerHole.map(Number):Array.isArray(t==null?void 0:t.parPerHole)?t.parPerHole.map(Number):null,_=i==="p3"?3:i==="p4"?4:i==="p5"?5:null;if(!_||!Array.isArray(y)||!y.length)return NaN;let k=0;for(let v=0;v<y.length;v++)Number(y[v])===_&&(k+=1);return k?2*k:NaN}),Ms=Us.slice().map(t=>Qs(t,mt)).filter(Number.isFinite),qt=at(Ms),cs=ce(a==="gross"?Ht.map(t=>U(t.gross,NaN)-U(t.parTotal,NaN)):Ht.map(t=>U(t.pts,NaN))),Lt=(()=>{const t=a==="gross"?Ht.map(p=>U(p.gross,NaN)-U(p.parTotal,NaN)):Ht.map(p=>U(p.pts,NaN)),i=ur(t.filter(Number.isFinite));return Number.isFinite(i)?a==="gross"?-i:i:NaN})(),pa=a==="gross"?U((Yt=ut==null?void 0:ut.metrics)==null?void 0:Yt.volGross,NaN):U((ls=ut==null?void 0:ut.metrics)==null?void 0:ls.volPts,NaN);a==="gross"?U((Zt=ut==null?void 0:ut.metrics)==null?void 0:Zt.grossVelocity,NaN):U((Ns=ut==null?void 0:ut.metrics)==null?void 0:Ns.velocity,NaN);const Mt=(()=>{const i=(Array.isArray(s==null?void 0:s.players)?s.players:[]).map(p=>{const y=Array.isArray(p==null?void 0:p.series)?p.series.slice():[];if(!y.length)return NaN;y.sort((k,v)=>{const ee=Number.isFinite(k==null?void 0:k.dateMs)&&Number(k.dateMs)>0?Number(k.dateMs):Number((k==null?void 0:k.idx)||0),F=Number.isFinite(v==null?void 0:v.dateMs)&&Number(v.dateMs)>0?Number(v.dateMs):Number((v==null?void 0:v.idx)||0);return ee-F});const _=a==="gross"?y.map(k=>U(k.gross,NaN)-U(k.parTotal,NaN)):y.map(k=>U(k.pts,NaN));return ce(_.filter(Number.isFinite))}).filter(Number.isFinite);return i.length?i.reduce((p,y)=>p+y,0)/i.length:NaN})();(()=>{const i=(Array.isArray(s==null?void 0:s.players)?s.players:[]).map(p=>{const y=Array.isArray(p==null?void 0:p.series)?p.series.slice():[];if(!y.length)return NaN;y.sort((v,ee)=>{const F=Number.isFinite(v==null?void 0:v.dateMs)&&Number(v.dateMs)>0?Number(v.dateMs):Number((v==null?void 0:v.idx)||0),oe=Number.isFinite(ee==null?void 0:ee.dateMs)&&Number(ee.dateMs)>0?Number(ee.dateMs):Number((ee==null?void 0:ee.idx)||0);return F-oe});const _=a==="gross"?y.map(v=>U(v.gross,NaN)-U(v.parTotal,NaN)):y.map(v=>U(v.pts,NaN)),k=ur(_.filter(Number.isFinite));return Number.isFinite(k)?a==="gross"?-k:k:NaN}).filter(Number.isFinite);return i.length?i.reduce((p,y)=>p+y,0)/i.length:NaN})();const st=Number.isFinite(pa)?pa:Mt,Be=ue.useMemo(()=>{const t=Gt(w),p=String(n||"").toLowerCase()==="all"?0:Number(n);return p&&p>0?t.slice(-p):t},[w,n]),Pt=ue.useMemo(()=>{try{return Za({scoringMode:a,windowSeries:Be})}catch{return{birdiePlusRate:NaN,parRate:NaN,bogeyRate:NaN,badRate:NaN}}},[a,Be]),h=ue.useMemo(()=>{const t=(ft||[]).flatMap(y=>Array.isArray(y==null?void 0:y.series)?y.series:[]).filter(Boolean);t.sort((y,_)=>(Number(y==null?void 0:y.dateMs)||Number(y==null?void 0:y.idx)||0)-(Number(_==null?void 0:_.dateMs)||Number(_==null?void 0:_.idx)||0));const p=String(n||"").toLowerCase()==="all"?0:Number(n);return p&&p>0?t.slice(-p):t},[ft,n]),P=ue.useMemo(()=>{try{return Za({scoringMode:a,windowSeries:h})}catch{return{birdiePlusRate:NaN,parRate:NaN,bogeyRate:NaN,badRate:NaN}}},[a,h]),z=ue.useMemo(()=>{const t=a==="gross",i=t?(w==null?void 0:w.bySIGross)||{}:(w==null?void 0:w.bySI)||{},p=t?(re==null?void 0:re.bySIGross)||{}:(re==null?void 0:re.bySI)||{},y=t?(w==null?void 0:w.byParGross)||{}:(w==null?void 0:w.byPar)||{},_=t?(re==null?void 0:re.byParGross)||{}:(re==null?void 0:re.byPar)||{},k=We=>We?t?-St(We):ie(We):NaN,v=(We,yt)=>{for(const ys of yt)if(We&&Object.prototype.hasOwnProperty.call(We,ys))return ys;return yt[0]},ee=v(i,["1‚Äì6","1-6","1‚Äì6 ","SI 1‚Äì6","SI 1-6"]),F=v(i,["13‚Äì18","13-18","13‚Äì18 ","SI 13‚Äì18","SI 13-18"]),oe=k(i==null?void 0:i[ee]),$=k(i==null?void 0:i[F]),K=k(p==null?void 0:p[ee]),Ae=k(p==null?void 0:p[F]),se=k(y==null?void 0:y[v(y,["Par 3","P3","par3","3"])]);k(y==null?void 0:y[v(y,["Par 4","P4","par4","4"])]);const ct=k(y==null?void 0:y[v(y,["Par 5","P5","par5","5"])]),Ie=k(_==null?void 0:_[v(_,["Par 3","P3","par3","3"])]);k(_==null?void 0:_[v(_,["Par 4","P4","par4","4"])]);const Ce=k(_==null?void 0:_[v(_,["Par 5","P5","par5","5"])]),Ye=t?.08:.12,Y=Number.isFinite(oe)&&Number.isFinite(K)?oe-K:NaN,Ze=Number.isFinite($)&&Number.isFinite(Ae)?$-Ae:NaN,Ut=Number.isFinite(se)&&Number.isFinite(Ie)?se-Ie:NaN,Tt=Number.isFinite(ct)&&Number.isFinite(Ce)?ct-Ce:NaN,It=We=>Number.isFinite(We)?Math.max(0,Math.min(3,Math.abs(We)/Ye)):0,Wt=[];if(Number.isFinite(Ze)&&Ze<-Ye){const We=Number.isFinite(Y)?Math.max(0,(Y-Ze)/Ye):0;Wt.push({key:"waster",name:"The Waster",icon:"üß©",why:"Easy holes (SI 13‚Äì18) are costing you more than the field. That usually means giving away points with short-game mistakes or poor ‚Äòsafe-miss‚Äô decisions.",tip:"Default to centre-green targets on SI 13‚Äì18 and protect par first. Birdies come from boring golf.",s:It(Ze)+.5*We})}Number.isFinite(Y)&&Number.isFinite(Ze)&&Y>Ye&&Ze<-Ye&&Wt.push({key:"survivor",name:"The Survivor",icon:"üõ°Ô∏è",why:"You hang in there on the toughest holes, but you leak points on the ‚Äòscoring‚Äô holes.",tip:"Treat easy holes as ‚Äòno big number‚Äô holes: aim fat, avoid short-side, two-putt and move on.",s:It(Y)+It(Ze)}),Number.isFinite(Ut)&&Ut<-Ye&&Wt.push({key:"p3",name:"The Par 3 Victim",icon:"üéØ",why:"You lose more than the field on par 3s ‚Äî usually start-line / club selection / commitment.",tip:"On par 3s: pick a bigger target (middle), choose the longer club if between, and commit to one start line.",s:It(Ut)}),Number.isFinite(Tt)&&Tt<-Ye&&Wt.push({key:"p5",name:"The Par 5 hacker",icon:"üöÄ",why:"Par 5s should be your scoring holes, but they‚Äôre costing you more than the field ‚Äî often from hero shots or poor wedge numbers.",tip:"Make par 5s a 3-shot plan: safe tee ball ‚Üí lay up to a favourite wedge ‚Üí fat green.",s:It(Tt)});const Nt=Number.isFinite(Pt==null?void 0:Pt.birdiePlusRate)?Pt.birdiePlusRate:NaN,pt=Number.isFinite(P==null?void 0:P.birdiePlusRate)?P.birdiePlusRate:NaN,is=Number.isFinite(cs)?cs:NaN,Fs=Number.isFinite(st)?st:NaN;if(Number.isFinite(is)&&Number.isFinite(Fs)&&is<=Fs*.8){const We=Number.isFinite(Nt)&&Number.isFinite(pt)?Nt-pt:NaN;Wt.push({key:"steady",name:"The Steady Bogey Player",icon:"üß±",why:"Your scoring is consistent (low volatility). That‚Äôs a strength ‚Äî but you may not be creating enough birdie chances to move the needle.",tip:"Keep the safety, add upside: pick 1‚Äì2 holes per round to be aggressive (only when the miss is safe).",s:.8+(Number.isFinite(We)&&We<0?It(We):0)})}return Wt.length?(Wt.sort((We,yt)=>(yt.s||0)-(We.s||0)),Wt[0]):{name:"No clear archetype yet",icon:"üß≠",why:"Not enough data to confidently label a pattern. Get a few more rounds in and this will sharpen up.",tip:"For now: reduce doubles on SI 1‚Äì6 and protect par on SI 13‚Äì18."}},[a,w,re,cs,st,Pt,P]),Q=t=>{const i=t&&(t.yardsPerHole||t.ydsPerHole||t.yardsArr||t.yards||t.holeYards||t.yardages||t.yardage)||null;return Array.isArray(i)?i.map(p=>rs(p,NaN)):null},ne=t=>{const i=t&&(t.grossPerHole||t.grossHoles||t.holeGross||t.scoresPerHole||t.scores||t.grossArr)||null;return Array.isArray(i)?i.map(p=>rs(p,NaN)):null},le=t=>{const i=t&&(t.perHole||t.perHolePts||t.pointsPerHole||t.ptsPerHole||t.stablefordPerHole||t.stablefordHoles)||null;return Array.isArray(i)?i.map(p=>rs(p,NaN)):null},Ee=(t,i)=>{const p=ia(t),y=Array.isArray(p==null?void 0:p.pArr)?p.pArr:null,_=Array.isArray(p==null?void 0:p.sArr)?p.sArr:null;if(a==="gross"){const ee=ne(t);if(!ee||!y||!_)return NaN;const F=rs(ee[i],NaN),oe=rs(y[i],NaN),$=rs(_[i],NaN);if(!Number.isFinite(F)||!Number.isFinite(oe)||!Number.isFinite($))return NaN;const K=Math.round(rs((t==null?void 0:t.hcap)??(t==null?void 0:t.playingHcap)??(t==null?void 0:t.startExact)??(t==null?void 0:t.handicap)??(w==null?void 0:w.playingHcap)??(w==null?void 0:w.startExact)??(w==null?void 0:w.handicap)??NaN,NaN)),Ae=fa(K,$),se=oe+Ae;return F-se}const k=le(t);if(!k)return NaN;const v=rs(k[i],NaN);return Number.isFinite(v)?v-2:NaN},be=t=>Number.isFinite(t)?Math.abs(t)<.05?"0.0":(t>0?"+":"")+qe(t,1):"‚Äî",Ne=ue.useMemo(()=>{const t=Array.isArray(Be)?Be:[];if(!t.length)return{status:"none",title:"NOTHING OBVIOUS TO FIX",headline:"No real weaknesses identified.",gain:NaN,unit:a==="gross"?"strokes/round":"pts/round",detail:"Add a few more rounds and this will get sharper."};const i=a==="gross",p=i?"strokes/round":"pts/round",y={easy:{key:"easy",label:"Stop leaking on easy holes (SI 13‚Äì18)",sumLeak:0,holes:0,rounds:0},hard:{key:"hard",label:"Reduce big numbers on hard holes (SI 1‚Äì6)",sumLeak:0,holes:0,rounds:0},p3:{key:"p3",label:"Par 3s are costing you",sumLeak:0,holes:0,rounds:0},p5:{key:"p5",label:"You‚Äôre not scoring on par 5s",sumLeak:0,holes:0,rounds:0},longP4:{key:"longP4",label:"Long par 4s (411y+) hurt you",sumLeak:0,holes:0,rounds:0}},_=(Ie,Ce)=>{if(!Number.isFinite(Ce))return;const Ye=i?Ce:-Ce;Ie.sumLeak+=Ye,Ie.holes+=1};t.forEach(Ie=>{const Ce=ia(Ie),Ye=Array.isArray(Ce==null?void 0:Ce.pArr)?Ce.pArr:[],Y=Array.isArray(Ce==null?void 0:Ce.sArr)?Ce.sArr:[],Ze=Q(Ie)||[],Ut=Math.max(Ye.length,Y.length,Ze.length,18);let Tt={easy:!1,hard:!1,p3:!1,p5:!1,longP4:!1};for(let It=0;It<Ut;It++){const Wt=rs(Ye[It],NaN),Nt=rs(Y[It],NaN),pt=rs(Ze[It],NaN),is=Ee(Ie,It);Number.isFinite(is)&&(Number.isFinite(Nt)&&Nt>=13&&Nt<=18&&(_(y.easy,is),Tt.easy=!0),Number.isFinite(Nt)&&Nt>=1&&Nt<=6&&(_(y.hard,is),Tt.hard=!0),Number.isFinite(Wt)&&Wt===3&&(_(y.p3,is),Tt.p3=!0),Number.isFinite(Wt)&&Wt===5&&(_(y.p5,is),Tt.p5=!0),Number.isFinite(Wt)&&Wt===4&&Number.isFinite(pt)&&pt>=411&&(_(y.longP4,is),Tt.longP4=!0))}Object.keys(Tt).forEach(It=>{Tt[It]&&(y[It].rounds+=1)})});const k=Ie=>{if(!Ie||!Ie.holes)return{gain:NaN,avgLeakPH:NaN,holesPerRound:NaN};const Ce=Ie.sumLeak/Ie.holes,Ye=Ie.rounds?Ie.holes/Ie.rounds:NaN;return{gain:Number.isFinite(Ye)?Ce*Ye:NaN,avgLeakPH:Ce,holesPerRound:Ye}},v=Object.values(y).map(Ie=>{const Ce=k(Ie);return{...Ie,...Ce}}),ee=18,F=i?.7:1.4,oe=v.filter(Ie=>Number.isFinite(Ie.gain)&&Ie.holes>=ee&&Ie.gain>=F).sort((Ie,Ce)=>(Ce.gain||0)-(Ie.gain||0));if(!oe.length)return{status:"none",title:"NOTHING OBVIOUS TO FIX",headline:"No real weaknesses identified.",gain:NaN,unit:p,detail:"You‚Äôre pretty balanced in this window. Biggest gains come from general consistency (fewer doubles)."};const $=oe[0],Ae=(Ie=>{if(!Number.isFinite(Ie))return NaN;const Ce=Math.max(.5,Math.min(3.5,Ie));return Math.round(Ce*2)/2})($.gain),se={easy:"These are advantage holes. Play boring golf: fat target, avoid short-side, bank par first.",hard:"Cut doubles. Choose safer lines and accept bogey‚Äîprotect against the big number.",p3:"Centre-green targets and committed swings. If between clubs, take the longer one.",p5:"Make it a 3-shot plan: safe tee ball ‚Üí lay up to a favourite wedge ‚Üí fat green.",longP4:"Prioritise position over power. Take trouble out of play and keep the next shot simple."};return{status:"fix",title:"FIX THIS",headline:`${$.label} ‚Üí gain ~${Number.isFinite(Ae)?Ae.toFixed(1):"‚Äî"} ${p}`,gain:Ae,unit:p,detail:se[$.key]||"Focus here for the quickest gains.",key:$.key,sample:{holes:$.holes,rounds:$.rounds}}},[a,Be,w]),_e=ue.useMemo(()=>{const t=Array.isArray(Be)?Be:[],i={all:[{k:"short",label:"Short",sum:0,n:0},{k:"mid",label:"Mid",sum:0,n:0},{k:"long",label:"Long",sum:0,n:0}],p3:[{k:"short",label:"<150y",sum:0,n:0},{k:"mid",label:"150‚Äì175y",sum:0,n:0},{k:"long",label:"176y+",sum:0,n:0}],p4:[{k:"short",label:"<360y",sum:0,n:0},{k:"mid",label:"360‚Äì410y",sum:0,n:0},{k:"long",label:"411y+",sum:0,n:0}],p5:[{k:"short",label:"<500y",sum:0,n:0},{k:"mid",label:"500‚Äì540y",sum:0,n:0},{k:"long",label:"541y+",sum:0,n:0}]},p=(k,v)=>!Number.isFinite(v)||!Number.isFinite(k)?null:k===3?v<150?"short":v<=175?"mid":"long":k===4?v<360?"short":v<=410?"mid":"long":k===5?v<500?"short":v<=540?"mid":"long":v<170?"short":v<=400?"mid":"long";for(const k of t){const v=ia(k),ee=Array.isArray(v==null?void 0:v.pArr)?v.pArr:null,F=Q(k);if(!ee||!F)continue;const oe=Math.min(ee.length,F.length,18);for(let $=0;$<oe;$++){const K=rs(ee[$],NaN),Ae=rs(F[$],NaN),se=p(K,Ae);if(!se)continue;const ct=Ee(k,$);if(!Number.isFinite(ct))continue;const Ie=i.all.find(Y=>Y.k===se);Ie&&(Ie.sum+=ct,Ie.n+=1);const Ce=K===3?"p3":K===4?"p4":K===5?"p5":null;if(!Ce)continue;const Ye=i[Ce].find(Y=>Y.k===se);Ye&&(Ye.sum+=ct,Ye.n+=1)}}const y={};Object.keys(i).forEach(k=>{y[k]=i[k].map(v=>({...v,avg:v.n?v.sum/v.n:NaN}))});const _=(k,v)=>{const ee=(k||[]).filter(Ae=>Number.isFinite(Ae.avg)&&(Ae.n||0)>=6);if(!ee.length)return"Not enough hole data in this window yet.";const F=ee.slice().sort((Ae,se)=>a==="gross"?se.avg-Ae.avg:Ae.avg-se.avg)[0],oe=a==="gross"?.4:-.4;return(a==="gross"?F.avg>=oe:F.avg<=oe)?a==="gross"?`Compared to your own expectation, your biggest drop-off is ${v} in the ${F.label} bucket (${be(F.avg)} strokes per hole).`:`Compared to your own expectation, your biggest drop-off is ${v} in the ${F.label} bucket (${be(F.avg)} pts per hole).`:`No obvious yardage weakness vs your expectation (${v}).`};return y.headlines={all:_(y.all,"all pars"),p3:_(y.p3,"Par 3s"),p4:_(y.p4,"Par 4s"),p5:_(y.p5,"Par 5s")},y},[Be,a,w]);ue.useEffect(()=>{try{if(typeof window>"u")return;const t=window.__dslOverviewReport;if(!t)return;const i=y=>String(y??"").trim(),p=y=>{const _=i(y),k=_.match(/^(\d{4})-(\d{2})$/);if(k){const v=k[1],ee=String(Number(v.slice(0,2)+k[2]));return`${v}-${ee}`}return _};if(i(t.playerName)!==i(w==null?void 0:w.name)||p(t.yearLabel)!==p(m)||i(t.seasonLimit)!==i(n)||i(t.scoringMode)!==i(a))return;t.archetypePP=z,t.comfortZonePP=_e,t.fixThisPP=Ne,t.afterBadHolePP=xs,t.fastStartPP=Vs,t.clutchFinishPP=sa,t.golfDNAPP=rt,t.avgPts=kt,t.avgGross=Ot,t.overallPPH=Bt,t.stableRank=Rs,t.grossRank=Ss,t.percentile=Aa,t.trendLabel=wa,t.consistencyLabel=Ea,t.vol=cs,t.volField=st,t.overallGoodRd=es,t.wins=Se,t.leaks=we;try{window.dispatchEvent(new Event("dsl_overview_report_change"))}catch{}}catch{}},[w,m,n,a,z,_e,Ne,Rs,Ss,Aa,wa,Ea,cs,st,Vs,sa,xs,rt,es,Se,we,kt,Ot,Bt]);const rt=ue.useMemo(()=>{const t=Array.isArray(Be)?Be:[];if(!t.length)return{label:"‚Äî",why:"No rounds in this window.",holes:[],phase:null,holeAvg:[]};const i=[0,0,0],p=[0,0,0],y=Array.from({length:18}).map(()=>0),_=Array.from({length:18}).map(()=>0);for(const Ie of t){const Ce=ia(Ie),Ye=Array.isArray(Ce==null?void 0:Ce.pArr)?Ce.pArr:null,Y=le(Ie),Ze=ne(Ie),Ut=Math.min(18,Array.isArray(Ye)?Ye.length:18,Array.isArray(Y)?Y.length:18,Array.isArray(Ze)?Ze.length:18);for(let Tt=0;Tt<Ut;Tt++){const It=Ee(Ie,Tt);if(!Number.isFinite(It))continue;y[Tt]+=It,_[Tt]+=1;const Wt=Tt<6?0:Tt<12?1:2;i[Wt]+=It,p[Wt]+=1}}const k=i.map((Ie,Ce)=>p[Ce]?Ie/p[Ce]:NaN),v=y.map((Ie,Ce)=>_[Ce]?Ie/_[Ce]:NaN),ee=(()=>{const Ie=k.filter(Number.isFinite);return Ie.length<2?NaN:Math.max(...Ie)-Math.min(...Ie)})(),F=.35;let oe="Steady Engine",$="Your scoring pattern is fairly even across the round.";if(Number.isFinite(ee)&&ee>=F){const Ie=Ze=>a==="gross"?-Ze:Ze,Ce=k.map((Ze,Ut)=>({i:Ut,v:Ze,s:Ie(Ze)})).filter(Ze=>Number.isFinite(Ze.v));Ce.sort((Ze,Ut)=>Ut.s-Ze.s);const Ye=Ce[0],Y=Ce[Ce.length-1];Ye.i===0&&Y.i===2?(oe="Fast Starter",$="You tend to score best early, then drift later. A tighter routine on holes 13‚Äì18 usually pays off."):Ye.i===2&&Y.i===0?(oe="Slow Cooker",$="You often start slow and finish strong. A sharper warm-up and first-tee plan could unlock quick wins."):Y.i===1?(oe="Mid‚ÄëRound Wobble",$="Holes 7‚Äì12 are your soft spot. That‚Äôs often focus/tempo or one bad stretch compounding."):Y.i===2?(oe="Late Collapse",$="Your last 6 holes cost you most. Keep it boring late: big targets, avoid short-side, protect par."):(oe="Rollercoaster",$="Your best and worst phases are far apart. The goal is fewer big swings: commit to safer targets and one tempo.")}const K=v.map((Ie,Ce)=>({hole:Ce+1,v:Ie,n:_[Ce]||0})).filter(Ie=>Number.isFinite(Ie.v)&&Ie.n>=3),Ae=Ie=>a==="gross"?-Ie:Ie,se=K.slice().sort((Ie,Ce)=>Ae(Ce.v)-Ae(Ie.v)).slice(0,3),ct=K.slice().sort((Ie,Ce)=>Ae(Ie.v)-Ae(Ce.v)).slice(0,3);return{label:oe,why:$,phaseAvg:k,holeAvg:v,strengths:se,leaks:ct}},[Be,a,w]),[nt,et]=he.useState("all"),[Pe,it]=he.useState("phase"),Xe=t=>{const i=(t||[]).map(Number).filter(Number.isFinite);return i.length?i.reduce((p,y)=>p+y,0)/i.length:NaN},kt=Xe(Be.map(t=>U(t==null?void 0:t.pts,U(t==null?void 0:t.points,NaN)))),Ot=Xe(Be.map(t=>U(t==null?void 0:t.gross,NaN))),gs=Xe(Be.map(t=>U(t==null?void 0:t.frontPts,NaN))),Et=Xe(Be.map(t=>U(t==null?void 0:t.backPts,NaN))),Es=(()=>{let t=gs,i=Et;if(!Number.isFinite(t)||!Number.isFinite(i)){const p=[],y=[];for(const _ of Be){const k=Array.isArray(_==null?void 0:_.perHole)?_.perHole:null;if(!k)continue;const v=k.slice(0,9).reduce((F,oe)=>F+U(oe,0),0),ee=k.slice(9,18).reduce((F,oe)=>F+U(oe,0),0);Number.isFinite(v)&&p.push(v),Number.isFinite(ee)&&y.push(ee)}t=Xe(p),i=Xe(y)}return!Number.isFinite(t)||!Number.isFinite(i)?"No clear front/back split.":Math.abs(t-i)<.5?"Front and back 9 are basically even.":t>i?"You score stronger on the front 9.":"You score stronger on the back 9."})(),Bt=(()=>{let t=0,i=0;for(const p of Be||[]){const y=Array.isArray(p==null?void 0:p.perHole)?p.perHole:null;if(y)for(const _ of y){const k=U(_,NaN);Number.isFinite(k)&&(t+=k,i+=1)}}return{pph:i?t/i:NaN,n:i}})().pph,ws=(t,i)=>{const p=[];for(const y of Be||[]){const _=Array.isArray(y==null?void 0:y.perHole)?y.perHole:null;if(!_||_.length<i)continue;let k=0,v=!1;for(let ee=t;ee<i;ee++){const F=U(_[ee],NaN);Number.isFinite(F)&&(k+=F,v=!0)}v&&p.push(k)}return p.length?p.reduce((y,_)=>y+_,0)/p.length:NaN},zs=(t,i)=>{let p=0;for(const y of Be||[]){const _=Array.isArray(y==null?void 0:y.perHole)?y.perHole:null;if(!_||_.length<i)continue;let k=!1;for(let v=t;v<i;v++){const ee=U(_[v],NaN);if(Number.isFinite(ee)){k=!0;break}}k&&(p+=1)}return p*(i-t)},ma=ws(0,3),Is=ws(15,18),ta=zs(0,3),ja=zs(15,18),Vs=(()=>{if(!Number.isFinite(ma)||!Number.isFinite(Bt))return null;const t=ma/3,i=t-Bt;return{pph:t,delta:i,is:i>=.15}})(),sa=(()=>{if(!Number.isFinite(Is)||!Number.isFinite(Bt))return null;const t=Is/3,i=t-Bt;return{pph:t,delta:i,is:i>=.15}})(),xs=(()=>{try{const t=Array.isArray(Be)?Be:[];if(!t.length)return null;const i=[],p=[],y=[],_=[];let k=0;for(const Ye of t){const Y=Array.isArray(Ye==null?void 0:Ye.perHole)?Ye.perHole.slice(0,18):null,Ze=Array.isArray(Ye==null?void 0:Ye.grossPerHole)?Ye.grossPerHole.slice(0,18):null,Ut=Array.isArray(Ye==null?void 0:Ye.parsArr)?Ye.parsArr.slice(0,18):Array.isArray(Ye==null?void 0:Ye.parsPerHole)?Ye.parsPerHole.slice(0,18):null,Tt=Array.isArray(Ye==null?void 0:Ye.siArr)?Ye.siArr.slice(0,18):Array.isArray(Ye==null?void 0:Ye.siPerHole)?Ye.siPerHole.slice(0,18):null,It=U(Ye==null?void 0:Ye.hcap,NaN);if(!Y||!Ze||!Ut||!Tt)continue;const Wt=Nt=>{if(!Number.isFinite(It)||!Number.isFinite(Nt))return 0;const pt=Math.floor(It/18),is=It%18;return pt+(is>=Nt?1:0)};for(let Nt=0;Nt<18;Nt++){const pt=rs(Y[Nt],NaN),is=rs(Ze[Nt],NaN),Fs=rs(Ut[Nt],NaN),Bs=rs(Tt[Nt],NaN);if((Number.isFinite(pt)||Number.isFinite(is))&&(Number.isFinite(pt)&&i.push(pt),Number.isFinite(is)&&Number.isFinite(Fs))){const yt=Fs+Wt(Bs);p.push(is-yt)}}for(let Nt=0;Nt<17;Nt++){const pt=rs(Ze[Nt],NaN),is=rs(Ut[Nt],NaN),Fs=rs(Tt[Nt],NaN);if(!Number.isFinite(pt)||!Number.isFinite(is))continue;const Bs=is+Wt(Fs);if(!(pt-Bs>=2))continue;const yt=rs(Y[Nt+1],NaN),ys=rs(Ze[Nt+1],NaN),ze=rs(Ut[Nt+1],NaN),Ke=rs(Tt[Nt+1],NaN);if((Number.isFinite(yt)||Number.isFinite(ys))&&(k+=1,Number.isFinite(yt)&&y.push(yt),Number.isFinite(ys)&&Number.isFinite(ze))){const Gs=ze+Wt(Ke);_.push(ys-Gs)}}}const v=i.length?Xe(i):NaN,ee=p.length?Xe(p):NaN,F=y.length,oe=_.length,$=Math.max(F,oe,k);if(!$||$<4)return null;const K=F?Xe(y):NaN,Ae=oe?Xe(_):NaN,se=Number.isFinite(K)&&Number.isFinite(v)?K-v:NaN,ct=Number.isFinite(Ae)&&Number.isFinite(ee)?Ae-ee:NaN,Ie=Number.isFinite(se)?se>=.15?"Ice cold":se>=.05?"Resilient":se<=-.15?"Spiraler":se<=-.05?"Wobbly":"Neutral":Number.isFinite(ct)?ct<=-.25?"Ice cold":ct<=-.08?"Resilient":ct>=.25?"Spiraler":ct>=.08?"Wobbly":"Neutral":"Neutral",Ce=(()=>{const Ye=Number.isFinite(se),Y=Number.isFinite(ct),Ze=Ye?se:Y?-ct:NaN;return Number.isFinite(Ze)?Math.abs(Ze)<.05?"You‚Äôre steady after mistakes.":Ze>=.25?"You often bounce back immediately ‚Äî that‚Äôs a real scoring strength.":Ze>=.1?"You generally recover well after mistakes.":Ze<=-.25?"Mistakes tend to snowball ‚Äî a reset routine would save shots.":Ze<=-.1?"A small dip after mistakes ‚Äî quick reset helps.":"You‚Äôre mostly steady after mistakes.":"Not enough data."})();return{triggers:k,nPts:F,nStr:oe,resiliencePts:se,resilienceStr:ct,label:Ie,summary:Ce}}catch{return null}})(),bs=ue.useMemo(()=>{try{const t=Fe!=null&&Fe.courseName?String(Fe.courseName):"",i=Fe!=null&&Fe.teeName?String(Fe.teeName):"";if(!t)return{ok:!1,reason:"no_course"};const p=Y=>(Y==null?void 0:Y.courseName)??(Y==null?void 0:Y.course)??(Y==null?void 0:Y.course_name)??(Y==null?void 0:Y.courseLabel)??(Y==null?void 0:Y.course_label)??"",y=Y=>(Y==null?void 0:Y.teeName)??(Y==null?void 0:Y.tee)??(Y==null?void 0:Y.tee_label)??(Y==null?void 0:Y.teeLabel)??(Y==null?void 0:Y.tee_color)??"",_=Y=>pe((Y==null?void 0:Y.points)??(Y==null?void 0:Y.stableford)??(Y==null?void 0:Y.stablefordTotal)??(Y==null?void 0:Y.totalPoints)??(Y==null?void 0:Y.pts),NaN),k=Y=>pe((Y==null?void 0:Y.startExact)??(Y==null?void 0:Y.start_exact)??(Y==null?void 0:Y.handicapIndex)??(Y==null?void 0:Y.handicap_index)??(Y==null?void 0:Y.hi)??(Y==null?void 0:Y.HI)??(Y==null?void 0:Y.index)??(Y==null?void 0:Y.INDEX),NaN),v=[];for(const Y of ft||[]){if(!fe(Y))continue;const Ze=Array.isArray(Y.series)?Y.series:[];if(!Ze.length)continue;const Ut=Ze.filter(Fs=>{const Bs=ot(p(Fs)),We=ot(y(Fs));return!Bs||!(Bs===ot(t))?!1:i?We===ot(i):!0});if(!Ut.length)continue;const Tt=at(Ut.map(_));if(!Number.isFinite(Tt))continue;const It=Ze.filter(Fs=>{const Bs=ot(p(Fs));return Bs?Bs===ot(t)?i?ot(y(Fs))!==ot(i):!1:!0:!1}),Wt=It.length>=3?It:Ze,Nt=at(Wt.map(_));if(!Number.isFinite(Nt))continue;const pt=Tt-Nt,is=gt(Ut.map(k));Number.isFinite(is)&&v.push({name:Y.name,hi:is,delta:pt,n:Ut.length})}if(!v.length)return{ok:!1,reason:"no_data",targetCourse:t,targetTee:i};const ee={low:v.filter(Y=>Y.hi<=7),mid:v.filter(Y=>Y.hi>=8&&Y.hi<=15),high:v.filter(Y=>Y.hi>=16)},F=Y=>({players:Y.length,rounds:Y.reduce((Ze,Ut)=>Ze+(Number(Ut.n)||0),0),avgDelta:at(Y.map(Ze=>Ze.delta))}),oe={low:F(ee.low),mid:F(ee.mid),high:F(ee.high)},$=Object.entries(oe).filter(([,Y])=>Number.isFinite(Y.avgDelta)).sort((Y,Ze)=>Ze[1].avgDelta-Y[1].avgDelta);if(!$.length)return{ok:!1,reason:"no_valid",targetCourse:t,targetTee:i};const K=$[0],Ae=$[$.length-1],se=Number(K[1].avgDelta)-Number(Ae[1].avgDelta);let ct="neutral";Number(K[1].avgDelta)>=.75&&se>=.75&&(ct=K[0]);const Ie=v.length,Ce=v.reduce((Y,Ze)=>Y+(Number(Ze.n)||0),0),Ye=Ie>=8&&Ce>=20?"high":Ie>=5&&Ce>=10?"medium":"low";return{ok:!0,targetCourse:t,targetTee:i,favours:ct,confidence:Ye,stats:oe,totalPlayers:Ie,totalRounds:Ce}}catch{return{ok:!1,reason:"error"}}},[ft,Fe==null?void 0:Fe.courseName,Fe==null?void 0:Fe.teeName]),wa=Number.isFinite(Lt)?Lt>.05?"Getting better":Lt<-.05?"Getting worse":"Flat":"Not enough data",Ea=!Number.isFinite(cs)||!Number.isFinite(st)?"Not enough data":cs<st?"More consistent":"Less consistent",aa=(t,i=1,p=!1)=>{const y=Number(t);if(!Number.isFinite(y))return"‚Äî";let _=p?-y:y;return Math.abs(_)<1e-6&&(_=0),(_>0?"+":"")+Os(_,i)},La=t=>{const i=(Array.isArray(ft)?ft:[]).filter(K=>K&&K.name&&K.name!==(w==null?void 0:w.name)&&!(typeof js=="function"&&js(K.name))),p=Be,y=Xe(t==="gross"?p.map(K=>U(K==null?void 0:K.gross,NaN)):p.map(K=>U(K==null?void 0:K.pts,U(K==null?void 0:K.points,NaN)))),_=i.map(K=>{const Ae=(()=>{const ct=Gt(K),Ce=String(n||"").toLowerCase()==="all"?0:Number(n);return Ce&&Ce>0?ct.slice(-Ce):ct})(),se=Xe(t==="gross"?Ae.map(ct=>U(ct==null?void 0:ct.gross,NaN)):Ae.map(ct=>U(ct==null?void 0:ct.pts,U(ct==null?void 0:ct.points,NaN))));return{name:K.name,v:se}}).filter(K=>Number.isFinite(K.v)),k=[{name:(w==null?void 0:w.name)||"You",v:y},..._].filter(K=>Number.isFinite(K.v)),v=(K,Ae)=>t==="gross"?K.v-Ae.v:Ae.v-K.v;k.sort(v);const ee=k.findIndex(K=>String(K.name)===String((w==null?void 0:w.name)||"You"))+1,F=k.length||0,oe=_.length?_.reduce((K,Ae)=>K+Ae.v,0)/_.length:NaN,$=Number.isFinite(y)&&Number.isFinite(oe)?y-oe:NaN;return{pos:ee||NaN,total:F,selfVal:y,fieldAvg:oe,delta:$}},Rs=ue.useMemo(()=>La("stableford"),[w,ft,n,m]),Ss=ue.useMemo(()=>La("gross"),[w,ft,n,m]),Ta=t=>ia(t),Ia=t=>{const i=Array.isArray(t==null?void 0:t.imputedGrossPerHole)?t.imputedGrossPerHole.map(Number):Array.isArray(t==null?void 0:t.grossPerHole)?t.grossPerHole.map(Number):null;if(!i||!i.length)return NaN;const{pArr:p,sArr:y}=Ta(t);if(!p||!y||p.length<9||y.length<9)return NaN;const _=Number((t==null?void 0:t.slope)||(t==null?void 0:t.slopeRating)||(t==null?void 0:t.courseSlope)||(t==null?void 0:t.teeSlope)||0),k=Number((t==null?void 0:t.rating)||(t==null?void 0:t.courseRating)||(t==null?void 0:t.teeRating)||0),v=Number.isFinite(Number(t==null?void 0:t.parTotal))?Number(t==null?void 0:t.parTotal):p.reduce(($,K)=>$+(Number(K)||0),0),ee=Number((t==null?void 0:t.startExact)??(t==null?void 0:t.index)??(t==null?void 0:t.handicapIndex)??(t==null?void 0:t.hi)??(w==null?void 0:w.startExact)??(w==null?void 0:w.hcap)??NaN);if(!Number.isFinite(_)||_<=0||!Number.isFinite(k)||!Number.isFinite(v)||v<=0||!Number.isFinite(ee))return NaN;const oe=nr(i,{pars:p,si:y},ee,_,k);return Number.isFinite(oe)?ir(oe,_,k,0):NaN},Ka=t=>{const i=Array.isArray(t)?t.slice():[];i.sort((y,_)=>(Number(y==null?void 0:y.dateMs)||Number(y==null?void 0:y.idx)||0)-(Number(_==null?void 0:_.dateMs)||Number(_==null?void 0:_.idx)||0));const p=i.map(Ia).filter(Number.isFinite);return p.length<3?NaN:Sr(p.slice(-20))},Sa=ue.useMemo(()=>Ka(Be),[Be]),Ba=Number.isFinite(Sa)?xa(Sa,0,36):Sa,us=ue.useMemo(()=>{const t=Be.slice().sort((i,p)=>(Number(i==null?void 0:i.dateMs)||Number(i==null?void 0:i.idx)||0)-(Number(p==null?void 0:p.dateMs)||Number(p==null?void 0:p.idx)||0));return t.length?t[t.length-1]:null},[Be]),Ga=ue.useMemo(()=>{if(typeof(us==null?void 0:us.isWinner)=="boolean")return us.isWinner;try{const t=(us==null?void 0:us.file)||null;if(!t)return!1;const i=[];for(const v of Array.isArray(ft)?ft:[]){if(!v||!v.name||typeof js=="function"&&js(v.name))continue;const F=Gt(v).find(K=>K&&K.file===t);if(!F)continue;const oe=U(F==null?void 0:F.pts,U(F==null?void 0:F.points,NaN)),$=Array.isArray(F==null?void 0:F.perHole)?F.perHole:[];Number.isFinite(oe)&&i.push({name:v.name,points:oe,perHole:$})}if(!i.length)return!1;i.sort((v,ee)=>ee.points-v.points||compareByCountback(v,ee));const p=i[0].points,y=i.filter(v=>v.points===p);let _=y.length?[y[0]]:[];for(let v=1;v<y.length;v++){const ee=compareByCountback(y[v],_[0]);ee>0?_=[y[v]]:ee===0&&_.push(y[v])}return new Set(_.map(v=>String(v.name||"").trim())).has(String((w==null?void 0:w.name)||"").trim())}catch{return!1}},[us,ft,w]),va=U(us==null?void 0:us.startExact,U(w==null?void 0:w.startExact,U(w==null?void 0:w.hcap,NaN))),ra=U(us==null?void 0:us.pts,U(us==null?void 0:us.points,NaN)),Qa=String((us==null?void 0:us.gender)||(w==null?void 0:w.gender)||"M"),qa=Number.isFinite(va)&&Number.isFinite(ra)?jr(va,Qa,ra,U(us==null?void 0:us.back9,0),Ga).nextExact:NaN,ka=U(w==null?void 0:w.hcap,U(w==null?void 0:w.startExact,U(w==null?void 0:w.handicapExact,U(w==null?void 0:w.handicapIndex,U(w==null?void 0:w.index,U(w==null?void 0:w.hi,U(va,NaN))))))),Da=x==="same"?Number.isFinite(ka)?ka:NaN:x==="den"?qa:x==="whs"?Ba:NaN,Fa=(t,i,p)=>{if(!Number.isFinite(t))return"text-neutral-500";const y=Number.isFinite(p)?p:.1;return Math.abs(t)<=y?"text-neutral-500":(i?t>0:t<0)?"text-emerald-700":"text-rose-700"};(()=>{const i=Ht.slice(-12).map(v=>a==="gross"?U(v.gross,NaN)-U(v.parTotal,NaN):U(v.pts,NaN)).filter(Number.isFinite);if(!i.length)return"";const p=Math.min(...i),_=Math.max(...i)-p||1;return i.map((v,ee)=>{const F=i.length===1?100:ee*(200/(i.length-1)),oe=34-(v-p)/_*28;return`${F.toFixed(1)},${oe.toFixed(1)}`}).join(" ")})();const Aa=ue.useMemo(()=>{const t=qt;if(!Number.isFinite(t))return NaN;const p=(J==="field"?ft:me.players).filter(_=>_&&_.name!==w.name).map(_=>{const k=hr(_==null?void 0:_.series),ee=Us.map(oe=>oe==null?void 0:oe.file).filter(Boolean).map(oe=>{const $=k.find(Ae=>(Ae==null?void 0:Ae.file)===oe),K=a==="gross"?U($==null?void 0:$.gross,NaN)-U($==null?void 0:$.parTotal,NaN):U($==null?void 0:$.pts,NaN);return Number.isFinite(K)?K:NaN}).filter(Number.isFinite),F=at(ee);return Number.isFinite(F)?F:null}).filter(_=>_!=null);return p.length?p.filter(_=>a==="gross"?t<=_:t>=_).length/p.length:NaN},[qt,J,ft,me.players,a]),ks=at(Ht.map(t=>U(t.hcap,NaN))),Pa=(t,i,p,y,_=8)=>{const k=[],v=(()=>{const F=Array.isArray(Ht)?Ht.length:Number(Ht);if(Number.isFinite(F)&&F>0)return F;const oe=Object.values(i||{}).reduce(($,K)=>$+U(K==null?void 0:K.holes,0),0);return oe>0?oe/18:0})();return Object.keys(i||{}).forEach(F=>{const oe=i==null?void 0:i[F],$=p==null?void 0:p[F],K=U(oe==null?void 0:oe.holes,0);if(!K)return;const Ae=y?St(oe):ie(oe),se=y?St($):ie($),ct=ke(y?"gross":"stableford",Ae,se),Ie=v>0?v:1,Ce=Ie>0?K/Ie:0,Ye=ct*Ce;k.push({key:F,label:`${t} ${F}`,holes:K,mePH:Ae,fldPH:se,dGood:ct,impactRd:Ye})}),k.sort((F,oe)=>Math.abs(oe.impactRd)-Math.abs(F.impactRd)),k},S=ve!=="pointsField",B=ve==="strokesPar"?"par":"field",H=t=>{const i={};return Object.keys(t||{}).forEach(p=>{var _;const y=U((_=t==null?void 0:t[p])==null?void 0:_.holes,0);y&&(i[p]={holes:y,val:0})}),i},R=S?(w==null?void 0:w.byParGross)||{}:(w==null?void 0:w.byPar)||{},q=B==="par"?H(R):S?(re==null?void 0:re.byParGross)||{}:(re==null?void 0:re.byPar)||{},L=Pa("Par",R,q,S,6),G=S?(w==null?void 0:w.bySIGross)||{}:(w==null?void 0:w.bySI)||{},je=B==="par"?H(G):S?(re==null?void 0:re.bySIGross)||{}:(re==null?void 0:re.bySI)||{},De=Pa("SI",G,je,S,6),dt=S?(w==null?void 0:w.byYardsGross)||{}:(w==null?void 0:w.byYards)||{},tt=B==="par"?H(dt):S?(re==null?void 0:re.byYardsGross)||{}:(re==null?void 0:re.byYards)||{},Ct=Pa("Yds",dt,tt,S,8),Re=[...L,...De,...Ct].filter(t=>Number.isFinite(t==null?void 0:t.impactRd)),we=Re.filter(t=>Number.isFinite(t==null?void 0:t.impactRd)&&t.impactRd<0).slice().sort((t,i)=>t.impactRd-i.impactRd).slice(0,3),Se=Re.filter(t=>Number.isFinite(t==null?void 0:t.impactRd)&&t.impactRd>0).slice().sort((t,i)=>i.impactRd-t.impactRd).slice(0,3),At=({row:t})=>{const i=Number(t==null?void 0:t.dGood),p=Number(t==null?void 0:t.impactRd),y=Number.isFinite(i)&&i>0,_=Number.isFinite(i)&&i<0,k=y?"text-emerald-700":_?"text-rose-700":"text-neutral-700",v=Math.max(-1,Math.min(1,Number.isFinite(p)?p/2.5:0)),ee=v>=0?50:50+v*50,F=Math.abs(v)*50,[oe,$]=ue.useState(!1);ue.useEffect(()=>{const se=setTimeout(()=>$(!0),20);return()=>clearTimeout(se)},[]);const K=oe?ee:50,Ae=oe?F:0;return e.jsx("div",{className:"flex items-center gap-3 py-1",children:e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("div",{className:"truncate font-extrabold text-neutral-900",children:t.label}),e.jsxs("div",{className:`text-xs font-black tabular-nums ${k}`,children:[Number.isFinite(p)?(p>=0?"+":"")+qe(p,2):"‚Äî",e.jsx("span",{className:"text-neutral-400 font-semibold",children:" /rd"})]})]}),e.jsxs("div",{className:"mt-1 text-[11px] text-neutral-500",children:[t.holes," holes ¬∑ ",ve==="pointsField"?`${qe(t.mePH,2)} vs ${qe(t.fldPH,2)} pts/hole`:ve==="strokesPar"?`${qe(t.mePH,2)} over/par (vs par)`:`${qe(t.mePH,2)} vs ${qe(t.fldPH,2)} over/par`]}),e.jsxs("div",{className:"mt-2 flex-1 relative h-8 bg-neutral-100 rounded-lg overflow-hidden shadow-inner border border-neutral-200/50",children:[e.jsx("div",{className:"absolute left-1/2 top-0 bottom-0 w-0.5 bg-neutral-300 z-10 opacity-50"}),e.jsx("div",{className:"bar-anim absolute top-0 bottom-0 transition-all duration-500 ease-out "+(y?"bg-gradient-to-r from-emerald-400 to-emerald-500":_?"bg-gradient-to-l from-rose-400 to-rose-500":"bg-neutral-300"),style:{left:`${K}%`,width:`${Ae}%`}})]})]})})},Ft=({rows:t,title:i="Impact Waterfall"})=>{const y=(Array.isArray(t)?t.filter(Y=>Number.isFinite(Number(Y==null?void 0:Y.impactRd))):[]).slice().sort((Y,Ze)=>Math.abs(Ze.impactRd)-Math.abs(Y.impactRd)).slice(0,8),_=[{label:"Baseline",v:0}];y.forEach(Y=>_.push({label:Y.label,v:Number(Y.impactRd)})),_.push({label:"Now",v:0});let k=0;const v=_.map((Y,Ze)=>{if(Ze===0)return{...Y,start:0,end:0,cum:0,kind:"base"};if(Ze===_.length-1)return{...Y,start:0,end:k,cum:k,kind:"end"};const Ut=k;return k+=Y.v,{...Y,start:Ut,end:k,cum:k,kind:"step"}}),ee=Math.max(1,...v.map(Y=>Math.max(Math.abs(Y.start),Math.abs(Y.end)))),F=720,oe=140,$=36,K=18,Ae=F-$*2,se=oe-K*2,ct=v.length,Ie=Ae/Math.max(1,ct-1),Ce=K+se/2,Ye=Y=>Ce-Y/ee*(se/2);return e.jsxs("div",{className:"rounded-2xl border border-neutral-200 bg-gradient-to-b from-white to-neutral-50 p-4","data-reveal":!0,children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-400",children:i}),e.jsxs("div",{className:"text-sm text-neutral-600 mt-1",children:["A quick visual of your biggest movers. Buckets overlap across lenses, so treat this as a ",e.jsx("span",{className:"font-semibold",children:"story of momentum"}),", not an exact add‚Äëup."]})]}),e.jsxs("span",{className:"chip border-neutral-200 bg-white text-neutral-700",children:["Top ",y.length," movers"]})]}),e.jsx("div",{className:"mt-3 overflow-x-auto",children:e.jsxs("svg",{viewBox:`0 0 ${F} ${oe}`,className:"w-full min-w-[680px]",children:[e.jsx("line",{x1:$,y1:Ce,x2:F-$,y2:Ce,stroke:"rgba(0,0,0,0.15)",strokeWidth:"1"}),v.map((Y,Ze)=>{const Ut=$+Ze*Ie,Tt=Ye(Y.start),It=Ye(Y.end),Wt=Y.end>=Y.start,Nt=Math.abs(It-Tt),pt=18,is=Wt?It:Tt,Fs=Y.kind==="base"||Y.kind==="end"?"rgba(59,130,246,0.35)":Y.v>=0?"rgba(16,185,129,0.55)":"rgba(244,63,94,0.55)";return e.jsxs("g",{children:[Ze>0&&e.jsx("line",{x1:$+(Ze-1)*Ie,y1:Ye(v[Ze-1].end),x2:Ut,y2:Tt,stroke:"rgba(0,0,0,0.25)",strokeWidth:"1.25"}),e.jsx("rect",{x:Ut-pt/2,y:is,width:pt,height:Math.max(2,Nt),rx:"4",fill:Fs}),e.jsx("circle",{cx:Ut,cy:It,r:"2.5",fill:"rgba(0,0,0,0.35)"}),e.jsx("text",{x:Ut,y:oe-6,textAnchor:"middle",fontSize:"10",fill:"rgba(0,0,0,0.65)",children:Y.label.length>12?Y.label.slice(0,11)+"...":Y.label})]},Ze)}),e.jsxs("text",{x:F-$,y:14,textAnchor:"end",fontSize:"11",fill:"rgba(0,0,0,0.55)",children:["Overall trend: ",v.length?(v[v.length-1].end>=0?"+":"")+qe(v[v.length-1].end,2)+" /rd":"‚Äî"]})]})})]})},Ue=t=>{const i=U(t==null?void 0:t.holes,0);return i>=80?{label:"High",cls:"border-emerald-200 bg-emerald-50 text-emerald-800"}:i>=40?{label:"Medium",cls:"border-amber-200 bg-amber-50 text-amber-900"}:{label:"Low",cls:"border-neutral-200 bg-neutral-50 text-neutral-700"}};if((Re||[]).slice().sort((t,i)=>Math.abs(i.impactRd)-Math.abs(t.impactRd)),(Re||[]).slice().sort((t,i)=>t.impactRd-i.impactRd)[0],E){const t=(D==null?void 0:D.done)||0,i=(D==null?void 0:D.total)||0,p=i?Math.round(t/i*100):0;return e.jsxs("section",{className:"glass-card pm-scope p-4 md:p-6",children:[e.jsx("div",{className:"pm-accent-rail","aria-hidden":"true"}),e.jsx("div",{className:"flex items-center justify-between gap-3",children:e.jsx(ga,{items:[{label:"How Well Am I Playing"}]})}),e.jsxs("div",{className:"mt-4 rounded-3xl border border-amber-200 bg-amber-50 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-black text-amber-900",children:"Loading Previous Games..."}),e.jsx("div",{className:"text-sm text-amber-900/80 mt-1",children:"We‚Äôre loading your previous games and building same-course / same-tee comparisons to spot patterns. This can take a moment ‚Äî especially the first time."})]}),e.jsxs("span",{className:"inline-flex items-center rounded-full bg-amber-100 px-3 py-1 text-xs font-bold text-amber-900 tabular-nums",children:[p,"%"]})]}),e.jsx("div",{className:"mt-3 h-2 w-full rounded-full bg-amber-100 overflow-hidden",children:e.jsx("div",{className:"h-full bg-amber-400",style:{width:`${p}%`}})}),e.jsxs("div",{className:"mt-2 text-xs text-amber-900/80 tabular-nums",children:["Progress: ",t,"/",i]})]})]})}if(C)return e.jsxs("section",{className:"glass-card p-4 md:p-6 hm-stage",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx(ga,{items:[{label:"Overview"}]}),e.jsx(Wa,{active:"progress",setView:X})]}),e.jsx("div",{className:"mt-4 rounded-2xl border border-rose-200 bg-rose-50 p-3 text-sm text-rose-800",children:C}),e.jsx("button",{className:"btn-primary mt-3",onClick:N,children:"Try again"})]});if(!s)return e.jsxs("section",{className:"glass-card p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx(ga,{items:[{label:"Overview"}]}),e.jsx(Wa,{active:"progress",setView:X})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border border-neutral-200 bg-white p-4",children:[e.jsx("div",{className:"font-black text-neutral-900",children:"Season analysis"}),e.jsx("div",{className:"text-sm text-neutral-600 mt-1",children:"Load all season CSVs and we‚Äôll build a proper player breakdown."}),e.jsx("button",{className:"btn-primary mt-3",onClick:N,children:"Run season analysis"})]})]});if(!ft.length){const t=m&&String(m).toLowerCase()!=="all"?String(m):"this selection";return e.jsxs("section",{className:"glass-card p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx(ga,{items:[{label:"Overview"}]}),e.jsx(Wa,{active:"progress",setView:X})]}),e.jsxs("div",{className:"mt-4 rounded-2xl border border-neutral-200 bg-white p-4",children:[e.jsx("div",{className:"font-black text-neutral-900",children:"No games yet"}),e.jsxs("div",{className:"text-sm text-neutral-600 mt-1",children:["There aren‚Äôt any games loaded for ",t,". Your League/Eclectic can still show standings (if you‚Äôve added events), but Performance analysis needs at least one round."]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>M&&M("All"),children:"Show all years"}),e.jsx("button",{className:"btn-secondary",onClick:()=>X("home"),children:"Back to Home"}),e.jsx("button",{className:"btn-primary",onClick:N,children:"Re-scan season files"})]})]})]})}return w?e.jsxs("section",{className:"glass-card p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx(ga,{items:[{label:"Overview"}]}),e.jsx(Wa,{active:"progress",setView:X})]}),e.jsx(rn,{seasonModel:s,seasonPlayer:c,setSeasonPlayer:o,seasonYear:m,setSeasonYear:M,seasonLimit:n,setSeasonLimit:l,seasonYears:f,scoringMode:a,setScoringMode:r}),e.jsxs("div",{className:"mt-4 hm-stage",children:[e.jsxs("div",{className:"glass-card p-4 md:p-6",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-3",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-400",children:"Performance Mirror"}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap sm:flex-nowrap w-full sm:w-auto justify-start sm:justify-end",children:["    ",e.jsx("button",{className:"btn-primary",onClick:()=>{try{const t=s,i=localStorage.getItem("dsl_lens")||"pointsField",p=window.__dslUiState&&window.__dslUiState.cohortMode?window.__dslUiState.cohortMode:null,y=p?p==="field"?"field":"band":window.__dslSeasonReportParams&&window.__dslSeasonReportParams.comparatorMode?window.__dslSeasonReportParams.comparatorMode:"band";window.__dslSeasonReportParams={model:s,playerName:c,yearLabel:m,seasonLimit:n,scoringMode:a,lensMode:i,comparatorMode:y};const _=Fr({model:s,playerName:c,yearLabel:m,seasonLimit:n,scoringMode:a,lensMode:i,comparatorMode:y});if(!_||!_.ok){alert((_==null?void 0:_.error)||"Could not generate report.");return}Ar(_.htmlFragment||_.html)}catch(t){console.error(t),alert("Could not generate report.")}},title:"Open the season report",children:"Generate Report"}),"    ",e.jsx("button",{className:"btn-secondary",onClick:()=>{try{const t=document.getElementById("pp-problem-holes-details");t&&(t.open=!0);const i=document.getElementById("pp-problem-holes");i&&i.scrollIntoView&&i.scrollIntoView({behavior:"smooth",block:"start"})}catch{}},title:"Jump to problem holes",children:"Problem Holes"}),"  "]})]}),e.jsxs("div",{className:"mt-1 break-words leading-tight",children:[e.jsx("span",{className:"text-4xl md:text-5xl font-black tracking-tight text-neutral-900",children:fs}),wt?e.jsx("span",{className:"ml-2 text-2xl md:text-3xl font-black tracking-tight text-neutral-800",children:wt}):null]}),e.jsxs("div",{className:"mt-1 text-sm text-neutral-600",children:["Comparator:"," ",e.jsx("span",{className:"font-extrabold text-neutral-900",children:J==="band"?"Handicap band":"Field"}),e.jsx("span",{className:"mx-2 text-neutral-300",children:"¬∑"}),"Mode:"," ",e.jsx("span",{className:"font-extrabold text-neutral-900",children:a==="gross"?"Gross":"Stableford"})]})]}),e.jsx("div",{id:"pp-problem-holes",className:"w-full",children:e.jsxs("details",{id:"pp-problem-holes-details",className:"rounded-3xl border border-neutral-200 bg-white p-5 shadow-sm",children:[e.jsx("summary",{className:"cursor-pointer select-none",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-400",children:"Problem holes"}),e.jsx("div",{className:"mt-1 text-lg md:text-xl font-black text-neutral-900",children:"Where you leak points on the same setup"}),e.jsx("div",{className:"mt-1 text-sm text-neutral-600",children:"Uses your most-played Course + Tee within the current window."})]}),e.jsx("div",{className:"text-xs font-black text-neutral-500 mt-1",children:"‚ñº"})]})}),e.jsx("div",{className:"mt-4",children:Fe&&Fe.ok?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-sm text-neutral-700",children:["Using: ",e.jsx("span",{className:"font-black text-neutral-900",children:Fe.courseName||"‚Äî"}),Fe.teeName?e.jsxs("span",{className:"text-neutral-600",children:[" ¬∑ ",Fe.teeName]}):null,e.jsxs("span",{className:"text-neutral-500",children:[" ¬∑ ",Fe.rounds||0," rounds"]})]}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:(Fe.flagged&&Fe.flagged.length?Fe.flagged:Fe.rows||[]).slice(0,6).map(t=>e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border px-3 py-1 text-xs font-black "+(Number(t.vsOverall)<=-.5?"border-rose-200 bg-rose-50 text-rose-700":"border-neutral-200 bg-neutral-50 text-neutral-700"),children:["Hole ",t.hole,": ",qe(t.avg,2)," pts"]},"phchip"+t.hole))}),e.jsx("div",{className:"mt-4 overflow-hidden rounded-2xl border border-neutral-200",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-neutral-50",children:e.jsxs("tr",{className:"text-left",children:[e.jsx("th",{className:"px-4 py-3 font-black text-neutral-600",children:"HOLE"}),e.jsx("th",{className:"px-4 py-3 font-black text-neutral-600",children:"AVG PTS"}),e.jsx("th",{className:"px-4 py-3 font-black text-neutral-600",children:"VS YOUR OVERALL"}),e.jsx("th",{className:"px-4 py-3 font-black text-neutral-600",children:"SAMPLES"})]})}),e.jsx("tbody",{children:(Fe.rows||[]).slice(0,10).map(t=>e.jsxs("tr",{className:"border-t border-neutral-200",children:[e.jsx("td",{className:"px-4 py-3 font-black text-neutral-900",children:t.hole}),e.jsx("td",{className:"px-4 py-3 text-neutral-900",children:qe(t.avg,2)}),e.jsx("td",{className:"px-4 py-3 font-black "+(Number(t.vsOverall)<=-.5?"text-rose-700":"text-neutral-700"),children:Number.isFinite(Number(t.vsOverall))?(t.vsOverall>=0?"+":"")+qe(t.vsOverall,2):"‚Äî"}),e.jsx("td",{className:"px-4 py-3 text-neutral-700",children:t.n||"‚Äî"})]},"phr"+t.hole))})]})})]}):e.jsx("div",{className:"text-sm text-neutral-700",children:"Not enough repeated rounds on the same Course + Tee in the current window to identify problem holes."})})]})}),e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"rounded-2xl border border-neutral-200 bg-neutral-50 p-3",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-black tracking-widest uppercase text-neutral-500 mb-1",children:"PLAYER"}),e.jsxs("div",{className:"select-wrap",children:[e.jsx("select",{className:"select-premium",value:c,onChange:t=>o(t.target.value),children:(ft||[]).map(t=>e.jsx("option",{value:t.name,children:t.name},t.name))}),e.jsx("svg",{className:"select-chevron",viewBox:"0 0 20 20",fill:"none","aria-hidden":"true",children:e.jsx("path",{d:"M6 8l4 4 4-4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-black tracking-widest uppercase text-neutral-500 mb-1",children:"YEAR"}),e.jsxs("div",{className:"select-wrap",children:[e.jsxs("select",{className:"select-premium",value:m,onChange:t=>M(t.target.value),children:[e.jsx("option",{value:"All",children:"All"}),["All"].concat(f||[]).map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx("svg",{className:"select-chevron",viewBox:"0 0 20 20",fill:"none","aria-hidden":"true",children:e.jsx("path",{d:"M6 8l4 4 4-4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-black tracking-widest uppercase text-neutral-500 mb-1",children:"MOST RECENT GAMES"}),e.jsxs("div",{className:"select-wrap",children:[e.jsxs("select",{className:"select-premium",value:n,onChange:t=>l(t.target.value),children:[e.jsx("option",{value:"All",children:"All"}),["1","5","10","15","20","30"].map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx("svg",{className:"select-chevron",viewBox:"0 0 20 20",fill:"none","aria-hidden":"true",children:e.jsx("path",{d:"M6 8l4 4 4-4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-black tracking-widest uppercase text-neutral-500 mb-1",children:"VIEW MODE"}),e.jsxs("div",{className:"select-wrap",children:[e.jsx("span",{className:"select-dot",style:j,"aria-hidden":"true"}),e.jsx("select",{className:"select-premium",style:{paddingLeft:"2.25rem"},value:b,onChange:t=>{const i=t.target.value,p=He.find(y=>y.key===i)||He[0];xt(p.pp),I(p.cohort)},"aria-label":"Leaderboard view mode",children:He.map(t=>e.jsx("option",{value:t.key,children:t.label},t.key))}),e.jsx("svg",{className:"select-chevron",viewBox:"0 0 20 20",fill:"none","aria-hidden":"true",children:e.jsx("path",{d:"M6 8l4 4 4-4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]}),e.jsx("div",{className:"text-xs text-neutral-500 mt-1",children:(Je==null?void 0:Je.hint)||""})]})]})})})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 xl:grid-cols-2 gap-3",children:[e.jsx("div",{className:"flex flex-wrap items-center gap-2"}),e.jsx("div",{className:"flex flex-wrap items-center gap-2 xl:justify-end",children:e.jsxs("div",{className:"mode-context-row",children:[e.jsx("div",{className:"mode-context-text",children:ve==="pointsField"&&J==="field"?e.jsxs(e.Fragment,{children:["Stableford points compared to the field average. ",e.jsx("b",{children:"Higher is better."})]}):ve==="pointsField"&&J==="band"?e.jsxs(e.Fragment,{children:["Stableford points compared to golfers in the same handicap band. ",e.jsx("b",{children:"Higher is better."})]}):ve==="strokesField"&&J==="field"?e.jsxs(e.Fragment,{children:["Gross score compared to the field average. ",e.jsx("b",{children:"Lower is better."})]}):ve==="strokesField"&&J==="band"?e.jsxs(e.Fragment,{children:["Gross score compared to golfers in the same handicap band. ",e.jsx("b",{children:"Lower is better."})]}):e.jsxs(e.Fragment,{children:["Gross score relative to par (absolute). ",e.jsx("b",{children:"Lower is better."})]})}),e.jsx("div",{className:"text-xs font-semibold text-neutral-400 px-2",children:ve==="strokesPar"?e.jsx(e.Fragment,{children:"Comparator: Par"}):e.jsxs(e.Fragment,{children:["Comparator: ",J==="band"?"Handicap band":"Field"]})})]})})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 lg:grid-cols-3 gap-4 pro-overview-grid pro-overview-stage",children:[e.jsxs("div",{className:"rounded-3xl border border-neutral-200 bg-white p-5 shadow-sm lg:col-span-1 report-handicap-preview",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-400",children:"Report handicap preview"}),e.jsx("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:e.jsxs("div",{className:"toggle-group",role:"tablist","aria-label":"Handicap preview mode",children:[e.jsx("button",{className:"toggle-btn "+(x==="den"?"active":""),onClick:()=>g("den"),role:"tab","aria-selected":x==="den",children:"Legacy"}),e.jsx("button",{className:"toggle-btn "+(x==="whs"?"active":""),onClick:()=>g("whs"),role:"tab","aria-selected":x==="whs",children:"WHS"}),e.jsx("button",{className:"toggle-btn "+(x==="same"?"active":""),onClick:()=>g("same"),role:"tab","aria-selected":x==="same",children:"No change"})]})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-3xl font-black text-neutral-900 tabular-nums",children:Number.isFinite(Da)?Os(Da,1):"‚Äî"}),e.jsxs("div",{className:"text-sm text-neutral-600 mt-1",children:["Calculated Hcap ",e.jsx("span",{className:"text-neutral-400",children:"vs"})," Card ",Number.isFinite(ka)?Os(ka,1):"‚Äî"]}),e.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:["Avg handicap ",e.jsx("span",{className:"font-semibold text-neutral-700",children:Number.isFinite(ks)?Os(ks,1):"‚Äî"})]}),e.jsxs("details",{className:"mt-3 rounded-2xl border border-neutral-200 bg-neutral-50/60 px-3 py-2",children:[e.jsxs("summary",{className:"no-marker flex cursor-pointer select-none items-center gap-2 text-xs font-semibold text-neutral-700","aria-label":"How to read this",title:"How to read this",children:[e.jsx("span",{"aria-hidden":"true",className:"text-base",children:"üí°"}),e.jsx("span",{className:"sr-only",children:"How to read this"})]}),e.jsxs("div",{className:"mt-2 text-xs text-neutral-500 space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-neutral-700",children:"What this is showing:"})," ","a preview of the handicap number this report would use"," ",e.jsx("span",{className:"font-semibold text-neutral-700",children:"if you updated it from the rounds you selected"}),". It's an explanation layer only ‚Äî all scoring and Insights maths stay exactly the same."]}),x==="den"&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-neutral-700",children:"League handicap"})," ","is a society system designed so more members have a fair shot at winning. This preview uses your ",e.jsx("span",{className:"font-semibold text-neutral-700",children:"latest selected round"})," ","and your ",e.jsx("span",{className:"font-semibold text-neutral-700",children:"Stableford points"}),": score ",e.jsx("span",{className:"font-semibold text-neutral-700",children:"35+ points"})," and your handicap tightens; score ",e.jsx("span",{className:"font-semibold text-neutral-700",children:"31 or fewer"})," and it loosens. The size of the change depends on your current handicap band, and winners get an extra small cut. The result is kept within sensible bounds (and capped for playing handicap: 28 for men, 36 for women)."]}),x==="whs"&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-neutral-700",children:"WHS handicap index"})," ","is the standard system based on ",e.jsx("span",{className:"font-semibold text-neutral-700",children:"score differentials"}),". In this file, each selected round is turned into a differential by: (1) taking your hole-by-hole gross scores, (2) applying the WHS per-hole cap (net double bogey) to get an adjusted gross score, then (3) converting that to a differential using"," ",e.jsx("span",{className:"font-semibold text-neutral-700",children:"(Adjusted Gross ‚àí Course Rating) √ó 113 √∑ Slope"})," ","(PCC assumed 0 here). Your next WHS index is then the average of the lowest differentials from your most recent up to 20 rounds (with the standard ‚Äúfewer than 20 scores‚Äù rules), rounded to 1 decimal. This needs slope/rating + pars/SI + hole scores to be present."]}),x==="same"&&e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-neutral-700",children:"No change"})," ","means: use the handicap already on the player record / card, with no recalculation from the selected rounds."]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-neutral-700",children:"Card"})," ","is the handicap number recorded for the round (the one used to compute your points on the day).",e.jsx("span",{className:"font-semibold text-neutral-700",children:" Avg handicap"})," ","is simply the average of the handicap values across the rounds you've selected."]})]})]})]})]}),e.jsx("div",{className:"rounded-3xl border border-neutral-200 bg-white p-5 shadow-sm lg:col-span-2",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"rounded-2xl border border-neutral-200 bg-neutral-50 p-4",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-500",children:"Rounds analysed"}),e.jsx("div",{className:"mt-2 text-2xl font-black text-neutral-900 tabular-nums",children:Cs||0}),e.jsx("div",{className:"mt-2 text-sm text-neutral-600",children:"Avg Points / Avg Strokes"}),e.jsxs("div",{className:"text-lg font-extrabold text-neutral-900 tabular-nums",children:[Number.isFinite(kt)?`${Os(kt,1)} pts`:"‚Äî"," ",e.jsx("span",{className:"text-neutral-300",children:"/"})," ",Number.isFinite(Ot)?`${Os(Ot,1)} str`:"‚Äî"]})]}),e.jsxs("div",{className:"rounded-2xl border border-neutral-200 bg-neutral-50 p-4",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-500",children:"Performance & Rank"}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-sm text-neutral-600",children:"Stableford Rank"}),e.jsxs("div",{className:"text-lg font-extrabold text-neutral-900 tabular-nums",children:[Number.isFinite(Rs==null?void 0:Rs.pos)&&(Rs!=null&&Rs.total)?`${Rs.pos} of ${Rs.total}`:"‚Äî",e.jsxs("span",{className:"ml-2 "+Fa(Rs==null?void 0:Rs.delta,!0,.2),children:["(",aa(Rs==null?void 0:Rs.delta,1)," pts vs field)"]})]}),e.jsxs("div",{className:"text-xs text-neutral-500 mt-1",children:["Percentile (",String(n||"").toLowerCase()==="all"?"all selected rounds":`last ${n} rounds`," avg): ",Number.isFinite(Aa)?Dt(Aa,0):"‚Äî"]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-sm text-neutral-600",children:"Gross Rank"}),e.jsxs("div",{className:"text-lg font-extrabold text-neutral-900 tabular-nums",children:[Number.isFinite(Ss==null?void 0:Ss.pos)&&(Ss!=null&&Ss.total)?`${Ss.pos} of ${Ss.total}`:"‚Äî",e.jsxs("span",{className:"ml-2 "+Fa(Ss==null?void 0:Ss.delta,!1,.5),children:["(",aa(Ss==null?void 0:Ss.delta,1,!0)," str vs field)"]})]})]})]}),e.jsxs("div",{className:"rounded-2xl border border-neutral-200 bg-neutral-50 p-4",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-500",children:"What‚Äôs happening"}),e.jsx("div",{className:"mt-2 text-sm text-neutral-600",children:"Improving or worse?"}),e.jsx("div",{className:"text-lg font-extrabold "+(wa==="Getting better"?"text-emerald-700":wa==="Getting worse"?"text-rose-700":"text-neutral-900"),children:wa}),e.jsx("div",{className:"mt-3 text-sm text-neutral-600",children:"Consistency"}),e.jsxs("div",{className:"text-lg font-extrabold text-neutral-900",children:[Ea," ",e.jsxs("span",{className:"text-sm font-bold text-neutral-500",children:[" (œÉ ",Number.isFinite(cs)?Os(cs,1):"‚Äî"," vs ",Number.isFinite(st)?Os(st,1):"‚Äî",")"]})]}),e.jsx("div",{className:"mt-3 text-sm text-neutral-600",children:"Better early or late"}),e.jsx("div",{className:"text-sm font-extrabold text-neutral-900",children:Es})]}),e.jsxs("div",{className:"rounded-2xl border border-neutral-200 bg-neutral-50 p-4",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-500",children:"Start & Finish"}),e.jsxs("div",{className:"mt-2 text-sm text-neutral-600",children:["Fast starter (holes 1‚Äì3",ta?`, n=${ta} holes`:"",")"]}),e.jsxs("div",{className:"text-lg font-extrabold text-neutral-900 tabular-nums",children:[Vs?Vs.is?"Yes":"No":"‚Äî",e.jsxs("span",{className:"ml-2 text-sm font-bold text-neutral-500",children:["(",Vs?Os(Vs.pph,2):"‚Äî"," pts/h, ",Vs?aa(Vs.delta,2):"‚Äî"," vs avg ",Number.isFinite(Bt)?Os(Bt,2):"‚Äî",")"]})]}),e.jsxs("div",{className:"mt-3 text-sm text-neutral-600",children:["Clutch finisher (holes 16‚Äì18",ja?`, n=${ja} holes`:"",")"]}),e.jsxs("div",{className:"text-lg font-extrabold text-neutral-900 tabular-nums",children:[sa?sa.is?"Yes":"No":"‚Äî",e.jsxs("span",{className:"ml-2 text-sm font-bold text-neutral-500",children:["(",sa?Os(sa.pph,2):"‚Äî"," pts/h, ",sa?aa(sa.delta,2):"‚Äî"," vs avg ",Number.isFinite(Bt)?Os(Bt,2):"‚Äî",")"]})]})]}),e.jsxs("div",{className:"rounded-2xl border border-neutral-200 bg-neutral-50 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-500",children:"After a bad hole"}),e.jsx("div",{className:"text-[11px] font-black text-neutral-500",children:xs?xs.label:"‚Äî"})]}),e.jsx("div",{className:"mt-2 text-sm text-neutral-600",children:"When you make a double bogey or worse, what happens next?"}),e.jsx("div",{className:"mt-2 text-lg font-extrabold text-neutral-900 tabular-nums",children:"Resilience score (next hole vs your average)"}),e.jsx("div",{className:"mt-1 text-lg font-extrabold text-neutral-900 tabular-nums",children:xs&&Number.isFinite(xs.resiliencePts)?e.jsxs(e.Fragment,{children:[aa(xs.resiliencePts,2)," pts",e.jsx("span",{className:"text-neutral-300",children:" / "}),xs&&Number.isFinite(xs.resilienceStr)?`${aa(xs.resilienceStr,2,!0)} str`:"‚Äî"]}):xs&&Number.isFinite(xs.resilienceStr)?e.jsxs(e.Fragment,{children:["‚Äî ",e.jsx("span",{className:"text-neutral-300",children:"/"})," ",aa(xs.resilienceStr,2,!0)," str"]}):"‚Äî"}),e.jsx("div",{className:"mt-2 text-sm font-extrabold text-neutral-900",children:xs?xs.summary:"Not enough data."}),e.jsx("div",{className:"mt-1 text-[11px] text-neutral-500",children:xs?`Based on ${Math.max(xs.triggers||0,xs.nPts||0,xs.nStr||0)} follow-ups after double+ holes.`:""})]}),e.jsxs("div",{className:"rounded-2xl border border-neutral-200 bg-neutral-50 p-4",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-500",children:"Course fit"}),e.jsx("div",{className:"mt-2 text-sm text-neutral-600",children:bs&&bs.ok?e.jsxs(e.Fragment,{children:["Using: ",e.jsx("span",{className:"font-black text-neutral-900",children:bs.targetCourse}),bs.targetTee?e.jsxs("span",{className:"text-neutral-600",children:[" ¬∑ ",bs.targetTee]}):null,e.jsxs("span",{className:"text-neutral-500",children:[" ¬∑ ",bs.totalRounds," rounds"]})]}):e.jsx(e.Fragment,{children:"Not enough data"})}),e.jsx("div",{className:"mt-2 text-lg font-extrabold text-neutral-900",children:bs&&bs.ok?e.jsxs(e.Fragment,{children:["Favours:"," ",e.jsx("span",{className:"tabular-nums",children:bs.favours==="low"?"Low handicappers":bs.favours==="mid"?"Mid handicappers":bs.favours==="high"?"High handicappers":"Neutral"}),e.jsxs("span",{className:"ml-2 text-xs font-bold text-neutral-500",children:["(",String(bs.confidence||"low").toUpperCase()," confidence)"]})]}):"‚Äî"}),bs&&bs.ok?e.jsxs("div",{className:"mt-3 text-xs text-neutral-600 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{children:"Low (‚â§7)"}),e.jsxs("span",{className:"font-mono tabular-nums",children:[aa(($s=(Hs=bs.stats)==null?void 0:Hs.low)==null?void 0:$s.avgDelta,2)," pts (",((As=(na=bs.stats)==null?void 0:na.low)==null?void 0:As.players)||0,"p)"]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{children:"Mid (8‚Äì15)"}),e.jsxs("span",{className:"font-mono tabular-nums",children:[aa((Ds=(Zs=bs.stats)==null?void 0:Zs.mid)==null?void 0:Ds.avgDelta,2)," pts (",((ht=(Ls=bs.stats)==null?void 0:Ls.mid)==null?void 0:ht.players)||0,"p)"]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{children:"High (‚â•16)"}),e.jsxs("span",{className:"font-mono tabular-nums",children:[aa((Ks=(Ts=bs.stats)==null?void 0:Ts.high)==null?void 0:Ks.avgDelta,2)," pts (",((la=(Js=bs.stats)==null?void 0:Js.high)==null?void 0:la.players)||0,"p)"]})]}),e.jsx("div",{className:"pt-1 text-[11px] text-neutral-500",children:"Deltas are vs each player‚Äôs own baseline (all selected rounds)."})]}):null]})]})})]}),e.jsxs("div",{className:"rounded-3xl border border-neutral-200 bg-white p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-400",children:"Par leaders"}),e.jsx("span",{className:"inline-flex items-center gap-1 rounded-full border border-amber-200 bg-amber-50 px-2 py-0.5 text-[11px] font-black text-amber-700",children:"üèÜ Leaders"})]}),e.jsx("div",{className:"text-lg font-extrabold text-neutral-900",children:"Who dominates Par 3s, Par 4s, and Par 5s"}),e.jsx("div",{className:"text-sm text-neutral-600 mt-1",children:_t==="gross"?"Gross mode: fewer strokes on each hole type = better scoring.":"Stableford mode: more points on each hole type = better scoring."}),W?e.jsxs("div",{className:"mt-3 rounded-2xl border border-neutral-200 bg-neutral-50 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-[10px] font-black tracking-widest uppercase text-neutral-500",children:"Quick podium"}),e.jsx("div",{className:"text-[11px] font-black text-neutral-500",children:_t==="gross"?"lower wins":"higher wins"})]}),e.jsx("div",{className:"mt-2 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2 text-sm",children:[{k:"all",label:"All holes",ico:"üèÜ",desc:"Best overall scoring across the course"},{k:"p3",label:"Par 3",ico:"üéØ",desc:"Short holes ‚Äî accuracy & distance control"},{k:"p4",label:"Par 4",ico:"‚öôÔ∏è",desc:"The backbone ‚Äî tee shot + approach quality"},{k:"p5",label:"Par 5",ico:"üöÄ",desc:"Scoring chances ‚Äî smart aggression pays"}].map(t=>{const i=Oe!=null&&Oe[t.k]&&Oe[t.k][0]?Oe[t.k][0]:null,p=i?i.v:NaN,y=_t==="gross"?"sop/ho":"pts/ho";return e.jsx("div",{className:"rounded-2xl border border-neutral-200 bg-white p-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg leading-none",children:t.ico}),e.jsx("div",{className:"font-extrabold text-neutral-900 truncate",children:t.label})]}),e.jsx("div",{className:"text-xs text-neutral-500 mt-0.5",children:t.desc})]}),e.jsx("div",{className:"text-right",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[11px] font-black text-neutral-500 uppercase tracking-wide",children:"Leader"}),e.jsx("div",{className:"font-black text-neutral-900",children:i.name}),e.jsx("div",{className:"text-xs text-neutral-500 tabular-nums",children:Number.isFinite(p)?`${Jr(p,2)} ${y}`:"‚Äî"})]}):e.jsx("div",{className:"text-xs text-neutral-500",children:"No data"})})]})},t.k)})}),e.jsxs("div",{className:"mt-2 text-xs text-neutral-500",children:["Tap ",e.jsx("b",{children:"View leaders"})," to see full boards and sample sizes."]})]}):null]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("button",{className:"chip special "+(W?"ring-2 ring-emerald-200 shadow-sm":""),onClick:()=>de(t=>!t),children:W?"View leaders ‚ñæ":"Hide leaders ‚ñ¥"}),e.jsx("button",{className:"px-3 py-1.5 rounded-xl text-sm font-extrabold border "+(_t==="stableford"?"bg-neutral-900 text-white border-neutral-900":"bg-white text-neutral-700 border-neutral-200"),onClick:()=>Kt("stableford"),children:"Stableford"}),e.jsx("button",{className:"px-3 py-1.5 rounded-xl text-sm font-extrabold border "+(_t==="gross"?"bg-neutral-900 text-white border-neutral-900":"bg-white text-neutral-700 border-neutral-200"),onClick:()=>Kt("gross"),children:"Gross"})]})]}),!W&&e.jsx("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-4 gap-3",children:[{key:"all",title:"All holes",ico:"üèÜ"},{key:"p3",title:"Par 3",ico:"üéØ"},{key:"p4",title:"Par 4",ico:"‚öôÔ∏è"},{key:"p5",title:"Par 5",ico:"üöÄ"}].map(t=>e.jsxs("div",{className:"rounded-2xl border border-neutral-200 bg-neutral-50 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"text-sm font-extrabold text-neutral-900",children:[e.jsx("span",{className:"mr-1",children:t.ico}),t.title]}),e.jsx("div",{className:"text-[11px] font-black text-neutral-500 uppercase tracking-wide",children:_t==="gross"?"lower wins":"higher wins"})]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[(Oe[t.key]||[]).map((i,p)=>{const y=p===0?"ü•á":p===1?"ü•à":p===2?"ü•â":`${p+1}.`;return e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"min-w-0 flex items-center gap-2",children:[e.jsx("span",{className:"text-neutral-500 tabular-nums font-black w-7 text-center",children:y}),e.jsx("span",{className:"font-semibold text-neutral-900 truncate",children:i.name})]}),e.jsxs("div",{className:"flex items-baseline justify-end gap-2",children:[e.jsx("span",{className:"font-black tabular-nums text-neutral-900",children:Os(i.v,2)}),Number.isFinite(i.holes)&&e.jsxs("span",{className:"text-[10px] font-black tabular-nums text-neutral-400",children:["n=",Math.round(i.holes)]})]})]},i.name)}),(!Oe[t.key]||Oe[t.key].length===0)&&e.jsx("div",{className:"text-sm text-neutral-500",children:"No data yet."})]})]},t.key))})]}),e.jsxs("div",{className:"mt-6 rounded-3xl border border-neutral-200 bg-white p-4 md:p-5 shadow-sm","data-reveal":!0,children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] uppercase tracking-widest font-black text-neutral-500",children:"Trend over time"}),e.jsx("div",{className:"text-sm text-neutral-700 mt-1",children:Ws})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(za,{value:mt,onChange:t=>vt(String(t)),options:[{label:"Overall",value:"overall"},{label:"Par 3",value:"p3"},{label:"Par 4",value:"p4"},{label:"Par 5",value:"p5"}]}),e.jsx(za,{value:n,onChange:t=>l(String(t)),options:[{label:"1",value:"1"},{label:"5",value:"5"},{label:"10",value:"10"},{label:"20",value:"20"},{label:"30",value:"30"},{label:"All",value:"All"}]})]})]}),e.jsxs("div",{className:"text-neutral-900",children:[e.jsx(Nn,{a:ea,b:jt==="par"?da:ba,labels:_s}),e.jsx("div",{className:"mt-2 text-xs text-neutral-500",children:jt==="par"?a==="gross"?"Vs Par: 0 = level par (negative is under par).":"Vs Par: 36 points is ‚Äòpar‚Äô for 18 holes (2 pts/hole).":a==="gross"?"Gross line uses strokes-over-par per round (lower is better).":"Stableford line uses total points per round (higher is better)."})]})]}),e.jsx("div",{className:"mt-6 rounded-3xl border border-neutral-200 bg-white p-4 lg:p-5 shadow-sm","data-reveal":!0,children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-widest font-black text-neutral-500",children:(Ne==null?void 0:Ne.status)==="fix"?"üõ†Ô∏è FIX THIS":"üõ†Ô∏è NOTHING OBVIOUS TO FIX"}),e.jsx("div",{className:"mt-1 text-lg lg:text-xl font-black text-neutral-900",children:(Ne==null?void 0:Ne.headline)||"‚Äî"}),e.jsx("div",{className:"mt-2 text-sm text-neutral-700",children:(Ne==null?void 0:Ne.detail)||"‚Äî"})]}),e.jsxs("div",{className:"shrink-0 text-right",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-widest font-black text-neutral-400",children:"Confidence"}),e.jsxs("div",{className:"mt-1 inline-flex flex-wrap justify-end gap-2",children:[e.jsxs("span",{className:"chip",children:["n=",Number.isFinite((ns=Ne==null?void 0:Ne.sample)==null?void 0:ns.holes)?Math.round(Ne.sample.holes):0]}),e.jsxs("span",{className:"chip",children:["r=",Number.isFinite((hs=Ne==null?void 0:Ne.sample)==null?void 0:hs.rounds)?Math.round(Ne.sample.rounds):0]})]})]})]})}),e.jsx("div",{className:"mt-6 rounded-3xl border border-neutral-200 bg-white p-4 lg:p-5 shadow-sm","data-reveal":!0,children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-widest font-black text-neutral-500",children:"Player archetype"}),e.jsxs("div",{className:"mt-1 text-xl lg:text-2xl font-black text-neutral-900 flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:(z==null?void 0:z.icon)||"üß≠"}),e.jsx("span",{className:"block lg:truncate break-words",children:(z==null?void 0:z.name)||"‚Äî"})]}),e.jsx("div",{className:"mt-2 text-sm text-neutral-600",children:(z==null?void 0:z.why)||"‚Äî"}),e.jsxs("div",{className:"mt-3 rounded-2xl border border-neutral-200 bg-neutral-50 p-3",children:[e.jsx("div",{className:"text-[11px] font-black uppercase tracking-widest text-neutral-500",children:"How to flip it"}),e.jsx("div",{className:"mt-1 text-sm text-neutral-700",children:(z==null?void 0:z.tip)||"‚Äî"})]})]}),e.jsxs("div",{className:"w-full lg:w-auto lg:shrink-0 lg:text-right",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-widest font-black text-neutral-400",children:"Based on"}),e.jsxs("div",{className:"mt-1 inline-flex flex-wrap gap-2 lg:justify-end",children:[e.jsx("span",{className:"chip",children:"SI bands"}),e.jsx("span",{className:"chip",children:"Par types"}),e.jsx("span",{className:"chip",children:"Trend window"})]})]})]})}),e.jsxs("div",{className:"mt-6 rounded-3xl border border-neutral-200 bg-white p-4 lg:p-5 shadow-sm","data-reveal":!0,children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-widest font-black text-neutral-500",children:"Comfort zone yardage"}),e.jsxs("div",{className:"mt-1 text-sm text-neutral-600",children:["Compared to ",e.jsx("b",{children:"your own expectation"})," (this window), grouped by hole yardage."]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(za,{value:nt,onChange:t=>et(String(t)),options:[{label:"All",value:"all"},{label:"Par 3",value:"p3"},{label:"Par 4",value:"p4"},{label:"Par 5",value:"p5"}]})})]}),e.jsx("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-3",children:((_e==null?void 0:_e[nt])||[]).map(t=>{const i=t==null?void 0:t.avg,y=(Number.isFinite(i)?a==="gross"?i<=0:i>=0:!1)?"border-emerald-200 bg-emerald-50/40":"border-rose-200 bg-rose-50/40";return e.jsxs("div",{className:`rounded-2xl border ${y} p-4`,children:[e.jsx("div",{className:"text-sm font-black text-neutral-900",children:t.label}),e.jsxs("div",{className:"mt-1 text-2xl font-black tabular-nums",children:[be(i),e.jsx("span",{className:"text-xs font-black text-neutral-400 ml-2",children:a==="gross"?"strokes/hole":"pts/hole"})]}),e.jsxs("div",{className:"mt-1 text-xs text-neutral-500",children:["n=",Number.isFinite(t.n)?Math.round(t.n):0," holes"]})]},t.k)})}),e.jsxs("div",{className:"mt-3 rounded-2xl border border-neutral-200 bg-neutral-50 p-3",children:[e.jsx("div",{className:"text-[11px] font-black uppercase tracking-widest text-neutral-500",children:"Takeaway"}),e.jsx("div",{className:"mt-1 text-sm text-neutral-700",children:(($e=_e==null?void 0:_e.headlines)==null?void 0:$e[nt])||"‚Äî"})]})]}),e.jsxs("div",{className:"mt-6 rounded-3xl border border-neutral-200 bg-white p-4 lg:p-5 shadow-sm","data-reveal":!0,children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-[11px] uppercase tracking-widest font-black text-neutral-500",children:"Golf DNA"}),e.jsx("div",{className:"mt-1 text-xl lg:text-2xl font-black text-neutral-900",children:(rt==null?void 0:rt.label)||"‚Äî"}),e.jsx("div",{className:"mt-1 text-sm text-neutral-600",children:(rt==null?void 0:rt.why)||"‚Äî"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(za,{value:Pe,onChange:t=>it(String(t)),options:[{label:"Phases",value:"phase"},{label:"Holes 1‚Äì18",value:"holes"}]})})]}),Pe==="phase"?e.jsx("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-3",children:[{label:"Holes 1‚Äì6",v:(Ve=rt==null?void 0:rt.phaseAvg)==null?void 0:Ve[0]},{label:"Holes 7‚Äì12",v:(Ge=rt==null?void 0:rt.phaseAvg)==null?void 0:Ge[1]},{label:"Holes 13‚Äì18",v:(lt=rt==null?void 0:rt.phaseAvg)==null?void 0:lt[2]}].map(t=>{const i=t.v,y=(Number.isFinite(i)?a==="gross"?i<=0:i>=0:!1)?"border-emerald-200 bg-emerald-50/40":"border-rose-200 bg-rose-50/40";return e.jsxs("div",{className:`rounded-2xl border ${y} p-4`,children:[e.jsx("div",{className:"text-sm font-black text-neutral-900",children:t.label}),e.jsxs("div",{className:"mt-1 text-2xl font-black tabular-nums",children:[be(i),e.jsx("span",{className:"text-xs font-black text-neutral-400 ml-2",children:a==="gross"?"strokes/hole":"pts/hole"})]}),e.jsx("div",{className:"mt-1 text-xs text-neutral-500",children:"Vs expected (window)"})]},t.label)})}):e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-xs font-black uppercase tracking-widest text-neutral-500 mb-2",children:"Hole fingerprint"}),e.jsx("div",{className:"grid grid-cols-9 gap-1",children:Array.from({length:18}).map((t,i)=>{var v;const p=(v=rt==null?void 0:rt.holeAvg)==null?void 0:v[i],y=Number.isFinite(p),_=y?a==="gross"?p<=0:p>=0:!1,k=y?_?"bg-emerald-100 border-emerald-200":"bg-rose-100 border-rose-200":"bg-neutral-100 border-neutral-200";return e.jsxs("div",{className:`rounded-md border ${k} py-2 text-center`,children:[e.jsx("div",{className:"text-[10px] font-black text-neutral-600",children:i+1}),e.jsx("div",{className:"text-[10px] font-black tabular-nums text-neutral-900",children:be(p)})]},i)})}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded-2xl border border-neutral-200 bg-neutral-50 p-3",children:[e.jsx("div",{className:"text-[11px] font-black uppercase tracking-widest text-neutral-500",children:"Repeat strengths"}),e.jsx("div",{className:"mt-1 text-sm text-neutral-700",children:((rt==null?void 0:rt.strengths)||[]).length?rt.strengths.map(t=>`#${t.hole}`).join(", ")+" (where you most often beat expectation)":"Not enough data yet."})]}),e.jsxs("div",{className:"rounded-2xl border border-neutral-200 bg-neutral-50 p-3",children:[e.jsx("div",{className:"text-[11px] font-black uppercase tracking-widest text-neutral-500",children:"Repeat leaks"}),e.jsx("div",{className:"mt-1 text-sm text-neutral-700",children:((rt==null?void 0:rt.leaks)||[]).length?rt.leaks.map(t=>`#${t.hole}`).join(", ")+" (where you most often miss expectation)":"Not enough data yet."})]})]})]})]}),e.jsx("div",{className:"mt-6 rounded-3xl border border-neutral-200 bg-white p-5 shadow-sm","data-reveal":!0,children:e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-start justify-between gap-4",children:e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-400",children:"Player progress"}),e.jsx("div",{className:"mt-1 text-2xl md:text-3xl font-black tracking-tight text-neutral-900",children:Number.isFinite(es)?es>=0?`Ahead of ${me.label} by +${qe(es,1)}${a==="gross"?" strokes/rd":" pts/rd"}`:`Behind ${me.label} by ${qe(Math.abs(es),1)}${a==="gross"?" strokes/rd":" pts/rd"}`:"‚Äî"}),e.jsxs("div",{className:"mt-1 text-sm text-neutral-600",children:["A quick read of ",e.jsx("b",{children:"where your score is coming from"}),": one area where you ",e.jsx("b",{children:"beat the field"})," and one area that ",e.jsx("b",{children:"costs you most"}),"."]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-3",children:[(()=>{const t=(Se==null?void 0:Se[0])||null,i=(we==null?void 0:we[0])||null,p=Ue(t),y=Ue(i);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-2xl border border-neutral-200 bg-neutral-50 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"text-[10px] font-black tracking-widest uppercase text-neutral-anchored text-neutral-500",children:"Where you beat the field"}),e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-emerald-200 bg-emerald-50 px-2 py-0.5 text-[11px] font-black text-emerald-700",children:["üèÖ Gain vs ",me.label]})]}),e.jsxs("div",{className:"mt-1 text-xs text-neutral-500",children:["The bucket where you perform ",e.jsx("b",{children:"better than the field"})," (even if it‚Äôs still a tough bucket in absolute terms)."]}),e.jsx("div",{className:"mt-2 text-lg font-black text-neutral-900 truncate",children:t?t.label:"‚Äî"}),e.jsx("div",{className:"mt-1 text-sm text-neutral-700",children:t&&Number.isFinite(t.impactRd)?a==="gross"?e.jsxs(e.Fragment,{children:["About ",e.jsx("b",{children:qe(Math.abs(t.impactRd),1)})," ",e.jsx("b",{children:"shots saved"})," per round vs ",me.label,"."]}):e.jsxs(e.Fragment,{children:["About ",e.jsx("b",{children:qe(Math.abs(t.impactRd),1)})," ",e.jsx("b",{children:"points gained"})," per round vs ",me.label,"."]}):"‚Äî"}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[e.jsxs("span",{className:`chip ${p.cls}`,children:["Confidence: ",p.label]}),e.jsx("span",{className:"chip",children:"Per round"}),e.jsx("span",{className:"chip",children:"Vs field"})]}),e.jsxs("div",{className:"mt-1 text-[11px] text-neutral-500",children:[e.jsx("b",{children:"High"})," = lots of holes/rounds and a stable pattern. ",e.jsx("b",{children:"Low"})," = limited evidence (treat as a hint)."]})]}),e.jsxs("div",{className:"rounded-2xl border border-neutral-200 bg-neutral-50 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"text-[10px] font-black tracking-widest uppercase text-neutral-500",children:"Biggest leak"}),e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full border border-rose-200 bg-rose-50 px-2 py-0.5 text-[11px] font-black text-rose-700",children:["üßØ Cost vs ",me.label]})]}),e.jsx("div",{className:"mt-1 text-xs text-neutral-500",children:"The bucket that hurts your scoring the most compared to the field (where big numbers tend to come from)."}),e.jsx("div",{className:"mt-2 text-lg font-black text-neutral-900 truncate",children:i?i.label:"‚Äî"}),e.jsx("div",{className:"mt-1 text-sm text-neutral-700",children:i&&Number.isFinite(i.impactRd)?a==="gross"?e.jsxs(e.Fragment,{children:["About ",e.jsx("b",{children:qe(Math.abs(i.impactRd),1)})," ",e.jsx("b",{children:"extra shots"})," per round vs ",me.label,"."]}):e.jsxs(e.Fragment,{children:["About ",e.jsx("b",{children:qe(Math.abs(i.impactRd),1)})," ",e.jsx("b",{children:"points lost"})," per round vs ",me.label,"."]}):"‚Äî"}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2",children:[e.jsxs("span",{className:`chip ${y.cls}`,children:["Confidence: ",y.label]}),e.jsx("span",{className:"chip",children:"Per round"}),e.jsx("span",{className:"chip",children:"Vs field"})]}),e.jsxs("div",{className:"mt-1 text-[11px] text-neutral-500",children:[e.jsx("b",{children:"High"})," = shows up repeatedly. ",e.jsx("b",{children:"Medium"})," = pretty consistent. ",e.jsx("b",{children:"Low"})," = could be noise ‚Äî needs more rounds."]})]})]})})(),e.jsxs("div",{className:"rounded-2xl border border-neutral-200 bg-neutral-50 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"text-[10px] font-black tracking-widest uppercase text-neutral-500",children:"Wipe / Double+ rate"}),e.jsx("span",{className:"inline-flex items-center gap-1 rounded-full bg-neutral-900 px-2 py-0.5 text-[11px] font-black text-white",children:"üõ°Ô∏è Card protection"})]}),(()=>{const t=Number(Pt==null?void 0:Pt.holes),i=Number(Pt==null?void 0:Pt.badRate),p=Number(Pt==null?void 0:Pt.bogeyRate),y=Number(Pt==null?void 0:Pt.parRate),_=Number(Pt==null?void 0:Pt.birdiePlusRate),k=Number(P==null?void 0:P.badRate),v=Number(P==null?void 0:P.bogeyRate),ee=Number(P==null?void 0:P.parRate),F=Number(P==null?void 0:P.birdiePlusRate),oe=Number.isFinite(i)?i*18:NaN,$=Number.isFinite(k)?k*18:NaN;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-2 flex items-baseline justify-between",children:[e.jsx("div",{className:"text-2xl font-black text-neutral-900",children:bt(i)}),e.jsx("div",{className:"text-sm font-black text-neutral-700",children:Number.isFinite(oe)?qe(oe,1)+" per 18":"‚Äî"})]}),e.jsxs("div",{className:"mt-1 text-[11px] text-neutral-600",children:["Field: ",bt(k)," ¬∑ ",Number.isFinite($)?qe($,1)+" /18":"‚Äî"]}),e.jsxs("div",{className:"mt-2 text-xs text-neutral-600",children:["Goal: ",e.jsx("b",{children:"0.2 per 18"})," (",e.jsx("b",{children:"1%"}),") over the next ",e.jsx("b",{children:"5 rounds"})," ‚Äî basically remove one disaster hole."]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"rounded-lg bg-white border border-neutral-200 p-2",children:[e.jsx("div",{className:"text-[10px] font-black tracking-widest uppercase text-neutral-500",children:"Bogey rate"}),e.jsxs("div",{className:"mt-0.5 flex items-baseline justify-between",children:[e.jsx("div",{className:"text-sm font-black",children:bt(p)}),e.jsxs("div",{className:"text-[11px] text-neutral-600",children:["Field: ",bt(v)]})]})]}),e.jsxs("div",{className:"rounded-lg bg-white border border-neutral-200 p-2",children:[e.jsx("div",{className:"text-[10px] font-black tracking-widest uppercase text-neutral-500",children:"Par rate"}),e.jsxs("div",{className:"mt-0.5 flex items-baseline justify-between",children:[e.jsx("div",{className:"text-sm font-black",children:bt(y)}),e.jsxs("div",{className:"text-[11px] text-neutral-600",children:["Field: ",bt(ee)]})]})]}),e.jsxs("div",{className:"rounded-lg bg-white border border-neutral-200 p-2",children:[e.jsx("div",{className:"text-[10px] font-black tracking-widest uppercase text-neutral-500",children:"Birdie+ rate"}),e.jsxs("div",{className:"mt-0.5 flex items-baseline justify-between",children:[e.jsx("div",{className:"text-sm font-black",children:bt(_)}),e.jsxs("div",{className:"text-[11px] text-neutral-600",children:["Field: ",bt(F)]})]})]}),e.jsxs("div",{className:"rounded-lg bg-white border border-neutral-200 p-2",children:[e.jsx("div",{className:"text-[10px] font-black tracking-widest uppercase text-neutral-500",children:"Rounds analysed"}),e.jsx("div",{className:"mt-0.5 text-sm font-black",children:t?Os(t/18,1):"‚Äî"}),e.jsx("div",{className:"text-[11px] text-neutral-600",children:"same window"})]})]}),e.jsx("div",{className:"mt-2 text-xs text-neutral-600",children:"This isn‚Äôt about chasing birdies ‚Äî it‚Äôs about protecting the card. Cut one wipe/double+ and your scoring moves immediately."})]})})()]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 lg:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"rounded-2xl border border-neutral-200 bg-white p-4",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-400",children:"Top gains"}),e.jsxs("div",{className:"mt-1 text-xs text-neutral-500",children:["Your best contributors ",e.jsx("b",{children:"per round"})," vs the field. (Stableford = points gained, Score = shots saved.)"]}),e.jsx("div",{className:"mt-2 space-y-2",children:(Se!=null&&Se.length?Se.slice(0,5):[null]).map((t,i)=>e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"min-w-0 text-sm font-semibold text-neutral-800 truncate",children:t?t.label:"‚Äî"}),e.jsx("div",{className:"text-sm tabular-nums font-black "+(t&&Number.isFinite(t.impactRd)&&t.impactRd<0?"text-rose-600":"text-emerald-700"),children:t&&Number.isFinite(t.impactRd)?`${yr(t.impactRd,1)}/rd`:"‚Äî"})]},i))})]}),e.jsxs("div",{className:"rounded-2xl border border-neutral-200 bg-white p-4",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-400",children:"Top leaks"}),e.jsxs("div",{className:"mt-1 text-xs text-neutral-500",children:["Your biggest costs ",e.jsx("b",{children:"per round"})," vs the field. (Stableford = points lost, Score = extra shots.)"]}),e.jsx("div",{className:"mt-2 space-y-2",children:(we!=null&&we.length?we.slice(0,5):[null]).map((t,i)=>e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"min-w-0 text-sm font-semibold text-neutral-800 truncate",children:t?t.label:"‚Äî"}),e.jsx("div",{className:"text-sm tabular-nums font-black "+(t&&Number.isFinite(t.impactRd)&&t.impactRd>0?"text-emerald-700":"text-rose-700"),children:t&&Number.isFinite(t.impactRd)?`${yr(t.impactRd,1)}/rd`:"‚Äî"})]},i))})]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-2",children:[e.jsx("button",{className:`chip hover:opacity-90 ${Z==="all"?"bg-neutral-900 text-white border-neutral-900":""}`,onClick:()=>{Qe("all"),T(8)},children:"All"}),e.jsx("button",{className:`chip hover:opacity-90 ${Z==="par"?"bg-neutral-900 text-white border-neutral-900":""}`,onClick:()=>{Qe("par"),T(8)},children:"Par"}),e.jsx("button",{className:`chip hover:opacity-90 ${Z==="si"?"bg-neutral-900 text-white border-neutral-900":""}`,onClick:()=>{Qe("si"),T(8)},children:"SI"}),e.jsx("button",{className:`chip hover:opacity-90 ${Z==="yd"?"bg-neutral-900 text-white border-neutral-900":""}`,onClick:()=>{Qe("yd"),T(8)},children:"Yardage"}),e.jsx("div",{className:"ml-auto flex items-center gap-2",children:e.jsxs("span",{className:"text-xs text-neutral-500",children:["Sorted by how many ",e.jsx("b",{children:a==="gross"?"shots":"points"})," you ",e.jsx("b",{children:"gain or lose per round"})," vs ",ve==="strokesPar"?"par":me.label,"."]})})]}),(()=>{const i=((Z==="par"?L:Z==="si"?De:Z==="yd"?Ct:Re)||[]).slice().sort((y,_)=>Math.abs(_.impactRd)-Math.abs(y.impactRd)),p=i.slice(0,O);return e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:(p.length?p:[{label:"‚Äî",impactRd:NaN,holes:0,mePH:NaN,fldPH:NaN,dGood:NaN}]).map((y,_)=>e.jsx("div",{className:"rounded-2xl border border-neutral-100 bg-white/70 p-2",children:e.jsx(At,{row:y})},_))}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsxs("div",{className:"text-xs text-neutral-500",children:["Showing ",Math.min(O,i.length||0)," of ",i.length||0," buckets."]}),i.length>O?e.jsx("button",{className:"chip hover:opacity-90",onClick:()=>T(y=>y+6),children:"Show more"}):i.length>8?e.jsx("button",{className:"chip hover:opacity-90",onClick:()=>T(8),children:"Show less"}):null]}),e.jsx("div",{className:"mt-4",children:e.jsx(Ft,{rows:i,title:"Momentum snapshot"})})]})})()]})})})]})]}):e.jsx("div",{className:"p-6 text-sm text-neutral-500",children:"Select a player."})}function Za({scoringMode:s,windowSeries:a}){const r=String(s)==="gross",u=(a||[]).slice();let d=0,A=0,x=0,g=0,c=0;for(const m of u){const M=Array.isArray(m==null?void 0:m.perHole)?m.perHole:null,n=Array.isArray(m==null?void 0:m.grossPerHole)?m.grossPerHole:null,l=Array.isArray(m==null?void 0:m.parsArr)?m.parsArr:Array.isArray(m==null?void 0:m.parsPerHole)?m.parsPerHole:Array.isArray(m==null?void 0:m.pars)?m.pars:null;for(let f=0;f<18;f++)if(r){const E=Number(n==null?void 0:n[f]),D=Number(l==null?void 0:l[f]);if(!Number.isFinite(E)||!Number.isFinite(D))continue;d++;const C=E-D;C<=-1?A++:C===0?x++:C===1?g++:c++}else{const E=Number(M==null?void 0:M[f]);if(!Number.isFinite(E))continue;d++,E>=3?A++:E===2?x++:E===1?g++:c++}}const o=m=>d?m/d:NaN;return{holes:d,birdiePlusRate:o(A),parRate:o(x),bogeyRate:o(g),badRate:o(c)}}function vn(s,a){const r=Array.isArray(s)?s.slice():s&&typeof s=="object"?{...s}:{};return!a||typeof a!="object"||Object.keys(a).forEach(u=>{const d=Number(r[u]),A=Number(a[u]);Number.isFinite(A)&&(r[u]=(Number.isFinite(d)?d:0)+A)}),r}function fr(s,a,r){const u=typeof r=="function"?r():{};return(s||[]).forEach(d=>{const A=d==null?void 0:d[a];!A||typeof A!="object"||Object.keys(A).forEach(x=>{const g=Number(A[x]);if(!Number.isFinite(g))return;const c=Number(u[x]);u[x]=(Number.isFinite(c)?c:0)+g})}),u}function _a(s,a,r){const u={};return(s||[]).forEach(d=>{const A=(d==null?void 0:d[a])||{};Object.keys(A).forEach(x=>{const g=A[x];!g||typeof g!="object"||(u[x]||(u[x]=typeof r=="function"?r():{}),u[x]=vn(u[x],g))})}),u}function jn(s){try{return String(s||"").toLowerCase().trim().replace(/['"]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/(^-|-$)/g,"").slice(0,80)||"report"}catch{return"report"}}function vs(s){return String(s??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function ar(s,a,r){const u=String(a)==="gross",d=f=>Number.isFinite(f)?f.toFixed(2):"‚Äî",A=f=>Number.isFinite(f)?String(Math.round(f)):"‚Äî";if(String(r)==="par"){const f=(s||[]).map(N=>{const X=vs((N==null?void 0:N.label)??(N==null?void 0:N.key)??""),J=Number.isFinite(N==null?void 0:N.holes)?Math.round(N.holes):NaN,I=Number.isFinite(N==null?void 0:N.me)?N.me:Number.isFinite(N==null?void 0:N.playerAvg)?N.playerAvg:NaN;return{label:X,holes:J,me:I}}),E=N=>Number.isFinite(N)?N<=.75?"PRgood":N<=1.25?"PRneutral":"PRbad":"PRneutral",D=N=>Number.isFinite(N)?N.toFixed(2):"‚Äî",C=N=>Number.isFinite(N)?String(N):"‚Äî";return`
    <div class="PRtableWrap">
      <div class="PRlegend">
        <span class="PRpill PRgoodPill">Good (closer to par)</span>
        <span class="PRpill PRbadPill">Leak (far from par)</span>
        <span class="PRpill PRneutralPill">Neutral</span>
        <span class="PRmuted" style="margin-left:8px;">Values shown are your <b>avg strokes over par per hole</b> in each bucket.</span>
      </div>
      <table class="PRtable">
        <thead>
          <tr>
            <th class="left">Bucket</th>
            <th>Holes</th>
            <th>You (avg over par)</th>
          </tr>
        </thead>
        <tbody>
          ${f.map(N=>`
              <tr class="PRrow ${E(N.me)}">
                <td class="left"><span class="PRbucket">${N.label}</span></td>
                <td>${C(N.holes)}</td>
                <td><b>${D(N.me)}</b></td>
              </tr>
            `).join("")}
        </tbody>
      </table>
    </div>
  `}const g=f=>{const E=Number.isFinite(f==null?void 0:f.me)?f.me:Number.isFinite(f==null?void 0:f.playerAvg)?f.playerAvg:NaN,D=Number.isFinite(f==null?void 0:f.peer)?f.peer:Number.isFinite(f==null?void 0:f.fieldAvg)?f.fieldAvg:NaN;return!Number.isFinite(E)||!Number.isFinite(D)?NaN:u?D-E:E-D},c=f=>Number.isFinite(f==null?void 0:f.me)?f.me:f==null?void 0:f.playerAvg,o=f=>Number.isFinite(f==null?void 0:f.peer)?f.peer:f==null?void 0:f.fieldAvg,m=f=>Number.isFinite(f)?(f>=0?"+":"")+f.toFixed(Math.abs(f)<.01&&f!==0?3:2):"‚Äî",M=f=>Number.isFinite(f)?f>5e-4?"good":f<-5e-4?"bad":"neu":"neu",n=f=>Number.isFinite(f)?f>5e-4?"‚ñ≤":f<-5e-4?"‚ñº":"‚Ä¢":"";return`
    <div class="PRlegend">
      <span class="PRlegItem good"><span class="PRlegDot"></span>Good (gain)</span>
      <span class="PRlegItem bad"><span class="PRlegDot"></span>Bad (leak)</span>
      <span class="PRlegItem neu"><span class="PRlegDot"></span>Neutral</span>
      <span class="PRlegNote">Delta is always oriented so <b>positive = better</b> (gross: fewer strokes; stableford: more points).</span>
    </div>

    <table class="PRtbl">
      <colgroup><col class="c1"/><col class="c2"/><col class="c3"/><col class="c4"/><col class="c5"/></colgroup>
      <thead>
        <tr>
          <th>Bucket</th><th>Holes</th><th>You (avg)</th><th>Peer (avg)</th><th>Delta</th>
        </tr>
      </thead>
      <tbody>
        ${(s||[]).map(f=>{const E=Number.isFinite(f==null?void 0:f.delta)?Number(f.delta):g(f),D=M(E),C=vs((f==null?void 0:f.label)??(f==null?void 0:f.key)??""),N=A(f==null?void 0:f.holes),X=d(c(f)),J=d(o(f)),I=m(E),V=n(E);return`
            <tr class="PRrow ${D}">
              <td class="left"><span class="PRbucket">${C}</span></td>
              <td>${N}</td>
              <td>${X}</td>
              <td>${J}</td>
              <td class="PRdelta">
                <span class="PRdeltaBadge ${D}"><span class="PRarr">${V}</span>${I}</span>
              </td>
            </tr>
          `}).join("")}
      </tbody>
    </table>
  `}function Ar(s){try{let a=document.getElementById("PR_seasonReportOverlay");a||(a=document.createElement("div"),a.id="PR_seasonReportOverlay",a.style.position="fixed",a.style.inset="0",a.style.zIndex="999999",a.style.background="rgba(2,6,23,.65)",a.style.display="none",a.innerHTML=`
        <div id="PR_seasonReportPanel" style="position:absolute; inset:18px; background:#fff; border-radius:14px; overflow:auto; box-shadow:0 20px 60px rgba(0,0,0,.35);">
          <div style="position:sticky; top:0; background:#fff; border-bottom:1px solid #e5e7eb; padding:12px 14px; display:flex; align-items:center; gap:10px; z-index:2;">
            <div style="font-weight:900; color:#0f172a;">Season Report</div>
            <div style="flex:1"></div>
            <button id="PR_closeSeasonReport" style="border:1px solid #e5e7eb; background:#fff; border-radius:10px; padding:8px 10px; font-weight:800; cursor:pointer;">Close</button>
          </div>
          <div id="PR_seasonReportBody" style="padding:16px 18px;"></div>
        </div>
      `,document.body.appendChild(a),a.addEventListener("click",r=>{r.target===a&&gr()}),a.querySelector("#PR_closeSeasonReport").addEventListener("click",gr)),a.querySelector("#PR_seasonReportBody").innerHTML=s,wn(),a.style.display="block",document.body.style.overflow="hidden"}catch(a){console.error(a),alert("Could not display report.")}}function gr(){const s=document.getElementById("PR_seasonReportOverlay");s&&(s.style.display="none"),document.body.style.overflow=""}function wn(){try{const s=document.getElementById("PR_seasonReportBody");if(!s)return;Array.from(s.querySelectorAll("[data-pr-report-cohort]")).forEach(r=>{r.addEventListener("click",()=>{const u=r.getAttribute("data-pr-report-cohort")||"band";Sn(u)})})}catch(s){console.error(s)}}function Sn(s){try{const a=window.__dslSeasonReportParams;if(!a||!a.model)return;const r=String(s)==="field"?"field":"band";window.__dslSeasonReportParams={...a,comparatorMode:r};const u=Fr({model:a.model,playerName:a.playerName,yearLabel:a.yearLabel,seasonLimit:a.seasonLimit,scoringMode:a.scoringMode,lensMode:a.lensMode,comparatorMode:r});if(!u||!u.ok){alert((u==null?void 0:u.error)||"Could not generate report.");return}Ar(u.htmlFragment||u.html)}catch(a){console.error(a),alert("Could not update report.")}}function Fr({model:s,playerName:a,yearLabel:r,seasonLimit:u,scoringMode:d,lensMode:A,comparatorMode:x}){var g="‚Äî",c=NaN,o=NaN,m=0;const M=Array.isArray(s==null?void 0:s.players)?s.players:[];let n=M.find(h=>String((h==null?void 0:h.name)||"")===String(a||""))||M[0]||null;if(!n)return{ok:!1,error:"No player selected."};const l=typeof window<"u"&&window.__dslOverviewReport?window.__dslOverviewReport:null,f=h=>String(h??"").trim(),E=h=>{const P=f(h),z=P.match(/^(\d{4})-(\d{2})$/);if(z){const Q=z[1],ne=String(Number(z[1].slice(0,2)+z[2]));return`${Q}-${ne}`}return P},D=!!(l&&f(l.playerName)===f(a)&&E(l.yearLabel)===E(r)&&f(l.seasonLimit)===f(u)&&f(l.scoringMode)===f(d)),C=D?String(l.comparatorMode||"band")==="par"?"par":String(l.comparatorMode||"band")==="field"?"field":"band":String(x||"band")==="par"?"par":String(x||"band")==="field"?"field":"band";let N=null;D&&(g=String(l.peerBand||l.cohortLabel||"‚Äî"),c=Number.isFinite(Number(l.peerMin))?Number(l.peerMin):NaN,o=Number.isFinite(Number(l.peerMax))?Number(l.peerMax):NaN,m=Number.isFinite(Number(l.peerPlayersN))?Number(l.peerPlayersN):0,l.playerAgg&&(n=l.playerAgg),N=l.peerAgg||null);function X(h){var ne;const P=le=>({holes:Number.isFinite(Number(le))?Number(le):0,val:0}),z={totalsGross:P((ne=h==null?void 0:h.totalsGross)==null?void 0:ne.holes),byParGross:{},bySIGross:{},byYardsGross:{}};["Par 3","Par 4","Par 5","Unknown"].forEach(le=>{var Ee,be;z.byParGross[le]=P((be=(Ee=h==null?void 0:h.byParGross)==null?void 0:Ee[le])==null?void 0:be.holes)}),["1‚Äì6","7‚Äì12","13‚Äì18","Unknown"].forEach(le=>{var Ee,be;z.bySIGross[le]=P((be=(Ee=h==null?void 0:h.bySIGross)==null?void 0:Ee[le])==null?void 0:be.holes)});const Q=(h==null?void 0:h.byYardsGross)||{};return Object.keys(Q||{}).forEach(le=>{var Ee;z.byYardsGross[le]=P((Ee=Q==null?void 0:Q[le])==null?void 0:Ee.holes)}),z}C==="par"&&(g="Par baseline",m=0,c=NaN,o=NaN,N=X(n));function J(h){let P=Array.isArray(h)?h.slice():[];const z=String(r||"All"),Q=String(u||"All"),ne=le=>{const Ee=(le==null?void 0:le.date)||(le==null?void 0:le.eventDate)||(le==null?void 0:le.roundDate)||(le==null?void 0:le.ts)||(le==null?void 0:le.when)||(le==null?void 0:le.playedAt)||"",be=new Date(Ee);if(!isNaN(be))return be.getTime();const Ne=String(Ee).match(/(20\d{2})/);return Ne?new Date(Ne[1]+"-01-01").getTime():0};if(z&&z!=="All"){const le=_e=>{const rt=String(_e??"").trim(),nt=rt.match(/^(\d{4})-(\d{2})$/);if(nt){const et=nt[1],Pe=String(Number(et.slice(0,2)+nt[2]));return`${et}-${Pe}`}return rt},Ee=le(z),be=typeof window<"u"&&Array.isArray(window.__dslSeasonsDef)?window.__dslSeasonsDef:[],Ne=_e=>{var et;const rt=(_e&&(_e.seasonId??_e.season_id))??"";if(String(rt).trim())return le(rt);const nt=Number.isFinite(Number(_e==null?void 0:_e.dateMs))?Number(_e.dateMs):Number.isFinite(Number((et=_e==null?void 0:_e.parsed)==null?void 0:et.dateMs))?Number(_e.parsed.dateMs):Number.isFinite(Number(_e==null?void 0:_e.ts))?Number(_e.ts):NaN;if(Number.isFinite(nt)&&typeof seasonIdForDateMs=="function"&&be.length)try{const Pe=seasonIdForDateMs(nt,be);if(String(Pe??"").trim())return le(Pe)}catch{}if(/^\d{4}$/.test(Ee)){const Pe=new Date(Number.isFinite(nt)?nt:ne(_e)).getFullYear();return String(Pe)}return""};P=P.filter(_e=>Ne(_e)===Ee)}if(P.sort((le,Ee)=>ne(le)-ne(Ee)),Q&&Q!=="All"){const le=parseInt(Q,10);!isNaN(le)&&le>0&&P.length>le&&(P=P.slice(-le))}return P}let I=M.filter(h=>h&&String((h==null?void 0:h.name)||"")!==String((n==null?void 0:n.name)||""));if(!N){const h=String(x||"band")==="field"?"field":"band";try{if(h==="field")g="Field";else{const Q=J(n==null?void 0:n.series),ne=_mean(Q.map(be=>sr(be==null?void 0:be.hcap,NaN))),le=Number.isFinite(ne)?ne>=18?6:ne>=10?4:3:4,Ee=M.filter(be=>{if(!be||String((be==null?void 0:be.name)||"")===String((n==null?void 0:n.name)||""))return!1;const Ne=J(be==null?void 0:be.series),_e=_mean(Ne.map(rt=>sr(rt==null?void 0:rt.hcap,NaN)));return Number.isFinite(ne)&&Number.isFinite(_e)&&Math.abs(_e-ne)<=le});if(Ee.length<3)I=M.filter(be=>be&&String((be==null?void 0:be.name)||"")!==String((n==null?void 0:n.name)||"")),g="Field (band too small)";else{I=Ee.slice();const be=ne-le,Ne=ne+le;g=`Handicap band (${be.toFixed(1)}‚Äì${Ne.toFixed(1)})`}}let P=1/0,z=-1/0;for(const Q of I){const ne=J(Q==null?void 0:Q.series),le=_mean(ne.map(Ee=>sr(Ee==null?void 0:Ee.hcap,NaN)));Number.isFinite(le)&&(P=Math.min(P,le),z=Math.max(z,le))}P!==1/0&&(c=P,o=z),m=I.length}catch{}}const V=String(d)==="gross",te=V?(n==null?void 0:n.totalsGross)||_makeAggGross():(n==null?void 0:n.totals)||_makeAgg(),Z=N?V?(N==null?void 0:N.totalsGross)||_makeAggGross():(N==null?void 0:N.totals)||_makeAgg():V?fr(I,"totalsGross",_makeAggGross):fr(I,"totals",_makeAgg),Qe=V?Xa(te):Ja(te),ve=V?Xa(Z):Ja(Z),xt=V?ve-Qe:Qe-ve,mt=Qe,vt=ve,jt=pe(n==null?void 0:n.rounds,NaN),He=pe(te==null?void 0:te.holes,NaN),Je=h=>{try{return Array.isArray(h==null?void 0:h.roundSeries)?h.roundSeries:J(h==null?void 0:h.series)}catch{return[]}},b=h=>{const P=(h||[]).map(Number).filter(Number.isFinite);return P.length?P.reduce((z,Q)=>z+Q,0)/P.length:NaN},j=h=>{const P=(h||[]).map(Number).filter(Number.isFinite);if(P.length<3)return NaN;const z=b(P),Q=P.reduce((ne,le)=>ne+Math.pow(le-z,2),0)/(P.length-1);return Math.sqrt(Q)},O=(h,P)=>{const z=[];for(let be=0;be<Math.min(h.length,P.length);be++){const Ne=Number(h[be]),_e=Number(P[be]);Number.isFinite(Ne)&&Number.isFinite(_e)&&z.push([Ne,_e])}if(z.length<3)return NaN;const Q=z.reduce((be,Ne)=>be+Ne[0],0)/z.length,ne=z.reduce((be,Ne)=>be+Ne[1],0)/z.length;let le=0,Ee=0;for(const[be,Ne]of z)le+=(be-Q)*(Ne-ne),Ee+=(be-Q)*(be-Q);return Ee?le/Ee:NaN},T=(M||[]).filter(h=>h&&h.name),ae=T.map(h=>({name:h.name,avg:b(Je(h).map(P=>pe(P==null?void 0:P.pts,NaN)))})).filter(h=>Number.isFinite(h.avg)),ye=T.map(h=>({name:h.name,avg:b(Je(h).map(P=>pe(P==null?void 0:P.gross,NaN)))})).filter(h=>Number.isFinite(h.avg)),U=ae.slice().sort((h,P)=>P.avg-h.avg),at=ye.slice().sort((h,P)=>h.avg-P.avg),ce=D&&(l!=null&&l.stableRank)&&Number.isFinite(Number(l.stableRank.pos))?Number(l.stableRank.pos):U.findIndex(h=>String(h.name)===String(n==null?void 0:n.name))+1,gt=D&&(l!=null&&l.grossRank)&&Number.isFinite(Number(l.grossRank.pos))?Number(l.grossRank.pos):at.findIndex(h=>String(h.name)===String(n==null?void 0:n.name))+1,ot=D&&(l!=null&&l.stableRank)&&Number.isFinite(Number(l.stableRank.total))?Number(l.stableRank.total):U.length||0,qe=D&&(l!=null&&l.grossRank)&&Number.isFinite(Number(l.grossRank.total))?Number(l.grossRank.total):at.length||0,Dt=b(ae.map(h=>h.avg)),bt=b(ye.map(h=>h.avg)),ke=D&&(l!=null&&l.stableRank)&&Number.isFinite(Number(l.stableRank.delta))?Number(l.stableRank.delta):Number.isFinite(b(Je(n).map(h=>pe(h==null?void 0:h.pts,NaN))))&&Number.isFinite(Dt)?b(Je(n).map(h=>pe(h==null?void 0:h.pts,NaN)))-Dt:NaN,w=D&&(l!=null&&l.grossRank)&&Number.isFinite(Number(l.grossRank.delta))?Number(l.grossRank.delta):Number.isFinite(b(Je(n).map(h=>pe(h==null?void 0:h.gross,NaN))))&&Number.isFinite(bt)?b(Je(n).map(h=>pe(h==null?void 0:h.gross,NaN)))-bt:NaN,Le=D&&Number.isFinite(Number(l==null?void 0:l.vol))&&String(d)!=="gross"?Number(l.vol):j(Je(n).map(h=>pe(h==null?void 0:h.pts,NaN))),Fe=D&&Number.isFinite(Number(l==null?void 0:l.vol))&&String(d)==="gross"?Number(l.vol):j(Je(n).map(h=>pe(h==null?void 0:h.gross,NaN))),Vt=D&&Number.isFinite(Number(l==null?void 0:l.volField))&&String(d)!=="gross"?Number(l.volField):j(ae.map(h=>h.avg)),fs=D&&Number.isFinite(Number(l==null?void 0:l.volField))&&String(d)==="gross"?Number(l.volField):j(ye.map(h=>h.avg)),wt=Je(n),ft=wt.map((h,P)=>{const z=Number(h==null?void 0:h.dateMs)||Number(h==null?void 0:h.date_ms)||(h!=null&&h.date?new Date(h.date).getTime():NaN);return Number.isFinite(z)?z/864e5:P}),ut=wt.map(h=>pe(h==null?void 0:h.pts,NaN)),Me=wt.map(h=>pe(h==null?void 0:h.gross,NaN)),Jt=O(ft,ut),_t=O(ft,Me),Kt=String(d)==="gross"?Number.isFinite(_t)?_t<=-.02?"Getting better":_t>=.02?"Getting worse":"No clear trend":"No clear trend":Number.isFinite(Jt)?Jt>=.02?"Getting better":Jt<=-.02?"Getting worse":"No clear trend":"No clear trend",W=Ha({scoringMode:d,dim:"SI",mapObj:V?n==null?void 0:n.bySIGross:n==null?void 0:n.bySI,fieldObj:N?V?(N==null?void 0:N.bySIGross)||{}:(N==null?void 0:N.bySI)||{}:V?_a(I,"bySIGross",_makeAggGross):_a(I,"bySI",_makeAgg),limit:6}),de=Ha({scoringMode:d,dim:"Par",mapObj:V?n==null?void 0:n.byParGross:n==null?void 0:n.byPar,fieldObj:N?V?(N==null?void 0:N.byParGross)||{}:(N==null?void 0:N.byPar)||{}:V?_a(I,"byParGross",_makeAggGross):_a(I,"byPar",_makeAgg),limit:6}),Te=Ha({scoringMode:d,dim:"Yards",mapObj:V?n==null?void 0:n.byYardsGross:n==null?void 0:n.byYards,fieldObj:N?V?(N==null?void 0:N.byYardsGross)||{}:(N==null?void 0:N.byYards)||{}:V?_a(I,"byYardsGross",_makeAggGross):_a(I,"byYards",_makeAgg),limit:10}),xe=Array.isArray(n==null?void 0:n.roundSeries)?n.roundSeries:J(n==null?void 0:n.series),fe=Za({scoringMode:d,windowSeries:xe}),Oe=pe(te==null?void 0:te.holes,0)||0,me=pe(Z==null?void 0:Z.holes,0)||0,re=(()=>{const h=(P,z=NaN)=>{const Q=Number(P);return Number.isFinite(Q)?Q:z};try{const P=(ne,le,Ee,be)=>({birdiePlusRate:Oe?h(ne,NaN)/Oe:NaN,parRate:Oe?h(le,NaN)/Oe:NaN,bogeyRate:Oe?h(Ee,NaN)/Oe:NaN,badRate:Oe?h(be,NaN)/Oe:NaN});let z;String(d)==="gross"?z=P(te==null?void 0:te.birdies,te==null?void 0:te.pars,te==null?void 0:te.bogeys,h(te==null?void 0:te.doubles,0)+h(te==null?void 0:te.triplesPlus,0)):z=P(te==null?void 0:te.birdies,te==null?void 0:te.pars,te==null?void 0:te.bogeys,te==null?void 0:te.wipes);const Q=fe||{};return!Number.isFinite(z.birdiePlusRate)&&Number.isFinite(Q.birdiePlusRate)&&(z.birdiePlusRate=Q.birdiePlusRate),!Number.isFinite(z.parRate)&&Number.isFinite(Q.parRate)&&(z.parRate=Q.parRate),!Number.isFinite(z.bogeyRate)&&Number.isFinite(Q.bogeyRate)&&(z.bogeyRate=Q.bogeyRate),!Number.isFinite(z.badRate)&&Number.isFinite(Q.badRate)&&(z.badRate=Q.badRate),z}catch{}return fe})();let ie={birdiePlusRate:NaN,parRate:NaN,bogeyRate:NaN,badRate:NaN};try{String(d)==="gross"?ie={birdiePlusRate:me?pe(Z==null?void 0:Z.birdies,0)/me:NaN,parRate:me?pe(Z==null?void 0:Z.pars,0)/me:NaN,bogeyRate:me?pe(Z==null?void 0:Z.bogeys,0)/me:NaN,badRate:me?(pe(Z==null?void 0:Z.doubles,0)+pe(Z==null?void 0:Z.triplesPlus,0))/me:NaN}:ie={birdiePlusRate:me?pe(Z==null?void 0:Z.birdies,0)/me:NaN,parRate:me?pe(Z==null?void 0:Z.pars,0)/me:NaN,bogeyRate:me?pe(Z==null?void 0:Z.bogeys,0)/me:NaN,badRate:me?pe(Z==null?void 0:Z.wipes,NaN)/me:NaN};const h=(Array.isArray(I)?I:[]).flatMap(ne=>Array.isArray(ne==null?void 0:ne.roundSeries)?ne.roundSeries:J(ne==null?void 0:ne.series)),P=Za({scoringMode:d,windowSeries:h})||{},z=(ne,le)=>!Number.isFinite(ne)||ne===0&&me>0&&pe(le,0)===0;z(ie.birdiePlusRate,Z==null?void 0:Z.birdies)&&Number.isFinite(P.birdiePlusRate)&&(ie.birdiePlusRate=P.birdiePlusRate),z(ie.parRate,Z==null?void 0:Z.pars)&&Number.isFinite(P.parRate)&&(ie.parRate=P.parRate),z(ie.bogeyRate,Z==null?void 0:Z.bogeys)&&Number.isFinite(P.bogeyRate)&&(ie.bogeyRate=P.bogeyRate);const Q=String(d)==="gross"?pe(Z==null?void 0:Z.doubles,0)+pe(Z==null?void 0:Z.triplesPlus,0):pe(Z==null?void 0:Z.wipes,0);z(ie.badRate,Q)&&Number.isFinite(P.badRate)&&(ie.badRate=P.badRate)}catch{}pe(re==null?void 0:re.badRate,NaN),pe(ie==null?void 0:ie.badRate,NaN),pe(re==null?void 0:re.bogeyRate,NaN),pe(ie==null?void 0:ie.bogeyRate,NaN);const St=h=>{const P=Number(h);return Number.isFinite(P)?(P>0?"+":"")+P.toFixed(Math.abs(P)<.01&&P!==0?3:2):"‚Äî"},Gt=D&&Number.isFinite(Number(l==null?void 0:l.avgPts))?Number(l.avgPts):b(wt.map(h=>pe(h==null?void 0:h.pts,NaN))),ge=D&&Number.isFinite(Number(l==null?void 0:l.avgGross))?Number(l.avgGross):b(wt.map(h=>pe(h==null?void 0:h.gross,NaN))),$t=h=>{const P=h&&(h.perHole||h.perHolePts||h.pointsPerHole||h.ptsPerHole||h.stablefordPerHole||h.stablefordHoles)||null;return Array.isArray(P)?P.map(z=>pe(z,NaN)):null},Qt=h=>{const P=h&&(h.grossPerHole||h.grossHoles||h.holeGross||h.grossesPerHole)||null;return Array.isArray(P)?P.map(z=>pe(z,NaN)):null},Rt=h=>{const P=h&&(h.yardsPerHole||h.yardsHoles||h.holeYards||h.yards)||null;return Array.isArray(P)?P.map(z=>pe(z,NaN)):null},ps=(()=>{let h=0,P=0,z=0,Q=0,ne=0,le=0;for(const Ee of wt||[]){const be=ia(Ee),Ne=Array.isArray(be==null?void 0:be.pArr)?be.pArr:null,_e=Array.isArray(be==null?void 0:be.sArr)?be.sArr:null,rt=$t(Ee),nt=Qt(Ee),et=Math.max(Array.isArray(Ne)?Ne.length:0,Array.isArray(_e)?_e.length:0,Array.isArray(rt)?rt.length:0,Array.isArray(nt)?nt.length:0,0);for(let Pe=0;Pe<et;Pe++)if(String(d)==="gross"){if(!Array.isArray(Ne)||!Array.isArray(_e)||!Array.isArray(nt))continue;const it=pe(nt[Pe],NaN),Xe=pe(Ne[Pe],NaN),kt=pe(_e[Pe],NaN);if(!Number.isFinite(it)||!Number.isFinite(Xe)||!Number.isFinite(kt))continue;const Ot=Math.round(pe((Ee==null?void 0:Ee.hcap)??(Ee==null?void 0:Ee.playingHcap)??(Ee==null?void 0:Ee.startExact)??(Ee==null?void 0:Ee.handicap)??(n==null?void 0:n.playingHcap)??(n==null?void 0:n.startExact)??(n==null?void 0:n.handicap)??NaN,NaN)),gs=fa(Ot,kt),Et=Xe+gs,Es=it-Xe,ss=it-Et;z+=Es,Q++,ne+=ss,le++}else{if(!Array.isArray(rt))continue;const it=pe(rt[Pe],NaN);if(!Number.isFinite(it))continue;const Xe=it-2;h+=it,P++,ne+=Xe,le++}}return{ptsPH:P?h/P:NaN,strOverPH:Q?z/Q:NaN,deltaPH:le?ne/le:NaN}})(),es=h=>{let P=0,z=0,Q=0,ne=0,le=0,Ee=0;for(const be of wt||[]){const Ne=ia(be),_e=Array.isArray(Ne==null?void 0:Ne.pArr)?Ne.pArr:null,rt=Array.isArray(Ne==null?void 0:Ne.sArr)?Ne.sArr:null,nt=$t(be),et=Qt(be);for(const Pe of h){const it=Pe;if(String(d)==="gross"){if(!Array.isArray(_e)||!Array.isArray(rt)||!Array.isArray(et)||it>=et.length||it>=_e.length||it>=rt.length)continue;const Xe=pe(et[it],NaN),kt=pe(_e[it],NaN),Ot=pe(rt[it],NaN);if(!Number.isFinite(Xe)||!Number.isFinite(kt)||!Number.isFinite(Ot))continue;const gs=Math.round(pe((be==null?void 0:be.hcap)??(be==null?void 0:be.playingHcap)??(be==null?void 0:be.startExact)??(be==null?void 0:be.handicap)??(n==null?void 0:n.playingHcap)??(n==null?void 0:n.startExact)??(n==null?void 0:n.handicap)??NaN,NaN)),Et=fa(gs,Ot),Es=kt+Et;Q+=Xe-kt,ne++,le+=Xe-Es,Ee++}else{if(!Array.isArray(nt)||it>=nt.length)continue;const Xe=pe(nt[it],NaN);if(!Number.isFinite(Xe))continue;P+=Xe,z++,le+=Xe-2,Ee++}}}return{ptsPH:z?P/z:NaN,strOverPH:ne?Q/ne:NaN,deltaPH:Ee?le/Ee:NaN}},Ht=es([0,1,2,3,4,5,6,7,8]),Cs=es([9,10,11,12,13,14,15,16,17]),Ys=es([0,1,2]),Xs=es([15,16,17]),Us=(()=>{if(String(d)==="gross"){if(!Number.isFinite(Ht.strOverPH)||!Number.isFinite(Cs.strOverPH))return"‚Äî";const h=Ht.strOverPH-Cs.strOverPH;return Math.abs(h)<.05?"Front and back 9 are basically even.":h>0?`You score better on the back 9 (front is +${Math.abs(h).toFixed(2)} str/h worse).`:`You score better on the front 9 (back is +${Math.abs(h).toFixed(2)} str/h worse).`}else{if(!Number.isFinite(Ht.ptsPH)||!Number.isFinite(Cs.ptsPH))return"‚Äî";const h=Ht.ptsPH-Cs.ptsPH;return Math.abs(h)<.05?"Front and back 9 are basically even.":h>0?`You score stronger on the front 9 (+${Math.abs(h).toFixed(2)} pts/h).`:`You score stronger on the back 9 (+${Math.abs(h).toFixed(2)} pts/h).`}})(),Qs=D&&(l!=null&&l.fastStartPP)?l.fastStartPP:(()=>{const h=String(d)==="gross"?ps.strOverPH:ps.ptsPH,P=String(d)==="gross"?Ys.strOverPH:Ys.ptsPH;if(!Number.isFinite(h)||!Number.isFinite(P))return{is:null,delta:NaN};const z=P-h;return{is:String(d)==="gross"?z<=-.1:z>=.1,delta:z,v:P,base:h}})(),ea=D&&(l!=null&&l.clutchFinishPP)?l.clutchFinishPP:(()=>{const h=String(d)==="gross"?ps.strOverPH:ps.ptsPH,P=String(d)==="gross"?Xs.strOverPH:Xs.ptsPH;if(!Number.isFinite(h)||!Number.isFinite(P))return{is:null,delta:NaN};const z=P-h;return{is:String(d)==="gross"?z<=-.1:z>=.1,delta:z,v:P,base:h}})(),_s=D&&(l!=null&&l.afterBadHolePP)?{ok:!0,...l.afterBadHolePP}:(()=>{const h=String(d)==="gross";let P=0,z=0,Q=0,ne=0,le=0;const Ee=ps.ptsPH,be=ps.deltaPH;for(const et of wt||[]){const Pe=ia(et),it=Array.isArray(Pe==null?void 0:Pe.pArr)?Pe.pArr:null,Xe=Array.isArray(Pe==null?void 0:Pe.sArr)?Pe.sArr:null,kt=$t(et),Ot=Qt(et),gs=Math.max(Array.isArray(kt)?kt.length:0,Array.isArray(Ot)?Ot.length:0,Array.isArray(it)?it.length:0,Array.isArray(Xe)?Xe.length:0);for(let Et=0;Et<gs-1;Et++){let Es=!1;if(h){if(!Array.isArray(it)||!Array.isArray(Xe)||!Array.isArray(Ot)||Et>=Ot.length||Et>=it.length||Et>=Xe.length)continue;const ss=pe(Ot[Et],NaN),Bt=pe(it[Et],NaN),ws=pe(Xe[Et],NaN);if(!Number.isFinite(ss)||!Number.isFinite(Bt)||!Number.isFinite(ws))continue;const zs=Math.round(pe((et==null?void 0:et.hcap)??(et==null?void 0:et.playingHcap)??(et==null?void 0:et.startExact)??(et==null?void 0:et.handicap)??(n==null?void 0:n.playingHcap)??(n==null?void 0:n.startExact)??(n==null?void 0:n.handicap)??NaN,NaN)),ma=fa(zs,ws),Is=Bt+ma;ss-Is>=2&&(Es=!0)}else{if(!Array.isArray(kt))continue;const ss=pe(kt[Et],NaN);if(!Number.isFinite(ss))continue;ss-2<=-2&&(Es=!0)}if(Es)if(P++,h){if(!Array.isArray(it)||!Array.isArray(Xe)||!Array.isArray(Ot)||Et+1>=Ot.length||Et+1>=it.length||Et+1>=Xe.length)continue;const ss=pe(Ot[Et+1],NaN),Bt=pe(it[Et+1],NaN),ws=pe(Xe[Et+1],NaN);if(!Number.isFinite(ss)||!Number.isFinite(Bt)||!Number.isFinite(ws))continue;const zs=Math.round(pe((et==null?void 0:et.hcap)??(et==null?void 0:et.playingHcap)??(et==null?void 0:et.startExact)??(et==null?void 0:et.handicap)??(n==null?void 0:n.playingHcap)??(n==null?void 0:n.startExact)??(n==null?void 0:n.handicap)??NaN,NaN)),ma=fa(zs,ws),Is=Bt+ma,ta=ss-Is;ne+=ta,le++}else{if(!Array.isArray(kt)||Et+1>=kt.length)continue;const ss=pe(kt[Et+1],NaN);if(!Number.isFinite(ss))continue;z+=ss,Q++,ne+=ss-2,le++}}}if(!P||(h?!le:!Q))return{ok:!1,triggers:P};const Ne=!h&&Number.isFinite(Ee)&&Q?z/Q-Ee:NaN,_e=h&&Number.isFinite(be)&&le?ne/le-be:NaN,rt=h?Number.isFinite(_e)?_e<=-.25?"Ice cold":_e<=-.1?"Resilient":_e>=.25?"Spiraler":_e>=.1?"Wobbly":"Neutral":"‚Äî":Number.isFinite(Ne)?Ne>=.25?"Ice cold":Ne>=.1?"Resilient":Ne<=-.25?"Spiraler":Ne<=-.1?"Wobbly":"Neutral":"‚Äî",nt=h?Number.isFinite(_e)?_e<=-.25?"You bounce back strongly ‚Äî that‚Äôs a scoring superpower.":_e<=-.1?"You recover well ‚Äî you don‚Äôt tend to carry mistakes forward.":_e>=.25?"You often follow a bad hole with another bad one ‚Äî reset routine needed.":_e>=.1?"Small dip after mistakes ‚Äî worth tightening your reset.":"You return to normal golf after a mistake.":"Not enough data.":Number.isFinite(Ne)?Ne>=.25?"You bounce back strongly ‚Äî that‚Äôs a scoring superpower.":Ne>=.1?"You recover well ‚Äî you don‚Äôt tend to carry mistakes forward.":Ne<=-.25?"You often follow a bad hole with another bad one ‚Äî reset routine needed.":Ne<=-.1?"Small dip after mistakes ‚Äî worth tightening your reset.":"You return to normal golf after a mistake.":"Not enough data.";return{ok:!0,label:rt,triggers:P,resiliencePts:Ne,resilienceStr:_e,summary:nt}})(),ha=D&&(l!=null&&l.fixThisPP)?l.fixThisPP:(()=>{const h=Array.isArray(wt)?wt:[],P=String(d)==="gross",z=P?"strokes/round":"pts/round";if(!h.length)return{status:"none",title:"NOTHING OBVIOUS TO FIX",headline:"No real weaknesses identified.",gain:NaN,unit:z};const Q={easy:{key:"easy",label:"Stop leaking on easy holes (SI 13‚Äì18)",sumLeak:0,holes:0,rounds:0},hard:{key:"hard",label:"Reduce big numbers on hard holes (SI 1‚Äì6)",sumLeak:0,holes:0,rounds:0},p3:{key:"p3",label:"Par 3s are costing you",sumLeak:0,holes:0,rounds:0},p5:{key:"p5",label:"You‚Äôre not scoring on par 5s",sumLeak:0,holes:0,rounds:0},longP4:{key:"longP4",label:"Long par 4s (411y+) hurt you",sumLeak:0,holes:0,rounds:0}},ne=(Pe,it)=>{if(!Number.isFinite(it))return;const Xe=P?it:-it;Pe.sumLeak+=Xe,Pe.holes+=1};for(const Pe of h){const it=ia(Pe),Xe=Array.isArray(it==null?void 0:it.pArr)?it.pArr:[],kt=Array.isArray(it==null?void 0:it.sArr)?it.sArr:[],Ot=Rt(Pe)||[],gs=$t(Pe),Et=Qt(Pe),Es=Math.max(Xe.length,kt.length,Ot.length,gs?gs.length:0,Et?Et.length:0,18);let ss={easy:!1,hard:!1,p3:!1,p5:!1,longP4:!1};for(let Bt=0;Bt<Es;Bt++){const ws=pe(Xe[Bt],NaN),zs=pe(kt[Bt],NaN),ma=pe(Ot[Bt],NaN);let Is=NaN;if(P){if(!Array.isArray(Et)||!Array.isArray(Xe)||!Array.isArray(kt)||Bt>=Et.length||Bt>=Xe.length||Bt>=kt.length)continue;const ta=pe(Et[Bt],NaN),ja=pe(Xe[Bt],NaN),Vs=pe(kt[Bt],NaN);if(!Number.isFinite(ta)||!Number.isFinite(ja)||!Number.isFinite(Vs))continue;const sa=Math.round(pe((Pe==null?void 0:Pe.hcap)??(Pe==null?void 0:Pe.playingHcap)??(Pe==null?void 0:Pe.startExact)??(Pe==null?void 0:Pe.handicap)??(n==null?void 0:n.playingHcap)??(n==null?void 0:n.startExact)??(n==null?void 0:n.handicap)??NaN,NaN)),xs=fa(sa,Vs),bs=ja+xs;Is=ta-bs}else{if(!Array.isArray(gs)||Bt>=gs.length)continue;const ta=pe(gs[Bt],NaN);if(!Number.isFinite(ta))continue;Is=ta-2}Number.isFinite(zs)&&zs>=13&&zs<=18&&(ne(Q.easy,Is),ss.easy=!0),Number.isFinite(zs)&&zs>=1&&zs<=6&&(ne(Q.hard,Is),ss.hard=!0),Number.isFinite(ws)&&ws===3&&(ne(Q.p3,Is),ss.p3=!0),Number.isFinite(ws)&&ws===5&&(ne(Q.p5,Is),ss.p5=!0),Number.isFinite(ws)&&ws===4&&Number.isFinite(ma)&&ma>=411&&(ne(Q.longP4,Is),ss.longP4=!0)}Object.keys(ss).forEach(Bt=>{ss[Bt]&&(Q[Bt].rounds+=1)})}const le=Object.values(Q).map(Pe=>{if(!Pe.holes)return{...Pe,gain:NaN};const it=Pe.sumLeak/Pe.holes,Xe=Pe.rounds?Pe.holes/Pe.rounds:NaN,kt=Number.isFinite(Xe)?it*Xe:NaN;return{...Pe,gain:kt}}),Ee=18,be=P?.7:1.4,Ne=le.filter(Pe=>Number.isFinite(Pe.gain)&&Pe.holes>=Ee&&Pe.gain>=be).sort((Pe,it)=>(it.gain||0)-(Pe.gain||0));if(!Ne.length)return{status:"none",title:"NOTHING OBVIOUS TO FIX",headline:"No real weaknesses identified.",gain:NaN,unit:z};const _e=Ne[0],nt=(Pe=>{if(!Number.isFinite(Pe))return NaN;const it=Math.max(.5,Math.min(3.5,Pe));return Math.round(it*2)/2})(_e.gain),et=`${_e.label} ‚Üí gain ~${Number.isFinite(nt)?nt.toFixed(1):"‚Äî"} ${z}`;return{status:"fix",title:"FIX THIS",key:_e.key,headline:et,gain:nt,unit:z}})(),Ws=D&&l&&l.archetypePP?l.archetypePP:(()=>{const h=String(d)==="gross",P={easy:{name:"The Waster",key:"easy",sum:0,n:0},hard:{name:"The Survivor",key:"hard",sum:0,n:0},p3:{name:"The Par 3 Victim",key:"p3",sum:0,n:0},p5:{name:"The Par 5 hacker",key:"p5",sum:0,n:0}};for(const ne of wt||[]){const le=ia(ne),Ee=Array.isArray(le==null?void 0:le.pArr)?le.pArr:[],be=Array.isArray(le==null?void 0:le.sArr)?le.sArr:[],Ne=$t(ne),_e=Qt(ne),rt=Math.max(Ee.length,be.length,Ne?Ne.length:0,_e?_e.length:0,18);for(let nt=0;nt<rt;nt++){const et=pe(Ee[nt],NaN),Pe=pe(be[nt],NaN);let it=NaN;if(h){if(!Array.isArray(_e)||nt>=_e.length||nt>=Ee.length||nt>=be.length)continue;const Xe=pe(_e[nt],NaN),kt=pe(Ee[nt],NaN),Ot=pe(be[nt],NaN);if(!Number.isFinite(Xe)||!Number.isFinite(kt)||!Number.isFinite(Ot))continue;const gs=Math.round(pe((ne==null?void 0:ne.hcap)??(ne==null?void 0:ne.playingHcap)??(ne==null?void 0:ne.startExact)??(ne==null?void 0:ne.handicap)??(n==null?void 0:n.playingHcap)??(n==null?void 0:n.startExact)??(n==null?void 0:n.handicap)??NaN,NaN)),Et=fa(gs,Ot),Es=kt+Et;it=Xe-Es}else{if(!Array.isArray(Ne)||nt>=Ne.length)continue;const Xe=pe(Ne[nt],NaN);if(!Number.isFinite(Xe))continue;it=Xe-2}Number.isFinite(Pe)&&Pe>=13&&Pe<=18&&(P.easy.sum+=it,P.easy.n++),Number.isFinite(Pe)&&Pe>=1&&Pe<=6&&(P.hard.sum+=it,P.hard.n++),Number.isFinite(et)&&et===3&&(P.p3.sum+=it,P.p3.n++),Number.isFinite(et)&&et===5&&(P.p5.sum+=it,P.p5.n++)}}const z=Object.values(P).filter(ne=>ne.n>=18).map(ne=>({...ne,avg:ne.sum/ne.n}));if(!z.length)return{name:"No clear pattern yet",key:"none"};z.sort((ne,le)=>h?le.avg-ne.avg:ne.avg-le.avg);const Q=z[0];return{name:Q.name,key:Q.key,avg:Q.avg,n:Q.n}})(),ba=D&&l&&l.comfortZonePP&&Array.isArray(l.comfortZonePP.p4)?l.comfortZonePP.p4:(()=>{const h=String(d)==="gross",P=[{label:"<360y",sum:0,n:0},{label:"360‚Äì410y",sum:0,n:0},{label:"411y+",sum:0,n:0}];for(const Q of wt||[]){const ne=ia(Q),le=Array.isArray(ne==null?void 0:ne.pArr)?ne.pArr:[],Ee=Array.isArray(ne==null?void 0:ne.sArr)?ne.sArr:[],be=Rt(Q)||[],Ne=$t(Q),_e=Qt(Q),rt=Math.max(le.length,be.length,Ne?Ne.length:0,_e?_e.length:0,18);for(let nt=0;nt<rt;nt++){const et=pe(le[nt],NaN),Pe=pe(be[nt],NaN);if(!(Number.isFinite(et)&&et===4&&Number.isFinite(Pe)))continue;let it=NaN;if(h){if(!Array.isArray(_e)||nt>=_e.length||nt>=le.length||nt>=Ee.length)continue;const kt=pe(_e[nt],NaN),Ot=pe(le[nt],NaN),gs=pe(Ee[nt],NaN);if(!Number.isFinite(kt)||!Number.isFinite(Ot)||!Number.isFinite(gs))continue;const Et=Math.round(pe((Q==null?void 0:Q.hcap)??(Q==null?void 0:Q.playingHcap)??(Q==null?void 0:Q.startExact)??(Q==null?void 0:Q.handicap)??(n==null?void 0:n.playingHcap)??(n==null?void 0:n.startExact)??(n==null?void 0:n.handicap)??NaN,NaN)),Es=fa(Et,gs),ss=Ot+Es;it=kt-ss}else{if(!Array.isArray(Ne)||nt>=Ne.length)continue;const kt=pe(Ne[nt],NaN);if(!Number.isFinite(kt))continue;it=kt-2}const Xe=Pe<360?P[0]:Pe<=410?P[1]:P[2];Xe.sum+=it,Xe.n++}}return P.map(Q=>({...Q,avg:Q.n?Q.sum/Q.n:NaN}))})(),da=[{label:"Holes 1‚Äì6",idxs:[0,1,2,3,4,5],m:es([0,1,2,3,4,5])},{label:"Holes 7‚Äì12",idxs:[6,7,8,9,10,11],m:es([6,7,8,9,10,11])},{label:"Holes 13‚Äì18",idxs:[12,13,14,15,16,17],m:es([12,13,14,15,16,17])}].map(P=>({label:P.label,deltaPH:P.m.deltaPH}));function Xt(h,P=3){const z=(h||[]).map(Q=>{const ne=Number(Q.playerAvg),le=Number(Q.fieldAvg),be=-(V?le-ne:ne-le);return{label:Q.label,holes:Q.holes,me:Q.playerAvg,fld:Q.fieldAvg,bad:be}}).filter(Q=>Number.isFinite(Q.bad)&&pe(Q.holes,0)>=12);return z.sort((Q,ne)=>ne.bad-Q.bad),z.slice(0,P)}[...Xt(W,2),...Xt(de,2),...Xt(Te,3)].sort((h,P)=>P.bad-h.bad).slice(0,3),`${vs((n==null?void 0:n.name)||a||"Player")}`,`${vs(r||"All years")}`;let Ms="Season Finale",qt="";try{const h=Array.isArray(xe)?xe:[],P=h.length?h[h.length-1]:null;if(P){Ms=String((P==null?void 0:P.eventName)||(P==null?void 0:P.event)||(P==null?void 0:P.competition)||(P==null?void 0:P.name)||(P==null?void 0:P.course)||"Season Finale");const z=(P==null?void 0:P.date)||(P==null?void 0:P.roundDate)||(P==null?void 0:P.playedAt)||(P==null?void 0:P.played_on)||(P==null?void 0:P.ts)||"",Q=new Date(z);qt=z?isNaN(Q.getTime())?String(z):Q.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}):""}}catch{}const cs=h=>{const P=Number.isFinite(h==null?void 0:h.me)?h.me:Number.isFinite(h==null?void 0:h.playerAvg)?h.playerAvg:NaN,z=Number.isFinite(h==null?void 0:h.peer)?h.peer:Number.isFinite(h==null?void 0:h.fieldAvg)?h.fieldAvg:NaN;return!Number.isFinite(P)||!Number.isFinite(z)?NaN:V?z-P:P-z},Lt=h=>Number.isFinite(h==null?void 0:h.me)?h.me:Number.isFinite(h==null?void 0:h.playerAvg)?h.playerAvg:NaN,pa=[].concat(W||[],de||[],Te||[]),Mt=pa.map(h=>({...h,delta:Number.isFinite(h==null?void 0:h.delta)?h.delta:cs(h)})).filter(h=>Number.isFinite(h.delta));let st=null,Be=null;if(C==="par"){const h=pa.map(P=>({...P,meAbs:Lt(P)})).filter(P=>Number.isFinite(P.meAbs));st=h.slice().sort((P,z)=>P.meAbs-z.meAbs)[0]||null,Be=h.slice().sort((P,z)=>z.meAbs-P.meAbs)[0]||null}else st=Mt.slice().sort((h,P)=>P.delta-h.delta)[0]||null,Be=Mt.slice().sort((h,P)=>h.delta-P.delta)[0]||null;const Pt=`
  <style>
    .PRr{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#0f172a}
    .PRh1{font-size:22px;font-weight:950;margin:0 0 6px}
    .PRsub{color:#475569;font-size:13px;margin:0 0 14px}
    .PRbox{border:1px solid #e5e7eb;border-radius:14px;padding:12px 14px;background:#fff}
    .PRgrid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
    .PRsec{margin-top:14px}
    .PRsecTitle{font-weight:950;margin:0 0 8px;font-size:14px;letter-spacing:.04em;text-transform:uppercase;color:#0f172a}
    .PRk{font-size:12px;color:#475569;text-transform:uppercase;letter-spacing:.06em}
    .PRv{font-size:18px;font-weight:950;margin-top:4px}
    .PRp{margin:8px 0;color:#0f172a;line-height:1.35}
    .PRmuted{color:#475569}
    .PRtbl{width:100%;border-collapse:collapse;table-layout:fixed;font-variant-numeric:tabular-nums}
    .PRtbl col.c1{width:40%}
    .PRtbl col.c2,.PRtbl col.c3,.PRtbl col.c4,.PRtbl col.c5{width:15%}
    .PRtbl th,.PRtbl td{padding:8px 10px;border-bottom:1px solid #e5e7eb}
    /* --- Table "good vs bad" clarity --- */
    .PRtbl tbody tr.PRrow.good td{background:rgba(16,185,129,0.06)}
    .PRtbl tbody tr.PRrow.bad td{background:rgba(244,63,94,0.06)}
    .PRtbl tbody tr.PRrow.neu td{background:transparent}
    .PRtbl tbody tr.PRrow td:first-child{font-weight:900}
    .PRtbl tbody tr.PRrow:hover td{filter:brightness(0.99)}
    .PRdeltaBadge{display:inline-flex;align-items:center;gap:6px;justify-content:flex-end;padding:4px 8px;border-radius:9999px;border:1px solid #e5e7eb;font-weight:950}
    .PRdeltaBadge.good{border-color:rgba(16,185,129,0.35);background:rgba(16,185,129,0.10);color:#065f46}
    .PRdeltaBadge.bad{border-color:rgba(244,63,94,0.35);background:rgba(244,63,94,0.10);color:#9f1239}
    .PRdeltaBadge.neu{border-color:rgba(100,116,139,0.25);background:rgba(148,163,184,0.12);color:#334155}
    .PRarr{font-size:10px;opacity:0.9}
    .PRlegend{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin:0 0 10px}
    .PRlegItem{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:9999px;border:1px solid #e5e7eb;font-size:11px;font-weight:900;color:#0f172a}
    .PRlegItem.good{border-color:rgba(16,185,129,0.30);background:rgba(16,185,129,0.08);color:#065f46}
    .PRlegItem.bad{border-color:rgba(244,63,94,0.30);background:rgba(244,63,94,0.08);color:#9f1239}
    .PRlegItem.neu{border-color:rgba(100,116,139,0.22);background:rgba(148,163,184,0.10);color:#334155}
    .PRlegDot{width:9px;height:9px;border-radius:9999px;background:currentColor;opacity:0.8}
    .PRlegNote{color:#475569;font-size:11px;font-weight:700}

    .PRtbl th:first-child,.PRtbl td:first-child{text-align:left;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .PRtbl th:not(:first-child),.PRtbl td:not(:first-child){text-align:right}
    .PRnote{font-size:12px;color:#475569;margin-top:10px}
    .PRpill{display:inline-block;border:1px solid #e5e7eb;border-radius:999px;padding:3px 8px;font-size:12px;color:#0f172a;background:#fff}
  </style>

  <div class="PRr">
    <div class="PRh1">Season Report: ${vs(a||"")}</div>
    <div class="PRsub">
      Benchmark: <b>${vs(g||"‚Äî")}</b>
      ¬∑ <b>${pe(jt,0)}</b> rounds
      ¬∑ <b>${pe(He,0)}</b> holes analysed
      <span class="PRpill" style="margin-left:8px;">${String(d)==="gross"?"Gross strokes":"Stableford points"} vs ${C==="par"?"Par baseline":C==="field"?"Field":"Handicap band"}</span>
      ${C==="par"?"":`<span class="PRpill" style="margin-left:8px;">Peers: <b>${m}</b>${Number.isFinite(c)&&Number.isFinite(o)?` ¬∑ Avg hcap range <b>${c.toFixed(1)}‚Äì${o.toFixed(1)}</b>`:""}</span>`}

</div>


<div class="PRbox PRsec">
  <div class="PRsecTitle">0. What this says about your game</div>

  <div style="display:grid; grid-template-columns: 1fr; gap:10px;">
    <p class="PRp">
      <b>Snapshot of current form (${pe(jt,0)} rounds):</b><br/>
      Average: <b>${Number.isFinite(Gt)?Gt.toFixed(1):"‚Äî"}</b> Stableford points /
      <b>${Number.isFinite(ge)?ge.toFixed(1):"‚Äî"}</b> strokes.
      <br/>
      Stableford rank: <b>${ce>0?ce:"‚Äî"}</b> of <b>${ot||"‚Äî"}</b>
      (${Number.isFinite(ke)?(ke>=0?"+":"")+ke.toFixed(1):"‚Äî"} pts vs field) ¬∑
      Gross rank: <b>${gt>0?gt:"‚Äî"}</b> of <b>${qe||"‚Äî"}</b>
      (${Number.isFinite(w)?(w>=0?"+":"")+w.toFixed(1):"‚Äî"} strokes vs field).
    </p>

    <p class="PRp">
      <b>Trend & consistency:</b><br/>
      ${vs(Kt)} ¬∑
      ${String(d)==="gross"?`œÉ <b>${Number.isFinite(Fe)?Fe.toFixed(1):"‚Äî"}</b> vs field <b>${Number.isFinite(fs)?fs.toFixed(1):"‚Äî"}</b>`:`œÉ <b>${Number.isFinite(Le)?Le.toFixed(1):"‚Äî"}</b> vs field <b>${Number.isFinite(Vt)?Vt.toFixed(1):"‚Äî"}</b>`}.
      <br/>
      ${vs(Us)}
      <br/>
      ${(Qs==null?void 0:Qs.is)===null?"":`Fast starter (holes 1‚Äì3): <b>${Qs.is?"Yes":"No"}</b> (${St(Qs.delta)} ${String(d)==="gross"?"str/h vs your avg":"pts/h vs your avg"}) ¬∑ `}
      ${(ea==null?void 0:ea.is)===null?"":`Clutch finisher (holes 16‚Äì18): <b>${ea.is?"Yes":"No"}</b> (${St(ea.delta)} ${String(d)==="gross"?"str/h vs your avg":"pts/h vs your avg"})`}
    </p>

    <p class="PRp">
      <b>After a bad hole (mental resilience):</b><br/>
      ${_s&&_s.ok?`${vs(_s.label)} ‚Äî Resilience score (next hole vs your average): <b>${String(d)==="gross"?`${St(_s.resilienceStr)} str`:`${St(_s.resiliencePts)} pts`}</b>. ${vs(_s.summary)}`:"Not enough data to score resilience."}
      ${_s&&_s.ok?`<span class="PRmuted"> (Based on ${pe(_s.triggers,0)} follow-ups after double+ holes.)</span>`:""}
    </p>

    <p class="PRp">
      <b>The single biggest fixable leak:</b><br/>
      ${(ha==null?void 0:ha.status)==="fix"?`<b>${vs(ha.headline)}</b>`:"<b>No real weaknesses identified</b> (in this window)."}
    </p>

    <p class="PRp">
      <b>Player archetype (pattern only):</b><br/>
      ${Ws!=null&&Ws.key&&Ws.key!=="none"?`<b>${vs(Ws.name)}</b>`:"Not enough data to confidently label a pattern."}
    </p>

    <p class="PRp">
      <b>Comfort zone yardage (Par 4s, vs expected):</b><br/>
      ${(()=>{const h=Array.isArray(ba)?ba:[];return h.some(Q=>Number.isFinite(Q.avg)&&pe(Q.n,0)>=10)?h.map(Q=>{const ne=Q.avg,le=Q.n||0;if(!Number.isFinite(ne)||le<10)return null;const Ee=String(d)==="gross"?St(ne)+" str vs expected":St(ne)+" pts vs expected";return`${vs(Q.label)}: <b>${Ee}</b> (n=${le})`}).filter(Boolean).join(" ¬∑ "):"Not enough data to break down Par 4 yardage reliably."})()}
    </p>

    <p class="PRp">
      <b>Golf DNA (round shape, vs expected):</b><br/>
      ${(()=>{const P=(Array.isArray(da)?da:[]).map(z=>{if(!Number.isFinite(z.deltaPH))return null;const Q=String(d)==="gross"?`${St(z.deltaPH)} str/h`:`${St(z.deltaPH)} pts/h`;return`${vs(z.label)}: <b>${Q}</b>`}).filter(Boolean);return P.length?P.join(" ¬∑ "):"‚Äî"})()}
    </p>

    <p class="PRp">
      <b>Where you beat the field / where you leak vs the field:</b><br/>
      ${C==="par"?"This section is shown only when benchmarking vs Field or Handicap band (not Par baseline).":`Best edge: <b>${vs((st==null?void 0:st.label)||"‚Äî")}</b> (${Number.isFinite(st==null?void 0:st.delta)?st.delta.toFixed(2):"‚Äî"} per hole) ¬∑ Biggest leak: <b>${vs((Be==null?void 0:Be.label)||"‚Äî")}</b> (${Number.isFinite(Be==null?void 0:Be.delta)?Be.delta.toFixed(2):"‚Äî"} per hole).`}
    </p>

  </div>

  <div class="PRnote">
    Everything above is generated from the same inputs the app has (Stableford/gross per hole, par, stroke index, yards, and handicaps).
    No shot-tracking assumptions.
  </div>
</div>
<div class="PRbox PRsec">
  <div class="PRsecTitle">1. The Season Headline</div>

      <p class="PRp">
  ${C==="par"?`
    <b>Scoring vs Par:</b>
    You average <b>${Number.isFinite(mt)?mt.toFixed(2):"‚Äî"}</b> strokes over par per hole (‚âà <b>${Number.isFinite(mt)?(mt*18).toFixed(1):"‚Äî"}</b> over par per 18 holes).
  `:`
    <b>Net Performance vs Peers:</b>
    ${Number.isFinite(xt)?V?xt>=0?`You average <b>${xt.toFixed(2)}</b> fewer strokes per hole than your peer group (‚âà <b>${(xt*18).toFixed(1)}</b> fewer strokes per 18 holes).`:`You average <b>${Math.abs(xt).toFixed(2)}</b> more strokes per hole than your peer group (‚âà <b>${(Math.abs(xt)*18).toFixed(1)}</b> more strokes per 18 holes).`:xt>=0?`You score <b>${xt.toFixed(2)}</b> more Stableford points per hole than your peer group (‚âà <b>${(xt*18).toFixed(1)}</b> more points per 18 holes).`:`You score <b>${Math.abs(xt).toFixed(2)}</b> fewer Stableford points per hole than your peer group (‚âà <b>${(Math.abs(xt)*18).toFixed(1)}</b> fewer points per 18 holes).`:"‚Äî"}
  `}
</p>
      <p class="PRp">
  <b>Scoring Average:</b>
  ${C==="par"?`
    Your scoring average is <b>${Number.isFinite(mt)?mt.toFixed(2):"‚Äî"}</b> strokes over par per hole.
  `:`
    ${V?`Your scoring average is <b>${Number.isFinite(mt)?mt.toFixed(2):"‚Äî"}</b> strokes over par per hole, compared to a peer average of <b>${Number.isFinite(vt)?vt.toFixed(2):"‚Äî"}</b> over par.`:`Your scoring average is <b>${Number.isFinite(mt)?mt.toFixed(2):"‚Äî"}</b> Stableford points per hole (‚âà <b>${Number.isFinite(mt)?(mt*18).toFixed(1):"‚Äî"}</b> points per 18 holes), compared to a peer average of <b>${Number.isFinite(vt)?vt.toFixed(2):"‚Äî"}</b> points per hole.`}
  `}
</p>
      <p class="PRp">
  <b>Scoring Profile:</b>
  ${C==="par"?`
    Birdie+ rate <b>${Number.isFinite(re==null?void 0:re.birdiePlusRate)?(re.birdiePlusRate*100).toFixed(1)+"%":"‚Äî"}</b> ¬∑
    Damage (Double+) <b>${Number.isFinite(re==null?void 0:re.badRate)?(re.badRate*100).toFixed(1)+"%":"‚Äî"}</b>.
    <span class="PRmuted">Damage usually provides the biggest scoring lever in absolute terms.</span>
  `:`
    Birdie+ rate <b>${Number.isFinite(re==null?void 0:re.birdiePlusRate)?(re.birdiePlusRate*100).toFixed(1)+"%":"‚Äî"}</b> (Peers:
    <b>${Number.isFinite(ie==null?void 0:ie.birdiePlusRate)?(ie.birdiePlusRate*100).toFixed(1)+"%":"‚Äî"}</b>) ¬∑
    Damage (Double+) <b>${Number.isFinite(re==null?void 0:re.badRate)?(re.badRate*100).toFixed(1)+"%":"‚Äî"}</b> (Peers:
    <b>${Number.isFinite(ie==null?void 0:ie.badRate)?(ie.badRate*100).toFixed(1)+"%":"‚Äî"}</b>).
    ${Number.isFinite(re==null?void 0:re.birdiePlusRate)&&Number.isFinite(ie==null?void 0:ie.birdiePlusRate)&&Number.isFinite(re==null?void 0:re.badRate)&&Number.isFinite(ie==null?void 0:ie.badRate)&&Math.abs((re.birdiePlusRate-ie.birdiePlusRate)*100)<2&&(re.badRate-ie.badRate)*100!==0?'<span class="PRmuted">This indicates that your net performance vs peers is driven more by Damage (double+) frequency than by Birdie+ frequency.</span>':" "}
  `}
</p>
      <div class="PRnote">All values are based on ${String(d)==="gross"?"gross strokes":"Stableford points"}, benchmarked against the selected comparator (${C==="par"?"Par baseline":C==="field"?"Field":"Handicap band"}).</div>
    </div>

    <div class="PRbox PRsec">
      <div class="PRsecTitle">2. Performance Insights</div>
      <p class="PRp">
        <b>Primary Strength:</b>
        ${C==="par"?`
          Your best scoring is in <b>${vs((st==null?void 0:st.label)||(st==null?void 0:st.key)||"‚Äî")}</b>, where you average <b>${Number.isFinite(Lt(st))?Lt(st).toFixed(2):"‚Äî"}</b> strokes over par per hole.
        `:`
          Your biggest advantage is in <b>${vs((st==null?void 0:st.label)||(st==null?void 0:st.key)||"‚Äî")}</b>, where you gain <b>${Number.isFinite(st==null?void 0:st.delta)?st.delta.toFixed(2):"‚Äî"}</b> strokes per hole over peers.
        `}
      </p>
      <p class="PRp">
        <b>The Focus Leak:</b>
        ${C==="par"?`
          Your worst scoring is in <b>${vs((Be==null?void 0:Be.label)||(Be==null?void 0:Be.key)||"‚Äî")}</b>, where you average <b>${Number.isFinite(Lt(Be))?Lt(Be).toFixed(2):"‚Äî"}</b> strokes over par per hole.
        `:`
          Your primary area for improvement is <b>${vs((Be==null?void 0:Be.label)||(Be==null?void 0:Be.key)||"‚Äî")}</b>, costing <b>${Number.isFinite(Be==null?void 0:Be.delta)?Be.delta.toFixed(2):"‚Äî"}</b> strokes per hole compared to your handicap cohort.
        `}
      </p>
      <p class="PRp">
  <b>Biggest Stroke Lever:</b>
  ${C==="par"?`
    Damage (double+) occurs <b>${Number.isFinite(re==null?void 0:re.badRate)?(re.badRate*100).toFixed(1)+"%":"‚Äî"}</b> of the time. Cutting big numbers is usually the fastest way to lower your over‚Äëpar scoring.
  `:`
    ${(()=>{if(!Number.isFinite(re==null?void 0:re.badRate)||!Number.isFinite(ie==null?void 0:ie.badRate))return"‚Äî";const h=re.badRate,P=ie.badRate,z=(P-h)*100,Q=z>=0?"less often":"more often",ne=Math.abs(z),le=(h*100).toFixed(1),Ee=(P*100).toFixed(1),be=ne/100*18,Ne=z>=0?"fewer":"more",_e=z>=0?"saved":"lost";return`Damage (double+) occurs <b>${ne.toFixed(1)}% ${Q}</b> than peers (${le}% vs ${Ee}%), equivalent to ~<b>${be.toFixed(1)}</b> ${Ne} damage holes per 18 (strokes typically ${_e} are meaningful).`})()}
  `}
</p>
    </div>

    <div class="PRbox PRsec">
      <div class="PRsecTitle">3. The Evidence Locker</div>
      <div class="PRmuted" style="font-size:13px;margin-bottom:10px;">Raw peer-benchmarked tables used for the insights above.</div>

      <div style="margin-top:10px;font-weight:900;">By Stroke Index</div>
      ${ar(W,d,C)}

      <div style="margin-top:14px;font-weight:900;">By Par Type</div>
      ${ar(de,d,C)}

      <div style="margin-top:14px;font-weight:900;">By Yardage</div>
      ${ar(Te,d,C)}
    </div>
  </div>
  `;return{ok:!0,htmlFragment:Pt,html:Pt,filename:`SeasonReport_${jn(a||"player")}.html`}}function kn(s){const a=String(s||"Den Society League").trim();return`<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>${a} ‚Äî Golfer‚Äôs Guide</title>

  <style>
    :root{
      --card: rgba(255,255,255,.86);
      --shadowA: 0 1px 2px rgba(15,23,42,.06);
      --shadowB: 0 18px 46px rgba(15,23,42,.14);
      --shadowC: 0 10px 26px rgba(15,23,42,.10);
      --radius: 22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color: #0f172a;
      background:
        radial-gradient(1000px 600px at 0% 0%, rgba(16,185,129,.18), transparent 55%),
        radial-gradient(900px 600px at 100% 0%, rgba(99,102,241,.18), transparent 55%),
        radial-gradient(900px 600px at 50% 100%, rgba(244,63,94,.10), transparent 55%),
        linear-gradient(180deg, #f8fafc, #eef2ff 55%, #f8fafc);
      background-attachment: fixed;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .wrap{max-width:1100px; margin:0 auto; padding:20px 16px 70px;}
    .topbar{
      position: sticky; top: 0; z-index: 50;
      padding-top: env(safe-area-inset-top);
      backdrop-filter: blur(12px);
      background: rgba(255,255,255,.72);
      border-bottom: 1px solid rgba(148,163,184,.18);
    }
    .topbar-inner{
      max-width:1100px; margin:0 auto; padding:14px 16px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:12px; min-width:0;
    }
    .logo{
      width:42px; height:42px; border-radius:14px;
      background: linear-gradient(180deg, rgba(34,197,94,.35), rgba(25,159,87,.18));
      border:1px solid rgba(16,185,129,.35);
      box-shadow: var(--shadowA);
      display:grid; place-items:center;
      flex: 0 0 auto;
    }
    .logo svg{width:24px; height:24px}
    .brand h1{
      margin:0; line-height:1.05;
      font-weight: 900;
      letter-spacing: -.03em;
      font-size: 16px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .brand p{
      margin:3px 0 0;
      font-size: 12px;
      color: rgba(100,116,139,1);
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    .chips{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end}
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(16,185,129,.30);
      background: rgba(240,253,244,.70);
      font-size: 12px;
      font-weight: 800;
      box-shadow: var(--shadowA);
      cursor: pointer;
      user-select:none;
    }
    .chip:hover{transform: translateY(-1px)}
    .btn{
      border:0;
      padding: 10px 14px;
      border-radius: 999px;
      font-weight: 900;
      cursor:pointer;
      box-shadow: var(--shadowA), var(--shadowC);
    }
    .btn.primary{
      background: linear-gradient(180deg, #22c55e, #199f57);
      color:white;
      border: 1px solid rgba(20,127,71,.55);
    }
    .btn.ghost{
      background: rgba(255,255,255,.82);
      border: 1px solid rgba(148,163,184,.22);
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:14px;
    }
    @media (min-width: 920px){
      .grid{grid-template-columns: 1.2fr .8fr;}
    }

    .card{
      background: var(--card);
      border: 1px solid rgba(255,255,255,.6);
      border-radius: var(--radius);
      box-shadow: var(--shadowA), var(--shadowB);
      backdrop-filter: blur(12px);
      overflow:hidden;
    }
    .card.pad{padding:16px}
    @media (min-width: 720px){ .card.pad{padding:20px} }

    .hero{
      padding: 18px;
      background:
        radial-gradient(900px 300px at 0% 0%, rgba(16,185,129,.20), transparent 60%),
        radial-gradient(900px 300px at 100% 0%, rgba(99,102,241,.12), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.8), rgba(255,255,255,.66));
      border-bottom: 1px solid rgba(148,163,184,.18);
    }
    .kicker{
      font-size: 10px;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: rgba(100,116,139,1);
      font-weight: 900;
      display:flex; align-items:center; gap:10px;
    }
    .kicker .dot{
      width:10px; height:10px; border-radius:4px;
      background: rgba(99,102,241,.28);
      border: 1px solid rgba(99,102,241,.22);
    }
    .title{
      margin:10px 0 0;
      font-size: clamp(26px, 4.2vw, 44px);
      line-height: 1.05;
      font-weight: 950;
      letter-spacing: -.03em;
      color: #0b1220;
    }
    .subtitle{
      margin:10px 0 0;
      max-width: 70ch;
      font-size: 14px;
      color: rgba(71,85,105,1);
      line-height: 1.55;
    }
    .hero-actions{
      margin-top: 14px;
      display:flex; gap:10px; flex-wrap:wrap;
    }

    .statbar{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      padding: 14px 16px 16px;
      background: rgba(255,255,255,.58);
    }
    .stat{
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,.18);
      background: rgba(248,250,252,.85);
      padding: 12px 12px;
    }
    .stat .lbl{
      font-size: 10px;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: rgba(100,116,139,1);
      font-weight: 900;
    }
    .stat .val{
      margin-top:6px;
      font-size: 15px;
      font-weight: 950;
      letter-spacing: -.02em;
    }
    .stat .hint{
      margin-top:6px;
      font-size: 12px;
      color: rgba(100,116,139,1);
      line-height: 1.35;
    }

    .h2{
      margin:0;
      font-size: 14px;
      font-weight: 950;
      letter-spacing: -.01em;
      display:flex; align-items:center; gap:10px;
      flex-wrap: wrap;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 900;
      border: 1px solid rgba(148,163,184,.20);
      background: rgba(2,6,23,.04);
      color: rgba(15,23,42,.80);
    }
    .p{
      margin:10px 0 0;
      font-size: 13px;
      line-height: 1.6;
      color: rgba(51,65,85,1);
    }

    .list{
      margin:10px 0 0; padding:0; list-style:none;
      display:grid; gap:10px;
    }
    .li{
      display:flex; gap:12px;
      padding: 12px 12px;
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,.18);
      background: rgba(255,255,255,.70);
    }
    .ico{
      width:34px; height:34px;
      border-radius: 12px;
      display:grid; place-items:center;
      background: rgba(25,159,87,.10);
      border: 1px solid rgba(16,185,129,.22);
      flex: 0 0 auto;
      font-size: 16px;
    }
    .li b{display:block; font-size: 13px; font-weight: 950;}
    .li span{display:block; font-size: 12px; color: rgba(100,116,139,1); margin-top:4px; line-height:1.45;}

    .accordion{
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,.18);
      overflow:hidden;
      background: rgba(255,255,255,.72);
    }
    details{ border-top: 1px solid rgba(148,163,184,.14); }
    details:first-child{border-top:0}
    summary{
      cursor:pointer;
      padding: 12px 14px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      font-weight: 950;
      user-select:none;
    }
    summary::-webkit-details-marker{display:none}
    summary .meta{
      font-size: 11px;
      font-weight: 900;
      color: rgba(100,116,139,1);
      margin-top: 3px;
    }
    .sum-left{display:flex; align-items:flex-start; gap:10px}
    .caret{
      width: 28px; height: 28px;
      border-radius: 12px;
      display:grid; place-items:center;
      background: rgba(2,6,23,.04);
      border: 1px solid rgba(148,163,184,.18);
      flex: 0 0 auto;
    }
    .content{
      padding: 0 14px 14px;
      color: rgba(51,65,85,1);
      font-size: 13px;
      line-height: 1.6;
    }
    .content .mini{ margin-top: 10px; display:grid; gap:10px; }
    .callout{
      border-radius: 18px;
      border: 1px solid rgba(16,185,129,.25);
      background: rgba(240,253,244,.75);
      padding: 12px 12px;
    }
    .callout b{font-weight: 950}
    .callout p{margin:6px 0 0; font-size: 12px; color: rgba(71,85,105,1); line-height: 1.5;}
    .danger{
      border-color: rgba(244,63,94,.22);
      background: rgba(254,242,242,.70);
    }

    /* Badges */
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 950;
      letter-spacing: .01em;
      border: 1px solid rgba(148,163,184,.22);
      background: rgba(255,255,255,.82);
      color: rgba(15,23,42,.85);
      box-shadow: var(--shadowA);
      white-space: nowrap;
    }
    .badge .spark{opacity:.9}
    .badge.captain{
      border-color: rgba(99,102,241,.22);
      background: rgba(99,102,241,.10);
      color: rgba(55,48,163,1);
    }
    .badge.favourite{
      border-color: rgba(245,158,11,.26);
      background: rgba(245,158,11,.12);
      color: rgba(146,64,14,1);
    }
    .badge.hype{
      border-color: rgba(16,185,129,.26);
      background: rgba(16,185,129,.12);
      color: rgba(6,95,70,1);
    }

    .footer{
      margin-top: 16px;
      padding: 14px 16px;
      color: rgba(100,116,139,1);
      font-size: 12px;
      text-align:center;
    }

    /* Floating ‚ÄúStart here‚Äù */
    .fab{
      position: fixed;
      right: 16px;
      bottom: 16px;
      z-index: 999;
      display:flex; align-items:center; gap:10px;
      padding: 12px 14px;
      border-radius: 999px;
      background: rgba(17,24,39,.92);
      color:white;
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 16px 44px rgba(0,0,0,.22);
      backdrop-filter: blur(10px);
      cursor:pointer;
    }
    .fab:hover{transform: translateY(-1px)}

    .tagline{
      display:inline-flex; align-items:center; gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(99,102,241,.22);
      background: rgba(99,102,241,.10);
      color: rgba(55,48,163,1);
      font-size: 12px;
      font-weight: 900;
      margin-left: 10px;
      white-space: nowrap;
    }
  </style>

<!-- iPhone: run as a standalone (full-screen) web app when launched from Home Screen -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="${a}">

<!-- PWA manifest + app icons -->
<link rel="manifest" href="manifest.webmanifest">
<link rel="apple-touch-icon" href="icons/apple-touch-icon.png">

</head>

<body>
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M6 13c2.2 3.6 8.2 3.6 10.4-1.4" stroke="white" stroke-width="2.2" stroke-linecap="round"/>
            <circle cx="9" cy="9" r="1.7" fill="white"/>
            <circle cx="15" cy="9" r="1.7" fill="white"/>
          </svg>
        </div>
        <div style="min-width:0">
          <h1>${a} ‚Äî Golfer‚Äôs Guide</h1>
          <p>What it does ‚Ä¢ How to use it ‚Ä¢ How it actually drops your scores</p>
        </div>
      </div>

      <div class="chips" aria-label="Quick navigation">
        <button class="chip" data-jump="#what"><span aria-hidden="true">üß≠</span>What is it?</button>
        <button class="chip" data-jump="#how"><span aria-hidden="true">‚ö°</span>Quick start</button>
        <button class="chip" data-jump="#improve-hub"><span aria-hidden="true">üß†</span>Improve tools</button>
        <button class="chip" data-jump="#views"><span aria-hidden="true">üß©</span>Menu map</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="card">
      <div class="hero">
        <div class="kicker"><span class="dot" aria-hidden="true"></span>ONE-FILE LEAGUE + ANALYTICS <span class="tagline">‚ÄúSports broadcast‚Äù vibe</span></div>
        <h2 class="title">Turn your society golf into <br/>a scoreboard, a story... and a plan.</h2>
        <p class="subtitle">
          Load a <b>Squabbit event game</b> and the app builds leaderboards, scorecards, course insights, season standings,
          and the fun stuff (Replay, Teams, Banter, Casino, Trophies).
          It‚Äôs designed for golfers: <b>simple, punchy, and brutally useful.</b>
        </p>

        <div class="hero-actions">
          <button class="btn primary" data-jump="#how">Start in 60 seconds</button>
          <button class="btn ghost" data-jump="#improve-hub">How it helps you improve</button>
          <button class="btn ghost" data-jump="#views">What screens exist?</button>
        </div>
      </div>

      <div class="statbar" id="what">
        <div class="stat">
          <div class="lbl">What it replaces</div>
          <div class="val">Spreadsheets + vibes</div>
          <div class="hint">No more ‚ÄúI think I‚Äôm bad on par 3s‚Äù ‚Äî it shows it.</div>
        </div>
        <div class="stat">
          <div class="lbl">What it creates</div>
          <div class="val">Decisions</div>
          <div class="hint">Where you win, where you leak, and what to do next.</div>
        </div>
      </div>
    </section>

    <div class="grid" style="margin-top:14px">
      <section class="card pad" id="how">
        <h3 class="h2">‚ö° Quick start <span class="pill">Do this first</span></h3>
        <p class="p">
          Think of the app as two modes: <b>Game</b> (single round deep-dive) and <b>League</b> (season story).
        </p>

        <ol class="list">
          <li class="li">
            <div class="ico" aria-hidden="true">1</div>
            <div>
              <b>Enter Game Explorer</b>
              <span>Choose the course and date you want to explore ‚Äî the app builds the round instantly.</span>
            </div>
          </li>
          <li class="li">
            <div class="ico" aria-hidden="true">2</div>
            <div>
              <b>Open the Menu</b>
              <span>Pick your view: leaderboards, scorecards, replay, teams, trophies, banter... the lot.</span>
            </div>
          </li>
          <li class="li">
            <div class="ico" aria-hidden="true">3</div>
            <div>
              <b>Add to League (optional)</b>
              <span>
                <span class="badge captain"><span class="spark">üßë‚Äç‚úàÔ∏è</span>This bit is for Admin/Captain/Captain</span>
                Stack rounds into a season for standings, progress trends, reports, trophies, and more.
              </span>
            </div>
          </li>
        </ol>

        <div class="callout" style="margin-top:12px">
          <b>The point:</b>
          <p>
            You don‚Äôt need ‚Äúadvanced analytics‚Äù to get better.
            You need <b>one clear leak</b>, a <b>simple target</b>, and a <b>re-check loop</b>.
          </p>
        </div>
      </section>

      <aside class="card pad">
        <h3 class="h2">üìâ Improve fast <span class="pill">The loop</span></h3>
        <p class="p">
          The fastest improvement is boring: <b>find the leak ‚Üí fix it ‚Üí prove it</b>.
          The app‚Äôs improvement tools make that loop effortless.
        </p>

        <div class="accordion" style="margin-top:12px">
          <details open>
            <summary>
              <div class="sum-left">
                <div class="ico" aria-hidden="true" style="background:rgba(240,253,244,.9);border-color:rgba(16,185,129,.25)">üéØ</div>
                <div>
                  Spot the leak
                  <div class="meta">Find where shots disappear</div>
                </div>
              </div>
              <div class="caret" aria-hidden="true">‚åÑ</div>
            </summary>
            <div class="content">
              Use <b>Player Scorecard</b> to find blow-up holes, and <b>Course Stats</b> to see where the course bites.
              Then jump into <b>Player Progress</b> to confirm whether it‚Äôs a pattern or a one-off.
            </div>
          </details>

          <details>
            <summary>
              <div class="sum-left">
                <div class="ico" aria-hidden="true" style="background:rgba(99,102,241,.12);border-color:rgba(99,102,241,.22)">üß†</div>
                <div>
                  Choose the fix
                  <div class="meta">Practice + on-course decisions</div>
                </div>
              </div>
              <div class="caret" aria-hidden="true">‚åÑ</div>
            </summary>
            <div class="content">
              Use <b>Insight</b> for fast answers.
              Then use <b>Play Do</b> to turn that into a simple plan you can actually follow.
              <div style="margin-top:10px">
                <b>Generate Report</b> creates a shareable performance summary using the report type you choose:
                <div style="margin-top:8px;line-height:1.45">
                  <b>Stableford Points vs Field</b> ‚Äî competitive day view (you vs everyone).<br/>
                  <b>Stableford Points vs Handicap band</b> ‚Äî fair comparison vs similar ability.<br/>
                  <b>Score vs Field</b> ‚Äî raw strokes vs everyone.<br/>
                  <b>Score vs Handicap band</b> ‚Äî strokes vs your peer group.<br/>
                  <b>Score vs Par</b> ‚Äî where you gained or lost shots vs the course.
                </div>
              </div>
            </div>
          </details>

          <details>
            <summary>
              <div class="sum-left">
                <div class="ico" aria-hidden="true" style="background:rgba(244,63,94,.10);border-color:rgba(244,63,94,.22)">‚úÖ</div>
                <div>
                  Prove it
                  <div class="meta">No guessing, just trend</div>
                </div>
              </div>
              <div class="caret" aria-hidden="true">‚åÑ</div>
            </summary>
            <div class="content">
              Commit to the top 1‚Äì2 fixes for <b>3‚Äì5 rounds</b>.
              Then re-check <b>Player Progress</b> on 5/10 games to see if volatility drops and form improves.
            </div>
          </details>
        </div>
      </aside>
    </div>

    <!-- Improvement hub (explicitly covers the 3 requested tools) -->
    <section class="card pad" id="improve-hub" style="margin-top:14px">
      <h3 class="h2">
        üß† The improvement engine
        <span class="pill">Fast answers ‚Üí plan ‚Üí trend</span>
        <span class="badge hype"><span class="spark">üìâ</span>Score-dropping stuff</span>
      </h3>

      <p class="p">
        This is where the app stops being ‚Äúnice stats‚Äù and becomes <b>what to do next</b>.
        Use it as a loop: <b>analyse ‚Üí decide ‚Üí repeat</b>.
      </p>

      <div class="accordion" style="margin-top:12px">

        <details open>
          <summary>
            <div class="sum-left">
              <div class="ico">üìä</div>
              <div>
                Player Progress
                <span class="badge favourite" style="margin-left:10px"><span class="spark">üß≠</span>Start here</span>
                <div class="meta">Overview ‚Ä¢ Insight ‚Ä¢ Play Do ‚Ä¢ Analyse 1/5/10/20/30/ALL games for trends &amp; volatility ‚Ä¢ Season</div>
              </div>
            </div>
            <div class="caret">‚åÑ</div>
          </summary>

          <div class="content">
            <b>What it is:</b> a trend view for a player over a chosen window ‚Äî so you can separate <b>form</b> from <b>noise</b>.
            <div class="mini">
              <div class="callout">
                <b>How it works:</b>
                <p>
                  Pick a player ‚Üí pick a window (1, 5, 10, 20, 30, ALL) ‚Üí the app shows how results are moving
                  and how ‚Äúswingy‚Äù they are (volatility).
                </p>
              </div>
              <div class="callout">
                <b>How to use it:</b>
                <p>
                  If your average is fine but volatility is high, you‚Äôre not ‚Äúbad‚Äù ‚Äî you‚Äôre leaking disasters.
                  That usually means smarter choices on 2‚Äì3 holes beat swing tweaks.
                </p>
              </div>
            </div>
          </div>
        </details>

        <details>
          <summary>
            <div class="sum-left">
              <div class="ico">üí¨</div>
              <div>
                Insight
                <span class="badge favourite" style="margin-left:10px"><span class="spark">üéØ</span>Fast answers</span>
                <div class="meta">Fast answers: form, vs field, buckets, what to fix ‚Ä¢ Q&amp;A</div>
              </div>
            </div>
            <div class="caret">‚åÑ</div>
          </summary>

          <div class="content">
            <b>What it is:</b> the ‚Äútell me what to do‚Äù view ‚Äî quick, plain-English guidance based on your results.
            <div class="mini">
              <div class="callout">
                <b>How it works:</b>
                <p>
                  It summarises your form, compares you <b>vs the field</b>, groups your scoring into <b>buckets</b>,
                  and highlights the top things to fix first.
                </p>
              </div>
              <div class="callout danger">
                <b>The best way to use it:</b>
                <p>
                  Take the top 1‚Äì2 recommendations and commit for 3‚Äì5 rounds.
                  Then check Player Progress again. If the trend moved, you keep it. If not, you change the plan.
                </p>
              </div>
            </div>
          </div>
        </details>

        <details>
          <summary>
            <div class="sum-left">
              <div class="ico">üìù</div>
              <div>
                Play Do
                <span class="badge captain" style="margin-left:10px"><span class="spark">üìã</span>Improvement plan</span>
                <div class="meta">‚Äî Improvement plan</div>
              </div>
            </div>
            <div class="caret">‚åÑ</div>
          </summary>

          <div class="content">
            <b>What it is:</b> a deeper report that pulls your season/round data into a clear plan.
            <div class="mini">
              <div class="callout">
                <b>How it works:</b>
                <p>
                  Pick a player ‚Üí the report summarises strengths, weaknesses, and the biggest recurring scoring leaks,
                  then frames an improvement plan you can actually follow.
                </p>
              </div>
              <div class="callout">
                <b>How to use it:</b>
                <p>
                  Pick <b>one</b> focus. Not ten.
                  The best focus is usually the most repeatable leak: penalties, blow-up holes, par-3 scoring, or closing holes.
                </p>
              </div>
            </div>
          </div>
        </details>

      </div>

      <div class="callout" style="margin-top:12px">
        <b>The simple weekly routine:</b>
        <p>
          After each round: <b>Player Scorecard</b> (find where it went wrong).<br/>
          Every few rounds: <b>Player Progress</b> (trend + volatility).<br/>
          Monthly: <b>Insight</b> + <b>Play Do</b> (choose the next focus).
        </p>
      </div>
    </section>

    <!-- FULL MENU COVERAGE -->
    <section class="card pad" id="views" style="margin-top:14px">
      <h3 class="h2">
        üß© What‚Äôs inside the app?
        <span class="pill">Every menu explained</span>
        <span class="badge hype" style="margin-left:6px"><span class="spark">‚ú®</span>Built for the group chat</span>
      </h3>

      <p class="p">
        Here‚Äôs what each menu item is for ‚Äî with a bias toward what golfers actually use.
      </p>

      <div class="accordion" style="margin-top:12px">

        <details open>
          <summary>
            <div class="sum-left">
              <div class="ico">‚õ≥</div>
              <div>Game
                <div class="meta">The scoreboard</div>
              </div>
            </div>
            <div class="caret">‚åÑ</div>
          </summary>
          <div class="content">
            The main leaderboard for the round. The ‚Äúopen this first‚Äù screen.
          </div>
        </details>

        <details>
          <summary>
            <div class="sum-left">
              <div class="ico">üìà</div>
              <div>Graphs
                <div class="meta">Trends and momentum</div>
              </div>
            </div>
            <div class="caret">‚åÑ</div>
          </summary>
          <div class="content">
            Visualise performance over holes/games ‚Äî perfect for spotting comebacks and collapses.
          </div>
        </details>

        <details>
          <summary>
            <div class="sum-left">
              <div class="ico">üßæ</div>
              <div>Player Scorecard
                <div class="meta">Hole-by-hole truth</div>
              </div>
            </div>
            <div class="caret">‚åÑ</div>
          </summary>
          <div class="content">
            Pick a player and see exactly where points were won or thrown away.
          </div>
        </details>

        <details>
          <summary>
            <div class="sum-left">
              <div class="ico">üó∫Ô∏è</div>
              <div>Course Stats
                <div class="meta">Which holes bite back</div>
              </div>
            </div>
            <div class="caret">‚åÑ</div>
          </summary>
          <div class="content">
            Course difficulty, scoring opportunities, and where strategy beats swing changes.
          </div>
        </details>

        <details>
          <summary>
            <div class="sum-left">
              <div class="ico">‚≠ê</div>
              <div>Ratings
                <div class="meta">Performance, simplified</div>
              </div>
            </div>
            <div class="caret">‚åÑ</div>
          </summary>
          <div class="content">
            Breaks performance into clean ratings so you can tell what worked without drowning in numbers.
          </div>
        </details>

        <details>
          <summary>
            <div class="sum-left">
              <div class="ico">üòÇ</div>
              <div>
                Banter <span class="badge favourite" style="margin-left:10px"><span class="spark">üî•</span>Captain‚Äôs favourite</span>
                <div class="meta">Stats with personality</div>
              </div>
            </div>
            <div class="caret">‚åÑ</div>
          </summary>
          <div class="content">
            Sharable talking points and properly-earned group-chat ammunition.
          </div>
        </details>

        <details>
          <summary>
            <div class="sum-left">
              <div class="ico">üéØ</div>
              <div>Styles
                <div class="meta">How you score</div>
              </div>
            </div>
            <div class="caret">‚åÑ</div>
          </summary>
          <div class="content">
            Are you steady? Streaky? Back-nine merchant? Styles makes it obvious.
          </div>
        </details>

        <details>
          <summary>
            <div class="sum-left">
              <div class="ico">üìñ</div>
              <div>Story
                <div class="meta">The narrative version</div>
              </div>
            </div>
            <div class="caret">‚åÑ</div>
          </summary>
          <div class="content">
            Turns the day into a story: turning points, momentum swings, late charges.
          </div>
        </details>

        <details>
          <summary>
            <div class="sum-left">
              <div class="ico">üì∫</div>
              <div>
                Replay <span class="badge favourite" style="margin-left:10px"><span class="spark">üé•</span>Must-watch</span>
                <div class="meta">The broadcast replay</div>
              </div>
            </div>
            <div class="caret">‚åÑ</div>
          </summary>
          <div class="content">
            Re-live the round hole-by-hole like TV coverage. Lead changes, pressure moments, and receipts.
            <div class="mini">
              <div class="callout">
                <b>Replay tip:</b>
                <p>Open Replay straight after the round. It‚Äôs peak entertainment while the pain is fresh.</p>
              </div>
            </div>
          </div>
        </details>

        <details>
          <summary>
            <div class="sum-left">
              <div class="ico">ü§º</div>
              <div>
                Teams <span class="badge favourite" style="margin-left:10px"><span class="spark">üß®</span>Spiciest screen</span>
                <div class="meta">Who carried who</div>
              </div>
            </div>
            <div class="caret">‚åÑ</div>
          </summary>
          <div class="content">
            Team results explained properly ‚Äî who delivered, where matches were won/lost, and why the ‚Äúweak link‚Äù rumours started.
          </div>
        </details>

        <details>
          <summary>
            <div class="sum-left">
              <div class="ico">üé∞</div>
              <div>Casino
                <div class="meta">Side games, sorted</div>
              </div>
            </div>
            <div class="caret">‚åÑ</div>
          </summary>
          <div class="content">
            Side games and extras tracked cleanly so nobody ‚Äúforgets‚Äù what they owe.
          </div>
        </details>

        <details>
          <summary>
            <div class="sum-left">
              <div class="ico">üèÜ</div>
              <div>Trophies
                <div class="meta">Permanent bragging rights</div>
              </div>
            </div>
            <div class="caret">‚åÑ</div>
          </summary>
          <div class="content">
            Achievements that stick ‚Äî because golf needs a history of receipts.
          </div>
        </details>

        <details>
          <summary>
            <div class="sum-left">
              <div class="ico">ü§ù</div>
              <div>Partners
                <div class="meta">Best and worst combinations</div>
              </div>
            </div>
            <div class="caret">‚åÑ</div>
          </summary>
          <div class="content">
            See who you play best with ‚Äî and who you should never be paired with again.
          </div>
        </details>

        <details>
          <summary>
            <div class="sum-left">
              <div class="ico">ü•ä</div>
              <div>Rivalry
                <div class="meta">Head-to-head receipts</div>
              </div>
            </div>
            <div class="caret">‚åÑ</div>
          </summary>
          <div class="content">
            Compare two golfers properly. No selective memory. Just results.
          </div>
        </details>

      </div>
    </section>

    <div class="footer">
      Built for golf societies: easy inputs, clear outputs, maximum banter potential.<br/>
      Tip: send this guide to new members so everyone finds Replay + Teams + Improve tools quickly.
    </div>
  </main>

  <button class="fab" data-jump="#how" title="Start here">
    <span aria-hidden="true">üß≠</span><span style="font-size:12px;font-weight:900;letter-spacing:.02em;">Start here</span>
  </button>

  <script>
    // Smooth jump buttons
    document.querySelectorAll("[data-jump]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const sel = btn.getAttribute("data-jump");
        const el = document.querySelector(sel);
        if(!el) return;
        el.scrollIntoView({behavior:"smooth", block:"start"});
      });
    });

    // Rotate caret on open/close
    const syncCarets = () => {
      document.querySelectorAll("details").forEach(d=>{
        const caret = d.querySelector(".caret");
        if(!caret) return;
        caret.style.transform = d.open ? "rotate(180deg)" : "rotate(0deg)";
        caret.style.transition = "transform 160ms ease";
      });
    };
    document.querySelectorAll("details").forEach(d=>{
      d.addEventListener("toggle", syncCarets);
    });
    syncCarets();
  <\/script>
</body>
</html>
`}function Nr({guideMode:s,setGuideMode:a}){return e.jsxs("div",{className:"mb-5",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-400",children:"Choose a mode"}),e.jsxs("div",{className:"mt-2 grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("button",{className:"guide-mode-card "+(s==="simple"?"active":""),onClick:()=>a("simple"),type:"button",children:[e.jsxs("div",{className:"gm-top",children:[e.jsx("div",{className:"gm-title",children:"Simple"}),e.jsx("span",{className:"gm-badge",children:"Fast start"})]}),e.jsx("div",{className:"gm-desc",children:"The essentials: what each menu item does, and how to get value immediately."})]}),e.jsxs("button",{className:"guide-mode-card "+(s==="deep"?"active":""),onClick:()=>a("deep"),type:"button",children:[e.jsxs("div",{className:"gm-top",children:[e.jsx("div",{className:"gm-title",children:"In‚ÄëDepth"}),e.jsx("span",{className:"gm-badge",children:"Full tour"})]}),e.jsx("div",{className:"gm-desc",children:"The full walkthrough (Improve tools, Replay & Teams) with the detailed guide embedded."})]})]}),e.jsxs("div",{className:"mt-2 text-xs text-neutral-500",children:["You‚Äôre picking ",e.jsx("span",{className:"font-black",children:s==="simple"?"Simple":"In‚ÄëDepth"})," mode."]})]})}function An({setView:s,leagueTitle:a}){const[r,u]=ue.useState(()=>{try{return localStorage.getItem("denGuideMode")||"simple"}catch{return"simple"}});return ue.useEffect(()=>{try{localStorage.setItem("denGuideMode",r)}catch{}},[r]),r==="deep"?e.jsxs("section",{className:"content-card p-4 md:p-6",children:[e.jsx(ya,{setView:s,title:"Guide"}),e.jsx(Nr,{guideMode:r,setGuideMode:u}),e.jsx("div",{className:"rounded-2xl border border-squab-200 bg-white shadow-sm overflow-hidden",children:e.jsx("iframe",{title:`${a} ‚Äî In-depth guide`,className:"w-full",style:{height:"78vh"},srcDoc:kn(a)})}),e.jsx("p",{className:"mt-3 text-xs text-neutral-500",children:"Tip: If you‚Äôre on mobile, rotate to landscape for the ‚Äúbroadcast‚Äù feel on Replay & Teams."})]}):e.jsxs("section",{className:"content-card p-4 md:p-6",children:[e.jsx(ya,{setView:s,title:"Guide"}),e.jsx(Nr,{guideMode:r,setGuideMode:u}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-lg md:text-xl font-extrabold text-squab-900",children:"What this app can do"}),e.jsx("p",{className:"text-sm text-neutral-600",children:"Explore any course and date in Game Explorer ‚Äî and it builds leaderboards, player views, and reports automatically."})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-4 mb-5",children:[e.jsxs("div",{className:"rounded-2xl border border-squab-200 bg-white p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"chip",children:"‚ö°"}),e.jsx("h3",{className:"font-bold text-squab-900",children:"Quick start"})]}),e.jsxs("ol",{className:"list-decimal pl-5 text-sm text-neutral-700 space-y-1",children:[e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold",children:"Game Explorer"})," ‚Üí choose a course + date to explore."]}),e.jsxs("li",{children:["Pick a view from ",e.jsx("span",{className:"font-semibold",children:"‚ò∞ Menu"}),"."]}),e.jsx("li",{children:"(Optional) Further functions are available to the Admin/Captain."})]})]}),e.jsxs("div",{className:"rounded-2xl border border-squab-200 bg-white p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"chip",children:"üß≠"}),e.jsx("h3",{className:"font-bold text-squab-900",children:"How to navigate"})]}),e.jsxs("ul",{className:"list-disc pl-5 text-sm text-neutral-700 space-y-1",children:[e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold",children:"‚ò∞ Menu"})," = everything (game + season + fun stuff)."]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold",children:"Home"})," returns to the main screen."]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold",children:"Guide"})," button (bottom-right) opens this page."]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold",children:"Tip"}),": in this Guide, click view names to jump straight to that screen."]})]})]})]}),e.jsxs("div",{className:"rounded-2xl border border-squab-200 bg-white p-4 md:p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"chip",children:"üß©"}),e.jsx("h3",{className:"font-extrabold text-squab-900",children:"Everything it can do (by menu)"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-sm text-neutral-700",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-black uppercase tracking-wide text-neutral-500 mb-2",children:"Round views"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsxs("li",{children:["‚õ≥ ",e.jsx("span",{className:"font-semibold",children:"Game"})," ‚Äî round leaderboard + key totals."]}),e.jsxs("li",{children:["üßæ ",e.jsx("span",{className:"font-semibold",children:"Player Scorecard"})," ‚Äî per-hole ",e.jsx("span",{className:"font-semibold",children:"Gross"}),", Stableford, Yards, SI with player dropdown."]}),e.jsxs("li",{children:["üìà ",e.jsx("span",{className:"font-semibold",children:"Graphs"})," ‚Äî charts for scoring / trends."]}),e.jsxs("li",{children:["üó∫Ô∏è ",e.jsx("span",{className:"font-semibold",children:"Course Stats"})," ‚Äî hole difficulty vs SI, par-type breakdowns."]}),e.jsxs("li",{children:["‚≠ê ",e.jsx("span",{className:"font-semibold",children:"Ratings"})," ‚Äî course/tee difficulty + performance splits."]}),e.jsxs("li",{children:["üßë‚Äçü§ù‚Äçüßë ",e.jsx("span",{className:"font-semibold",children:"Head‚Äëto‚ÄëHead"})," ‚Äî compare players."]}),e.jsxs("li",{children:["üé® ",e.jsx("span",{className:"font-semibold",children:"Styles"})," ‚Äî style / pattern analysis views."]}),e.jsxs("li",{children:["üìñ ",e.jsx("span",{className:"font-semibold",children:"Story"})," ‚Äî narrative recap of the round."]}),e.jsxs("li",{children:["üéûÔ∏è ",e.jsx("span",{className:"font-semibold",children:"Replay"})," ‚Äî step through the round / highlights."]}),e.jsxs("li",{children:["üë• ",e.jsx("span",{className:"font-semibold",children:"Team Replay"})," ‚Äî team view / matchplay‚Äëstyle replay."]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-black uppercase tracking-wide text-neutral-500 mb-2",children:"Season + extras"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsxs("li",{children:["üß† ",e.jsx("button",{type:"button",className:"link",onClick:()=>{s("player_progress"),window.scrollTo(0,0)},children:e.jsx("span",{className:"font-semibold",children:"Insights"})})," ‚Äî plain-English performance insights. Explains what‚Äôs helping or hurting your score and highlights the quickest scoring gains (uses the same data as Player Progress)."]}),e.jsxs("li",{children:["üèÜ ",e.jsx("button",{type:"button",className:"link",onClick:()=>{s("player_progress"),window.scrollTo(0,0)},children:e.jsx("span",{className:"font-semibold",children:"Par Leaders"})})," ‚Äî league leaders by ",e.jsx("strong",{children:"All Pars"}),", ",e.jsx("strong",{children:"Par 3"}),", ",e.jsx("strong",{children:"Par 4"}),", and ",e.jsx("strong",{children:"Par 5"}),". Based on points/strokes per hole, with filters for Stableford or Gross."]}),e.jsxs("li",{children:["üèÅ ",e.jsx("button",{type:"button",className:"link",children:e.jsx("span",{className:"font-semibold",onClick:()=>{s("league"),window.scrollTo(0,0)},children:"League"})})," ‚Äî season standings and points totals."]}),e.jsxs("li",{children:["üß© ",e.jsx("span",{className:"font-semibold",children:"Eclectic"})," ‚Äî best score on each hole across the season."]}),e.jsxs("li",{children:["üóÇÔ∏è ",e.jsx("span",{className:"font-semibold",children:"Analyse Game"})," ‚Äî pick a past game and deep‚Äëdive."]}),e.jsxs("li",{children:["üìä ",e.jsx("button",{type:"button",className:"link",onClick:()=>{s("player_progress"),window.scrollTo(0,0)},children:e.jsx("span",{className:"font-semibold",children:"Player Progress"})})," ‚Äî analyse 1/5/10/20/30/ALL games for trends, volatility, and vs field comparisons."]}),e.jsxs("li",{children:["üìù ",e.jsx("span",{className:"font-semibold",children:"Player Report"})," ‚Äî single-player report across 1/5/10/20/30/ALL games (spot patterns over time)."]}),e.jsxs("li",{children:["üí¨ ",e.jsx("span",{className:"font-semibold",children:"Banter"})," ‚Äî fun / commentary view."]}),e.jsxs("li",{children:["ü§ù ",e.jsx("span",{className:"font-semibold",children:"Partners"})," ‚Äî partner / duo views."]}),e.jsxs("li",{children:["ü•ä ",e.jsx("span",{className:"font-semibold",children:"Rivalry"})," ‚Äî rivalry comparisons."]}),e.jsxs("li",{children:["üé∞ ",e.jsx("span",{className:"font-semibold",children:"Casino"})," ‚Äî side games / gambling formats."]}),e.jsxs("li",{children:["üèÜ ",e.jsx("span",{className:"font-semibold",children:"Trophies"})," ‚Äî trophies / achievements."]})]})]})]})]})]})}function Fn({setView:s}){return e.jsxs("section",{className:"content-card p-4 md:p-6",children:[e.jsx(ya,{setView:s,left:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>s("player_progress"),children:"‚Üê Back to Performance Mirror"}),e.jsx("button",{className:"btn-secondary",onClick:()=>s("home"),children:"Home"})]}),title:"How to read"}),e.jsxs("div",{className:"rounded-3xl border border-neutral-200 bg-white p-5 shadow-sm",children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-400",children:"Performance Mirror"}),e.jsx("div",{className:"text-2xl md:text-3xl font-black text-neutral-900 mt-1",children:"What the numbers actually mean"}),e.jsx("div",{className:"text-sm text-neutral-600 mt-2",children:"Choose your options, then generate a fast, readable summary."})]}),e.jsxs("div",{className:"mt-5 grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-3xl border border-neutral-200 bg-white p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-400",children:"Player Progress"}),e.jsx("div",{className:"text-lg font-extrabold text-neutral-900",children:"Trends over time"}),e.jsxs("div",{className:"text-sm text-neutral-600 mt-1",children:["Uses your chosen window: ",e.jsx("span",{className:"font-semibold",children:"1 / 5 / 10 / 20 / 30 / All"})," games."]})]}),e.jsx("button",{className:"btn-secondary",onClick:()=>s("player_progress"),children:"Open"})]}),e.jsxs("div",{className:"mt-4 space-y-3 text-sm text-neutral-700",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-neutral-900",children:"Window (1/5/10/20/30/All)"}),e.jsx("div",{children:"How many recent games are included. Smaller windows show ‚Äúcurrent form‚Äù, larger ones show ‚Äúreal trend‚Äù."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-neutral-900",children:"Scoring mode"}),e.jsxs("ul",{className:"list-disc ml-5 space-y-1",children:[e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold",children:"Stableford"}),": higher is better."]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold",children:"Gross"}),": lower is better (strokes)."]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-neutral-900",children:"Last round"}),e.jsx("div",{children:"Your most recent score in the selected mode (stableford points or gross strokes)."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-neutral-900",children:"Form / Trend (‚Üë / ‚Üì)"}),e.jsx("div",{children:"A quick ‚Äúdirection of travel‚Äù. It compares your recent chunk (up to the last 5 games) against the previous chunk. For gross, down is good (fewer strokes) ‚Äî the arrow already accounts for that."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-neutral-900",children:"Consistency (Std Dev)"}),e.jsx("div",{children:"‚ÄúHow swingy are your rounds?‚Äù Lower = steadier. Higher = more up/down performances."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-neutral-900",children:"Vs Field / Vs Handicap band"}),e.jsxs("ul",{className:"list-disc ml-5 space-y-1",children:[e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold",children:"Vs Field"}),": compares you to the average of everyone in the same events."]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold",children:"Vs Handicap band"}),": compares you to players with similar handicaps (more ‚Äúfair‚Äù)."]})]}),e.jsx("div",{className:"mt-1",children:"Positive in stableford = good. Positive in gross = also shown as good (because it‚Äôs inverted for readability)."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-neutral-900",children:"The trend chart"}),e.jsx("div",{children:"Solid line = you. Faint line = field average. The horizontal guide lines give you a quick sense of scale."})]})]})]}),e.jsxs("div",{className:"rounded-3xl border border-neutral-200 bg-white p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-black tracking-widest uppercase text-neutral-400",children:"Player Report"}),e.jsx("div",{className:"text-lg font-extrabold text-neutral-900",children:"One player, explained"}),e.jsx("div",{className:"text-sm text-neutral-600 mt-1",children:"A single‚Äëplayer breakdown ‚Äî either the latest round, or averages across a selected window."})]}),e.jsx("button",{className:"btn-secondary",onClick:()=>s("player_progress"),children:"Open"})]}),e.jsxs("div",{className:"mt-4 space-y-3 text-sm text-neutral-700",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-neutral-900",children:"Round vs Window"}),e.jsx("div",{children:"If you‚Äôre looking at the latest round, you‚Äôll see hole‚Äëby‚Äëhole. If you‚Äôre in ‚Äúwindow‚Äù mode, you‚Äôll see averages per hole across the selected games."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-neutral-900",children:"Hole Map"}),e.jsx("div",{children:"Each box is a hole. The number is points. Darker usually means a better result. If you see NDB, that hole was adjusted (made up for completeness, WHS-style)."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-neutral-900",children:"Round Highlights"}),e.jsxs("ul",{className:"list-disc ml-5 space-y-1",children:[e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold",children:"Bounce-back"}),": best improvement from one hole to the next."]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold",children:"Hot stretch"}),": best 3‚Äëhole run."]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-semibold",children:"Biggest leak (worst hole)"}),": the hole that cost you the most points."]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-neutral-900",children:"Graph"}),e.jsx("div",{children:"Shows the score moving game‚Äëto‚Äëgame (or hole‚Äëto‚Äëhole depending on the view). The faint horizontal lines are there so you can read the ‚Äúup/down‚Äù properly."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-neutral-900",children:"Missing holes & WHS adjustment (NDB)"}),e.jsxs("div",{children:["If a hole is missing but the round exists, we fill it as ",e.jsx("span",{className:"font-semibold",children:"Net Double Bogey"})," for completeness (WHS style) and mark it",e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-black border border-amber-300 bg-amber-100 text-amber-900 ml-2",children:"NDB"}),". That prevents ‚Äú17 holes looking like an 18‚Äëhole 78‚Äù and keeps averages fair."]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-neutral-900",children:"9 holes vs 18 holes"}),e.jsx("div",{children:"If nobody recorded holes 10‚Äì18, the app treats it as a 9‚Äëhole round and only analyses the front 9. (So ‚Äúfinish‚Äù stats use holes 6‚Äì9 for 9‚Äëholers.)"})]})]})]})]}),e.jsxs("div",{className:"mt-6 rounded-3xl border border-neutral-200 bg-white p-5 shadow-sm",children:[e.jsx("div",{className:"text-sm font-black text-neutral-900",children:"Quick tips"}),e.jsxs("ul",{className:"mt-2 text-sm text-neutral-700 list-disc ml-5 space-y-1",children:[e.jsx("li",{children:"If something looks ‚Äútoo good to be true‚Äù, check whether the round had missing holes before adjustment."}),e.jsx("li",{children:"Use small windows (5/10) for form, and larger windows (20/30/All) for genuine trend."}),e.jsx("li",{children:"‚ÄúVs Field‚Äù answers ‚Äúhow did I do compared to everyone today?‚Äù while ‚ÄúVs Handicap band‚Äù answers ‚Äúhow did I do compared to my peers?‚Äù"})]})]})]})}function $n(s){const[a,r]=he.useState("home"),[u,d]=he.useState(0),[A,x]=he.useState(null),[g,c]=he.useState("");try{if(typeof window<"u"&&typeof sessionStorage<"u"){const S=sessionStorage.getItem("dsl_active_society_id")||"",B=sessionStorage.getItem("dsl_active_society_slug")||"",H=sessionStorage.getItem("dsl_active_society_name")||"";S&&!window.__activeSocietyId&&(window.__activeSocietyId=S),B&&!window.__activeSocietySlug&&(window.__activeSocietySlug=B),H&&!window.__activeSocietyName&&(window.__activeSocietyName=H)}}catch{}he.useEffect(()=>{try{if(typeof window>"u")return;const S=String($r()||"").trim();if(!S)return;const B=String(window.__activeSocietySlug||"").trim(),H=String(window.__activeSocietyId||"").trim();if(B===S&&H)return;(async()=>{try{const R=typeof window<"u"&&window.__supabase_client__?window.__supabase_client__:rr(`https://mqknahdfpqxrpgpxqtus.supabase.co
`,`eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1xa25haGRmcHF4cnBncHhxdHVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI0NTU3MDYsImV4cCI6MjA3ODAzMTcwNn0.GTUVsrRJ-MClMg96vuHZpUtAnUFtCsJvuLiiE0D-fCc
`,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}});typeof window<"u"&&(window.__supabase_client__=R);const{data:q,error:L}=await R.from("societies_public").select("id,name,slug").eq("slug",S).limit(1).maybeSingle();if(L)throw L;if(q&&q.id){window.__activeSocietyId=q.id,window.__activeSocietySlug=q.slug||S,window.__activeSocietyName=q.name||q.slug||S,window.__activeSocietyRole="";try{sessionStorage.setItem("dsl_active_society_id",q.id),sessionStorage.setItem("dsl_active_society_slug",q.slug||S),sessionStorage.setItem("dsl_active_society_name",q.name||"")}catch{}d(G=>G+1)}}catch(R){console.warn("Society bootstrap failed:",R)}})()}catch{}},[]);const o=s||{},m=(()=>{try{const S=String(o.activeSocietyId||(typeof window<"u"?window.__activeSocietyId:"")||"").trim(),B=String(o.activeSocietySlug||(typeof window<"u"?window.__activeSocietySlug:"")||"den-society").trim(),H=String(o.activeSocietyName||(typeof window<"u"?window.__activeSocietyName:"")||"").trim(),R=String(o.activeSocietyRole||(typeof window<"u"?window.__activeSocietyRole:"")||"").trim();return{id:S,slug:B,name:H,role:R}}catch{return{id:"",slug:"den-society",name:"",role:""}}})(),M=m.id,n=m.slug||"den-society";Ra=m.name||n,Oa=Ra;const l=n==="winter-league",f="den-events",E=M?`societies/${M}/events`:"societies/UNKNOWN/events",D=l?"winter":"season";he.useEffect(()=>{const S=H=>{const R=H==="pointsField"||H==="strokesField"||H==="strokesPar"?H:"pointsField",q=document.documentElement;if(!q||!q.style)return;let L="#7c3aed",G="124,58,237";R==="strokesField"&&(L="#2563eb",G="37,99,235"),R==="strokesPar"&&(L="#f97316",G="249,115,22"),q.style.setProperty("--mode-accent",L),q.style.setProperty("--mode-accent-rgb",G),q.style.setProperty("--mode-accent-soft",`rgba(${G}, 0.12)`),q.style.setProperty("--mode-accent-soft2",`rgba(${G}, 0.20)`)},B=()=>{try{S(localStorage.getItem("dsl_lens")||"pointsField")}catch{S("pointsField")}};return B(),window.addEventListener("dsl_lens_change",B),window.addEventListener("storage",B),()=>{window.removeEventListener("dsl_lens_change",B),window.removeEventListener("storage",B)}},[]);const[C,N]=he.useState(""),[X,J]=he.useState(!1),[I,V]=he.useState(!1),[te,Z]=he.useState(null),Qe=he.useRef(!1),ve="standings",xt="den_admin_pw_ok_v1",mt=typeof window<"u"&&window.DEN_ADMIN_PASSWORD?String(window.DEN_ADMIN_PASSWORD):"Den Society League",vt="den_hidden_players_v1",jt=E?`${E}/admin/player_visibility.json`:"admin/player_visibility.json",[He,Je]=he.useState(null),[b,j]=he.useState("Connecting..."),[O,T]=he.useState([]),[ae,ye]=he.useState(null),[U,at]=he.useState([]),[ce,gt]=he.useState("All"),[ot,qe]=he.useState("All"),[Dt,bt]=he.useState(""),[ke,w]=he.useState([]),[Le,Fe]=he.useState("All"),[Vt,fs]=ue.useState(!1),[wt,ft]=ue.useState(()=>{try{return localStorage.getItem("den_reportNextHcapMode_v1")||"whs"}catch{return"whs"}});ue.useEffect(()=>{try{localStorage.setItem("den_reportNextHcapMode_v1",wt)}catch{}},[wt]);const[ut,Me]=he.useState(null),[Jt,_t]=he.useState(()=>{try{const S=localStorage.getItem(vt),B=S?JSON.parse(S):[];return Array.isArray(B)?B.filter(Boolean):[]}catch{return[]}}),Kt=ue.useMemo(()=>new Set((Jt||[]).filter(Boolean)),[Jt]),[W,de]=he.useState(!1),[Te,xe]=he.useState(!1),[fe,Oe]=he.useState(()=>{try{return localStorage.getItem(xt)==="1"}catch{return!1}}),me=ue.useCallback(()=>{if(!te){zt("Sign in first");return}fe?de(!0):xe(!0)},[te,fe]),re=ue.useCallback(S=>{if(!(String(S||"")===mt)){zt("Wrong password");return}Oe(!0);try{localStorage.setItem(xt,"1")}catch{}xe(!1),de(!0),zt("Admin unlocked ‚úì")},[]);he.useEffect(()=>{try{const S=Array.from(document.querySelectorAll("[data-reveal]"));if(!S.length)return;const B=new IntersectionObserver(H=>{H.forEach(R=>{R.isIntersecting&&(R.target.classList.add("is-revealed"),B.unobserve(R.target))})},{threshold:.12});return S.forEach(H=>{H.classList.add("reveal"),B.observe(H)}),()=>B.disconnect()}catch{}},[a,ae]);const ie=ue.useMemo(()=>{const S=(ke||[]).map(B=>String(B.season_id)).filter(Boolean);return Array.from(new Set(S)).sort((B,H)=>H.localeCompare(B))},[ke]);function St(S,B,H){let R=Array.isArray(S)?S.slice():[];R.sort((L,G)=>{var dt,tt;const je=Number.isFinite(Number(L==null?void 0:L.dateMs))?Number(L.dateMs):Number.isFinite(Number((dt=L==null?void 0:L.parsed)==null?void 0:dt.dateMs))?Number(L.parsed.dateMs):L!=null&&L.date?st(L.date):Number.POSITIVE_INFINITY,De=Number.isFinite(Number(G==null?void 0:G.dateMs))?Number(G.dateMs):Number.isFinite(Number((tt=G==null?void 0:G.parsed)==null?void 0:tt.dateMs))?Number(G.parsed.dateMs):G!=null&&G.date?st(G.date):Number.POSITIVE_INFINITY;return je!==De?je-De:String((L==null?void 0:L.file)||"").localeCompare(String((G==null?void 0:G.file)||""))});const q=L=>{var De;const G=L==null?void 0:L.seasonId;if(G!=null&&String(G).trim()!=="")return String(G);const je=Number.isFinite(Number(L==null?void 0:L.dateMs))?Number(L.dateMs):Number.isFinite(Number((De=L==null?void 0:L.parsed)==null?void 0:De.dateMs))?Number(L.parsed.dateMs):L!=null&&L.date?st(L.date):NaN;if(Number.isFinite(je)){try{const dt=Ss(je,ke);if(dt!=null&&String(dt).trim()!=="")return String(dt)}catch{}try{return String(new Date(je).getFullYear())}catch{return""}}return""};if(B&&B!=="All"&&(R=R.filter(L=>q(L)===String(B))),H&&H!=="All"){const L=Number(H);Number.isFinite(L)&&L>0&&R.length>L&&(R=R.slice(R.length-L))}return R}ue.useEffect(()=>{var R;if(!U||!U.length)return;const S=St(U,ce,Le),B=Mt(S);Me(B);try{typeof window<"u"&&(window.__seasonModelAll=B)}catch{}const H=Mt(S,{hiddenKeys:Kt});ye(H);try{typeof window<"u"&&(window.__seasonModel=H)}catch{}try{typeof window<"u"&&(window.__dslUiState={seasonYear:ce,seasonLimit:Le})}catch{}(R=H==null?void 0:H.players)!=null&&R.length&&(Ys&&H.players.some(L=>L.name===Ys)||Xs(H.players[0].name))},[U,ce,Le,Jt]);const Gt=ue.useMemo(()=>St(Array.isArray(U)?U:[],ce,Le),[U,ce,Le]);ue.useMemo(()=>St(Array.isArray(U)?U:[],ce,"All"),[U,ce]);const ge=ue.useMemo(()=>{try{return Array.isArray(U)?U.slice():[]}catch{return[]}},[U]),$t=ue.useMemo(()=>{try{return Mt(ge,{hiddenKeys:Kt})}catch{try{return Mt(ge)}catch{return null}}},[ge,Jt]),[Qt,Rt]=he.useState(!1);ue.useEffect(()=>{try{a==="event"&&(!Array.isArray(U)||U.length===0)&&!Qt&&Pt({afterView:"event"})}catch{}},[a,U,Qt]);const[ps,es]=he.useState({done:0,total:0}),[Ht,Cs]=he.useState(""),[Ys,Xs]=he.useState(""),[Us,Qs]=he.useState("stableford"),[ea,_s]=he.useState("par"),[ha,Ws]=he.useState({processed:[],skipped:[]});function ba(S){return Number.isFinite(S)?S<150?"<150":S<=200?"150‚Äì200":S<=350?"201‚Äì350":S<=420?"351‚Äì420":"420+":"Unknown"}function da(S){return Number.isFinite(S)?S<=6?"1‚Äì6":S<=12?"7‚Äì12":"13‚Äì18":"Unknown"}function Xt(){return{holes:0,pts:0,wipes:0,p0:0,p1:0,p2:0,p3:0,p4:0,p5:0}}function Ms(S,B){S.holes+=1,S.pts+=B,B===0&&(S.wipes+=1);const H=Math.max(0,Math.min(5,Math.round(Number(B||0))));H===0?S.p0+=1:H===1?S.p1+=1:H===2?S.p2+=1:H===3?S.p3+=1:H===4?S.p4+=1:S.p5+=1}function qt(){return{holes:0,val:0,sumSq:0,bogeyPlus:0,parOrBetter:0,birdieOrBetter:0,doublePlus:0,eaglePlus:0,birdies:0,pars:0,bogeys:0,doubles:0,triplesPlus:0}}function cs(S,B){const H=Number(B);Number.isFinite(H)&&(S.holes+=1,S.val+=H,S.sumSq+=H*H,H>=1&&(S.bogeyPlus+=1),H<=0&&(S.parOrBetter+=1),H<=-1&&(S.birdieOrBetter+=1),H<=-2?S.eaglePlus+=1:H===-1?S.birdies+=1:H===0?S.pars+=1:H===1?S.bogeys+=1:H===2?S.doubles+=1:H>=3&&(S.triplesPlus+=1))}function Lt(S,B=NaN){if(S==null||typeof S=="string"&&S.trim()==="")return B;const H=Number(S);return Number.isFinite(H)?H:B}function pa(S,B){const R=(S.teeLabel||S.tee||S.tee_name||"").toString().trim().toLowerCase();if(R&&Array.isArray(B)){const q=B.find(G=>(G.teeName||G.name||G.label||"").toString().trim().toLowerCase()===R);if(q)return q;const L=B.find(G=>{const je=(G.teeName||G.name||G.label||"").toString().trim().toLowerCase();return je&&(je.includes(R)||R.includes(je))});if(L)return L}return Array.isArray(B)&&B.length?B[0]:null}function Mt(S,B){var Ue,Yt,ls,Zt,Ns,Hs,$s,na,As,Zs,Ds,Ls,ht,Ts,Ks,Js,la,ns,hs;function R($e){const Ve=String($e||"");let Ge=Ve.match(/(20\d{2})[-_\.](0?[1-9]|1[0-2])[-_\.](0?[1-9]|[12]\d|3[01])/);if(Ge){const lt=Number(Ge[1]),t=Number(Ge[2]),i=Number(Ge[3]),p=Date.UTC(lt,t-1,i);return Number.isFinite(p)?p:null}if(Ge=Ve.match(/(0?[1-9]|[12]\d|3[01])[-_\.](0?[1-9]|1[0-2])[-_\.](20\d{2})/),Ge){const lt=Number(Ge[1]),t=Number(Ge[2]),i=Number(Ge[3]),p=Date.UTC(i,t-1,lt);return Number.isFinite(p)?p:null}return null}function q($e){const Ve=$e.length;if(!Ve)return NaN;let Ge=0;for(const lt of $e)Ge+=Number(lt);return Ge/Ve}function L($e){const Ve=$e.length;if(Ve<2)return NaN;const Ge=q($e);let lt=0;for(const t of $e){const i=Number(t)-Ge;lt+=i*i}return Math.sqrt(lt/(Ve-1))}function G($e,Ve){const Ge=Math.min($e.length,Ve.length);if(Ge<2)return NaN;let lt=0,t=0,i=0,p=0;for(let _=0;_<Ge;_++){const k=Number($e[_]),v=Number(Ve[_]);lt+=k,t+=v,i+=k*k,p+=k*v}const y=Ge*i-lt*lt;return y?(Ge*p-lt*t)/y:NaN}function je($e,Ve){const Ge=os($e);if(!Ge)return"";if(Ve[Ge])return Ge;let lt="",t=1/0;for(const i of Object.keys(Ve)){if(!br(Ge,i))continue;const p=Va(Ge,i);p<t&&(t=p,lt=i)}return lt||Ge}function De($e,Ve){if(!$e||Ve==null)return;const Ge=String(Ve);Ge&&($e.includes(Ge)||$e.push(Ge))}const dt={},tt={totals:Xt(),totalsGross:qt(),totalsNet:qt(),byPar:{"Par 3":Xt(),"Par 4":Xt(),"Par 5":Xt(),Unknown:Xt()},byParGross:{"Par 3":qt(),"Par 4":qt(),"Par 5":qt(),Unknown:qt()},byParYards:{"Par 3":{},"Par 4":{},"Par 5":{},Unknown:{}},byParYardsGross:{"Par 3":{},"Par 4":{},"Par 5":{},Unknown:{}},byYards:{},byYardsGross:{},bySI:{"1‚Äì6":Xt(),"7‚Äì12":Xt(),"13‚Äì18":Xt(),Unknown:Xt()},bySIGross:{"1‚Äì6":qt(),"7‚Äì12":qt(),"13‚Äì18":qt(),Unknown:qt()}},Ct={};let Re=0;const we=B&&B.hiddenKeys instanceof Set?B.hiddenKeys:null;for(const $e of S){const Ve=$e.file||`round_${Re}`,Ge=[],lt=[],t=$e.parsed||{},i=Number.isFinite(t.dateMs)&&Number(t.dateMs)>0?Number(t.dateMs):R(Ve),p=t.players||[],y=t.courseTees||[],_=(()=>{try{const k=(p||[]).filter($=>!js($==null?void 0:$.name)).map(($,K)=>({idx:K,name:String(($==null?void 0:$.name)||"").trim(),points:Number(($==null?void 0:$.points)??($==null?void 0:$.pts)??NaN),back9:Number(($==null?void 0:$.back9)??0),perHole:Array.isArray($==null?void 0:$.perHole)?$.perHole.slice(0,18):[]})).filter($=>$.name&&Number.isFinite($.points));if(!k.length)return new Set;const v=k.slice().sort(($,K)=>K.points-$.points||va($,K)),ee=v[0].points,F=v.filter($=>$.points===ee);let oe=F.length?[F[0]]:[];for(let $=1;$<F.length;$++){const K=va(F[$],oe[0]);K>0?oe=[F[$]]:K===0&&oe.push(F[$])}return new Set(oe.map($=>String($.name).trim()))}catch{return new Set}})();for(const k of p){const v=k.name||"",ee=je(v,dt);if(we&&we.has(ee)||!v)continue;const F=pa(k,y)||{pars:Array(18).fill(NaN),yards:Array(18).fill(NaN),si:Array(18).fill(NaN)},oe=Array.isArray(k.perHole)?k.perHole:Array(18).fill(0),$=Array.isArray(F.pars)?F.pars:Array(18).fill(NaN),K=Array.isArray(F.yards)?F.yards:Array(18).fill(NaN),Ae=Array.isArray(F.si)?F.si:Array(18).fill(NaN),se=dt[ee]||(dt[ee]={name:String(v).replace(/\u00A0/g," ").replace(/\s+/g," ").trim(),rounds:0,files:[],totals:Xt(),totalsGross:qt(),totalsNet:qt(),byPar:{"Par 3":Xt(),"Par 4":Xt(),"Par 5":Xt(),Unknown:Xt()},byParGross:{"Par 3":qt(),"Par 4":qt(),"Par 5":qt(),Unknown:qt()},byParYards:{"Par 3":{},"Par 4":{},"Par 5":{},Unknown:{}},byParYardsGross:{"Par 3":{},"Par 4":{},"Par 5":{},Unknown:{}},byYards:{},byYardsGross:{},bySI:{"1‚Äì6":Xt(),"7‚Äì12":Xt(),"13‚Äì18":Xt(),Unknown:Xt()},bySIGross:{"1‚Äì6":qt(),"7‚Äì12":qt(),"13‚Äì18":qt(),Unknown:qt()},diag:{holesMissing:{par:0,si:0,yards:0},missingHoles:{par:[],si:[],yards:[]},teeLabelsSeen:[],teesMatched:[],issuesByFile:{}}});se.rounds+=1;const ct=String(v).replace(/\u00A0/g," ").replace(/\s+/g," ").trim();ct&&(!se.name||ct.length>se.name.length)&&(se.name=ct),$e.file&&!se.files.includes($e.file)&&se.files.push($e.file);const Ie=(k.teeLabel||k.tee||k.tee_name||"").toString().trim()||"(blank)",Ce=((F==null?void 0:F.teeName)||(F==null?void 0:F.name)||(F==null?void 0:F.label)||"(fallback/unknown)").toString().trim();De(se.diag.teeLabelsSeen,Ie),De(se.diag.teesMatched,Ce);const Ye=$e.file||"(unknown file)";se.diag.issuesByFile[Ye]||(se.diag.issuesByFile[Ye]={teeLabel:Ie,teeMatched:Ce,par:[],si:[],yards:[]});const Y=Array.isArray(oe)?oe:[],Ze=Y.reduce((ze,Ke)=>ze+Lt(Ke,0),0),Ut=Y.slice(0,9).reduce((ze,Ke)=>ze+Lt(Ke,0),0),Tt=Y.slice(9,18).reduce((ze,Ke)=>ze+Lt(Ke,0),0),It=Math.round(Lt(k.playingHcap??k.startExact??k.handicap??k.hcap??NaN,NaN)),Wt=Array.isArray(k.grossPerHole)?k.grossPerHole:null,Nt=Array.from({length:18},(ze,Ke)=>{const Ps=Lt(Y[Ke],NaN),Gs=Wt?Lt(Wt[Ke],NaN):NaN;return Number.isFinite(Ps)||Number.isFinite(Gs)&&Gs>0}),pt=Wt?Wt.map((ze,Ke)=>{if(!Nt[Ke])return NaN;const Ps=Number($[Ke]),Gs=Number(Ae[Ke]);let er=0;if(Number.isFinite(It)&&Number.isFinite(Gs)){const ua=Math.floor(It/18),$a=It%18;er=ua+($a>=Gs?1:0)}return Number.isFinite(ze)&&ze>0?ze:Number.isFinite(Ps)?Ps+er+2:NaN}):null,is=Wt?Wt.map((ze,Ke)=>Nt[Ke]&&!(Number.isFinite(ze)&&ze>0)):null,Fs=Nt.filter(Boolean).length,Bs=pt?pt.some((ze,Ke)=>Nt[Ke]&&!Number.isFinite(ze))?NaN:pt.reduce((ze,Ke)=>ze+(Number.isFinite(Ke)?Ke:0),0):NaN,We=pt?pt.slice(0,9).some((ze,Ke)=>Nt[Ke]&&!Number.isFinite(ze))?NaN:pt.slice(0,9).reduce((ze,Ke)=>ze+(Number.isFinite(Ke)?Ke:0),0):NaN,yt=pt?pt.slice(9,18).some((ze,Ke)=>Nt[Ke+9]&&!Number.isFinite(ze))?NaN:pt.slice(9,18).reduce((ze,Ke)=>ze+(Number.isFinite(Ke)?Ke:0),0):NaN,ys=Array.isArray($)?$.reduce((ze,Ke,Ps)=>ze+(Nt[Ps]?Lt(Ke,0):0),0):NaN;if(pt&&Array.isArray($)){const ze=se._parTypeAgg||(se._parTypeAgg={3:{over:0,n:0},4:{over:0,n:0},5:{over:0,n:0}});for(let Ke=0;Ke<18;Ke++){const Ps=Lt($[Ke],NaN),Gs=Lt(pt[Ke],NaN);!Number.isFinite(Ps)||!Number.isFinite(Gs)||(Ps===3||Ps===4||Ps===5)&&(ze[Ps].over+=Gs-Ps,ze[Ps].n+=1)}}(se.series||(se.series=[])).push({file:Ve,isWinner:_.has(String(v||"").trim()),idx:Re,dateMs:i,courseName:((t==null?void 0:t.courseName)||(t==null?void 0:t.internalCourseName)||(t==null?void 0:t.course)||"").toString(),teeName:((F==null?void 0:F.teeName)||(F==null?void 0:F.name)||(F==null?void 0:F.label)||"").toString(),teeGender:((F==null?void 0:F.gender)||(k==null?void 0:k.gender)||"M").toString(),teeLabel:((k==null?void 0:k.teeLabel)||(k==null?void 0:k.tee)||(k==null?void 0:k.tee_name)||"").toString(),teeSlope:Lt((F==null?void 0:F.slope)??(F==null?void 0:F.Slope)??(F==null?void 0:F.slopeRating)??(t==null?void 0:t.courseSlope)??(t==null?void 0:t.slope)??NaN,NaN),teeRating:Lt((F==null?void 0:F.rating)??(F==null?void 0:F.courseRating)??(t==null?void 0:t.courseRating)??(t==null?void 0:t.rating)??NaN,NaN),slope:Lt((F==null?void 0:F.slope)??(F==null?void 0:F.slopeRating)??(t==null?void 0:t.courseSlope)??(t==null?void 0:t.slope)??NaN,NaN),rating:Lt((F==null?void 0:F.rating)??(F==null?void 0:F.courseRating)??(t==null?void 0:t.courseRating)??(t==null?void 0:t.rating)??NaN,NaN),parsPerHole:Array.isArray(F==null?void 0:F.pars)?F.pars.slice(0,18):Array.isArray(F==null?void 0:F.par)?F.par.slice(0,18):[],siPerHole:Array.isArray(F==null?void 0:F.si)?F.si.slice(0,18):Array.isArray(F==null?void 0:F.SI)?F.SI.slice(0,18):[],startExact:Lt(k.handicap??k.startExact??k.handicapIndex??k.hcap??k.hi??NaN,NaN),gender:((k==null?void 0:k.gender)||(F==null?void 0:F.gender)||"M").toString(),perHole:Y.slice(0,18),parsArr:$.slice(0,18),siArr:Ae.slice(0,18),yardsArr:Array.isArray(K)?K.slice(0,18):[],pts:Ze,frontPts:Ut,backPts:Tt,hcap:It,gross:Bs,grossPerHole:pt?pt.slice(0,18):Array(18).fill(NaN),imputedGrossPerHole:pt?pt.slice(0,18):Array(18).fill(NaN),imputedMask:is?is.slice(0,18):null,frontGross:We,backGross:yt,parTotal:ys,holesPlayed:Fs}),Ge.push(Ze),Number.isFinite(Bs)&&lt.push(Bs);for(let ze=0;ze<18;ze++){const Ke=Lt(oe[ze],NaN),Ps=Array.isArray(k.grossPerHole)?k.grossPerHole:Array(18).fill(NaN),Gs=Lt(Ps[ze],NaN);if(!(Number.isFinite(Ke)||Number.isFinite(Gs)&&Gs>0))continue;Number.isFinite(Ke)&&(Ms(se.totals,Ke),Ms(tt.totals,Ke));const ua=Lt($[ze],NaN),$a=Lt(k.playingHcap??k.startExact??k.handicap??k.hcap??NaN,NaN),or=Lt(Ae[ze],NaN);let cr=0;if(Number.isFinite($a)&&Number.isFinite(or)){const _r=Math.floor($a/18),Rr=$a%18;cr=_r+(Rr>=or?1:0)}const tr=Gs,dr=Number.isFinite(tr)&&tr>0?tr:NaN,oa=Number.isFinite(dr)&&Number.isFinite(ua)?dr-ua:NaN;cs(se.totalsGross,oa),cs(tt.totalsGross,oa);const mr=Number.isFinite(oa)?oa-cr:NaN;cs(se.totalsNet,mr),cs(tt.totalsNet,mr);const as=ua===3?"Par 3":ua===4?"Par 4":ua===5?"Par 5":"Unknown";(!Number.isFinite(ua)||!(ua===3||ua===4||ua===5))&&(se.diag.holesMissing.par+=1,se.diag.missingHoles.par.push(ze+1),se.diag.issuesByFile[Ye].par.push(ze+1)),Number.isFinite(Ke)&&(Ms(se.byPar[as],Ke),Ms(tt.byPar[as],Ke)),(Ue=se.byParGross)[as]||(Ue[as]=qt()),(Yt=tt.byParGross)[as]||(Yt[as]=qt()),cs(se.byParGross[as],oa),cs(tt.byParGross[as],oa);const ts=ba(Lt(K[ze],NaN)),Pr=Lt(K[ze],NaN);Number.isFinite(Pr)||(se.diag.holesMissing.yards+=1,se.diag.missingHoles.yards.push(ze+1),se.diag.issuesByFile[Ye].yards.push(ze+1)),(ls=se.byParYards)[as]||(ls[as]={}),(Zt=tt.byParYards)[as]||(Zt[as]={}),(Ns=se.byParYards[as])[ts]||(Ns[ts]=Xt()),(Hs=tt.byParYards[as])[ts]||(Hs[ts]=Xt()),Number.isFinite(Ke)&&(Ms(se.byParYards[as][ts],Ke),Ms(tt.byParYards[as][ts],Ke)),($s=se.byParYardsGross)[as]||($s[as]={}),(na=tt.byParYardsGross)[as]||(na[as]={}),(As=se.byParYardsGross[as])[ts]||(As[ts]=qt()),(Zs=tt.byParYardsGross[as])[ts]||(Zs[ts]=qt()),cs(se.byParYardsGross[as][ts],oa),cs(tt.byParYardsGross[as][ts],oa),(Ds=se.byYards)[ts]||(Ds[ts]=Xt()),(Ls=tt.byYards)[ts]||(Ls[ts]=Xt()),Number.isFinite(Ke)&&(Ms(se.byYards[ts],Ke),Ms(tt.byYards[ts],Ke)),(ht=se.byYardsGross)[ts]||(ht[ts]=qt()),(Ts=tt.byYardsGross)[ts]||(Ts[ts]=qt()),cs(se.byYardsGross[ts],oa),cs(tt.byYardsGross[ts],oa);const qs=da(Lt(Ae[ze],NaN)),Cr=Lt(Ae[ze],NaN);Number.isFinite(Cr)||(se.diag.holesMissing.si+=1,se.diag.missingHoles.si.push(ze+1),se.diag.issuesByFile[Ye].si.push(ze+1)),(Ks=se.bySI)[qs]||(Ks[qs]=Xt()),(Js=tt.bySI)[qs]||(Js[qs]=Xt()),Ms(se.bySI[qs],Ke),Ms(tt.bySI[qs],Ke),(la=se.bySIGross)[qs]||(la[qs]=qt()),(ns=tt.bySIGross)[qs]||(ns[qs]=qt()),cs(se.bySIGross[qs],oa),cs(tt.bySIGross[qs],oa)}if(Ge.length){const ze=q(Ge),Ke=L(Ge),Ps=lt.length?q(lt):NaN,Gs=lt.length?L(lt):NaN;Ct[Ve]={mean:ze,sd:Ke,meanGross:Ps,sdGross:Gs,n:Ge.length,dateMs:i}}else Ct[Ve]={mean:NaN,sd:NaN,meanGross:NaN,sdGross:NaN,n:0,dateMs:i};Re+=1}}for(const $e of Object.keys(dt)){const Ve=(hs=dt[$e])==null?void 0:hs.diag;if(!Ve)continue;const Ge=lt=>Array.from(new Set(lt.map(Number).filter(t=>Number.isFinite(t)))).sort((t,i)=>t-i);Ve.missingHoles.par=Ge(Ve.missingHoles.par),Ve.missingHoles.si=Ge(Ve.missingHoles.si),Ve.missingHoles.yards=Ge(Ve.missingHoles.yards),Ve.teeLabelsSeen=Array.from(new Set((Ve.teeLabelsSeen||[]).map(String))),Ve.teesMatched=Array.from(new Set((Ve.teesMatched||[]).map(String)));for(const lt of Object.keys(Ve.issuesByFile||{})){const t=Ve.issuesByFile[lt];t.par=Ge(t.par||[]),t.si=Ge(t.si||[]),t.yards=Ge(t.yards||[])}}function Se($e){return $e.holes?$e.pts/$e.holes:0}function At($e){return $e.holes?$e.wipes/$e.holes:0}return{players:Object.values(dt).map($e=>{const Ve={...$e,deltas:{totals:{},byPar:{},byYards:{},bySI:{}},metrics:{}},Ge=Array.isArray($e.series)?$e.series.slice():[];Ge.sort((We,yt)=>{const ys=Number.isFinite(We.dateMs)&&Number(We.dateMs)>0?Number(We.dateMs):Number(We.idx||0),ze=Number.isFinite(yt.dateMs)&&Number(yt.dateMs)>0?Number(yt.dateMs):Number(yt.idx||0);return ys-ze});const lt=Ge.map(We=>Number(We.pts)).filter(Number.isFinite),t=Ge.map(We=>Number(We.frontPts)).filter(Number.isFinite),i=Ge.map(We=>Number(We.backPts)).filter(Number.isFinite),p=Ge.map(We=>Number(We.hcap)).filter(Number.isFinite),y=L(lt),_=Ge.map((We,yt)=>Number.isFinite(We.dateMs)?We.dateMs/864e5:yt),k=Ge.map(We=>Number(We.pts)),v=G(_,k),ee=lt.slice(0,3),F=lt.slice(-3),oe=ee.length?q(F)-q(ee):NaN,$=t.length&&i.length?q(i)-q(t):NaN,K=lt.length?q(lt)-36:NaN,Ae=p.length?q(p):NaN;let se=0,ct=0;for(const We of Ge){const yt=Ct[We.file]||null;if(!yt||!Number.isFinite(yt.mean)||!Number.isFinite(yt.sd)||yt.sd<=0)continue;const ys=(Number(We.pts)-yt.mean)/yt.sd;Number.isFinite(ys)&&(se+=ys,ct+=1)}const Ie=ct?se/ct:NaN,Ce=Ge.map(We=>Number(We.gross)).filter(Number.isFinite),Ye=Ce.length>=2?L(Ce):NaN,Y=Ce.length>=4?q(Ce.slice(0,Math.min(3,Ce.length)))-q(Ce.slice(Math.max(0,Ce.length-3))):NaN;let Ze=NaN;if(Ce.length>=2){const We=Ge.map((ze,Ke)=>Number.isFinite(ze.dateMs)?Number(ze.dateMs)/864e5:Ke),yt=Ge.map(ze=>Number(ze.gross)),ys=We.map((ze,Ke)=>({x:ze,y:yt[Ke]})).filter(ze=>Number.isFinite(ze.x)&&Number.isFinite(ze.y));if(ys.length>=2){const ze=G(ys.map(Ke=>Ke.x),ys.map(Ke=>Ke.y));Ze=Number.isFinite(ze)?-ze:NaN}}let Ut=0,Tt=0;for(const We of Ge){const yt=Ct[We.file]||null;if(!yt||!Number.isFinite(yt.meanGross)||!Number.isFinite(yt.sdGross)||yt.sdGross<=0)continue;const ys=(yt.meanGross-Number(We.gross))/yt.sdGross;Number.isFinite(ys)&&(Ut+=ys,Tt+=1)}const It=Tt?Ut/Tt:NaN,Wt=Ce.length?q(Ce):NaN,Nt=Ce.length?Math.min(...Ce):NaN,pt=Ve._parTypeAgg||null,is=pt&&pt[3]&&pt[3].n?pt[3].over/pt[3].n:NaN,Fs=pt&&pt[4]&&pt[4].n?pt[4].over/pt[4].n:NaN,Bs=pt&&pt[5]&&pt[5].n?pt[5].over/pt[5].n:NaN;Ve.metrics={rounds:Ge.length,volPts:y,velocity:v,trend3:oe,fb:$,avgDelta36:K,avgHcap:Ae,ctxZ:Ie,volGross:Ye,grossVelocity:Ze,grossTrend3:Y,ctxZG:It,avgGross:Wt,minGross:Nt,par3SOPH:is,par4SOPH:Fs,par5SOPH:Bs},Ve.deltas.totals={avgPts:Se($e.totals)-Se(tt.totals),wipeRate:At($e.totals)-At(tt.totals)};for(const We of Object.keys($e.byPar))Ve.deltas.byPar[We]={avgPts:Se($e.byPar[We])-Se(tt.byPar[We]),wipeRate:At($e.byPar[We])-At(tt.byPar[We])};for(const We of Object.keys($e.byYards)){const yt=tt.byYards[We]||Xt();Ve.deltas.byYards[We]={avgPts:Se($e.byYards[We])-Se(yt),wipeRate:At($e.byYards[We])-At(yt)}}for(const We of Object.keys($e.bySI)){const yt=tt.bySI[We]||Xt();Ve.deltas.bySI[We]={avgPts:Se($e.bySI[We])-Se(yt),wipeRate:At($e.bySI[We])-At(yt)}}return Ve}).sort(($e,Ve)=>$e.name.localeCompare(Ve.name)),field:tt}}function st(S){const B=Number(S);if(Number.isFinite(B)&&B>0)return B;const H=String(S??"").trim();if(!H)return NaN;let R=H.match(/\b(20\d{2})[-\/\.](0?[1-9]|1[0-2])[-\/\.](0?[1-9]|[12]\d|3[01])\b/);if(R)return Date.UTC(Number(R[1]),Number(R[2])-1,Number(R[3]));if(R=H.match(/\b(0?[1-9]|[12]\d|3[01])[-\/\.](0?[1-9]|1[0-2])[-\/\.](20\d{2})\b/),R)return Date.UTC(Number(R[3]),Number(R[2])-1,Number(R[1]));const q=Date.parse(H);if(Number.isFinite(q)){const L=new Date(q);return Date.UTC(L.getUTCFullYear(),L.getUTCMonth(),L.getUTCDate())}return NaN}function Be(S){try{const B=String(S||"");if(!B)return null;const H=B.slice(0,12e4),R=H.split(/\r?\n/).slice(0,250).join(`
`),q={jan:0,january:0,feb:1,february:1,mar:2,march:2,apr:3,april:3,may:4,jun:5,june:5,jul:6,july:6,aug:7,august:7,sep:8,sept:8,september:8,oct:9,october:9,nov:10,november:10,dec:11,december:11},L=Object.keys(q).sort((Ct,Re)=>Re.length-Ct.length).join("|"),G=(Ct,Re,we)=>{const Se=Number(Ct),At=Number(Re),Ft=Number(we);if(!Number.isFinite(Se)||!Number.isFinite(At)||!Number.isFinite(Ft)||Se<2e3||Se>2100||At<0||At>11||Ft<1||Ft>31)return null;const Ue=Date.UTC(Se,At,Ft);return Number.isFinite(Ue)?Ue:null};let je=H.match(/\b(20\d{2})[-\/\.](0?[1-9]|1[0-2])[-\/\.](0?[1-9]|[12]\d|3[01])\b/);if(je){const Ct=G(je[1],Number(je[2])-1,je[3]);if(Ct!==null)return Ct}if(je=H.match(/\b(0?[1-9]|[12]\d|3[01])[-\/\.](0?[1-9]|1[0-2])[-\/\.](20\d{2})\b/),je){const Ct=G(je[3],Number(je[2])-1,je[1]);if(Ct!==null)return Ct}const De=new RegExp(`(?:^|[^a-z])(${L})\\s+(\\d{1,2})(?:st|nd|rd|th)?\\s*,?\\s*(20\\d{2})`,"i");if(je=R.match(De)||H.match(De),je){const Ct=q[String(je[1]).toLowerCase()],Re=G(je[3],Ct,je[2]);if(Re!==null)return Re}const dt=new RegExp(`\\b(\\d{1,2})(?:st|nd|rd|th)?\\s+(${L})\\s+(20\\d{2})\\b`,"i");if(je=R.match(dt)||H.match(dt),je){const Ct=q[String(je[2]).toLowerCase()],Re=G(je[3],Ct,je[1]);if(Re!==null)return Re}const tt=R.match(/(?:^|,)\s*(date|round\s*date|event\s*date|played\s*on)\s*[,;:]\s*("?)([^"\r\n,;]+)\2/i);if(tt){const Ct=String(tt[3]||"").trim();let Re=st(Ct);if(Number.isFinite(Re)){const Se=new Date(Re);return Date.UTC(Se.getUTCFullYear(),Se.getUTCMonth(),Se.getUTCDate())}const we=Ct.match(/\b(0?[1-9]|[12]\d|3[01])[-\/\.](0?[1-9]|1[0-2])[-\/\.](20\d{2})\b/);if(we){const Se=G(we[3],Number(we[2])-1,we[1]);if(Se!==null)return Se}}return null}catch{return null}}async function Pt(S={}){if(!He){alert("Supabase client not ready");return}Cs(""),Rt(!0),es({done:0,total:0}),Ws({processed:[],skipped:[]});const B={};function H(we,Se){const At=Object.keys(we||{});for(const Ft of Se){const Ue=Ft instanceof RegExp?Ft:new RegExp(Ft,"i"),Yt=At.find(ls=>Ue.test(ls));if(Yt)return Yt}return null}async function R(we){var At,Ft;const Se=os(we||"");if(!Se)return null;if(B[Se]!==void 0)return B[Se];try{let Ue=null,Yt=await He.from("courses").select("id,name").eq("name",we).maybeSingle();if(!Yt.error&&Yt.data&&(Ue=Yt.data),Ue||(Yt=await He.from("courses").select("id,name").ilike("name",`%${we}%`).limit(1),!Yt.error&&Yt.data&&Yt.data.length&&(Ue=Yt.data[0])),!(Ue!=null&&Ue.id))return B[Se]=null,null;const ls=await He.from("tees").select("*").eq("course_id",Ue.id);if(ls.error||!((At=ls.data)!=null&&At.length))return B[Se]=null,null;const Zt=ls.data.map(ht=>ht.id),Ns=await He.from("hole_data").select("*").in("tee_id",Zt);if(Ns.error||!((Ft=Ns.data)!=null&&Ft.length))return B[Se]=null,null;const Hs=Ns.data,$s=Hs[0]||{},na=H($s,[/hole/i,/hole.*number/i,/number/i]),As=H($s,[/^par$/i,/par/i]),Zs=H($s,[/stroke.*index/i,/^si$/i,/handicap/i,/strokeindex/i]),Ds=H($s,[/yards?/i,/yardage/i,/distance/i,/length/i,/metre/i,/meter/i]),Ls=ls.data.map(ht=>{const Ts=Hs.filter(ns=>ns.tee_id===ht.id),Ks=Array(18).fill(NaN),Js=Array(18).fill(NaN),la=Array(18).fill(NaN);return Ts.forEach(ns=>{const $e=(Number(na?ns[na]:ns.hole_number)||0)-1;if($e<0||$e>=18)return;const Ve=Number(As?ns[As]:ns.par),Ge=Number(Zs?ns[Zs]:ns.stroke_index),lt=Number(Ds?ns[Ds]:ns.yards);Number.isFinite(Ve)&&(Ks[$e]=Ve),Number.isFinite(Ge)&&(Js[$e]=Ge),Number.isFinite(lt)&&(la[$e]=lt)}),{teeName:ht.color||ht.tee_name||ht.teeName||ht.name||"Tee",gender:ht.gender==="Women"||ht.gender==="F"||ht.gender==="Female"?"F":"M",slope:ds(ht.slope??ht.slope_rating??ht.slopeRating??ht.slope_value??ht.slope_val??ht.sr),rating:ds(ht.rating??ht.course_rating??ht.courseRating??ht.course_rating_value??ht.cr),pars:Ks,si:Js,yards:la}});return B[Se]=Ls,Ls}catch{return B[Se]=null,null}}async function q(we){const Se=[we],At=[],Ft=new Set;for(;Se.length;){const Ue=Se.pop();if(Ft.has(Ue))continue;Ft.add(Ue);const Yt=await He.storage.from(f).list(Ue,{limit:1e3,sortBy:{column:"name",order:"asc"}});if(!Yt.error)for(const ls of Yt.data||[]){const Zt=ls&&ls.name?String(ls.name):"";if(!Zt||Zt.startsWith("."))continue;if(!ls.id&&!ls.metadata){Se.push(Ue?Ue+"/"+Zt:Zt);continue}if(Zt.toLowerCase().endsWith(".csv")){const Hs=Ue?Ue+"/"+Zt:Zt;At.push({name:Zt,path:Hs})}}}return At}const L=await q(E);if(!L.length){Rt(!1),Cs('No CSV files found under prefix "'+E+'".');return}es({done:0,total:L.length});const G=[],je=[],De=[];let dt=0;for(const we of L)try{const Se=await He.storage.from(f).download(we.path);if(Se.error)De.push({file:we.path,reason:"download"});else{const At=await Se.data.text(),Ft=Be(At)||_extractDateMsFromPath(we.path)||null;let Ue=null;try{Ue=Ua(At);const Yt=await R(Ue.courseName||Ue.internalCourseName||"");Yt&&Yt.length&&(Ue.courseTees=Yt)}catch{Ue=null}!Ue||!Ue.players||!Ue.players.length?De.push({file:we.path,reason:"parse/empty"}):(!Number.isFinite(Ue.dateMs)&&Number.isFinite(Ft)&&(Ue.dateMs=Ft),G.push({file:we.path,parsed:Ue,dateMs:Number.isFinite(Ue.dateMs)?Ue.dateMs:Ft}),je.push(we.path))}}catch{De.push({file:we.path,reason:"error"})}finally{dt+=1,es({done:dt,total:L.length})}G.sort((we,Se)=>{var Ue,Yt;const At=Number.isFinite(Number(we==null?void 0:we.dateMs))?Number(we.dateMs):Number.isFinite(Number((Ue=we==null?void 0:we.parsed)==null?void 0:Ue.dateMs))?Number(we.parsed.dateMs):we!=null&&we.date?st(we.date):Number.POSITIVE_INFINITY,Ft=Number.isFinite(Number(Se==null?void 0:Se.dateMs))?Number(Se.dateMs):Number.isFinite(Number((Yt=Se==null?void 0:Se.parsed)==null?void 0:Yt.dateMs))?Number(Se.parsed.dateMs):Se!=null&&Se.date?st(Se.date):Number.POSITIVE_INFINITY;return At!==Ft?At-Ft:String((we==null?void 0:we.file)||"").localeCompare(String((Se==null?void 0:Se.file)||""))});const tt=G.map(we=>we.file);Ws({processed:tt,skipped:De}),at(G);const Ct=St(G,ce,Le),Re=Mt(Ct);ye(Re);try{typeof window<"u"&&(window.__seasonModel=Re)}catch{}try{typeof window<"u"&&(window.__dslUiState={seasonYear:ce,seasonLimit:Le})}catch{}!Ys&&Re.players.length&&Xs(Re.players[0].name),Rt(!1);try{const we=S&&typeof S=="object"&&S.afterView?String(S.afterView):"player_progress";r(we)}catch{r("player_progress")}}const[h,P]=he.useState([]),[z,Q]=he.useState([]),[ne,le]=he.useState({}),[Ee,be]=he.useState(Ra);he.useEffect(()=>{try{document.title=Oa}catch{}},[Oa]);const[Ne,_e]=he.useState([]),[rt,nt]=he.useState(""),[et,Pe]=he.useState(null),it=he.useRef(null),[Xe,kt]=he.useState(0),[Ot,gs]=he.useState(0);he.useEffect(()=>{try{if(!Array.isArray(z)||z.length===0||!Array.isArray(Ne)||Ne.length===0||!Ne.filter(L=>Number(L.slope)>0&&Number(L.rating)>0).length)return;const B=new Map;for(const L of z){const G=Na(L,Ne);if(!G||!(Number(G.slope)>0)||!(Number(G.rating)>0))continue;const je=`${(G.teeName||"").toLowerCase()}|${(G.gender||"M").toUpperCase()}`,De=B.get(je)||{tee:G,n:0};De.n+=1,B.set(je,De)}if(!B.size)return;let H=null;for(const L of B.values())(!H||L.n>H.n)&&(H=L);if(!H)return;const R=Number(H.tee.slope)||0,q=Number(H.tee.rating)||0;R&&q&&(Number(Xe)!==R&&kt(R),Number(Ot)!==q&&gs(q))}catch{}},[z,Ne]);const[Et,Es]=he.useState("raw"),[ss,Bt]=he.useState("den"),[ws,zs]=he.useState(12),[ma,Is]=he.useState({}),[ta,ja]=he.useState([]);he.useEffect(()=>{let S=!1;async function B(){try{try{T([]),at([]),Ws({processed:[],skipped:[]}),Cs(""),w([])}catch{}if(!M){j("Waiting for society...");return}const H=s&&s.supabase?s.supabase:typeof window<"u"&&window.__supabase_client__?window.__supabase_client__:rr(`https://mqknahdfpqxrpgpxqtus.supabase.co
`,`eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1xa25haGRmcHF4cnBncHhxdHVzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI0NTU3MDYsImV4cCI6MjA3ODAzMTcwNn0.GTUVsrRJ-MClMg96vuHZpUtAnUFtCsJvuLiiE0D-fCc
`,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}});if(typeof window<"u"&&(window.__supabase_client__=H),S)return;Je(H);const R=async L=>{if(!((L==null?void 0:L.user)??null)){Qe.current=!1;return}if(!Qe.current){Qe.current=!0;try{await H.rpc("claim_memberships_from_email")}catch{}}};H.auth.getSession().then(async({data:{session:L}})=>{Z((L==null?void 0:L.user)??null),await R(L)}),H.auth.onAuthStateChange(async(L,G)=>{Z((G==null?void 0:G.user)??null),await R(G)});const q=await H.from(ve).select("name").limit(1);q.error?j("Error: "+q.error.message):(j("Connected"),await Ia(H),await Ta(H),await Sa(H),await Ba(H),await Ea(H),await bs(H))}catch(H){S||j("Error: "+((H==null?void 0:H.message)||H))}}return B(),()=>{S=!0}},[M]),he.useEffect(()=>{He&&Sa(He)},[He,ot]);async function Vs(S,B){if(!S||!B){J(!0);return}V(!0);try{const{error:H}=await He.auth.signInWithPassword({email:S,password:B});if(H)throw H;zt("Logged in"),J(!1)}finally{V(!1)}}async function sa(){try{typeof window<"u"&&(window.__activeSocietyId="",window.__activeSocietySlug="",window.__activeSocietyName="",window.__activeSocietyRole="")}catch{}try{sessionStorage.removeItem("dsl_active_society_id"),sessionStorage.removeItem("dsl_active_society_slug"),sessionStorage.removeItem("dsl_active_society_name"),localStorage.removeItem("den_active_society_id_v1"),localStorage.removeItem("dsl_active_society_id"),localStorage.removeItem("dsl_active_society_slug"),localStorage.removeItem("dsl_active_society_name")}catch{}try{const S="/golf/";window.location.href=S.endsWith("/")?S:S+"/"}catch{try{window.location.href="/golf/"}catch{}}}async function xs(){try{await He.auth.signOut()}catch{}Z(null);try{window.location.reload()}catch{alert("Logged out")}}async function bs(S){try{if(S=S||He,!S)return;const B=`${E}/admin`,H=await S.storage.from(f).list(B,{search:"player_visibility.json",limit:1});if(!H||H.error||!Array.isArray(H.data)||H.data.length===0)return;const R=await S.storage.from(f).download(jt);if(R&&R.data){const q=await R.data.text(),L=JSON.parse(q),G=Array.isArray(L==null?void 0:L.hiddenKeys)?L.hiddenKeys:Array.isArray(L==null?void 0:L.hidden)?L.hidden:[];if(Array.isArray(G)){const je=G.map(De=>String(De||"").trim()).filter(Boolean);_t(Array.from(new Set(je)));try{localStorage.setItem(vt,JSON.stringify(Array.from(new Set(je))))}catch{}}}}catch{}}async function wa(S){const B=Array.from(new Set((Array.isArray(S)?S:[]).map(H=>String(H||"").trim()).filter(Boolean)));_t(B);try{localStorage.setItem(vt,JSON.stringify(B))}catch{}if(He){if(!te){zt("Saved locally (sign in to publish to everyone)");return}try{const H=JSON.stringify({hiddenKeys:B,updatedAt:new Date().toISOString(),updatedBy:(te==null?void 0:te.email)||""},null,2),R=new Blob([H],{type:"application/json"}),q=await He.storage.from(f).upload(jt,R,{upsert:!0,contentType:"application/json"});q&&q.error?zt("Save failed: "+q.error.message):zt("Player filter saved ‚úì")}catch(H){zt("Save failed: "+((H==null?void 0:H.message)||H))}}}async function Ea(S){if(S=S||He,!S)return;const{data:B,error:H}=await S.from("courses").select("id, name").order("name");!H&&B&&P(B)}async function aa(S){if(!h.length||!S)return!1;const B=String(S).toLowerCase().replace(/\.csv$/i,"").replace(/[_\-]/g," ").replace(/[^a-z0-9\s]/g," ").replace(/\s+/g," ").trim(),H=new Set(["golf","club","course","society","gc","the","and","of","at","&","resort","links","hotel","country","park","estate"]),R=B.split(/\s+/).map(De=>De.trim()).filter(De=>De&&De.length>2&&!H.has(De)),q=new Set(R);let L=null,G=-1,je=1e9;for(const De of h){const dt=String(De.name||"").toLowerCase().replace(/[^a-z0-9\s]/g," ").replace(/\s+/g," ").trim(),tt=dt.split(/\s+/).map(Ft=>Ft.trim()).filter(Ft=>Ft&&Ft.length>2&&!H.has(Ft));if(!tt.length)continue;let Ct=0,Re=0;for(const Ft of tt)q.has(Ft)&&(Ct++,Re+=Ft.length);const we=Ct*100+Re,Se=Ct>0||br(B,dt)?Va(os(B),os(dt)):1e9;(Ct>0||Se<6)&&(we>G||we===G&&Se<je)&&(G=we,je=Se,L=De)}return L?(zt(`Auto-detected: ${L.name}`),await La(L.id),!0):!1}async function La(S){if(!He||!S)return;const B=await He.from("courses").select("name").eq("id",S).single();B.data&&nt(B.data.name);const H=await He.from("tees").select("*").eq("course_id",S);if(H.error||!H.data.length){zt("No tee data found for this course.");return}const R=H.data,q=R.map(De=>De.id),L=await He.from("hole_data").select("*").in("tee_id",q);if(L.error){zt("Error loading hole data.");return}const G=L.data;kt(0),gs(0);const je=R.map(De=>{const dt=G.filter(we=>we.tee_id===De.id).sort((we,Se)=>we.hole_number-Se.hole_number),tt=Array(18).fill(0),Ct=Array(18).fill(0),Re=Array(18).fill(0);return dt.forEach(we=>{const Se=we.hole_number-1;Se>=0&&Se<18&&(tt[Se]=we.par,Ct[Se]=we.stroke_index,Re[Se]=we.yards)}),{teeName:De.color,gender:De.gender==="Women"||De.gender==="F"||De.gender==="Female"?"F":"M",slope:Number(De.slope)||0,rating:Number(De.rating)||0,pars:tt,si:Ct,yards:Re}});_e(je)}function Rs(S){const B={};for(const R of S||[]){const q=Number(R==null?void 0:R.dateMs),L=Number.isFinite(q)&&q>0?new Date(q).getUTCFullYear():null,G=String((R==null?void 0:R.name)||"").match(/(20\d{2})/),je=L?String(L):G?G[1]:"Unknown";(B[je]||(B[je]=[])).push({...R,dateMs:Number.isFinite(q)?q:null})}return Object.keys(B).sort((R,q)=>{const L=Number(R),G=Number(q),je=Number.isFinite(L)?L:1/0,De=Number.isFinite(G)?G:1/0;return je-De}).map(R=>{const q=(B[R]||[]).slice().sort((L,G)=>{const je=Number(L==null?void 0:L.dateMs),De=Number(G==null?void 0:G.dateMs),dt=Number.isFinite(je)&&je>0?je:1/0,tt=Number.isFinite(De)&&De>0?De:1/0;return dt!==tt?dt-tt:String((L==null?void 0:L.name)||"").localeCompare(String((G==null?void 0:G.name)||""))});return{year:R,events:q}})}function Ss(S,B){try{const H=Number(S),R=new Date(st(S));if(!Number.isFinite(R.getTime()))return null;const q=R.toISOString().slice(0,10);for(const L of B||[]){const G=String(L.start_date||L.startDate||"").slice(0,10),je=String(L.end_date||L.endDate||"").slice(0,10);if(G&&je&&q>=G&&q<je)return String(L.season_id)}return null}catch{return null}}async function Ta(S){if(S=S||He,!S)return;const B=await S.from("seasons").select("competition,season_id,label,start_date,end_date,is_active").eq("competition",D).eq("society_id",M).eq("society_id",M).order("start_date",{ascending:!1});if(B.error){zt("Seasons load failed: "+B.error.message);return}const H=Array.isArray(B.data)?B.data:[];w(H);try{typeof window<"u"&&(window.__dslSeasonsDef=H)}catch{}const R=H.find(L=>L.is_active)||H[0],q=R?String(R.season_id):"";bt(q),qe(L=>{const G=String(L||"");return!G||G.toLowerCase()==="all"?q||"All":G})}async function Ia(S){if(S=S||He,!S)return;const B=await S.storage.from(f).list(E,{limit:1e3,sortBy:{column:"name",order:"asc"}});if(B.error){zt("Storage error: "+B.error.message);return}const H=(B.data||[]).filter(R=>(R==null?void 0:R.name)&&!R.name.startsWith(".")&&/\.csv$/i.test(R.name)).map(R=>({name:R.name.replace(/\.csv$/i,""),file:R.name,path:`${E}/${R.name}`,dateMs:null}));for(const R of H)try{const q=await S.storage.from(f).download(R.path);if(q.error)continue;const L=await q.data.text();R.dateMs=Be(L)||_extractDateMsFromPath(R.file)||null,R.seasonId=R.dateMs&&Ss(R.dateMs,ke)||null;try{const G=Ua(L);R.courseName=(G==null?void 0:G.courseName)||(G==null?void 0:G.internalCourseName)||"",R.format=(G==null?void 0:G.format)||(G==null?void 0:G.gameFormat)||(G==null?void 0:G.formatName)||""}catch{R.courseName=R.courseName||"",R.format=R.format||""}}catch{}T(Rs(H))}async function Ka(S){var L;if(!He){alert("Supabase client not ready");return}const B=await He.storage.from(f).download(S.path);if(B.error){alert("Download failed: "+B.error.message);return}const H=await B.data.text();let R;try{R=Ua(H)}catch(G){alert((G==null?void 0:G.message)||"Failed to parse CSV.");return}Q(R.players||[]),N(((L=R.players[0])==null?void 0:L.name)||""),be(S.name),Pe(null);try{const G=Number.isFinite(R==null?void 0:R.dateMs)?R.dateMs:Be(H)||_extractDateMsFromPath(S.path)||null;x(Number.isFinite(G)?G:null)}catch{x(null)}c((S==null?void 0:S.name)||String((S==null?void 0:S.path)||"").split("/").pop()||""),await aa(R.courseName||S.file)||(_e(R.courseTees||[]),nt(R.courseName||"")),r("event"),zt("Event loaded")}async function Sa(S){if(S=S||He,!S)return;let B=S.from(ve).select("*").eq("competition",D).eq("society_id",M);ot&&String(ot).toLowerCase()!=="all"&&(B=B.eq("season_id",String(ot)));const H=await B;if(H.error){j("Error: "+H.error.message);return}const R={};for(const q of H.data||[]){if(js(q.name))continue;let L=[];if(Array.isArray(q.best_per_hole))L=q.best_per_hole;else if(typeof q.best_per_hole=="string")try{L=JSON.parse(q.best_per_hole)}catch{}R[q.name]={name:q.name,totalPoints:q.total_points||0,events:q.events||0,bestEventPoints:q.best_event_points??0,bestHolePoints:q.best_hole_points??0,eclecticTotal:q.eclectic_total??0,bestPerHole:(L||[]).map(G=>Number(G)||0)}}le(R)}async function Ba(S){if(S=S||He,!!S)try{const B=await S.from(ve).select("name,exclude_from_odds").eq("competition",D).eq("society_id",M).neq("name","");if(B.error)return;const H={},R=[];for(const q of B.data||[]){const L=String((q==null?void 0:q.name)||"").trim();if(!L)continue;const G=os(L);G&&q!=null&&q.exclude_from_odds&&(H[G]=!0,R.push(L))}Is(H),ja(R)}catch{}}async function us(S,B){const H=String(S||"").trim();if(!H)return;const R=os(H);if(R){Is(q=>({...q||{},[R]:!!B}));try{const q=await He.from(ve).update({exclude_from_odds:!!B}).eq("competition",D).eq("society_id",M).eq("name",H);q!=null&&q.error&&zt("Could not update odds visibility: "+q.error.message)}catch{zt("Could not update odds visibility")}finally{try{await Ba(He)}catch{}}}}function Ga(S,B,H){var q;let R;try{R=Ua(S)}catch(L){alert((L==null?void 0:L.message)||"Failed to parse CSV.");return}Q(R.players||[]),N(((q=R.players[0])==null?void 0:q.name)||""),be((B||"").replace(/\.[^.]+$/,"")),x(Number.isFinite(R==null?void 0:R.dateMs)?R.dateMs:Be(S)||null),c(B||""),H&&Pe(H),aa(R.courseName||B).then(L=>{L||(_e(R.courseTees||[]),nt(R.courseName||""))}),r("event")}function va(S,B){const H=S.perHole||[],R=B.perHole||[],q=(Ct,Re,we)=>Ct.slice(Re,we).reduce((Se,At)=>Se+(Number(At)||0),0),L=q(H,9,18),G=q(R,9,18);if(L!==G)return G-L;const je=q(H,12,18),De=q(R,12,18);if(je!==De)return De-je;const dt=q(H,15,18),tt=q(R,15,18);return dt!==tt?tt-dt:0}const ra=he.useMemo(()=>{var Ct;if(!z.length)return[];const S=z.map((Re,we)=>{const Se=Number(Re.handicap),At=Number.isFinite(Se)?Se:0,Ft=Math.round(At);let Ue=null;if(Et==="calc"){const Yt=Number(Xe)||113,ls=Number(Ot)||0;let Zt=72;try{const Hs=Na({gender:Re.gender,teeLabel:Re.teeLabel},Ne);if(Hs&&Array.isArray(Hs.pars)&&Hs.pars.length){const $s=Hs.pars.reduce((na,As)=>na+(Number.isFinite(Number(As))?Number(As):0),0);$s>0&&(Zt=$s)}}catch{}const Ns=At*(Yt/113)+(ls-Zt);Ue=Math.round(Ns)}return{idx:we,name:Re.name,gender:Re.gender,teeLabel:Re.teeLabel,startExact:At,playingHcap:Ft,playingHcapRef:Ue,points:Re.points,back9:Re.back9,perHole:Re.perHole,grossPerHole:Re.grossPerHole,imputedGrossPerHole:Re.imputedGrossPerHole,imputedMask:Re.imputedMask,bestBallPerHole:Re.bestBallPerHole}}),B=[...S].sort((Re,we)=>we.points-Re.points||va(Re,we)),H=Re=>{const we=Array.isArray(Re==null?void 0:Re.perHole)?Re.perHole:[],Se=(Yt,ls)=>we.slice(Yt,ls).reduce((Zt,Ns)=>Zt+(Number(Ns)||0),0),At=Se(9,18),Ft=Se(12,18),Ue=Se(15,18);return`${Number(Re==null?void 0:Re.points)||0}|${At}|${Ft}|${Ue}`},R=[];let q=[],L=null;for(const Re of B){const we=H(Re);L===null||we===L?q.push(Re.idx):(R.push(q),q=[Re.idx]),L=we}q.length&&R.push(q);const G=((Ct=R[0])==null?void 0:Ct.map(Re=>S.find(we=>we.idx===Re)))||[];let je=G.length?[G[0]]:[];for(let Re=1;Re<G.length;Re++){const we=va(G[Re],je[0]);we>0?je=[G[Re]]:we===0&&je.push(G[Re])}const De=new Set(je.map(Re=>Re.idx));let dt=1;const tt=[];for(let Re=0;Re<R.length;Re++){const we=R[Re],Se=dt,At=Lr[Se-1]||0;for(const Ft of we){const Ue=S.find(ht=>ht.idx===Ft),Yt=De.has(Ft)&&Re===0;let ls="-",Zt=Number(Ue.startExact);if(ss==="den"){const ht=jr(Ue.startExact,Ue.gender,Ue.points,Ue.back9,Yt);Zt=xa(Number(ht.nextExact),0,36),ls=Number.isFinite(Zt)?Zt.toFixed(1):"‚Äî"}else if(ss==="whs"){let ht=null,Ts=Number(Xe)||113,Ks=Number(Ot)||0;try{ht=Na(Ue,Ne),ht&&Number(ht.slope)>0&&(Ts=Number(ht.slope)),ht&&Number(ht.rating)>0&&(Ks=Number(ht.rating))}catch{}const Js=ht?{pars:ht.pars||ht.par||ht.Pars||[],si:ht.si||ht.SI||ht.strokeIndex||[]}:{pars:[],si:[]},la=nr(Ue.imputedGrossPerHole||Ue.grossPerHole,Js,Ue.startExact,Ts,Ks);let ns=ir(la,Ts,Ks,0);const hs=[];try{const Ge=Ue.file||null;for(const lt of Array.isArray(U)?U:[]){if(!lt||!lt.parsed||Ge&&lt.file===Ge)continue;const t=lt.parsed,i=Array.isArray(t.players)?t.players:[],p=os(String(Ue.name||"")),y=i.find(se=>os(String((se==null?void 0:se.name)||""))===p);if(!y)continue;let _=null,k=Number(t.courseSlope)||Number(Xe)||113,v=Number(t.courseRating)||Number(Ot)||0;const ee=t.courseTees||Ne||[];try{_=Na(y,ee),_&&Number(_.slope)>0&&(k=Number(_.slope)),_&&Number(_.rating)>0&&(v=Number(_.rating))}catch{}const F=_?{pars:_.pars||_.par||[],si:_.si||_.SI||[]}:{pars:[],si:[]},oe=Number(y.startExact??y.hi??y.handicap),$=y.grossPerHole||y.imputedGrossPerHole;if(!Array.isArray($)||$.length===0)continue;const K=nr($,F,oe,k,v),Ae=ir(K,k,v,0);Number.isFinite(Ae)&&hs.push({d:Ae,t:Number(lt.dateMs)||0})}}catch{}Number.isFinite(ns)&&hs.push({d:ns,t:Number(Date.now())}),hs.sort((Ge,lt)=>Ge.t-lt.t);const $e=hs.slice(-20).map(Ge=>Ge.d),Ve=Sr($e);Zt=Number.isFinite(Ve)?xa(Number(Ve),0,36):xa(Number(Ue.startExact),0,36),ls=Number.isFinite(Ve)?Ve.toFixed(1):Number.isFinite(ns)?ns.toFixed(1):"‚Äî"}else Zt=xa(Number(Ue.startExact),0,36),ls=Number.isFinite(Zt)?Zt.toFixed(1):"‚Äî";let Ns=0,Hs=0,$s=0,na=!1,As=0,Zs=4,Ds=0,Ls=36;try{const ht=[];for(const hs of Array.isArray(U)?U:[]){if(!hs||!hs.parsed)continue;const $e=hs.parsed,Ve=Array.isArray($e.players)?$e.players:[],Ge=os(String(Ue.name||"")),lt=Ve.find(p=>os(String((p==null?void 0:p.name)||""))===Ge);if(!lt)continue;let t=Number(lt.points);if(!Number.isFinite(t)&&Array.isArray(lt.perHole))try{t=lt.perHole.reduce((p,y)=>p+(Number(y)||0),0)}catch{t=NaN}let i=Number(lt.startExact);Number.isFinite(i)||(i=Number(lt.handicap)),Number.isFinite(i)||(i=Number(lt.hcap)),Number.isFinite(i)||(i=Number(lt.HI)),Number.isFinite(i)||(i=Number(lt.hi)),Number.isFinite(t)&&ht.push({p:t,t:Number(hs.dateMs)||0,h:i})}Number.isFinite(Number(Ue.points))&&ht.push({p:Number(Ue.points),t:Number(Date.now()),h:Number(Ue.startExact)}),ht.sort((hs,$e)=>hs.t-$e.t);const Ts=ht.slice(-Math.max(3,Math.min(12,Number(ws)||12))),Ks=Number.isFinite(Number(Zt))?Number(Zt):Number(Ue.startExact),Js=Ts.filter(hs=>Number.isFinite(Number(hs.h))&&Math.abs(Number(hs.h)-Ks)<=4);Hs=Js.length;const la=Js.length>=3?Js:Ts;na=Js.length>=3;const ns=la.map(hs=>Number(hs.p)).filter(Number.isFinite);if($s=ns.length,Ns=ns.length,Ns>=2){const $e=ns.map((v,ee)=>Math.pow(.5,(Ns-1-ee)/6)),Ve=$e.reduce((v,ee)=>v+ee,0)||1,Ge=$e.reduce((v,ee)=>v+ee*ee,0)||1,lt=Math.max(1,Ve*Ve/Ge),t=ns.map(v=>v-36),i=t.reduce((v,ee,F)=>v+ee*$e[F],0)/Ve,p=t.reduce((v,ee,F)=>v+$e[F]*Math.pow(ee-i,2),0)/Ve,_=lt/(lt+6);As=i*_;const k=Math.sqrt(Math.max(1,p));Zs=Math.min(8,k*(1+1/Math.sqrt(lt)));try{const v=ns.map((Ae,se)=>se),ee=v.reduce((Ae,se,ct)=>Ae+se*$e[ct],0)/Ve,F=t.reduce((Ae,se,ct)=>Ae+se*$e[ct],0)/Ve,oe=t.reduce((Ae,se,ct)=>Ae+$e[ct]*(v[ct]-ee)*(se-F),0),$=v.reduce((Ae,se,ct)=>Ae+$e[ct]*Math.pow(se-ee,2),0),K=$>1e-9?oe/$:0;Ds=(Number.isFinite(K)?K:0)*_}catch{Ds=0}Ls=36+As}else Ns===1?(As=(ns[0]-36)*.15,Zs=6,Ds=0,Ls=36+As):(As=0,Zs=6,Ds=0,Ls=36)}catch{Ns=0,As=0,Zs=6,Ds=0,Ls=36}try{const ht=Number.isFinite(Number(Zt))&&Number.isFinite(Number(Ue.startExact))?Number(Zt)-Number(Ue.startExact):0,Ts=Number.isFinite(Ds)?Math.max(-2,Math.min(2,Ds*.75)):0;Ls=Math.max(20,Math.min(50,Number(Ls)+ht+Ts))}catch{}tt.push({...Ue,position:Se,leaguePoints:At,isWinner:Yt,nextDisplay:ls,nextExactNum:Zt,formN:Ns,oddsRoundsUsed:$s,oddsSimilarRounds:Hs,oddsUsedSimilar:na,formMu:As,formTrend:Ds,formSigma:Zs,expPts:Ls})}dt+=we.length}return tt.sort((Re,we)=>Re.position-we.position)},[z,Ne,Xe,Ot,Et,ss,U,ws]);async function Qa(S){const B=await S.from("seasons").select("season_id").eq("society_id",M).eq("competition",D).order("start_date",{ascending:!1}).limit(1);if(B.data&&B.data.length)return B.data[0].season_id;const H=new Date().getFullYear(),R=String(H),q=`${H}-01-01`,L=`${H+1}-01-01`,{error:G}=await S.from("seasons").insert({society_id:M,competition:D,season_id:R,label:R,start_date:q,end_date:L,is_active:!0});if(G)throw G;return R}async function qa(){var B;if(!ra.length){zt("Load an event first");return}if(!te){alert("Please log in as admin first.");return}if(et){zt("Uploading file...");const H=et.name,R=`${E}/${H}`,{error:q}=await He.storage.from(f).upload(R,et,{upsert:!0});q?alert("File upload failed: "+q.message):zt("File uploaded successfully.")}const S={...ne};for(const H of ra){if(js(H.name))continue;const R=S[H.name]||{name:H.name,totalPoints:0,events:0,bestPerHole:Array(18).fill(0),bestEventPoints:0,bestHolePoints:0},q=(H.perHole||[]).map(dt=>Math.max(0,Math.min(6,Number(dt)||0))),L=R.bestPerHole.map((dt,tt)=>Math.max(dt,q[tt])),G=L.reduce((dt,tt)=>dt+tt,0),je=Math.max(R.bestEventPoints||0,H.points||0),De=Math.max(R.bestHolePoints||0,Math.max(...q));S[H.name]={name:H.name,totalPoints:(R.totalPoints||0)+(H.leaguePoints||0),events:(R.events||0)+1,bestEventPoints:je,bestHolePoints:De,eclecticTotal:G,bestPerHole:L}}if(le(S),He){const H=Object.values(S).filter(G=>!js(G.name));let R=ot&&String(ot).toLowerCase()!=="all"?String(ot):((B=ke.find(G=>G&&G.is_active))==null?void 0:B.season_id)||"";R||(R=await Qa(He));try{const G=Number.isFinite(A)?A:null,je=et&&et.name?et.name:g||"";if(G&&je){const De=new Date(G).toISOString().slice(0,10),dt=`${E}/${je}`,tt=await He.from("events").upsert([{society_id:M,competition:D,season_id:R,event_name:(je||"").replace(/\.[^.]+$/,""),storage_bucket:f,storage_path:dt,event_date:De}],{onConflict:"society_id,competition,season_id,storage_path"});tt!=null&&tt.error&&(console.error("events upsert failed",tt.error),zt("Events insert failed: "+tt.error.message))}else G?je||console.warn("No file name available; events table not updated."):console.warn("No event_date detected for this CSV; events table not updated.")}catch(G){console.error("Failed to save event metadata to events table:",G)}const q=H.map(G=>({society_id:M,season_id:R,competition:D,name:G.name,total_points:G.totalPoints,events:G.events,best_event_points:G.bestEventPoints,best_hole_points:G.bestHolePoints,eclectic_total:G.eclecticTotal,best_per_hole:G.bestPerHole})),L=await He.from(ve).upsert(q,{onConflict:"society_id,season_id,competition,name"});L.error?zt("Error: "+L.error.message):zt("Season updated ‚úì"),await Ia(He)}}async function ka(){var H,R;if(!(ot&&String(ot).toLowerCase()!=="all"?String(ot):((H=ke.find(q=>q&&q.is_active))==null?void 0:H.season_id)||"")){zt("Select a season first");return}if(!ra.length){zt("Load an event first");return}if(!window.confirm("Remove this event from the season standings?"))return;const B={...ne};for(const q of ra){const L=B[q.name];if(!L)continue;const G=L.totalPoints-q.leaguePoints,je=Math.max(0,L.events-1);G<=0&&je===0?delete B[q.name]:B[q.name]={...L,totalPoints:G,events:je}}if(le(B),He){const q=Object.values(B).filter(De=>!js(De.name)),L=ot&&String(ot).toLowerCase()!=="all"?String(ot):((R=ke.find(De=>De&&De.is_active))==null?void 0:R.season_id)||"";if(!L){zt("Select a season first");return}const G=q.map(De=>({society_id:M,season_id:L,competition:D,name:De.name,total_points:De.totalPoints,events:De.events,best_event_points:De.bestEventPoints,best_hole_points:De.bestHolePoints,eclectic_total:De.eclecticTotal,best_per_hole:De.bestPerHole})),je=await He.from(ve).upsert(G,{onConflict:"society_id,season_id,competition,name"});je.error?zt("Error: "+je.error.message):zt("Event removed from season ‚úì")}}async function Da(){var L,G;if(!He){zt("No client");return}if(!te){alert("Please log in as admin first.");return}const S=ot&&String(ot).toLowerCase()!=="all"?String(ot):((L=ke.find(je=>je&&je.is_active))==null?void 0:L.season_id)||"";if(!S){zt("Select a season first");return}if(!window.confirm("‚ö† This will delete ALL standings rows, event records, and CSV files for the selected season. Continue?"))return;const B=await He.from("events").select("storage_path, storage_bucket").eq("society_id",M).eq("competition",D).eq("season_id",S);if(B!=null&&B.error){zt("Error loading events: "+B.error.message);return}const H=Array.isArray(B==null?void 0:B.data)?B.data:[],R=H.map(je=>String((je==null?void 0:je.storage_path)||"").trim()).filter(Boolean);if(R.length>0){const je=String(((G=H.find(dt=>dt==null?void 0:dt.storage_bucket))==null?void 0:G.storage_bucket)||f).trim()||f,De=await He.storage.from(je).remove(R);if(De!=null&&De.error){zt("Storage delete failed: "+De.error.message);return}}if(H.length>0){const je=await He.from("events").delete().eq("society_id",M).eq("competition",D).eq("season_id",S);if(je!=null&&je.error){zt("Error deleting event records: "+je.error.message);return}}const q=await He.from(ve).delete().eq("competition",D).eq("society_id",M).eq("season_id",S).neq("name","");if(q.error){zt("Error: "+q.error.message);return}le({}),zt(`Season cleared (${R.length} file${R.length===1?"":"s"} removed)`),await Ta(He),await Sa(He),await Ia(He)}const Fa=ue.useMemo(()=>{const S=new Map,B=R=>{const q=String(R||"").trim();if(!q)return;try{if(typeof js=="function"&&js(q))return}catch{}const L=os(q);L&&(S.has(L)||S.set(L,q))};try{Object.values(ne||{}).forEach(R=>B(R==null?void 0:R.name))}catch{}try{((ut==null?void 0:ut.players)||[]).forEach(R=>B(R==null?void 0:R.name))}catch{}try{(ra||[]).forEach(R=>B(R==null?void 0:R.name))}catch{}return Array.from(S.values()).sort((R,q)=>R.localeCompare(q)).map(R=>({name:R}))},[ne,ut,ra]),Aa=ue.useMemo(()=>{try{if(!Kt||Kt.size===0)return ne;const S={};return Object.entries(ne||{}).forEach(([B,H])=>{const R=H&&H.name?String(H.name):String(B||""),q=os(R);q&&Kt.has(q)||(S[B]=H)}),S}catch{return ne}},[ne,Kt]),ks=ue.useMemo(()=>{try{return!Kt||Kt.size===0?ra:(ra||[]).filter(S=>{const B=S&&S.name?String(S.name):"",H=os(B);return!(H&&Kt.has(H))})}catch{return ra}},[ra,Kt]);ue.useMemo(()=>{try{return!Kt||Kt.size===0?z:(z||[]).filter(S=>{const B=S&&S.name?String(S.name):"",H=os(B);return!(H&&Kt.has(H))})}catch{return z}},[z,Kt]);const Pa=ue.useMemo(()=>{const S=((te==null?void 0:te.email)||"").toLowerCase();return S?(Hr||[]).map(B=>String(B).toLowerCase()).includes(S):!1},[te==null?void 0:te.email]);return e.jsx("div",{className:"min-h-screen p-4 sm:p-6 bg-neutral-50",children:e.jsxs("div",{className:"app-shell space-y-4 pt-1",children:[e.jsx(nn,{leagueHeaderTitle:Oa,eventName:Ee,statusMsg:b,courseName:rt,view:a,setView:r}),e.jsx(Tr,{open:X,busy:I,onClose:()=>J(!1),onSubmit:Vs}),e.jsx(Br,{open:Te,onClose:()=>xe(!1),onSubmit:re}),e.jsx(Gr,{open:W,onClose:()=>de(!1),isAdmin:!!te,players:Fa,hiddenKeys:Jt,onSave:wa}),e.jsx(ln,{statusMsg:b,courseName:rt}),e.jsx("button",{className:"fixed right-3 bottom-3 z-[9999] w-11 h-11 rounded-full bg-neutral-900 text-white flex items-center justify-center shadow-xl border border-white/10 hover:-translate-y-[1px] transition",onClick:()=>r("guide"),title:"Guide","aria-label":"Guide",children:"üß≠"}),a==="home"&&e.jsx(on,{runSeasonAnalysis:Pt,setView:r,fileInputRef:it,importLocalCSV:Ga,computed:ks,addEventToSeason:qa,removeEventFromSeason:ka,clearSeason:Da,user:te,activeRole:m.role,isSuperAdmin:Pa,handleLogin:Vs,handleLogout:xs,handleSwitchSociety:sa,openPlayersAdmin:me,visiblePlayersCount:((ae==null?void 0:ae.players)||[]).length,totalPlayersCount:(Fa||[]).length}),a==="admin"&&e.jsx(cn,{setView:r,fileInputRef:it,importLocalCSV:Ga,computed:ks,addEventToSeason:qa,removeEventFromSeason:ka,clearSeason:Da,seasonsDef:ke,leagueSeasonYear:ot,setLeagueSeasonYear:qe,activeSocietyId:String((m==null?void 0:m.id)||""),activeSocietySlug:String((m==null?void 0:m.slug)||""),user:te,activeRole:m.role,isSuperAdmin:Pa,handleLogin:Vs,handleLogout:xs,handleSwitchSociety:sa,openPlayersAdmin:me,visiblePlayersCount:((ae==null?void 0:ae.players)||[]).length,totalPlayersCount:(Fa||[]).length}),a==="player_progress"&&e.jsx(yn,{seasonModel:ae,seasonFiles:ha,reportNextHcapMode:wt,setReportNextHcapMode:ft,seasonPlayer:Ys,setSeasonPlayer:Xs,seasonYear:ce,setSeasonYear:gt,seasonLimit:Le,setSeasonLimit:Fe,seasonYears:ie,seasonLoading:Qt,seasonProgress:ps,seasonError:Ht,runSeasonAnalysis:Pt,setView:r,scoringMode:Us,setScoringMode:Qs,grossCompare:ea,setGrossCompare:_s}),a==="past"&&e.jsx(dn,{sharedGroups:O,loadShared:Ka,setView:r}),a==="event"&&e.jsx(un,{computed:ks,setView:r,courseSlope:Xe,setCourseSlope:kt,courseRating:Ot,setCourseRating:gs,startHcapMode:Et,setStartHcapMode:Es,nextHcapMode:ss,setNextHcapMode:Bt,oddsMaxRounds:ws,setOddsMaxRounds:zs,seasonRoundsFiltered:Gt,seasonRoundsAll:ge,seasonModelAll:$t,oddsExcludeMap:ma,oddsExcludedNames:ta,setExcludeFromOdds:us}),a==="banter"&&e.jsx(pn,{computed:ks,setView:r}),a==="guide"&&e.jsx(An,{setView:r,leagueTitle:Ra}),a==="mirror_read"&&e.jsx(Fn,{setView:r}),a==="ratings"&&e.jsx(hn,{computed:ks,courseTees:Ne,setView:r}),a==="standings"&&e.jsx(xn,{season:Aa,setView:r,seasonsDef:ke,seasonYear:ot,setSeasonYear:qe}),a==="eclectic"&&e.jsx(bn,{season:Aa,setView:r,seasonsDef:ke,seasonYear:ot,setSeasonYear:qe}),a==="graphs"&&e.jsx(fn,{computed:ks,courseTees:Ne,setView:r}),a==="scorecard"&&e.jsx(mn,{computed:ks,courseTees:Ne,setView:r}),a==="course_stats"&&e.jsx(Pn,{computed:ks,courseTees:Ne,setView:r}),a==="headtohead"&&e.jsx(Cn,{computed:ks,setView:r,courseTees:Ne}),a==="style"&&e.jsx(_n,{computed:ks,setView:r}),a==="story"&&e.jsx(Rn,{computed:ks,setView:r}),a==="replay"&&e.jsx(In,{computed:ks,setView:r}),a==="team_replay"&&e.jsx(gn,{computed:ks,courseTees:Ne,courseSlope:Xe,courseRating:Ot,startHcapMode:Et,setView:r}),a==="casino"&&e.jsx(Hn,{computed:ks,courseTees:Ne,setView:r}),a==="trophies"&&e.jsx(Mn,{computed:ks,courseTees:Ne,setView:r}),a==="partner"&&e.jsx(En,{computed:ks,setView:r})]})})}function Pn({computed:s,courseTees:a,setView:r}){const u=ue.useMemo(()=>ca(s),[s]);if(!s.length)return e.jsxs("section",{className:"content-card p-4 md:p-6",children:[e.jsx(ga,{items:[{label:"Game",onClick:()=>r("event"),title:"Round Leaderboard"},{label:"Course Stats"}]}),e.jsx(ms,{setView:r,hasEvent:!!(s&&s.length)}),e.jsx("p",{className:"text-neutral-600",children:"Load an event to see course stats."})]});const d=Array.from({length:u}).map((l,f)=>({hole:f+1,totalPts:0,count:0,zeros:0,threesPlus:0}));s.forEach(l=>{(l.perHole||[]).slice(0,u).forEach((f,E)=>{const D=Number(f)||0;d[E].totalPts+=D,d[E].count++,D===0&&d[E].zeros++,D>=3&&d[E].threesPlus++})});const A=a.find(l=>l.gender==="M")||a[0]||{},x=A.pars||Array(18).fill(0),g=A.si||Array(18).fill(0),c=d.map((l,f)=>{const E=l.count?l.totalPts/l.count:0;return{...l,par:x[f],si:g[f],avg:E}}),o=[...c].sort((l,f)=>l.avg-f.avg),m={};o.forEach((l,f)=>{m[l.hole]=f+1});const M=c.map(l=>({...l,playedRank:m[l.hole],diff:m[l.hole]-l.si})),n=l=>l>=2.2?"bg-emerald-100 text-emerald-800":l>=1.8?"bg-neutral-50 text-neutral-800":l>=1.4?"bg-orange-50 text-orange-800":"bg-red-50 text-red-800 font-bold";return e.jsxs("section",{className:"content-card p-4 md:p-6",children:[e.jsx(ms,{setView:r,hasEvent:!!(s&&s.length)}),e.jsx("h2",{className:"text-lg font-semibold text-squab-900 mb-1",children:"Course Difficulty Analysis"}),e.jsx("p",{className:"text-xs text-neutral-500 mb-4",children:"Comparing scorecard Stroke Index (SI) vs actual field performance."}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-6",children:[e.jsxs("div",{className:"p-3 border border-red-200 bg-red-50 rounded-2xl",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wide text-red-700 font-bold",children:"Hardest Hole"}),e.jsxs("div",{className:"text-xl font-bold text-red-900 mt-1",children:["Hole ",o[0].hole]}),e.jsxs("div",{className:"text-xs text-red-800",children:["Avg: ",o[0].avg.toFixed(2)," pts"]})]}),e.jsxs("div",{className:"p-3 border border-emerald-200 bg-emerald-50 rounded-2xl",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wide text-emerald-700 font-bold",children:"Easiest Hole"}),e.jsxs("div",{className:"text-xl font-bold text-emerald-900 mt-1",children:["Hole ",o[o.length-1].hole]}),e.jsxs("div",{className:"text-xs text-emerald-800",children:["Avg: ",o[o.length-1].avg.toFixed(2)," pts"]})]}),e.jsxs("div",{className:"p-3 border border-squab-200 bg-white rounded-2xl",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wide text-neutral-600 font-bold",children:"Most Wipes"}),e.jsxs("div",{className:"text-lg font-bold text-neutral-900 mt-1",children:["Hole ",M.sort((l,f)=>f.zeros-l.zeros)[0].hole]}),e.jsxs("div",{className:"text-xs text-neutral-500",children:[M.sort((l,f)=>f.zeros-l.zeros)[0].zeros," players"]})]}),e.jsxs("div",{className:"p-3 border border-squab-200 bg-white rounded-2xl",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-wide text-neutral-600 font-bold",children:"Most 3+ Pts"}),e.jsxs("div",{className:"text-lg font-bold text-neutral-900 mt-1",children:["Hole ",M.sort((l,f)=>f.threesPlus-l.threesPlus)[0].hole]}),e.jsxs("div",{className:"text-xs text-neutral-500",children:[M.sort((l,f)=>f.threesPlus-l.threesPlus)[0].threesPlus," players"]})]})]}),e.jsx("div",{className:"overflow-auto table-wrap",children:e.jsxs("table",{className:"min-w-full text-xs md:text-sm text-center",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-squab-200 bg-squab-50 text-neutral-700",children:[e.jsx("th",{className:"py-2 px-2 text-left",children:"Hole"}),e.jsx("th",{className:"py-2 px-2",children:"Par"}),e.jsx("th",{className:"py-2 px-2",children:"Card SI"}),e.jsx("th",{className:"py-2 px-2 bg-neutral-100 border-l border-neutral-200",children:"Field Avg Pts"}),e.jsx("th",{className:"py-2 px-2 bg-neutral-100 border-r border-neutral-200",children:"Played Rank"}),e.jsx("th",{className:"py-2 px-2",children:"Diff"}),e.jsx("th",{className:"py-2 px-2 text-red-600",children:"Wipes"})]})}),e.jsx("tbody",{children:[...M].sort((l,f)=>(Number(l.playedRank)||999)-(Number(f.playedRank)||999)).map(l=>e.jsxs("tr",{className:"border-b border-squab-100 hover:bg-squab-50",children:[e.jsx("td",{className:"py-2 px-2 text-left font-bold",children:l.hole}),e.jsx("td",{className:"py-2 px-2",children:l.par||"-"}),e.jsx("td",{className:"py-2 px-2",children:l.si||"-"}),e.jsx("td",{className:`py-2 px-2 font-mono font-medium border-l border-neutral-200 ${n(l.avg)}`,children:l.avg.toFixed(2)}),e.jsx("td",{className:"py-2 px-2 font-bold bg-neutral-50 border-r border-neutral-200",children:l.playedRank}),e.jsx("td",{className:"py-2 px-2 text-xs text-neutral-500",children:Math.abs(l.diff)>=4?e.jsx("span",{className:l.diff<0?"text-red-600 font-bold":"text-emerald-600 font-bold",children:l.diff<0?"Harder":"Easier"}):e.jsx("span",{className:"text-neutral-300",children:"‚Äî"})}),e.jsx("td",{className:"py-2 px-2 text-neutral-400",children:l.zeros>0?e.jsx("span",{className:"text-neutral-800",children:l.zeros}):"-"})]},l.hole))})]})})]})}function Cn({computed:s,setView:a,courseTees:r}){const[u,d]=he.useState(""),[A,x]=he.useState("");if(he.useEffect(()=>{var ce;s.length>=2&&!u&&!A&&(d(s[0].name),x(((ce=s[1])==null?void 0:ce.name)||s[0].name))},[s,u,A]),s.length<2||!u||!A)return e.jsxs("section",{className:"rounded-2xl p-4 bg-white border border-squab-200 shadow-sm",children:[e.jsx(ms,{setView:a,hasEvent:!!(s&&s.length)}),e.jsx("p",{className:"text-neutral-600",children:"Need at least 2 distinct players loaded."})]});const g=s.find(ce=>ce.name===u)||s[0],c=s.find(ce=>ce.name===A)||s[1],o=(g.perHole||[]).map(ce=>Number(ce)||0),m=(c.perHole||[]).map(ce=>Number(ce)||0),M=Na(g,r),n=Na(c,r),l=(M==null?void 0:M.pars)||Array(18).fill(0),f=(n==null?void 0:n.pars)||Array(18).fill(0),E=(ce,gt)=>ce.reduce((ot,qe,Dt)=>gt[Dt]===3?ot+(qe||0):ot,0),D=E(o,l),C=E(m,f),N=ce=>ce.reduce((gt,ot)=>gt+ot,0),X=N(o),J=N(m),I=N(o.slice(0,9)),V=N(m.slice(0,9)),te=N(o.slice(9)),Z=N(m.slice(9));let Qe=0,ve=0,xt=0,mt=0;const vt=[];o.forEach((ce,gt)=>{const ot=m[gt];ce>ot?Qe++:ot>ce?ve++:xt++;const qe=ce>ot?1:ot>ce?-1:0;mt+=qe,vt.push(mt)});const jt=X-J,He=jt>0?g.name:jt<0?c.name:"Draw",Je=jt>0?"text-emerald-600":jt<0?"text-blue-600":"text-neutral-600",b=150,j=600,O={top:15,bottom:25,left:30,right:15},T=Math.max(...vt.map(Math.abs),5),ae=ce=>{const gt=(ce+T)/(T*2);return b-O.bottom-gt*(b-O.top-O.bottom)},ye=ce=>O.left+ce*((j-O.left-O.right)/17),U=vt.map((ce,gt)=>`${ye(gt)},${ae(ce)}`).join(" "),at=ae(0);return e.jsxs("section",{className:"rounded-2xl p-4 bg-white border border-squab-200 shadow-sm",children:[e.jsx(ms,{setView:a,hasEvent:!!(s&&s.length)}),e.jsxs("div",{className:"flex flex-wrap items-end justify-between gap-4 mb-4 border-b border-squab-100 pb-4",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"text-[10px] font-bold text-emerald-600 uppercase tracking-wider block mb-1",children:"Player A"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{className:"w-full p-2 rounded-lg border border-squab-200 bg-white text-sm font-semibold focus:ring-2 focus:ring-emerald-500 outline-none",value:u,onChange:ce=>d(ce.target.value),children:s.map(ce=>e.jsx("option",{value:ce.name,children:ce.name},ce.name))}),e.jsx("div",{className:"text-xl font-bold text-emerald-700 w-12 text-center",children:X})]})]}),e.jsxs("div",{className:"hidden md:flex flex-col items-center px-2 pb-2",children:[e.jsx("span",{className:"text-xs font-bold text-neutral-300",children:"VS"}),e.jsx("span",{className:`text-sm font-bold ${Je} whitespace-nowrap`,children:jt===0?"TIED":`${He} +${Math.abs(jt)}`})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"text-[10px] font-bold text-blue-600 uppercase tracking-wider block mb-1 text-right md:text-left",children:"Player B"}),e.jsxs("div",{className:"flex items-center gap-2 flex-row-reverse md:flex-row",children:[e.jsx("select",{className:"w-full p-2 rounded-lg border border-squab-200 bg-white text-sm font-semibold focus:ring-2 focus:ring-blue-500 outline-none",value:A,onChange:ce=>x(ce.target.value),children:s.map(ce=>e.jsx("option",{value:ce.name,children:ce.name},ce.name))}),e.jsx("div",{className:"text-xl font-bold text-blue-700 w-12 text-center",children:J})]})]})]}),e.jsx("div",{className:"md:hidden text-center mb-4 -mt-2",children:e.jsx("span",{className:`text-sm font-bold ${Je}`,children:jt===0?"TIED":`${He} +${Math.abs(jt)}`})}),e.jsxs("div",{className:"mb-6 relative h-[150px] w-full bg-squab-50/50 rounded-2xl border border-squab-100",children:[e.jsxs("svg",{viewBox:`0 0 ${j} ${b}`,className:"w-full h-full block",children:[e.jsx("line",{x1:O.left,y1:at,x2:j-O.right,y2:at,stroke:"#cbd5e1",strokeWidth:"1",strokeDasharray:"4 4"}),e.jsx("polyline",{points:U,fill:"none",stroke:"#4b5563",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),vt.map((ce,gt)=>e.jsx("circle",{cx:ye(gt),cy:ae(ce),r:"3",className:ce>0?"fill-emerald-500":ce<0?"fill-blue-500":"fill-neutral-400",stroke:"white",strokeWidth:"1.5"},gt)),e.jsx("text",{x:O.left,y:b-5,className:"text-[9px] fill-neutral-400",textAnchor:"middle",children:"1"}),e.jsx("text",{x:j/2,y:b-5,className:"text-[9px] fill-neutral-400",textAnchor:"middle",children:"9"}),e.jsx("text",{x:j-O.right,y:b-5,className:"text-[9px] fill-neutral-400",textAnchor:"middle",children:"18"})]}),e.jsx("div",{className:"absolute top-1 left-2 text-[9px] font-bold text-emerald-600/50 pointer-events-none",children:"A Leads"}),e.jsx("div",{className:"absolute bottom-6 left-2 text-[9px] font-bold text-blue-600/50 pointer-events-none",children:"B Leads"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-neutral-50 rounded-2xl p-3 border border-neutral-100",children:[e.jsxs("div",{className:"flex justify-between items-center text-xs mb-2 font-semibold text-neutral-500",children:[e.jsx("span",{children:"Match Play"}),e.jsxs("span",{children:[xt," halved"]})]}),e.jsxs("div",{className:"w-full bg-white h-2.5 rounded-full overflow-hidden flex shadow-sm",children:[e.jsx("div",{style:{width:`${Qe/18*100}%`},className:"bg-emerald-400"}),e.jsx("div",{style:{width:`${xt/18*100}%`},className:"bg-neutral-200"}),e.jsx("div",{style:{width:`${ve/18*100}%`},className:"bg-blue-400"})]}),e.jsxs("div",{className:"flex justify-between text-[10px] mt-1 font-medium",children:[e.jsxs("span",{className:"text-emerald-700",children:[Qe," won"]}),e.jsxs("span",{className:"text-blue-700",children:[ve," won"]})]})]}),e.jsx("div",{className:"bg-white rounded-2xl border border-neutral-100 overflow-hidden",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-neutral-50 border-b border-neutral-100 text-neutral-500 uppercase",children:[e.jsx("th",{className:"py-1.5 w-1/3 text-center text-emerald-700",children:g.name.split(" ")[0]}),e.jsx("th",{className:"py-1.5 w-1/3 text-center",children:"Sector"}),e.jsx("th",{className:"py-1.5 w-1/3 text-center text-blue-700",children:c.name.split(" ")[0]})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-50",children:[{l:"Front 9",a:I,b:V},{l:"Back 9",a:te,b:Z},{l:"Par 3s",a:D,b:C}].map((ce,gt)=>e.jsxs("tr",{children:[e.jsx("td",{className:`py-1.5 text-center font-bold ${ce.a>ce.b?"text-emerald-600 bg-emerald-50/30":"text-neutral-600"}`,children:ce.a}),e.jsx("td",{className:"py-1.5 text-center text-neutral-400 font-medium",children:ce.l}),e.jsx("td",{className:`py-1.5 text-center font-bold ${ce.b>ce.a?"text-blue-600 bg-blue-50/30":"text-neutral-600"}`,children:ce.b})]},gt))})]})})]})]})}function _n({computed:s,setView:a}){if(!s.length)return e.jsxs("section",{className:"rounded-2xl p-4 bg-white border border-squab-200 shadow-sm",children:[e.jsx(ms,{setView:a,hasEvent:!!(s&&s.length)}),e.jsx("p",{className:"text-neutral-600",children:"Load an event to see style analysis."})]});const r=he.useMemo(()=>ca(s),[s]),u=s.map(l=>{const f=(Array.isArray(l.perHole)?l.perHole:[]).slice(0,r).map(C=>rs(C,NaN)),E=f.filter(C=>Number.isFinite(C)&&C===0).length,D=f.filter(C=>Number.isFinite(C)&&C>=3).length;return{name:l.name,wipes:E,fireworks:D,total:l.points}}),d=400,A=600,x={top:40,right:40,bottom:50,left:50},g=A-x.left-x.right,c=d-x.top-x.bottom,o=Math.max(...u.map(l=>l.wipes),5)+1,m=Math.max(...u.map(l=>l.fireworks),4)+1,M=l=>l/o*g,n=l=>c-l/m*c;return e.jsxs("section",{className:"content-card p-4 md:p-6",children:[e.jsx(ms,{setView:a,hasEvent:!!(s&&s.length)}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-squab-900",children:"Play Style Matrix"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Mapping players by Aggression (3+ pts) vs. Errors (0 pts)."})]}),e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsx("div",{className:"min-w-[600px] relative",children:e.jsxs("svg",{viewBox:`0 0 ${A} ${d}`,className:"w-full h-auto bg-neutral-50 rounded-2xl border border-neutral-100",children:[Array.from({length:o+1}).map((l,f)=>e.jsx("line",{x1:x.left+M(f),y1:x.top,x2:x.left+M(f),y2:d-x.bottom,stroke:"#e5e5e5",strokeWidth:"1"},`x-${f}`)),Array.from({length:m+1}).map((l,f)=>e.jsx("line",{x1:x.left,y1:x.top+n(f),x2:A-x.right,y2:x.top+n(f),stroke:"#e5e5e5",strokeWidth:"1"},`y-${f}`)),e.jsx("text",{x:x.left+g*.15,y:x.top+c*.15,className:"text-sm font-bold fill-emerald-100 uppercase tracking-widest select-none",children:"The Gunslinger"}),e.jsx("text",{x:x.left+g*.85,y:x.top+c*.15,className:"text-sm font-bold fill-red-100 uppercase tracking-widest text-right select-none",textAnchor:"end",children:"The Tourist"}),e.jsx("text",{x:x.left+g*.15,y:x.top+c*.9,className:"text-sm font-bold fill-emerald-100 uppercase tracking-widest select-none",children:"The Shark"}),e.jsx("text",{x:x.left+g*.85,y:x.top+c*.9,className:"text-sm font-bold fill-neutral-200 uppercase tracking-widest text-right select-none",textAnchor:"end",children:"The Grinder"}),e.jsx("text",{x:A/2,y:d-10,textAnchor:"middle",className:"text-xs font-bold fill-neutral-500 uppercase tracking-widest",children:"Chaos Factor (Wipes / 0 pts) ‚Üí"}),e.jsx("text",{transform:`rotate(-90 15 ${d/2})`,x:15,y:d/2,textAnchor:"middle",className:"text-xs font-bold fill-neutral-500 uppercase tracking-widest",children:"Fireworks (3+ pts holes) ‚Üí"}),e.jsx("g",{transform:`translate(${x.left}, ${x.top})`,children:u.map(l=>{const f=M(l.wipes),E=n(l.fireworks),D=l.fireworks>=m/2,C=l.wipes>=o/2;let N="#a3a3a3";return!C&&D&&(N="#10b981"),C&&D&&(N="#a855f7"),!C&&!D&&(N="#3b82f6"),C&&!D&&(N="#f97316"),e.jsxs("g",{className:"group cursor-pointer",children:[e.jsx("circle",{cx:f,cy:E,r:6,fill:N,stroke:"white",strokeWidth:"2",className:"transition-all duration-300 group-hover:r-8"}),e.jsxs("text",{x:f,y:E-10,textAnchor:"middle",className:"text-[10px] font-bold fill-neutral-700 opacity-0 group-hover:opacity-100 transition-opacity bg-white",style:{textShadow:"0px 0px 4px white"},children:[l.name," (",l.total,"pts)"]}),(l.fireworks===Math.max(...u.map(X=>X.fireworks))||l.wipes===Math.max(...u.map(X=>X.wipes)))&&e.jsx("text",{x:f,y:E+15,textAnchor:"middle",className:"text-[9px] fill-neutral-400 font-medium pointer-events-none",children:l.name.split(" ")[0]})]},l.name)})})]})})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"p-3 bg-emerald-50 rounded-2xl border border-emerald-100",children:[e.jsx("div",{className:"text-xs font-bold text-emerald-800 uppercase",children:"The Shark"}),e.jsx("div",{className:"text-[10px] text-emerald-600",children:"High Fireworks, Low Wipes. The zone you want to be in."})]}),e.jsxs("div",{className:"p-3 bg-purple-50 rounded-2xl border border-purple-100",children:[e.jsx("div",{className:"text-xs font-bold text-purple-800 uppercase",children:"The Gunslinger"}),e.jsx("div",{className:"text-[10px] text-purple-600",children:"High Fireworks, High Wipes. Volatile, exciting, dangerous."})]}),e.jsxs("div",{className:"p-3 bg-blue-50 rounded-2xl border border-blue-100",children:[e.jsx("div",{className:"text-xs font-bold text-blue-800 uppercase",children:"The Grinder"}),e.jsx("div",{className:"text-[10px] text-blue-600",children:"Low Fireworks, Low Wipes. Boring golf, often places in the money."})]}),e.jsxs("div",{className:"p-3 bg-orange-50 rounded-2xl border border-orange-100",children:[e.jsx("div",{className:"text-xs font-bold text-orange-800 uppercase",children:"The Tourist"}),e.jsx("div",{className:"text-[10px] text-orange-600",children:"Low Fireworks, High Wipes. Just here for the banter."})]})]})]})}function Rn({computed:s,setView:a}){if(!s.length)return e.jsxs("section",{className:"rounded-2xl p-4 bg-white border border-squab-200 shadow-sm",children:[e.jsx(ms,{setView:a,hasEvent:!!(s&&s.length)}),e.jsx("p",{className:"text-neutral-600",children:"Load an event to see the story."})]});const r=he.useMemo(()=>ca(s),[s]),u=Array.from({length:r}).map((C,N)=>{let X=-1,J=[];return s.forEach(I=>{const V=rs(I.perHole[N],NaN);Number.isFinite(V)&&(V>X?(X=V,J=[I.name.split(" ")[0]]):V===X&&J.push(I.name.split(" ")[0]))}),{hole:N+1,bestPts:X,contributors:J}}),d=u.reduce((C,N)=>C+N.bestPts,0),x=s.slice(0,5).map((C,N)=>{let X=0;const J=(Array.isArray(C.perHole)?C.perHole:[]).slice(0,r).map(V=>(X+=rs(V,0)||0,X)),I=["#10b981","#3b82f6","#f59e0b","#8b5cf6","#ec4899"];return{name:C.name,points:J,color:I[N%I.length]}}),g=300,c=800,o={top:20,right:80,bottom:30,left:30},m=c-o.left-o.right,M=g-o.top-o.bottom,n=Math.max(...x.map(C=>C.points[r-1]??0)),l=Math.max(1,n),f=Math.max(1,r-1),E=C=>C/f*m,D=C=>M-C/l*M;return e.jsxs("section",{className:"rounded-2xl p-4 md:p-6 bg-white border border-squab-200 shadow-sm space-y-8",children:[e.jsx(ms,{setView:a,hasEvent:!!(s&&s.length)}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-squab-900 mb-1",children:"The Race for the Title"}),e.jsx("p",{className:"text-sm text-neutral-500 mb-4",children:"Cumulative progress of the Top 5 finishers. See where the lead changed."}),e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsx("div",{className:"min-w-[600px] relative",children:e.jsxs("svg",{viewBox:`0 0 ${c} ${g}`,className:"w-full h-auto bg-white rounded-2xl border border-squab-100",children:[[0,.25,.5,.75,1].map(C=>{const N=Math.round(l*C),X=D(N)+o.top;return e.jsxs("g",{children:[e.jsx("line",{x1:o.left,y1:X,x2:c-o.right,y2:X,stroke:"#f3f4f6"}),e.jsx("text",{x:o.left-5,y:X+3,textAnchor:"end",className:"text-[10px] fill-neutral-400",children:N})]},C)}),Array.from({length:r}).map((C,N)=>e.jsx("text",{x:o.left+E(N),y:g-10,textAnchor:"middle",className:"text-[10px] fill-neutral-400",children:N+1},N)),x.map((C,N)=>{const X=C.points.map((J,I)=>`${I===0?"M":"L"} ${o.left+E(I)} ${o.top+D(J)}`).join(" ");return e.jsxs("g",{children:[e.jsx("path",{d:X,fill:"none",stroke:C.color,strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",className:"opacity-90 hover:opacity-100 hover:stroke-[4]"}),e.jsx("text",{x:o.left+E(r-1)+5,y:o.top+D(C.points[r-1]??0)+3,className:"text-[10px] font-bold",fill:C.color,children:C.name.split(" ")[0]})]},C.name)})]})})})]}),e.jsx("div",{className:"border-t border-squab-100"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-end mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-squab-900 mb-1",children:'The "Perfect" Round'}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Best score recorded on every hole combined."})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-neutral-500 uppercase tracking-wide",children:"Potential Total"}),e.jsxs("div",{className:"text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-emerald-500 to-teal-600",children:[d," pts"]})]})]}),e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-6 md:grid-cols-9 gap-2",children:u.map(C=>e.jsxs("div",{className:`p-2 rounded-lg border flex flex-col items-center justify-between h-20 ${C.bestPts>=4?"bg-purple-50 border-purple-200":"bg-white border-squab-100"}`,children:[e.jsxs("div",{className:"text-[10px] text-neutral-400 font-bold",children:["Hole ",C.hole]}),e.jsxs("div",{className:`text-xl font-bold ${C.bestPts>=4?"text-purple-600":"text-emerald-600"}`,children:[C.bestPts," ",e.jsx("span",{className:"text-[10px] text-neutral-400 font-normal",children:"pts"})]}),e.jsx("div",{className:"text-[9px] text-neutral-600 truncate w-full text-center",title:C.contributors.join(", "),children:C.contributors.length>1?`${C.contributors.length} players`:C.contributors[0]})]},C.hole))})]})]})}function Hn({computed:s,courseTees:a,setView:r}){if(!s.length)return e.jsxs("section",{className:"rounded-2xl p-4 bg-white border border-squab-200 shadow-sm",children:[e.jsx(ms,{setView:r,hasEvent:!!(s&&s.length)}),e.jsx("p",{className:"text-neutral-600",children:"Load an event to open the casino."})]});const u=he.useMemo(()=>ca(s),[s]),d=[];for(let g=0;g<u;g++){let c=-1,o=[];s.forEach(m=>{const M=rs(m.perHole[g],NaN);Number.isFinite(M)&&(M>c?(c=M,o=[m.name]):M===c&&o.push(m.name))}),o.length===1&&c>0&&d.push({hole:g+1,points:c,winner:o[0]})}const A=[];s.forEach(g=>{const c=Na(g,a);if(!c)return;const o=c.pars||[],m=c.si||[],M=Math.round(g.startExact??g.handicap??0);g.perHole.forEach((n,l)=>{const f=Number(n)||0,E=m[l]||0;let D=0;if(E>0&&M>0){const N=Math.floor(M/18),X=M%18;D=N+(X>=E?1:0)}const C=o[l];C&&C+D+2-f===2&&A.push({name:g.name,hole:l+1})})});const x={};return d.forEach(g=>{x[g.winner]||(x[g.winner]=[]),x[g.winner].push(g)}),e.jsxs("section",{className:"content-card p-4 md:p-6",children:[e.jsx(ms,{setView:r,hasEvent:!!(s&&s.length)}),e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("h2",{className:"text-3xl font-black text-squab-900 uppercase tracking-widest drop-shadow-sm",children:"üé∞ The Casino"}),e.jsx("p",{className:"text-sm text-neutral-500 mt-1",children:"Net Skins & The 2s Club"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-squab-100 pb-2 mb-4",children:[e.jsx("h3",{className:"font-bold text-xl text-squab-900",children:"üí∞ Net Skins"}),e.jsx("span",{className:"text-xs bg-emerald-100 text-emerald-800 border border-emerald-200 px-2 py-1 rounded",children:"Unique High Score Wins"})]}),Object.keys(x).length===0?e.jsx("div",{className:"text-center py-8 text-neutral-400 italic",children:"No skins won. Everyone tied!"}):e.jsx("div",{className:"space-y-3",children:Object.entries(x).sort((g,c)=>c[1].length-g[1].length).map(([g,c])=>e.jsxs("div",{className:"bg-emerald-50 rounded-2xl p-3 flex justify-between items-center border border-emerald-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-white border border-emerald-200 text-emerald-800 font-bold w-8 h-8 rounded-full flex items-center justify-center shadow-sm",children:c.length}),e.jsx("span",{className:"font-semibold text-emerald-900",children:g})]}),e.jsx("div",{className:"flex gap-1 flex-wrap justify-end",children:c.map(o=>e.jsxs("span",{className:"text-xs bg-white border border-emerald-200 px-2 py-1 rounded text-emerald-800 font-mono",children:["H",o.hole," (",o.points,"pts)"]},o.hole))})]},g))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-squab-100 pb-2 mb-4",children:[e.jsx("h3",{className:"font-bold text-xl text-squab-900",children:"‚úåÔ∏è The 2s Club"}),e.jsx("span",{className:"text-xs bg-purple-100 text-purple-800 border border-purple-200 px-2 py-1 rounded",children:"Gross Score of 2"})]}),A.length===0?e.jsx("div",{className:"text-center py-8 text-neutral-400 italic",children:"No 2s recorded today."}):e.jsx("div",{className:"grid grid-cols-2 gap-2",children:A.map((g,c)=>e.jsxs("div",{className:"bg-purple-50 p-3 rounded-2xl border border-purple-100 flex justify-between items-center shadow-sm",children:[e.jsx("span",{className:"font-semibold text-purple-900 text-sm",children:g.name}),e.jsxs("span",{className:"font-bold text-purple-600 font-mono",children:["Hole ",g.hole]})]},c))}),A.length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-neutral-50 rounded-lg text-center border border-neutral-100",children:[e.jsx("div",{className:"text-xs text-neutral-500 uppercase tracking-widest",children:"Total Pot Shares"}),e.jsx("div",{className:"text-2xl font-bold text-squab-900",children:A.length})]})]})]})]})}function Mn({computed:s,courseTees:a,setView:r}){if(!s.length)return e.jsxs("section",{className:"rounded-2xl p-4 bg-white border border-squab-200 shadow-sm",children:[e.jsx(ms,{setView:r,hasEvent:!!(s&&s.length)}),e.jsx("p",{className:"text-neutral-600",children:"Load an event to award trophies."})]});const u=he.useMemo(()=>ca(s),[s]),d=u,g=((a.find(o=>o.gender==="M")||a[0]||{}).si||[]).findIndex(o=>o===1),c=s.map(o=>{const M=(Array.isArray(o.perHole)?o.perHole:[]).map(C=>rs(C,NaN)).slice(0,u).map(C=>Number.isFinite(C)?C:0),n=[];M.includes(0)||n.push({icon:"üõ°Ô∏è",title:"Clean Sheet",desc:"Zero wipes (0 pts) all round."}),M.some(C=>C>=4)&&n.push({icon:"ü¶Ö",title:"The Bandit",desc:"Scored a Net Eagle (4+ pts)."});let l=0,f=0;M.forEach(C=>{C>=3?f++:(l=Math.max(l,f),f=0)}),l=Math.max(l,f),l>=3&&n.push({icon:"üî•",title:"He's on Fire",desc:"3+ points on 3 consecutive holes."});const E=M.slice(0,9).reduce((C,N)=>C+N,0),D=M.slice(9).reduce((C,N)=>C+N,0);return E<12&&D>=17&&n.push({icon:"üê¢",title:"Slow Starter",desc:"Woke up on the Back 9."}),g!==-1&&M[g]>=2&&n.push({icon:"üéØ",title:"The Sniper",desc:"Conquered the Stroke Index 1 hole."}),M[d-1]>=3&&n.push({icon:"üí£",title:"Clutch Finish",desc:"Big points on the finishing hole."}),{name:o.name,badges:n}}).filter(o=>o.badges.length>0).sort((o,m)=>m.badges.length-o.badges.length);return e.jsxs("section",{className:"content-card p-4 md:p-6",children:[e.jsx(ms,{setView:r,hasEvent:!!(s&&s.length)}),e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-squab-900",children:"üèÜ The Trophy Room"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Honoring the heroes, the bandits, and the survivors."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[c.map(o=>e.jsxs("div",{className:"border border-squab-100 rounded-2xl p-4 bg-neutral-50 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3 border-b border-neutral-200 pb-2",children:[e.jsx("h3",{className:"font-bold text-neutral-800",children:o.name}),e.jsxs("span",{className:"text-xs font-semibold bg-squab-100 text-squab-800 px-2 py-0.5 rounded-full",children:[o.badges.length," Award",o.badges.length!==1?"s":""]})]}),e.jsx("div",{className:"space-y-2",children:o.badges.map((m,M)=>e.jsxs("div",{className:"flex items-start gap-3 bg-white p-2 rounded-lg border border-neutral-100",children:[e.jsx("div",{className:"text-2xl",children:m.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-neutral-900",children:m.title}),e.jsx("div",{className:"text-[10px] text-neutral-500 leading-tight",children:m.desc})]})]},M))})]},o.name)),c.length===0&&e.jsx("div",{className:"col-span-full text-center py-10 text-neutral-400 italic",children:"No distinct achievements earned this round. Tough crowd."})]})]})}function En({computed:s,setView:a}){const[r,u]=he.useState("");if(he.useEffect(()=>{s.length&&!r&&u(s[0].name)},[s,r]),!s.length)return e.jsxs("section",{className:"rounded-2xl p-4 bg-white border border-squab-200 shadow-sm",children:[e.jsx(ms,{setView:a,hasEvent:!!(s&&s.length)}),e.jsx("p",{className:"text-neutral-600",children:"Load an event to find your partner."})]});const d=he.useMemo(()=>ca(s),[s]),A=s.find(o=>o.name===r)||s[0],x=A.perHole.map(o=>Number(o)||0),g=s.filter(o=>o.name!==r).map(o=>{const m=o.perHole.map(f=>Number(f)||0);let M=0,n=0;for(let f=0;f<d;f++){const E=x[f],D=m[f];M+=Math.max(E,D),E===0&&D>=2&&n++}const l=M-A.points;return{name:o.name,total:M,synergy:l,coveredWipes:n,points:o.points}}).sort((o,m)=>m.total-o.total),c=g[0];return e.jsxs("section",{className:"content-card p-4 md:p-6",children:[e.jsx(ms,{setView:a,hasEvent:!!(s&&s.length)}),e.jsxs("div",{className:"mb-6 border-b border-squab-100 pb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-squab-900 mb-2",children:"ü§ù The Partner Simulator"}),e.jsx("p",{className:"text-sm text-neutral-500 mb-4",children:'Who complements your game? We calculated the "Better Ball" score for every possible partnership.'}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4 bg-squab-50 p-4 rounded-2xl border border-squab-100",children:[e.jsxs("div",{className:"flex flex-col w-full sm:w-auto",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-squab-600 mb-1",children:"Select Player"}),e.jsx("select",{className:"p-2 rounded-lg border border-squab-200 bg-white font-semibold text-squab-900 focus:ring-2 focus:ring-emerald-500 outline-none",value:r,onChange:o=>{const m=o.target.value;u(m),window.umami&&window.umami.track("Check Partner",{player:m})},children:s.map(o=>e.jsx("option",{value:o.name,children:o.name},o.name))})]}),e.jsx("div",{className:"hidden sm:block text-2xl text-squab-300",children:"‚Üí"}),e.jsxs("div",{className:"flex-1 w-full",children:[e.jsx("div",{className:"text-xs text-squab-600 font-bold uppercase mb-1",children:"Best Match"}),c?e.jsxs("div",{className:"flex items-center justify-between bg-white p-3 rounded-lg border border-squab-200 shadow-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-lg text-emerald-700",children:c.name}),e.jsxs("div",{className:"text-[10px] text-neutral-500",children:["Saved you on ",c.coveredWipes," holes"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-black text-squab-600",children:c.total}),e.jsx("div",{className:"text-[10px] font-bold text-emerald-500 uppercase tracking-wide",children:"Combined Pts"})]})]}):e.jsx("div",{className:"text-sm text-neutral-400",children:"Not enough players"})]})]})]}),e.jsxs("div",{className:"overflow-hidden rounded-2xl border border-neutral-200",children:[e.jsxs("table",{className:"w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-neutral-50 border-b border-neutral-200 text-neutral-500",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 font-semibold",children:"Partner"}),e.jsx("th",{className:"p-3 font-semibold",children:"Their Score"}),e.jsx("th",{className:"p-3 font-semibold text-center",children:"Synergy"}),e.jsx("th",{className:"p-3 font-semibold text-right",children:"Team Total"})]})}),e.jsx("tbody",{className:"divide-y divide-neutral-100",children:g.slice(0,10).map((o,m)=>e.jsxs("tr",{className:"hover:bg-neutral-50 transition-colors",children:[e.jsxs("td",{className:"p-3 font-medium text-neutral-800",children:[m===0?"ü•á ":m===1?"ü•à ":m===2?"ü•â ":"",o.name]}),e.jsx("td",{className:"p-3 text-neutral-500",children:o.points}),e.jsx("td",{className:"p-3 text-center",children:e.jsxs("span",{className:"inline-block px-2 py-1 bg-emerald-100 text-emerald-700 text-xs font-bold rounded-md",children:["+",o.synergy," pts"]})}),e.jsx("td",{className:"p-3 text-right font-bold text-lg text-squab-700",children:o.total})]},o.name))})]}),e.jsx("div",{className:"bg-neutral-50 p-2 text-center text-[10px] text-neutral-400",children:"Showing Top 10 potential partners"})]})]})}function In({computed:s,setView:a}){var l,f;const[r,u]=he.useState(0),[d,A]=he.useState(!1),[x,g]=he.useState(800),c=he.useMemo(()=>ca(s),[s]),o=he.useMemo(()=>{if(!s.length)return[];const E=[];E.push(s.map(D=>({name:D.name,total:0,lastHolePts:0,color:"#e5e7eb"})));for(let D=0;D<c;D++){const N=E[D].map(X=>{const J=s.find(Z=>Z.name===X.name),I=Number(J.perHole[D])||0,V=X.total+I;let te="#94a3b8";return I>=3&&(te="#10b981"),I===0&&(te="#ef4444"),{name:X.name,total:V,lastHolePts:I,color:te}});N.sort((X,J)=>J.total-X.total),E.push(N)}return E},[s]);if(he.useEffect(()=>{let E=null;return d&&r<c?E=setInterval(()=>{u(D=>D>=c?(A(!1),c):D+1)},x):r===c&&A(!1),()=>clearInterval(E)},[d,r,x]),!s.length)return e.jsxs("section",{className:"rounded-2xl p-4 bg-white border border-squab-200 shadow-sm",children:[e.jsx(ms,{setView:a,hasEvent:!!(s&&s.length)}),e.jsx("p",{className:"text-neutral-600",children:"Load an event to watch the replay."})]});const m=o[r]||[],M=m.slice(0,10),n=Math.max(...m.map(E=>E.total),10);return e.jsxs("section",{className:"rounded-2xl p-4 md:p-6 bg-white border border-squab-200 shadow-sm transition-all",children:[e.jsx(ms,{setView:a,hasEvent:!!(s&&s.length)}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between mb-6 border-b border-squab-100 pb-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-squab-900",children:"üì∫ The Replay Room"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Watch the round unfold hole-by-hole."})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-neutral-50 p-2 rounded-2xl border border-neutral-200",children:[e.jsx("button",{onClick:()=>{u(0),A(!0)},className:"w-10 h-10 flex items-center justify-center rounded-lg bg-white text-neutral-700 border border-neutral-300 font-bold hover:bg-neutral-50 transition-colors",title:"Restart & Play",children:"‚Üª"}),e.jsx("button",{onClick:()=>A(!d),className:"w-24 h-10 flex items-center justify-center rounded-lg bg-neutral-900 text-white font-bold hover:bg-neutral-800 transition-colors shadow-sm",children:d?"PAUSE":r===c?"DONE":"PLAY ‚ñ∂"}),e.jsxs("div",{className:"flex flex-col px-2",children:[e.jsx("label",{className:"text-[9px] font-bold text-neutral-600 uppercase",children:"Speed"}),e.jsx("input",{type:"range",min:"100",max:"1500",step:"100",className:"w-20 accent-neutral-900 h-1.5 bg-neutral-200 rounded-lg appearance-none cursor-pointer",value:1600-x,onChange:E=>g(1600-Number(E.target.value))})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex justify-between items-end mb-2 px-1",children:[e.jsx("div",{className:"text-4xl font-black text-neutral-900",children:r===0?"START":`HOLE ${r}`}),r>0&&r<c&&e.jsx("div",{className:"animate-pulse text-xs font-bold text-emerald-600 uppercase tracking-widest",children:"‚óè Live Updates"})]}),e.jsx("div",{className:"w-full bg-neutral-100 h-2 rounded-full mb-6 overflow-hidden",children:e.jsx("div",{className:"bg-neutral-900 h-full transition-all duration-300 ease-linear",style:{width:`${r/c*100}%`}})}),e.jsx("div",{className:"space-y-2 min-h-[400px]",children:M.map((E,D)=>e.jsxs("div",{className:"relative flex items-center gap-3 transition-all duration-500 ease-in-out",style:{transform:"translateY(0px)"},children:[e.jsx("div",{className:"w-6 text-right text-xs font-bold text-neutral-400 font-mono",children:D+1}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-xs font-bold text-squab-900 truncate w-32",children:E.name}),r>0&&E.lastHolePts>=3&&e.jsx("span",{className:"text-[9px] bg-emerald-100 text-emerald-700 px-1 rounded animate-bounce",children:"üî• 3pts"}),r>0&&E.lastHolePts===0&&e.jsx("span",{className:"text-[9px] bg-red-100 text-red-700 px-1 rounded",children:"‚ùå Wipe"})]}),e.jsx("div",{className:"relative h-8 bg-neutral-50 rounded-r-lg w-full",children:e.jsx("div",{className:"h-full rounded-r-lg flex items-center justify-end px-2 text-white text-xs font-bold shadow-sm transition-all duration-700 ease-out",style:{width:`${Math.max(E.total/n*100,2)}%`,backgroundColor:r===0?"#cbd5e1":E.color},children:E.total})})]})]},E.name))}),r===c&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 backdrop-blur-sm z-10 rounded-2xl",children:e.jsxs("div",{className:"bg-white border-2 border-emerald-500 p-8 rounded-2xl shadow-2xl text-center transform scale-110",children:[e.jsx("div",{className:"text-6xl mb-2",children:"üèÜ"}),e.jsx("div",{className:"text-sm font-bold text-neutral-400 uppercase tracking-widest",children:"Winner"}),e.jsx("div",{className:"text-3xl font-black text-squab-900",children:(l=M[0])==null?void 0:l.name}),e.jsxs("div",{className:"text-xl font-bold text-squab-600",children:[(f=M[0])==null?void 0:f.total," Points"]}),e.jsx("button",{onClick:()=>{u(0),A(!0)},className:"mt-4 text-xs underline text-neutral-500 hover:text-squab-600",children:"Replay"})]})})]})]})}function yr(s,a=2){const r=s==null||s===""?NaN:Number(s);if(!Number.isFinite(r))return"‚Äî";const u=Number.isFinite(a)?Math.max(0,Math.min(6,a)):2;let d;try{d=new Intl.NumberFormat(void 0,{minimumFractionDigits:u,maximumFractionDigits:u}).format(r)}catch{d=r.toFixed(u)}return r>0?`+${d}`:d}export{$n as default};
